<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Transport Layer</title>
    <link rel="StyleSheet" href="css/Chapter%204-3.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <div>
      <img src="snt-logo-text2-transparent-small.png" />
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Chapter%204-1.05.1.html#1045364">4	Developing Protocol Models in QualNet</a> &gt; 4.3  Transport Layer</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading1Numbered">4.3  <a name="1045364">Transport Layer</a></div>
      <div class="BodyAfterHead"><a name="1045365">The Transport Layer resides between the Application and Network Layers in the </a><span class="Variable">QualNet</span> protocol stack, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-1.05.1.html#993736', '');" title="Developing Protocol Models in QualNet">Figure&nbsp;4-1</a></span>. The Transport Layer provides the service of transporting Application Layer data between the client and the server of an application. The Transport Layer uses Network Layer services to provide a data delivery service to the Application Layer. The Transport Layer provides services for both connection-mode transmissions and for connectionless-mode transmissions. </div>
      <div class="Body"><a name="933702">When the Application Layer sends a data packet to the Transport Layer, the Transport Layer header is appended to the packet, and the packet is passed down to the next layer, the Network Layer. Similarly, when the Transport Layer receives a packet from the Network Layer, it removes the Transport Layer header from the data packet and sends the packet up to the Application Layer.</a></div>
      <div class="BodyAfterHead"><a name="1004654">This section gives a detailed description of how to add a Transport Layer protocol to </a><span class="Variable">QualNet</span>.</div>
      <div class="Heading2Numbered">4.3.1  <a name="933415">Transport Layer Protocols in </a><span class="Variable">QualNet</span></div>
      <div class="BodyAfterHead"><a name="1077612">The Transport Layer of the TCP/IP protocol suite consists of two protocols, UDP and TCP. UDP provides an unreliable connectionless delivery service to send and receive messages. TCP provides a reliable delivery service on top of the IP datagram delivery service. </a><span class="Variable">QualNet</span> also supports the Multicast Dissemination Protocol (MDP), which is a reliable multicast transport protocol built on top of the generic UDP/IP multicast transport. <span class="Variable">QualNet</span> also provides an extension of RSVP (RSVP-TE) that is used to Label Switch Path (LSP) determination for MPLS (Multiprotocol Label Switching).</div>
      <div class="Body"><a name="1067133">See </a><span style="font-style: italic">Developer Model Library</span> for a description of <span class="Variable">QualNet</span>’s MDP, UDP, and TCP models and the MPLS section of <span style="font-style: italic">Multimedia and Enterprise Model Library </span>for a description of <span class="Variable">QualNet</span>’s RSVP-TE model.</div>
      <div class="Heading3Numbered">4.3.1.1  <a name="933465">Multicast Dissemination Protocol (MDP)</a></div>
      <div class="BodyAfterHead"><a name="1077653">The Multicast Dissemination Protocol (MDP) is a transport protocol which allows data to be reliably transmitted from a source (server) to a set of receivers on top of the generic UDP/IP multicast transport. MDP is well suited for reliable multicast bulk transfer of data across a heterogeneous inter-network. At its core, it is an efficient negative acknowledgement (NACK) based reliable multicast protocol and also includes an optional adaptive end-to-end rate-based congestion control mode.</a></div>
      <div class="Heading3Numbered">4.3.1.2  <a name="1077638">User Datagram Protocol (UDP)</a></div>
      <div class="BodyAfterHead"><a name="933473">The User Datagram Protocol (UDP) offers only a minimal transport service, i.e., an unreliable datagram delivery. UDP is a connectionless protocol, and, hence, does not incur the delay associated with connection establishment. UDP also has a smaller header than TCP. Lastly, UDP does not implement any congestion control mechanism, which means that although some packets may be lost, the packets that are delivered incur minimum transmission delay. These features make UDP suitable for certain applications. </a></div>
      <div class="Body"><a name="933736">In </a><span class="Variable">QualNet</span>, the CBR (constant bit rate) is an example of an application that uses UDP at the Transport Layer. </div>
      <div class="Heading3Numbered">4.3.1.3  <a name="933474">Transmission Control Protocol (TCP)</a></div>
      <div class="BodyAfterHead"><a name="1056790">TCP, Transmission Control Protocol, is a Transport Layer connection-oriented byte stream protocol. This protocol is typically used by applications that require guaranteed delivery. To provide a reliable transport service, TCP implements a connection management mechanism, maintains the connection state in the end systems, and implements a congestion control mechanism.</a></div>
      <div class="Heading4"><a name="1056791">TCP Variants in </a><span class="Variable">QualNet</span></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="1056795">QualNet</a></span> TCP implementation supports the following TCP variants:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="933922">Abstract TCP: Abstract TCP is based on TCP Reno. It omits some features oF TCP Reno to improve runtime performance at the cost of reduced fidelity.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1077572">TAHOE: This TCP variant implements three TCP congestion control algorithms, namely Slow Start, Congestion Avoidance, and Fast Retransmit.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="933923">RENO: This TCP variant extends TAHOE to include a fourth congestion control algorithm called Fast Recovery.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="933924">LITE: This TCP variant extends RENO by including two additional options, namely Big Window and Protection Against Wrapped Sequence Numbers.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="933925">NEWRENO: This TCP variant is the same as RENO except for a modification to Fast Recovery (i.e., an ACK for highest sequence number sent must be received to exit Fast Recovery).</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="933926">SACK: This TCP variant is an extension of RENO that includes Selective Acknowledgements and Selective Retransmissions.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1034809">Abstract: This TCP variant is based on RENO. It simplifies and omits some features to improve the performance.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="933842">Examples of TCP-based applications implemented in </a><span class="Variable">QualNet</span> are FTP, FTP/GEN and HTTP. </div>
      <div class="Heading3Numbered">4.3.1.4  <a name="933483">Reservation Protocol with Traffic Engineering (RSVP-TE)</a></div>
      <div class="BodyAfterHead"><a name="1056773">Reservation Protocol (RSVP) is a control protocol in the Transport Layer. This protocol is not used to transmit data from one node to another. This is only used as a control protocol in the Transport Layer and determines the resources in a path from a source to a destination for the quality of service requested. At present, </a><span class="Variable">QualNet</span> does not support the basic RSVP service but implements an extension of RSVP called Reservation Protocol with Traffic Engineering (RSVP-TE). RSVP-TE is an extension of RSVP for establishing Label Switched Paths (LSPs) in Multiprotocol Switching Paths (MPLS) networks, with or without resource reservations. When a LSP is established between two MPLS nodes, packets can be delivered through this LSP tunnel without considering IP Layer routing techniques. </div>
      <div class="Heading2Numbered">4.3.2  <a name="933421">Transport Layer Organization: Files and Folders</a></div>
      <div class="BodyAfterHead"><a name="994757">In this section, we briefly examine the files and folders that are relevant to Transport Layer protocols. These files contain detailed comments on functions and other code components.</a></div>
      <div class="Body"><a name="1056740">The Transport Layer API is composed of several macros, functions, and structures. These are defined in the following header files:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1056741">QUALNET_HOME</a></span>/include/api.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1056742">This file defines the events and data structures needed to communicate between different layers of the protocol stack.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="933973">QUALNET_HOME</a></span>/include/transport.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="933974">This file contains definitions common to Transport Layer protocols and transport data structure in the node structure.</a></div>
      <div class="Body"><a name="1056725">Additionally, the following header file is also relevant to the Transport Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1056726">QUALNET_HOME</a></span>/include/fileio.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1056727">This file contains prototypes of functions to read input files and create output files. </a></div>
      <div class="Body"><a name="938909"> The following are the folders and source files associated with the Transport Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1034836">QUALNET_HOME</a></span>/main/transport.cpp</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1034837">This file contains Transport Layer functions, including the initialization, message processing, and finalization functions.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="994773">QUALNET_HOME</a></span>/libraries/developer/src</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1056706">This folder contains the source and header files for the UDP protocol and the various TCP versions.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1056707">QUALNET_HOME</a></span>/libraries/multimedia_enterprise/src </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1056708">This folder contains the source and header files the RSVP-TE implementation in </a><span class="Variable">QualNet</span>.</div>
      <div class="Heading2Numbered">4.3.3  <a name="916187">Transport Layer Data Structures</a></div>
      <div class="BodyAfterHead"><a name="1006811">The Transport Layer data structures are defined in </a><span class="Variable">QUALNET_HOME</span>/include/transport.h. This section describes the main data structures. (Note that only a partial description of the data structures is provided here. Refer to file transport.h for a complete description.)</div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1006812">TransportProtocol</a></span>: This is an enumeration type that lists all the Transport Layer protocols. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1006813">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="994838">typedef enum {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996481">			TransportProtocol_UDP,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996476">			TransportProtocol_TCP,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996477">			TransportProtocol_RSVP</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996480">} TransportProtocol;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="994863">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="994839">TransportData</a></span>: This is the main data structure used by the Transport Layer and stores information about all protocols running at the Transport Layer. It also stores a Boolean variable for each non-mandatory protocol to indicate whether the protocol is enabled or disabled in the configuration.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="994840">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="994841">struct TransportData</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996482">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996483">			TransportDataUdp* udp;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996484">			int tcpType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1036203">			void* tcp;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996485">			BOOL rsvpProtocol;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996486">			void *rsvpVariable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996487">}</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999666">&nbsp;</a></div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="font-size: 10.0pt"><a name="994834">udp</a></span><span style="font-family: Arial">: Pointer the data structure for the UDP protocol.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1036204">tcpType</a></span><span style="font-family: Arial; font-size: 9.0pt">: Variable that indicates the TCP protocol type (TCP regular or TCP Abstract)</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="font-size: 10.0pt"><a name="994974">tcp</a></span><span style="font-family: Arial">: Pointer to the data structure for the TCP protocol.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="font-size: 10.0pt"><a name="994978">rsvpProtocol</a></span><span style="font-family: Arial">: Flag that indicates whether the RSVP-TE protocol is enabled.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="font-size: 10.0pt"><a name="994950">rsvpVariable</a></span><span style="font-family: Arial">: Pointer to the data structure for the RSVP-TE protocol.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading2Numbered">4.3.4  <a name="1007019">Transport Layer APIs and Inter-layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1007020">This section describes the APIs used by the Application Layer to communicate with the Transport Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1007021', '');" title="Transport Layer">Section&nbsp;4.3.4.1</a></span>), message types that are used by the Transport Layer to communicate with the Application Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1007295', '');" title="Transport Layer">Section&nbsp;4.3.4.2</a></span>), the API used by Transport Layer protocols to communicate with the Network Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1007178', '');" title="Transport Layer">Section&nbsp;4.3.4.3</a></span>), and the message type used by the Network Layer to communicate with the Transport Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1007037', '');" title="Transport Layer">Section&nbsp;4.3.4.4</a></span>).</div>
      <div class="Body"><a name="1007373">The complete list of APIs, with their parameters and description, can be found in </a><span style="font-style: italic">API Reference Guide</span>.</div>
      <div class="Heading3Numbered">4.3.4.1  <a name="1007021">Application Layer to Transport Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1007117">Application Layer protocols use several APIs to communicate with the Transport Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1005871', '');" title="Application Layer">Section&nbsp;4.2.4.1</a></span>). The file <span class="Variable">QUALNET_HOME</span>/main/app_util.cpp contains the implementation of these functions. These APIs are implemented using messages. The message types used in the implementation of these APIs are enumerated in the file <span class="Variable">QUALNET_HOME</span>/include/api.h. Some of the message types used by the Application Layer to communicate with the Transport Layer are listed below.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007127">MSG_TRANSPORT_FromAppSend</a></span>: This message type is used by the Application Layer to send data to the Transport Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007141">MSG_TRANSPORT_FromAppListen</a></span>: This message type is used by the Application Layer to direct TCP to listen on a port.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007145">MSG_TRANSPORT_FromAppOpen</a></span>: This message type is used by the Application Layer to request TCP to open a TCP connection.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007293">MSG_TRANSPORT_FromAppClose</a></span>: This message type is used by the Application Layer to request TCP to close a TCP connection.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.3.4.2  <a name="1007295">Transport Layer to Application Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1007296">Transport Layer protocols communicate with the Application Layer by means of messages. The message types used for this communication are enumerated in the file api.h. Some of the message types used by Transport Layer protocols to communicate with the Application Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007031">MSG_APP_FromTransport</a></span>: This message type is used by UDP to pass an incoming packet to the Application Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007032">MSG_APP_FromTransOpenResult</a></span>: This message type is used by TCP to notify an application client that a TCP connection request was accepted or rejected.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007033">MSG_APP_FromTransDataSent</a></span>: This message type is used by TCP to indicate to the Application Layer that an outgoing packet has been transmitted.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007034">MSG_APP_FromTransDataReceived</a></span>: This message type is used by TCP to pass an incoming packet to the Application Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007035">MSG_APP_FromTransListenResult</a></span>: This message type is used by TCP to notify an application server that a request to open a TCP connection has been received.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1007036">MSG_APP_FromTransCloseResult</a></span>: This message type is used by TCP to notify an application client or server that a TCP connection has been closed.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.3.4.3  <a name="1007178">Transport Layer to Network Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1007300">The Transport Layer communicates with the Network Layer by using the API NetworkIpReceivePacketFromTransportLayer. This function sends a packet from a Transport Layer protocol (UDP, TCP or RSVP-TE) to the IP protocol at the Network Layer. The prototype for this function is contained in the file </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.h. The file <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.cpp contains the implementation of NetworkIpReceivePacketFromTransportLayer.</div>
      <div class="Heading3Numbered">4.3.4.4  <a name="1007037">Network Layer to Transport Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1007221">The IP protocol at the Network Layer uses several APIs to communicate with the Transport Layer protocols: SendToUdp, SendToTcp, SendToRsvp, and SendToTransport (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1009546', '');" title="Network Layer">Section&nbsp;4.4.4.2</a></span>). The prototype for this function is contained in the file network_ip.h. The file network_ip.cpp contains the implementation of these functions. These APIs are implemented using messages. These messages use the message type <span style="font-family: &quot;Courier New&quot;">MSG_TRANSPORT_FromNetwork</span>, which is used to pass incoming packets to Transport Layer protocols. </div>
      <div class="Heading2Numbered">4.3.5  <a name="933447">Adding a Transport Layer Protocol</a></div>
      <div class="BodyAfterHead"><a name="934925">This section provides an overview of the flow of a Transport Layer protocol and provides an outline for developing and adding a new Transport Layer protocol to </a><span class="Variable">QualNet</span>. It describes how to develop code components common to most transport protocols, such as initializing, sending and receiving packets, and collecting statistics.</div>
      <div class="Body"><a name="995157">We illustrate the process of adding a Transport Layer protocol by using as an example the implementation code for UDP. The header file for the UDP implementation is transport_udp.h and the source file is transport_udp.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. We use code segments from these two files throughout this section to illustrate different steps in writing a transport protocol. After understanding the discussed snippets, look at the complete code for UDP to understand how a transport protocol is implemented in <span class="Variable">QualNet</span>.</div>
      <div class="Body"><a name="1056959">The following list summarizes the actions that need to be performed for adding a Transport Layer protocol to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1056963">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992938', '');" title="Transport Layer">Section&nbsp;4.3.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995166">Modify the file transport.cpp to include the protocol’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992938', '');" title="Transport Layer">Section&nbsp;4.3.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995170">Include the protocol in the list of Transport Layer protocols and trace protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1006251', '');" title="Transport Layer">Section&nbsp;4.3.5.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995174">Define data structures for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996018', '');" title="Transport Layer">Section&nbsp;4.3.5.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995178">Decide on the format for the protocol-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992947', '');" title="Transport Layer">Section&nbsp;4.3.5.5.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995179">Read the protocol’s configuration parameters and call the protocol’s initialization function from the Transport Layer initialization function, TRANSPORT_Initialize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992963', '');" title="Transport Layer">Section&nbsp;4.3.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995183">Write the initialization function for the protocol. The initialization function should include the following tasks:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="995187">Declare and initialize the state variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#995358', '');" title="Transport Layer">Section&nbsp;4.3.5.5.3.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="995195">Initialize timers (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993325', '');" title="Transport Layer">Section&nbsp;4.3.5.5.3.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995196">Call the protocol event dispatcher from the Transport Layer event dispatcher, TRANSPORT_ProcessEvent (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#933642', '');" title="Transport Layer">Section&nbsp;4.3.5.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1004528">Declare any new event types used by the protocol in the header file api.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993353', '');" title="Transport Layer">Section&nbsp;4.3.5.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995203">Write the protocol event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993353', '');" title="Transport Layer">Section&nbsp;4.3.5.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995349">Integrate the protocol with the Network Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1006366', '');" title="Transport Layer">Section&nbsp;4.3.5.8</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="999783">Define an IP Protocol Number for the protocol.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1000117">Write a function to deliver packets from IP to the protocol.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1000121">Call the function to deliver packets from IP to the protocol from the IP function DeliverPacket.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995208">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="995212">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993123', '');" title="Transport Layer">Section&nbsp;4.3.5.9.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="995216">Initialize the statistics variables in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#936225', '');" title="Transport Layer">Section&nbsp;4.3.5.9.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="995220">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#936297', '');" title="Transport Layer">Section&nbsp;4.3.5.9.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="995224">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993131', '');" title="Transport Layer">Section&nbsp;4.3.5.9.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1067212">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1067242', '');" title="Transport Layer">Section&nbsp;4.3.5.9.5</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995225">Call the protocol finalization function from the Transport Layer finalization function, TRANSPORT_Finalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#999396', '');" title="Transport Layer">Section&nbsp;4.3.5.10.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995232">Write the protocol finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993555', '');" title="Transport Layer">Section&nbsp;4.3.5.10.2</a></span>). Call the function to print statistics from the protocol finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="995240">Include the protocol header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1056868', '');" title="Transport Layer">Section&nbsp;4.3.5.11</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1067230">To make the protocol available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1067274', '');" title="Transport Layer">Section&nbsp;4.3.5.12</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.3.5.1  <a name="933570">Naming Guidelines</a></div>
      <div class="BodyAfterHead"><a name="1056942">In </a><span class="Variable">QualNet</span>, each component (file, data structure, function, etc.) is given a name that indicates the name of the protocol, the layer in which the protocol resides, and the functionality of the component, as appropriate. We recommend that when adding a new protocol, the programmer name the different components of the new protocol in a similar manner. It will be helpful to examine the implementation of UDP in <span class="Variable">QualNet</span> for hints for naming and coding different components of the new protocol.</div>
      <div class="Body"><a name="995399">In this section, we describe the steps for developing a Transport Layer protocol called “MYPROTOCOL”. We will use the string “Myprotocol” in the names of the different components of this protocol, just as the string “Udp” appears in the names of the components of the UDP implementation. </a></div>
      <div class="Heading3Numbered">4.3.5.2  <a name="992938">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1034877">The first step towards adding a transport protocol is creating files. Most models comprise two files: the header file and the source file. These files can be placed in any library, e.g., in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. However, it is recommended that all user-developed models be made part of a separate library. In our example, we will place the transport model in a library called user_models. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#954568', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10</a></span> for instructions for creating and activating a library.</div>
      <div class="BodyAfterHead"><a name="1056658">If it doesn’t already exist, create a directory in </a><span class="Variable">QUALNET_HOME</span>/libraries called user_models and a subdirectory in <span class="Variable">QUALNET_HOME</span>/libraries/user_models called src. Create the files for the transport model and place them in the folder <span class="Variable">QUALNET_HOME</span>/libraries/user_models/src. Name these files in a way that clearly indicates the model that they implement. Prefix the file names with <span style="font-style: italic">transport_</span> to designate the files as transport model files.</div>
      <div class="Body"><a name="934944">	Examples:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="934945">transport_udp.cpp, transport_udp.h: Implement UDP (User Datagram Protocol)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="934946">transport_rsvp.cpp, transport_rsvp.h: Implement RSVP-TE (Reservation Protocol with Traffic Engineering)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="995434">In keeping with the naming guidelines of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1067230', '');" title="Transport Layer">Section&nbsp;16</a></span>, the header file for the example protocol is called transport_myprotocol.h, and the source file is called transport_myprotocol.cpp.</div>
      <div class="Note_Indented"><a name="934948"><img class="Default" src="images/Chapter%204-3.07.1.1.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems, even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="934957">While adding code to the files, it is important to organize the code well between the files. Generally, the header file, transport_myprotocol.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="934958">	Prototypes for interface functions in source file, transport_myprotocol.cpp</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="934959">	Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="934960">	Data structure definitions and data types: </a><span style="font-family: &quot;Courier New&quot;">struct</span> and <span style="font-family: &quot;Courier New&quot;">enum</span> declarations</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="995469">The source file, transport_myprotocol.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="995451">Statement to include the protocol’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="995452">	</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="995733">#include “transport_myprotocol.h”</a></span></div>
      <div class="Code_Segment"><a name="995734">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="995460">Statements to include standard library functions and other header files needed by the protocol source file. A typical protocol source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="995461">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="995738">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="995462">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="995463">#include &lt;string.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="995464">#include "api.h"     </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1034992">#include "partition.h"</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1035007">#include "network_ip.h"  </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="995739">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004458">Protocol initialization function, TransportMyprotocolInit</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004459">Protocol event dispatcher function, TransportMyprotocolLayer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004460">Protocol finalization function, MyprotocolFinalize</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004461">Additional protocol implementation functions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="995482">The file </a><span class="Variable">QUALNET_HOME</span>/main/transport.cpp contains the layer level initialization, event dispatcher, and finalization functions. These layer level functions in turn call the protocol functions TransportMyprotocolInit, TransportMyprotocolLayer, and MyprotocolFinalize. Therefore, to make these protocol functions available to the layer level functions, insert the following include statement in the file transport.cpp:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1006249">	</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1077740">#include “transport_myprotocol.h”</a></span></div>
      <div class="Heading3Numbered">4.3.5.3  <a name="1006251">Including MYPROTOCOL in List of Transport Protocols</a></div>
      <div class="BodyAfterHead"><a name="1006252">Each node in </a><span class="Variable">QualNet</span> hosts an operating protocol stack. For each layer in the stack, a list of protocols running at that layer is maintained. When a new Transport Layer protocol is added to <span class="Variable">QualNet</span>, it needs to be included in the list of Transport Layer protocols. To do this, add the protocol name to the enumeration <span style="font-family: &quot;Courier New&quot;">TransportProtocol</span> defined in transport.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#916187', '');" title="Transport Layer">Section&nbsp;4.3.3</a></span>). </div>
      <div class="Body"><a name="995928">For our example protocol, add the entry </a><span style="font-family: &quot;Courier New&quot;; font-size: 9.0pt">MYPROTOCOL</span> to <span style="font-family: &quot;Courier New&quot;">TransportProtocol</span><span style="font-size: 9.0pt"> </span>as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1035791', '');" title="Transport Layer">Figure&nbsp;4-49</a></span>.</div>
      <div class="Code_Segment"><a name="995919">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995973">typedef enum {<br />			TransportProtocol_UDP,</a></div>
      <div class="Code_Segment"><a name="995978">			TransportProtocol_TCP,</a></div>
      <div class="Code_Segment"><a name="995979">			TransportProtocol_RSVP,</a></div>
      <div class="Code_New"><a name="995977">			TransportProtocol_MYPROTOCOL</a></div>
      <div class="Code_Segment"><a name="1035789">} TransportProtocol;</a></div>
      <div class="Figure">FIGURE 4-49.&nbsp;&nbsp;<a name="1035791">Adding MYPROTOCOL to List of Transport Layer Protocols</a></div>
      <div class="Note_Indented"><a name="1056911"><img class="Default" src="images/Chapter%204-3.07.1.2.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files.</a></div>
      <div class="Body"><span class="Variable"><a name="1056912">QualNet</a></span> provides for detailed traces of packets as they traverse the protocol stack at nodes in the network. A packet trace lists, among other information, the protocol that is handling the packet at the time of the trace. To facilitate tracing, <span class="Variable">QualNet</span> lists all protocols in an enumeration, <span style="font-family: &quot;Courier New&quot;">TraceProtocolType</span>, in the file <span class="Variable">QUALNET_HOME</span>/include/trace.h. For our example protocol, add an entry <span style="font-family: &quot;Courier New&quot;">TRACE_MYPROTOCOL</span> in<span style="font-family: &quot;Courier New&quot;"> TraceProtocolType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1006199', '');" title="Transport Layer">Figure&nbsp;4-50</a></span>.</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1006182">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1006183">typedef enum</a></div>
      <div class="Code_Segment"><a name="1006184">{</a></div>
      <div class="Code_Segment"><a name="1035394">    TRACE_UNDEFINED = 0,</a></div>
      <div class="Code_Segment"><a name="1035395">    TRACE_TCP,                // 1</a></div>
      <div class="Code_Segment"><a name="1035396">    TRACE_UDP,                // 2</a></div>
      <div class="Code_Segment"><a name="1035397">    TRACE_IP,                 // 3</a></div>
      <div class="Code_Segment"><a name="1006189">    TRACE_CBR,                // 4</a></div>
      <div class="Code_Segment"><a name="1035405">    ...</a></div>
      <div class="Code_Segment"><a name="1006193">&nbsp;</a></div>
      <div class="Code_New"><a name="1006194">    TRACE_MYPROTCOL,</a></div>
      <div class="Code_Segment"><a name="1006195">    // Must be last one!!!</a></div>
      <div class="Code_Segment"><a name="1006196">    TRACE_ANY_PROTOCOL</a></div>
      <div class="Code_Segment"><a name="1006197">}TraceProtocolType;</a></div>
      <div class="Figure">FIGURE 4-50.&nbsp;&nbsp;<a name="1006199">Adding MYPROTOCOL to List of Trace Protocols</a></div>
      <div class="Note_Indented"><a name="1006203">Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">TRACE_ANY_PROTOCOL</span>). <img class="Default" src="images/Chapter%204-3.07.1.3.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></div>
      <div class="Body"><a name="1006211">The state information for each transport protocol is stored in </a><span style="font-family: &quot;Courier New&quot;">TransportData</span>. Modify <span style="font-family: &quot;Courier New&quot;">TransportData</span> to include a pointer to the new protocol’s state. Also, if the new protocol is not mandatory, then include a Boolean flag to indicate whether the protocol is enabled. An example of adding a non-mandatory protocol is shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996466', '');" title="Transport Layer">Figure&nbsp;4-51</a></span>. </div>
      <div class="Code_Segment"><a name="996489">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996490">struct struct_transport_str</a></div>
      <div class="Code_Segment"><a name="996491">{</a></div>
      <div class="Code_Segment"><a name="996492">			TransportDataUdp* udp;</a></div>
      <div class="Code_Segment"><a name="996493">			int tcpType;</a></div>
      <div class="Code_Segment"><a name="1036284">			void* tcp;</a></div>
      <div class="Code_Segment"><a name="996494">			BOOL rsvpProtocol;</a></div>
      <div class="Code_Segment"><a name="996495">			void *rsvpVariable;</a></div>
      <div class="Code_New"><a name="996503">			BOOL myprotocolEnabled;								// Flag to indicate if protocol is enabled</a></div>
      <div class="Code_New"><a name="996504">			void *myprotocolVariable								// Pointer to protocol’s state</a></div>
      <div class="Code_Segment"><a name="996496">}</a></div>
      <div class="Figure">FIGURE 4-51.&nbsp;&nbsp;<a name="996466">Adding MYPROTOCOL to TransportData</a></div>
      <div class="Heading3Numbered">4.3.5.4  <a name="996018">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="996031">Each Transport Layer protocol has its own data structures, which are defined in the protocol’s header file. The data structures store information such as:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="996032">Protocol parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992963', '');" title="Transport Layer">Section&nbsp;4.3.5.5.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="996034">Protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992975', '');" title="Transport Layer">Section&nbsp;4.3.5.5.3</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="996035">Statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993123', '');" title="Transport Layer">Section&nbsp;4.3.5.9.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1035024">Define appropriate data structures for your protocol in the protocol header file, transport_myprotocol.h. As an example, the following data structure (defined in transport_udp.h) is used by the UDP protocol:</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1000318">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1000319">struct TransportDataUdpStruct {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1000320">    BOOL udpStatsEnabled;            /* whether to collect stats */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1000321">    TransportUdpStat *statistics;    /* statistics variable*/</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1000322">    BOOL traceEnabled;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1000323">};</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1000324">&nbsp;</a></div>
      <div class="BodyAfterHead"><a name="1000325">In the above declaration, </a><span style="font-family: &quot;Courier New&quot;">TransportUdpStat</span> is the data structure for UDP statistics (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993123', '');" title="Transport Layer">Section&nbsp;4.3.5.9.1</a></span>).</div>
      <div class="Heading3Numbered">4.3.5.5  <a name="992949">Initialization</a></div>
      <div class="BodyAfterHead"><a name="996175">In this section, we describe the tasks that need to be performed as part of the initialization process of a Transport Layer protocol.</a></div>
      <div class="Heading4Numbered">4.3.5.5.1  <a name="992947">Determining the Protocol Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="1027043">A protocol may use protocol-specific configuration parameters. The configuration parameters are specified in the </a><span class="Variable">QualNet</span> configuration file. The format for specifying a protocol’s configuration parameters is:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1027044">[&lt;Identifier&gt;] &lt;Parameter-name&gt; [&lt;Index&gt;] &lt;Parameter-value&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1027045">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="1027046">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1027047"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;	</span>: Node identifier, subnet identifier, or IP address to which this parameter declaration is applicable, enclosed in square brackets. This specification is optional, and if it is not included, the parameter declaration applies to all nodes.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="1027048">&lt;Parameter-name&gt;	</a></span>: Name of the parameter.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1027049"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;	</span>: Instance to which this parameter declaration is applicable, enclosed in square brackets. This is used when there are multiple instances of the parameter. This specification is optional, and if it is not included, the parameter declaration applies to all instances.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><span style="font-family: &quot;Courier New&quot;"><a name="1027050">&lt;Parameter-value&gt;</a></span>	: Value to be used for the parameter.</div>
      <div class="Body"><a name="996329">As an example, the following configuration specifies the TCP variant to be used:</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="935172">TCP   RENO</a></span></div>
      <div class="Body"><a name="935174">A configuration variable is not always mandatory. If an optional configuration variable is not assigned a value in the configuration file, the default value is used. For example, if a user does not specify the TCP variant in the configuration file, the default variant LITE will be used for TCP.</a></div>
      <div class="Body"><a name="935178">The new Transport Layer protocol may not be a mandatory service in the Transport Layer. In that case, use a configuration parameter to enable or disable the protocol. The syntax of this parameter is as follows:</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026978">&nbsp;</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1077767">TRANSPORT-PROTOCOL-&lt;Protocol_name&gt; &lt;status&gt;</a></span></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026979">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 18pt"><a name="1026980">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="1026981">&lt;Parameter-name&gt;	</a></span>: Name of the protocol.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="1026982">&lt;status&gt;	</a></span>: YES, if the protocol is enabled; NO, if the protocol is disabled.</div>
      <div class="Body"><a name="1004809">For our example protocol MYPROTOCOL, the following statement indicates that the protocol is enabled:</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1004810">&nbsp;</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1077774">TRANSPORT-PROTOCOL-MYPROTOCOL YES</a></span></div>
      <div class="Body"><a name="1004811">Define a configuration parameter for the new Transport Layer protocol which determines whether statistics are to be collected for the protocol. If this parameter is set to YES in the configuration file, statistics collection is enabled for the protocol; if the parameter is set to NO, statistics collection is disabled for the protocol. For our example protocol MYPROTOCOL, the following statement indicates that statistics collection is enabled:</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1004799">&nbsp;</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1077781">MYPROTOCOL-STATISTICS YES</a></span></div>
      <div class="Body"><a name="1004790">Decide on the format for specifying the new protocol’s configuration parameters. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992963', '');" title="Transport Layer">Section&nbsp;4.3.5.5.2</a></span> explains how to read user input specified in this format to initialize the protocol.</div>
      <div class="Heading4Numbered">4.3.5.5.2  <a name="992963">Reading Configuration Parameters and Calling the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="993278">QualNet</a></span> can configure a protocol to the parameters specified by the user in the <span class="Variable">QualNet</span> configuration file that sets up the experiment. This section explains how to read these user-specified configuration parameters for the protocol and provide them to the protocol's initialization function.</div>
      <div class="Body"><a name="996426">The protocol stack of each node is initialized in a bottom up manner. The initialization of the Transport Layer thus occurs after the layers below it have been initialized. This process is performed in the node initialization function PARTITION_InitializeNodes, implemented in </a><span class="Variable">QUALNET_HOME</span>/main/partition.cpp<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#919750', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.1</a></span>).</div>
      <div class="Body"><a name="996430">The node initialization function, PARTITION_InitializeNodes, calls the Transport Layer initialization function TRANSPORT_Initialize, which is implemented in the file transport.cpp. Function TRANSPORT_Initialize reads the configuration parameters and stores them in the appropriate data structure, and calls the initialization routine for the protocol as follows:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996586">If the protocol is mandatory, such as UDP and TCP, TRANSPORT_Initialize calls its initialization function, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996620', '');" title="Transport Layer">Figure&nbsp;4-52</a></span>. TransportUdpInit, defined in transport_udp.cpp, is the initialization function for UDP. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996591">If the transport protocol is non-mandatory, such as RSVP-TE, then TRANSPORT_Initialize first finds whether the protocol is enabled by searching the keyword TRANSPORT-PROTOCOL-&lt;protocol_name&gt;. The Boolean flag corresponding to the protocol is set accordingly, and if the protocol is enabled, then its initialization function is called. Function IO_ReadString, defined in </a><span class="Variable">QUALNET_HOME</span>/include/fileio.h, is a utility function that retrieves from an input file the value associated with a string parameter. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="996852">For our example non-mandatory protocol, MYPROTOCOL, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996620', '');" title="Transport Layer">Figure&nbsp;4-52</a></span> gives an example of code to be added to TRANSPORT_Initialize to call the initialization function for MYPROTOCOL. The Boolean variable myprotocolEnabled (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1006251', '');" title="Transport Layer">Section&nbsp;4.3.5.3</a></span>) is set to TRUE or FALSE depending upon the value read from the configuration file (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#992947', '');" title="Transport Layer">Section&nbsp;4.3.5.5.1</a></span>). Function TransportMyprotocolInit is the initialization function of MYPROTOCOL. </div>
      <div class="Code_Segment"><a name="996859">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996686">void TRANSPORT_Initialize(Node * node, const NodeInput * nodeInput)</a></div>
      <div class="Code_Segment"><a name="996626">{</a></div>
      <div class="Code_Segment"><a name="996627">    BOOL wasFound = FALSE;</a></div>
      <div class="Code_Segment"><a name="996628">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="996629">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996630">    node-&gt;transportData.tcp = NULL;</a></div>
      <div class="Code_Segment"><a name="996631">    node-&gt;transportData.udp = NULL;</a></div>
      <div class="Code_Segment"><a name="996632">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996633">    TransportTcpInit(node, nodeInput);</a></div>
      <div class="Code_Segment"><a name="996634">    TransportUdpInit(node, nodeInput);</a></div>
      <div class="Code_Segment"><a name="996635">			...</a></div>
      <div class="Code_Segment"><a name="996749">&nbsp;</a></div>
      <div class="Code_New"><a name="996636">    /* Initialize MYPROTCOL. */</a></div>
      <div class="Code_New"><a name="996808">    </a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="996813">    node-&gt;transportData.myprotocolVariable = NULL;</a></span></div>
      <div class="Code_New"><a name="996709">    IO_ReadString(node-&gt;nodeId, ANY_ADDRESS, nodeInput,</a></div>
      <div class="Code_New"><a name="996710">        							 "TRANSPORT-PROTOCOL-MYPROTOCOL", &amp;wasFound, buf);</a></div>
      <div class="Code_New"><a name="996711">&nbsp;</a></div>
      <div class="Code_New"><a name="996712">    if (wasFound)</a></div>
      <div class="Code_New"><a name="996806">    {</a></div>
      <div class="Code_New"><a name="996807">				if (strcmp(buf, "YES") == 0)</a></div>
      <div class="Code_New"><a name="996713">    				{</a></div>
      <div class="Code_New"><a name="996714">       					 node-&gt;transportData.myprotocolEnabled = TRUE;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="996786">       					 TransportMyprotocolInit(node, nodeInput);</a></span></div>
      <div class="Code_New"><a name="996717">   				}</a></div>
      <div class="Code_New"><a name="996718">    				else</a></div>
      <div class="Code_New"><a name="996719">    				if (strcmp(buf, "NO") == 0)</a></div>
      <div class="Code_New"><a name="996720">    				{</a></div>
      <div class="Code_New"><a name="996721">        					node-&gt;transportData.myprotocolEnabled = FALSE;</a></div>
      <div class="Code_New"><a name="996722">    				}</a></div>
      <div class="Code_New"><a name="996723">    				else</a></div>
      <div class="Code_New"><a name="996724">    				{</a></div>
      <div class="Code_New"><a name="996725">        					ERROR_ReportError("Expecting YES or NO for”</a></div>
      <div class="Code_New"><a name="996726">                        									    "TRANSPORT-PROTOCOL-MYPROTOCOL parameter\n");</a></div>
      <div class="Code_New"><a name="996729">    				}</a></div>
      <div class="Code_New"><a name="996822">			}</a></div>
      <div class="Code_New"><a name="996823">			else  /* Not found */</a></div>
      <div class="Code_New"><a name="996824">			{</a></div>
      <div class="Code_New"><a name="996827">				node-&gt;transportData.myprotocolEnabled = FALSE;</a></div>
      <div class="Code_New"><a name="996825">			}</a></div>
      <div class="Code_Segment"><a name="996707">}</a></div>
      <div class="Figure">FIGURE 4-52.&nbsp;&nbsp;<a name="996620">Calling the Protocol Initialization Function</a></div>
      <div class="Heading4Numbered">4.3.5.5.3  <a name="992975">Implementing the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="996900">The initialization of a Transport Layer protocol takes place in the initialization function of the protocol that is called by the Transport Layer initialization function TRANSPORT_Initialize. The initialization function of a protocol commonly performs the following tasks:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996901">Initialize the state and store the user specified configuration parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004773">Create an instance of the protocol </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996902">Initialize data structures and variables as required, e.g., allocate memory to tables, set default values, etc.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996904">Schedule a timer to itself for starting the protocol</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="996905">Like all other functions belonging to the protocol, the prototype for the initialization function should be included in the protocol's header file, transport_myprotocol.h.</a></div>
      <div class="Heading5Numbered">4.3.5.5.3.1  <a name="995358">Creating an Instance and Initializing the State</a></div>
      <div class="BodyAfterHead"><a name="996937">The initialization function initializes the protocol state. Each protocol has a structure that it uses to store state information. This may include information such as flags, connection information, sequence number, pointers to tables used by the protocol, etc. </a></div>
      <div class="Body"><a name="996938">To store the state, declare the structure to hold the protocol state in the header file, transport_myprotocol.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996018', '');" title="Transport Layer">Section&nbsp;4.3.5.4</a></span>). </div>
      <div class="Body"><a name="996942">Create an instance of the protocol state by allocating memory to the state structure. UDP performs this task in its initialization function TransportUdpInit by calling the function MEM_alloc to allocate memory for the UDP data structure TransportDataUdp, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996962', '');" title="Transport Layer">Figure&nbsp;4-53</a></span>. </div>
      <div class="Body"><a name="1066871">Update the Transport Layer data structure, TransportData, so that the field for the protocol points to the newly created instance of the protocol data structure, e.g., TransportInitUdp updates the udp field of TransportData to point to the newly created instance of the UDP data structure.</a></div>
      <div class="Code_Segment"><a name="1066872">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1066881">void</a></div>
      <div class="Code_Segment"><a name="1066873">TransportUdpInit(Node *node, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="996967">{</a></div>
      <div class="Code_Segment"><a name="996968">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="996969">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="1035479">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996970">    TransportDataUdp* udp =</a></div>
      <div class="Code_Segment"><a name="996971">       (TransportDataUdp*)MEM_malloc(sizeof(TransportDataUdp));</a></div>
      <div class="Code_Segment"><a name="996973">    node-&gt;transportData.udp = udp;</a></div>
      <div class="Code_Segment"><a name="1035480">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996975">    TransportUdpInitTrace(node, nodeInput);</a></div>
      <div class="Code_Segment"><a name="1035478">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996977">    IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="996978">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="996979">        ANY_ADDRESS,</a></div>
      <div class="Code_Segment"><a name="996980">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="996981">        "UDP-STATISTICS",</a></div>
      <div class="Code_Segment"><a name="996982">        &amp;retVal,</a></div>
      <div class="Code_Segment"><a name="996983">        buf);</a></div>
      <div class="Code_Segment"><a name="1066889">    if (retVal == FALSE || strcmp(buf, "NO") == 0)</a></div>
      <div class="Code_Segment"><a name="1066890">    {</a></div>
      <div class="Code_Segment"><a name="1066891">        udp-&gt;udpStatsEnabled = FALSE;</a></div>
      <div class="Code_Segment"><a name="1066892">    }</a></div>
      <div class="Code_Segment"><a name="1066893">    else if (strcmp(buf, "YES") == 0)</a></div>
      <div class="Code_Segment"><a name="1066894">    {</a></div>
      <div class="Code_Segment"><a name="1066895">        udp-&gt;udpStatsEnabled = TRUE;</a></div>
      <div class="Code_Segment"><a name="1066896">    }</a></div>
      <div class="Code_Segment"><a name="1066897">    else</a></div>
      <div class="Code_Segment"><a name="1066898">    {</a></div>
      <div class="Code_Segment"><a name="1066899">        printf("TransportUdp unknown setting (%s) for UDP-STATISTICS.\n", buf);</a></div>
      <div class="Code_Segment"><a name="1066900">        udp-&gt;udpStatsEnabled = FALSE;</a></div>
      <div class="Code_Segment"><a name="1035477">    }</a></div>
      <div class="Code_Segment"><a name="1066912">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035412">    if (udp-&gt;udpStatsEnabled == TRUE)</a></div>
      <div class="Code_Segment"><a name="1035413">    {</a></div>
      <div class="Code_Segment"><a name="1035414">        udp-&gt;statistics = (TransportUdpStat *)</a></div>
      <div class="Code_Segment"><a name="1035415">            MEM_malloc(sizeof(TransportUdpStat));</a></div>
      <div class="Code_Segment"><a name="1035416">        if (udp-&gt;statistics == NULL)</a></div>
      <div class="Code_Segment"><a name="1035417">        {</a></div>
      <div class="Code_Segment"><a name="1035418">            printf("TRANSPORT UDP: cannot allocate memory\n");</a></div>
      <div class="Code_Segment"><a name="1035419">            abort();</a></div>
      <div class="Code_Segment"><a name="1035420">        }</a></div>
      <div class="Code_Segment"><a name="1035421">        memset(udp-&gt;statistics, 0, sizeof(TransportUdpStat));</a></div>
      <div class="Code_Segment"><a name="1035423">        </a></div>
      <div class="Code_Segment"><a name="1035475">        std::string path;</a></div>
      <div class="Code_Segment"><a name="1066931">        D_Hierarchy *h = &amp;node-&gt;partitionData-&gt;dynamicHierarchy;</a></div>
      <div class="Code_Segment"><a name="1035436">        ...</a></div>
      <div class="Code_Segment"><a name="1035447">    }</a></div>
      <div class="Code_Segment"><a name="996963">}</a></div>
      <div class="Figure">FIGURE 4-53.&nbsp;&nbsp;<a name="996962">UDP Initialization Function</a></div>
      <div class="Heading5Numbered">4.3.5.5.3.2  <a name="993325">Initializing Timers</a></div>
      <div class="BodyAfterHead"><a name="993326">In addition to initializing data structures, the initialization function may also initialize timers for the transport protocol. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#920185', '');" title="Discrete-event Simulation in QualNet">Section&nbsp;3.3.2.2</a></span> discusses in detail how to use timers.</div>
      <div class="Heading3Numbered">4.3.5.6  <a name="992983">Implementing the Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="997330">In this section, we describe the steps for implementing the event dispatcher function for a transport protocol. </a></div>
      <div class="Body"><a name="1000409">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#933631', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.2</a></span>, when an event occurs, it is first handled by the node level dispatcher function NODE_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/node.cpp. If the event is for the Transport Layer, NODE_ProcessEvent calls the Transport Layer event dispatcher TRANSPORT_ProcessEvent, defined in transport.cpp. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#933642', '');" title="Transport Layer" name="1000397">Section&nbsp;4.3.5.6.1</a></span> describes how to modify the Transport Layer event dispatcher function to call the transport protocol’s event dispatcher. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993353', '');" title="Transport Layer">Section&nbsp;4.3.5.6.2</a></span> describes how to implement the protocol’s event dispatcher.</div>
      <div class="Heading4Numbered">4.3.5.6.1  <a name="933642">Modifying the Transport Layer Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="997435">Function TRANSPORT_ProcessEvent implements the Transport Layer event dispatcher that informs the appropriate transport protocol of received events. Messages contain the name of the protocol they are destined for. (This is the transport protocol name specified in the enumerated data type </a><span style="font-family: &quot;Courier New&quot;">TransportProtocol</span>, described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#916187', '');" title="Transport Layer">Section&nbsp;4.3.3</a></span>.) The API function MESSAGE_GetProtocol returns the protocol for which the message is destined. TRANSPORT_ProcessEvent implements a switch statement on the protocol name read from the message and calls the appropriate protocol-specific event dispatcher. </div>
      <div class="Body"><a name="997439">To enable the protocol MYPROTOCOL to receive events, add code to TRANSPORT_ProcessEvent to call the protocol's event dispatcher function when messages for the protocol are received. If MYPROTOCOL is a non-mandatory protocol, check if it is enabled before calling its event dispatcher function. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#997424', '');" title="Transport Layer">Figure&nbsp;4-54</a></span> shows a code fragment from TRANSPORT_ProcessEvent with sample code for calling MYPROTOCOL’s event dispatcher function TransportMyprotocolLayer.</div>
      <div class="Code_Segment"><a name="997362">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997412">void</a></div>
      <div class="Code_Segment"><a name="997363">TRANSPORT_ProcessEvent(Node * node, Message * msg)</a></div>
      <div class="Code_Segment"><a name="997364">{</a></div>
      <div class="Code_Segment"><a name="997365">    switch (MESSAGE_GetProtocol(msg))</a></div>
      <div class="Code_Segment"><a name="997366">    {</a></div>
      <div class="Code_Segment"><a name="997367">        case TransportProtocol_UDP:</a></div>
      <div class="Code_Segment"><a name="997368">        {</a></div>
      <div class="Code_Segment"><a name="997369">            TransportUdpLayer(node, msg);</a></div>
      <div class="Code_Segment"><a name="997370">            break;</a></div>
      <div class="Code_Segment"><a name="997371">        }</a></div>
      <div class="Code_Segment"><a name="997372">        case TransportProtocol_TCP:</a></div>
      <div class="Code_Segment"><a name="997373">        {</a></div>
      <div class="Code_Segment"><a name="997374">            TransportTcpLayer(node, msg);</a></div>
      <div class="Code_Segment"><a name="997375">            break;</a></div>
      <div class="Code_Segment"><a name="997376">        }</a></div>
      <div class="Code_Segment"><a name="1035041">        case TransportProtocol_RSVP:</a></div>
      <div class="Code_Segment"><a name="997378">        {</a></div>
      <div class="Code_Segment"><a name="997379">            ...</a></div>
      <div class="Code_Segment"><a name="997503">        }</a></div>
      <div class="Code_New"><a name="997389">        case TransportLayer_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="997508">        {</a></div>
      <div class="Code_New"><a name="1004851">            if (node-&gt;transportData.myprotocolEnabled == FALSE)</a></div>
      <div class="Code_New"><a name="1004852">            {</a></div>
      <div class="Code_New"><a name="1004853">                ERROR_ReportError("MYPROTOCOL is not enabled\n”);</a></div>
      <div class="Code_New"><a name="1004878">             }</a></div>
      <div class="Code_New"><a name="1004864">            TransportMyprotocolLayer(node, msg);</a></div>
      <div class="Code_New"><a name="997510">            break;</a></div>
      <div class="Code_New"><a name="997511">        }</a></div>
      <div class="Code_Segment"><a name="997390">        default:</a></div>
      <div class="Code_Segment"><a name="997391">            assert(FALSE); abort();</a></div>
      <div class="Code_Segment"><a name="997392">            break;</a></div>
      <div class="Code_Segment"><a name="997393">    }//switch//</a></div>
      <div class="Code_Segment"><a name="997394">}</a></div>
      <div class="Figure">FIGURE 4-54.&nbsp;&nbsp;<a name="997424">Transport Layer Event Dispatcher </a></div>
      <div class="Heading4Numbered">4.3.5.6.2  <a name="993353">Implementing the Protocol Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="1056860">A protocol's event dispatcher should include a switch on all message types that the protocol may receive. It can then process each message type either inside the switch or by calling a function to handle the message type received. </a></div>
      <div class="Body"><a name="1056861">All event types used by </a><span class="Variable">QualNet</span> protocols are enumerated in the file api.h. If the protocol being added needs additional event types, these should be included in the enumeration in file api.h, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1000841', '');" title="Transport Layer">Figure&nbsp;4-55</a></span>. </div>
      <div class="Code_Segment"><a name="1000818">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000819">// /**</a></div>
      <div class="Code_Segment"><a name="1000820">// ENUM        :: MESSAGE/EVENT</a></div>
      <div class="Code_Segment"><a name="1000821">// DESCRIPTION :: Event/message types exchanged in the simulation</a></div>
      <div class="Code_Segment"><a name="1000822">// **/</a></div>
      <div class="Code_Segment"><a name="1000823">enum</a></div>
      <div class="Code_Segment"><a name="1000824">{</a></div>
      <div class="Code_Segment"><a name="1000825">    /* Special message types used for internal design. */</a></div>
      <div class="Code_Segment"><a name="1000826">    MSG_SPECIAL_Timer                          = 0,</a></div>
      <div class="Code_Segment"><a name="1000827">    ...</a></div>
      <div class="Code_Segment"><a name="1000828">    /* Message Types for Channel layer */</a></div>
      <div class="Code_Segment"><a name="1000829">    MSG_PROP_SignalArrival                     = 100,</a></div>
      <div class="Code_Segment"><a name="1000830">    MSG_PROP_SignalEnd                         = 101,</a></div>
      <div class="Code_Segment"><a name="1000831">    ...</a></div>
      <div class="Code_Segment"><a name="1000832">    /*</a></div>
      <div class="Code_Segment"><a name="1000833">     * Any other message types which have to be added should be added before</a></div>
      <div class="Code_Segment"><a name="1000834">     * MSG_DEFAULT. Otherwise the program will not work correctly.</a></div>
      <div class="Code_Segment"><a name="1000835">     */</a></div>
      <div class="Code_New"><a name="1004725">    MSG_TRANSPORT_PROTOCOL_NewEvent1,</a></div>
      <div class="Code_New"><a name="1000837">    MSG_TRANSPORT_PROTOCOL_NewEvent2,</a></div>
      <div class="Code_Segment"><a name="1000838">    MSG_DEFAULT                                = 10000</a></div>
      <div class="Code_Segment"><a name="1000839">};</a></div>
      <div class="Figure">FIGURE 4-55.&nbsp;&nbsp;<a name="1000841">Declaring New Event Types</a></div>
      <div class="Note_Indented"><a name="1035808"><img class="Default" src="images/Chapter%204-3.07.1.4.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">MSG_DEFAULT</span>).</div>
      <div class="Body"><a name="997557">The event dispatcher function for a protocol that provides a transport service, such as UDP and TCP, is different from the event dispatcher for a protocol that provides a supplemental or auxiliary service, such as RSVP-TE. In the former case, the protocol interacts with both Application and Network Layers, while in the latter case, the protocol interacts only with the Network Layer. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#997562', '');" title="Transport Layer">Section&nbsp;4.3.5.6.2.1</a></span> describes the event dispatcher for UDP and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#997578', '');" title="Transport Layer">Section&nbsp;4.3.5.6.2.2</a></span> describes the event dispatcher for RSVP-TE. </div>
      <div class="Body"><a name="1004738">Write MYPROTOCOL’s event dispatcher function, TransportMyprotocolLayer, using UDP or RSVP-TE as an example. Include the prototype for TransportMyprotocolLayer in the protocol's header file, transport_myprotocol.h.</a></div>
      <div class="Heading5Numbered">4.3.5.6.2.1  <a name="997562">UDP Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="997595">UDP provides a transport service to Application Layer protocols. When UDP receives a packet from the Application Layer, it appends a UDP header to the packet and sends the packet to the Network Layer. When UDP receives a packet from the Network Layer, it removes the UDP header from the packet and sends the packet to the Application Layer. Function TransportUdpLayer, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#997712', '');" title="Transport Layer">Figure&nbsp;4-56</a></span>, is the event dispatcher for UDP. Event <span style="font-family: &quot;Courier New&quot;">MSG_TRANSPORT_FromNetwork</span> corresponds to receiving a packet from the Network Layer and event <span style="font-family: &quot;Courier New&quot;">MSG_TRANSPORT_FromAppSend</span> corresponds to receiving a packet from the Application Layer. </div>
      <div class="Body"><a name="997924">The event dispatcher also includes a default case in the switch statement to handle events of an unknown type. </a></div>
      <div class="BodyAfterHead"><a name="997927">See files transport_udp.h and transport_udp.cpp in </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src for definitions of data structures and functions used for implementing UDP.</div>
      <div class="Code_Segment"><a name="997672">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997675">void</a></div>
      <div class="Code_Segment"><a name="997676">TransportUdpLayer(Node *node,  Message *msg)</a></div>
      <div class="Code_Segment"><a name="997677">{</a></div>
      <div class="Code_Segment"><a name="997678">    switch (msg-&gt;eventType)</a></div>
      <div class="Code_Segment"><a name="997682">    {</a></div>
      <div class="Code_Segment"><a name="997683">        case MSG_TRANSPORT_FromNetwork:</a></div>
      <div class="Code_Segment"><a name="997684">        {</a></div>
      <div class="Code_Segment"><a name="997685">            TransportUdpSendToApp(node, msg);</a></div>
      <div class="Code_Segment"><a name="997686">            break;</a></div>
      <div class="Code_Segment"><a name="997687">        }</a></div>
      <div class="Code_Segment"><a name="997688">        case MSG_TRANSPORT_FromAppSend:</a></div>
      <div class="Code_Segment"><a name="997689">        {</a></div>
      <div class="Code_Segment"><a name="997690">            TransportUdpSendToNetwork(node, msg);</a></div>
      <div class="Code_Segment"><a name="997691">            break;</a></div>
      <div class="Code_Segment"><a name="997692">        }</a></div>
      <div class="Code_Segment"><a name="997693">        default:</a></div>
      <div class="Code_Segment"><a name="997694">            assert(FALSE);</a></div>
      <div class="Code_Segment"><a name="997695">            abort();</a></div>
      <div class="Code_Segment"><a name="997696">    }</a></div>
      <div class="Code_Segment"><a name="997673">}</a></div>
      <div class="Figure">FIGURE 4-56.&nbsp;&nbsp;<a name="997712">Event Dispatcher for UDP</a></div>
      <div class="BodyAfterHead"><a name="997671">Function TransportUdpLayer calls function TransportUdpSendToApp when it receives a packet from the Network Layer. Function TransportUdpSendToApp, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#997868', '');" title="Transport Layer">Figure&nbsp;4-57</a></span>, performs the following actions:</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="997732">Reads the source address, destination address and incoming interface index from the info field of the message.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997736">Reads the destination port number from the UDP header (which is at the beginning of the packet field of the message), using the API MESSAGE_ReturnPacket.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997737">Allocates a new info field for the message, using the API MESSAGE_InfoAlloc.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997738">Copies the source address, destination address, incoming interface index and the destination port number into the new info field of the message.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997739">Removes the header, using the API MESSAGE_RemoveHeader.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997742">Schedules a packet receive event </a><span style="font-family: &quot;Courier New&quot;">(MSG_APP_FromTransport</span>) for the destination protocol at the Application Layer, using the APIs MESSAGE_SetLayer, MESSAGE_SetEvent and MESSAGE_Send.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="997789">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035496">void</a></div>
      <div class="Code_Segment"><a name="1035497">TransportUdpSendToApp(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="1035498">{</a></div>
      <div class="Code_Segment"><a name="1035499">    TransportDataUdp *udpLayer =</a></div>
      <div class="Code_Segment"><a name="1035500">        (TransportDataUdp *) node-&gt;transportData.udp;</a></div>
      <div class="Code_Segment"><a name="1035501">    TransportUdpHeader* udpHdr = (TransportUdpHeader *)</a></div>
      <div class="Code_Segment"><a name="1035502">                                 MESSAGE_ReturnPacket(msg);</a></div>
      <div class="Code_Segment"><a name="1035504">    UdpToAppRecv *info;</a></div>
      <div class="Code_Segment"><a name="1035505">    Address sourceAddress;</a></div>
      <div class="Code_Segment"><a name="1035506">    Address destinationAddress;</a></div>
      <div class="Code_Segment"><a name="1035507">    NetworkToTransportInfo *infoPtr = (NetworkToTransportInfo *)</a></div>
      <div class="Code_Segment"><a name="1035508">                                      MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="1035509">    int incomingInterfaceIndex = infoPtr-&gt;incomingInterfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1035510">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035511">    memcpy(&amp;sourceAddress, &amp;(infoPtr-&gt;sourceAddr), sizeof(Address));</a></div>
      <div class="Code_Segment"><a name="1035513">    memcpy(&amp;destinationAddress,</a></div>
      <div class="Code_Segment"><a name="1035514">           &amp;(infoPtr-&gt;destinationAddr),</a></div>
      <div class="Code_Segment"><a name="1035515">           sizeof(Address));</a></div>
      <div class="Code_Segment"><a name="1035517">    if (udpLayer-&gt;udpStatsEnabled == TRUE)</a></div>
      <div class="Code_Segment"><a name="1035518">    {</a></div>
      <div class="Code_Segment"><a name="1035519">        udpLayer-&gt;statistics-&gt;numPktToApp++;</a></div>
      <div class="Code_Segment"><a name="1035520">    }</a></div>
      <div class="Code_Segment"><a name="1035522">    /* Set destination port. */</a></div>
      <div class="Code_Segment"><a name="1035524">    MESSAGE_SetLayer(msg, APP_LAYER, udpHdr-&gt;destPort);</a></div>
      <div class="Code_Segment"><a name="1035525">    MESSAGE_SetEvent(msg, MSG_APP_FromTransport);</a></div>
      <div class="Code_Segment"><a name="1036286">    MESSAGE_SetInstanceId(msg, 0);</a></div>
      <div class="Code_Segment"><a name="1035526">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035527">    /* Update info field (used by application layer). */</a></div>
      <div class="Code_Segment"><a name="1035529">    TosType_priority = infoPtr-&gt;priority;</a></div>
      <div class="Code_Segment"><a name="1036287">    MESSAGE_InfoAlloc(node, msg, sizeof(UdpToAppRecv));</a></div>
      <div class="Code_Segment"><a name="1035530">    info = (UdpToAppRecv *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="1035532">    </a></div>
      <div class="Code_Segment"><a name="1066993">    info-&gt;priority = priority;</a></div>
      <div class="Code_Segment"><a name="1066986">    memcpy(&amp;(info-&gt;sourceAddr), &amp;sourceAddress, sizeof(Address));</a></div>
      <div class="Code_Segment"><a name="1035533">    info-&gt;sourcePort = udpHdr-&gt;sourcePort;</a></div>
      <div class="Code_Segment"><a name="1035534">    memcpy(&amp;(info-&gt;destAddr), &amp;destinationAddress, sizeof(Address));</a></div>
      <div class="Code_Segment"><a name="1035535">    info-&gt;destPort = udpHdr-&gt;destPort;</a></div>
      <div class="Code_Segment"><a name="1035536">    info-&gt;incomingInterfaceIndex = incomingInterfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1035537">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035538">    ActionData acnData;</a></div>
      <div class="Code_Segment"><a name="1035539">    acnData.actionType = RECV;</a></div>
      <div class="Code_Segment"><a name="1035540">    acnData.actionComment = NO_COMMENT;</a></div>
      <div class="Code_Segment"><a name="1035541">    TRACE_PrintTrace(node,</a></div>
      <div class="Code_Segment"><a name="1035542">                     msg,</a></div>
      <div class="Code_Segment"><a name="1035543">                     TRACE_TRANSPORT_LAYER,</a></div>
      <div class="Code_Segment"><a name="1035544">                     PACKET_IN,</a></div>
      <div class="Code_Segment"><a name="1035545">                     &amp;acnData);</a></div>
      <div class="Code_Segment"><a name="1035547">    /* Remove UDP header. */</a></div>
      <div class="Code_Segment"><a name="1035548">    MESSAGE_RemoveHeader(node, msg, sizeof(TransportUdpHeader), TRACE_UDP);</a></div>
      <div class="Code_Segment"><a name="1035549">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035550">    /* Send packet to application layer. */</a></div>
      <div class="Code_Segment"><a name="1035551">    MESSAGE_Send(node, msg, TRANSPORT_DELAY);</a></div>
      <div class="Code_Segment"><a name="1035482">}</a></div>
      <div class="Figure">FIGURE 4-57.&nbsp;&nbsp;<a name="997868">Processing a Packet Received from Network Layer at UDP</a></div>
      <div class="BodyAfterHead"><a name="997958">Function TransportUdpLayer calls function TransportUdpSendToNetwork when it receives a packet from the Application Layer. Function TransportUdpSendToNetwork, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#998050', '');" title="Transport Layer">Figure&nbsp;4-58</a></span>, performs the following actions:</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="997975">Creates a header, using the API MESSAGE_Addheader.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997980">Copies the source and destination port numbers from the message info field to the header.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997981">Sets the length field of the header to the message packet size, using the API MESSAGE_ReturnPacketSize.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997982">Sends the packet to the Network Layer, using the API NetworkIpReceivePacketFromTransportLayer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><a name="998758">Function NetworkIpReceivePacketFromTransportLayer, defined in network_ip.cpp, is the API for sending a packet from the Transport Layer to the Network Layer. TransportUdpSendToNetwork passes to NetworkIpReceivePacketFromTransportLayer an integer parameter that is the IP Protocol Number for the Transport Layer protocol. In </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#998050', '');" title="Transport Layer">Figure&nbsp;4-58</a></span>, this parameter is <span style="font-family: &quot;Courier New&quot;">IPPROTO_UDP</span>, which is defined in <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.h (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1006366', '');" title="Transport Layer">Section&nbsp;4.3.5.8</a></span>). </div>
      <div class="Code_Segment"><a name="1035605">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035671">void</a></div>
      <div class="Code_Segment"><a name="1035606">TransportUdpSendToNetwork(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="1035607">{</a></div>
      <div class="Code_Segment"><a name="1035608">    TransportDataUdp *udp = (TransportDataUdp *) node-&gt;transportData.udp;</a></div>
      <div class="Code_Segment"><a name="1035609">    TransportUdpHeader *udpHdr;</a></div>
      <div class="Code_Segment"><a name="1035666">    AppToUdpSend *info;</a></div>
      <div class="Code_Segment"><a name="1035667">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035668">    if (udp-&gt;udpStatsEnabled == TRUE)</a></div>
      <div class="Code_Segment"><a name="1035613">    {</a></div>
      <div class="Code_Segment"><a name="1035614">        udp-&gt;statistics-&gt;numPktFromApp++;</a></div>
      <div class="Code_Segment"><a name="1035615">    }</a></div>
      <div class="Code_Segment"><a name="1035617">    MESSAGE_AddHeader(node, msg, sizeof(TransportUdpHeader), TRACE_UDP);</a></div>
      <div class="Code_Segment"><a name="1035619">    udpHdr = (TransportUdpHeader *) msg-&gt;packet;</a></div>
      <div class="Code_Segment"><a name="1035620">    info = (AppToUdpSend *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="1035622">    udpHdr-&gt;sourcePort = info-&gt;sourcePort;</a></div>
      <div class="Code_Segment"><a name="1035623">    udpHdr-&gt;destPort = info-&gt;destPort;</a></div>
      <div class="Code_Segment"><a name="1035624">    udpHdr-&gt;length = (unsigned short) MESSAGE_ReturnPacketSize(msg);</a></div>
      <div class="Code_Segment"><a name="1035625">    udpHdr-&gt;checksum = 0;  /* checksum not calculated */</a></div>
      <div class="Code_Segment"><a name="1035626">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035627">    ActionData acnData;</a></div>
      <div class="Code_Segment"><a name="1035628">    acnData.actionType = SEND;</a></div>
      <div class="Code_Segment"><a name="1035629">    acnData.actionComment = NO_COMMENT;</a></div>
      <div class="Code_Segment"><a name="1035630">    TRACE_PrintTrace(node,</a></div>
      <div class="Code_Segment"><a name="1035631">                     msg,</a></div>
      <div class="Code_Segment"><a name="1035632">                     TRACE_TRANSPORT_LAYER,</a></div>
      <div class="Code_Segment"><a name="1035633">                     PACKET_OUT,</a></div>
      <div class="Code_Segment"><a name="1035634">                     &amp;acnData);</a></div>
      <div class="Code_Segment"><a name="1035636">    NetworkIpReceivePacketFromTransportLayer(</a></div>
      <div class="Code_Segment"><a name="1035637">        node,</a></div>
      <div class="Code_Segment"><a name="1035638">        msg,</a></div>
      <div class="Code_Segment"><a name="1035639">        info-&gt;sourceAddr,</a></div>
      <div class="Code_Segment"><a name="1035640">        info-&gt;destAddr,</a></div>
      <div class="Code_Segment"><a name="1035641">        info-&gt;outgoingInterface,</a></div>
      <div class="Code_Segment"><a name="1035642">        info-&gt;priority,</a></div>
      <div class="Code_Segment"><a name="1035643">        IPPROTO_UDP,</a></div>
      <div class="Code_Segment"><a name="1035644">        FALSE,</a></div>
      <div class="Code_Segment"><a name="1036292">        info-&gt;ttl);</a></div>
      <div class="Code_Segment"><a name="997994">}</a></div>
      <div class="Figure">FIGURE 4-58.&nbsp;&nbsp;<a name="998050">Processing a Packet Received from Application Layer at UDP</a></div>
      <div class="Heading5Numbered">4.3.5.6.2.2  <a name="997578">RSVP-TE Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="993444">RSVP-TE is a control protocol operating at the Transport Layer. Unlike UDP and TCP, RSVP-TE is not used for transporting Application Layer data; therefore, it does not exchange packets with the Application Layer. Packets received from the Network Layer are processed at the Transport Layer and are not forwarded to the Application Layer. </a></div>
      <div class="Body"><a name="998284">See files transport_rsvp.h and transport_rsvp.cpp in </a><span class="Variable">QUALNET_HOME</span>/libraries/multimedia_enterprise/src for definitions of data structures and functions used for implementing RSVP-TE.</div>
      <div class="Body"><a name="998265">Function RsvpLayer, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#998254', '');" title="Transport Layer">Figure&nbsp;4-59</a></span>, is the event dispatcher for RSVP-TE. Event <span style="font-family: &quot;Courier New&quot;">MSG_TRANSPORT_RSVP_InitApp</span> is a trigger to initialize RSVP-TE, and function RsvpInitApplication is called to handle this event. Event <span style="font-family: &quot;Courier New&quot;">MSG_TRANSPORT_FromNetwork</span> corresponds to receiving a packet from the Network Layer and function RsvpHandlePacket is called to handle this event. All other events are timer events and are handled by their respective event handling routines.</div>
      <div class="Body"><a name="998297">The event dispatcher also includes a default case in the switch statement to handle events of an unknown type. </a></div>
      <div class="Body"><a name="998262">Note that after processing each event, RsvpLayer calls API MESSAGE_Free to free the message.</a></div>
      <div class="Note_Indented"><a name="998309"><img class="Default" src="images/Chapter%204-3.07.1.5.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is important to free the memory after the message has been processed; otherwise, the simulator will leak memory.</a></div>
      <div class="Code_Segment"><a name="998253">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000895">void RsvpLayer(Node* node, Message* msg)</a></div>
      <div class="Code_Segment"><a name="998115">{</a></div>
      <div class="Code_Segment"><a name="998116">    switch (MESSAGE_GetEvent(msg))</a></div>
      <div class="Code_Segment"><a name="998117">    {</a></div>
      <div class="Code_Segment"><a name="998118">        case MSG_TRANSPORT_RSVP_InitApp:</a></div>
      <div class="Code_Segment"><a name="998119">        {</a></div>
      <div class="Code_Segment"><a name="998120">            RsvpInitApplication(node, msg);</a></div>
      <div class="Code_Segment"><a name="998123">            break;</a></div>
      <div class="Code_Segment"><a name="998124">        }</a></div>
      <div class="Code_Segment"><a name="998125">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998126">        case MSG_TRANSPORT_FromNetwork:</a></div>
      <div class="Code_Segment"><a name="998127">        {</a></div>
      <div class="Code_Segment"><a name="998128">            NetworkToTransportInfo* netToTransInfo =</a></div>
      <div class="Code_Segment"><a name="998129">                (NetworkToTransportInfo*) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="998130">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998131">            RsvpHandlePacket(node, msg,</a></div>
      <div class="Code_Segment"><a name="998136">                             GetIPv4Address(netToTransInfo-&gt;sourceAddr));</a></div>
      <div class="Code_Segment"><a name="998137">            break;</a></div>
      <div class="Code_Segment"><a name="998138">        }</a></div>
      <div class="Code_Segment"><a name="998139">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998140">        case MSG_TRANSPORT_RSVP_PathRefresh:</a></div>
      <div class="Code_Segment"><a name="998141">        {</a></div>
      <div class="Code_Segment"><a name="998142">           ...</a></div>
      <div class="Code_Segment"><a name="998236">        }</a></div>
      <div class="Code_Segment"><a name="998153">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998154">        case MSG_TRANSPORT_RSVP_ResvRefresh:</a></div>
      <div class="Code_Segment"><a name="998155">        {</a></div>
      <div class="Code_Segment"><a name="998156">            ...</a></div>
      <div class="Code_Segment"><a name="998162">        }</a></div>
      <div class="Code_Segment"><a name="998163">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998164">        case MSG_TRANSPORT_RSVP_HelloExtension:</a></div>
      <div class="Code_Segment"><a name="998165">        {</a></div>
      <div class="Code_Segment"><a name="998166">            ...</a></div>
      <div class="Code_Segment"><a name="998171">        }</a></div>
      <div class="Code_Segment"><a name="998172">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998173">        case MSG_TRANSPORT_RSVP_InitiateExplicitRoute:</a></div>
      <div class="Code_Segment"><a name="998174">        {</a></div>
      <div class="Code_Segment"><a name="998175">            ...</a></div>
      <div class="Code_Segment"><a name="998185">        }</a></div>
      <div class="Code_Segment"><a name="998186">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998187">        default:</a></div>
      <div class="Code_Segment"><a name="998188">        {</a></div>
      <div class="Code_Segment"><a name="998323">            // invalid event type</a></div>
      <div class="Code_Segment"><a name="998324">            ERROR_Assert(FALSE, "Invalid RSVP message.");</a></div>
      <div class="Code_Segment"><a name="998189">            break;</a></div>
      <div class="Code_Segment"><a name="998192">        }</a></div>
      <div class="Code_Segment"><a name="998193">    }</a></div>
      <div class="Code_Segment"><a name="998194">    // Free the message</a></div>
      <div class="Code_Segment"><a name="998195">    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="998196">}</a></div>
      <div class="Figure">FIGURE 4-59.&nbsp;&nbsp;<a name="998254">Event Dispatcher for RSVP-TE</a></div>
      <div class="Heading3Numbered">4.3.5.7  <a name="933604">Integrating with the Application Layer</a></div>
      <div class="BodyAfterHead"><a name="1006367">Application Layer protocols exchange data by using transport services provided by UDP or TCP by means of APIs listed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1007021', '');" title="Transport Layer">Section&nbsp;4.3.4.1</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1007295', '');" title="Transport Layer">Section&nbsp;4.3.4.2</a></span>. Since TCP is a connection-oriented protocol, it also implements connection management APIs, such as APP_TcpOpenConnection, APP_TcpServerListen and APP_TcpCloseConnection. These APIs are implemented in <span class="Variable">QUALNET_HOME</span>/main/app_util.cpp. As an example, function APP_UdpSendNewDataWithPriority, shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#940243', '');" title="Discrete-event Simulation in QualNet">Figure&nbsp;3-7</a></span>, sends application data to UDP with a user-specified priority after a user-specified delay. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#928544', '');" title="Discrete-event Simulation in QualNet">Section&nbsp;3.3.2.1.2</a></span> explains the implementation of APP_UdpSendNewDataWithPriority.</div>
      <div class="Body"><a name="1006682">If the new protocol, MYPROTOCOL, provides a transport service, integrate MYPROTOCOL with the Application Layer as follows:</a></div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="1006696">Write functions similar to the UDP and TCP APIs which enable Application Layer protocols to use the services provided by MYPROTOCOL. Include these functions in the file transport_myprotocol.cpp.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1006706">Include the prototypes of these functions in the file transport_myprotocol.h.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1006707">Make these functions available to any specific Application Layer protocol by including the file transport_myprotocol.h in Application Layer protocol’s source file, e.g., to enable the Application Layer protocol CBR to use MYPROTOCOL, include the following statement in the file </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/app_cbr.cpp:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1006717">&nbsp;</a></div>
      <div class="Command_Input" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1006758">#include “transport_myprotocol.h”</a></span></div>
      <div class="Heading3Numbered">4.3.5.8  <a name="1006366">Integrating with the Network Layer</a></div>
      <div class="BodyAfterHead"><a name="933618">When the IP protocol at the Network Layer sends a packet to a protocol at the Transport Layer protocol, it calls a function specific to that protocol. Therefore, when a new protocol, MYPROTOCOL, is added at the Transport Layer, a function needs to be added at the Network Layer which enables IP to deliver packets to MYPROTOCOL. This section describes the steps for integrating a new Transport Layer protocol with the Network Layer.</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="998667">Define an IP Protocol Number for MYPROTOCOL. File network_ip.h contains constant definitions for all Transport Layer and Network Layer protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#998606', '');" title="Transport Layer">Figure&nbsp;4-60</a></span>). For example, the IP Protocol Number for UDP is 17. Add a constant definition to associate an IP Protocol Number with MYPROTOCOL.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Note_Indented"><a name="998699"><img class="Default" src="images/Chapter%204-3.07.1.6.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Be sure to use an IP Protocol Number that is not already used for some other protocol.</a></div>
      <div class="Note_Indented"><a name="998713">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998882">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998885">//----------------------------------------------------------</a></div>
      <div class="Code_Segment"><a name="998518">// IP protocol numbers</a></div>
      <div class="Code_Segment"><a name="998519">//----------------------------------------------------------</a></div>
      <div class="Code_Segment"><a name="998520">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998521">// IP protocol numbers for network-layer and transport-layer protocols</a></div>
      <div class="Code_Segment"><a name="998522">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998541">...</a></div>
      <div class="Code_Segment"><a name="1000458">// /**</a></div>
      <div class="Code_Segment"><a name="998542">// CONSTANT    :: IPPROTO_TCP : 6</a></div>
      <div class="Code_Segment"><a name="998543">// DESCRIPTION :: IP protocol number for TCP.</a></div>
      <div class="Code_Segment"><a name="998544">// **/</a></div>
      <div class="Code_Segment"><a name="998545">#define IPPROTO_TCP             6</a></div>
      <div class="Code_Segment"><a name="998547">// /**</a></div>
      <div class="Code_Segment"><a name="998548">// CONSTANT    :: IPPROTO_UDP : 17</a></div>
      <div class="Code_Segment"><a name="998549">// DESCRIPTION :: IP protocol number for UDP.</a></div>
      <div class="Code_Segment"><a name="998550">// **/</a></div>
      <div class="Code_Segment"><a name="998551">#define IPPROTO_UDP             17</a></div>
      <div class="Code_Segment"><a name="998553">// /**</a></div>
      <div class="Code_Segment"><a name="998554">// CONSTANT    :: IPPROTO_RSVP : 46</a></div>
      <div class="Code_Segment"><a name="998555">// DESCRIPTION :: IP protocol number for RSVP.</a></div>
      <div class="Code_Segment"><a name="998556">// **/</a></div>
      <div class="Code_Segment"><a name="998557">#define IPPROTO_RSVP            46</a></div>
      <div class="Code_Segment"><a name="1000447">...</a></div>
      <div class="Code_New"><a name="998612">// /**</a></div>
      <div class="Code_New"><a name="998613">// CONSTANT    :: IPPROTO_MYPROTOCOL : 255</a></div>
      <div class="Code_New"><a name="998614">// DESCRIPTION :: IP protocol number for MYPROTOCOL.</a></div>
      <div class="Code_New"><a name="998615">// **/</a></div>
      <div class="Code_New"><a name="998616">#define IPPROTO_MYPROTOCOL      255</a></div>
      <div class="Code_Segment"><a name="998342">...</a></div>
      <div class="Figure">FIGURE 4-60.&nbsp;&nbsp;<a name="998606">Declaring IP Protocol Number for MYPROTOCOL</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998721">Modify function DeliverPacket in network_ip.cpp. Function DeliverPacket, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#998458', '');" title="Transport Layer">Figure&nbsp;4-61</a></span>, performs a switch on the IP Protocol Number, <span style="font-family: &quot;Courier New&quot;">ipProtocolNumber</span>, contained in the IP header of the received packet, and calls the appropriate routine to deliver the packet to the protocol identified by <span style="font-family: &quot;Courier New&quot;">ipProtocolNumber</span>. For example, DeliverPacket calls the function SendToUdp to deliver a packet to UDP if the IP Protocol Number read from the packet’s header is 17.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Anchor"><a name="1067459">&nbsp;</a></div>
      <div class="NumberedCont"><a name="998842">Add code to DeliverPacket to call function SendToMyprotocol, with appropriate parameters, if the IP Protocol Number read from the packet’s header is </a><span style="font-family: &quot;Courier New&quot;">IPPROTO_MYPROTOCOL</span> (defined in step 1), as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#998458', '');" title="Transport Layer">Figure&nbsp;4-61</a></span>.</div>
      <div class="Code_Segment"><a name="998584">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998402">static void </a></div>
      <div class="Code_Segment"><a name="998343">DeliverPacket(Node *node, Message *msg,</a></div>
      <div class="Code_Segment"><a name="998344">              int interfaceIndex, NodeAddress previousHopAddress)</a></div>
      <div class="Code_Segment"><a name="998345">{</a></div>
      <div class="Code_Segment"><a name="998346">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="998347">    NodeAddress sourceAddress = 0;</a></div>
      <div class="Code_Segment"><a name="998348">    NodeAddress destinationAddress =0;</a></div>
      <div class="Code_Segment"><a name="998349">    unsigned char ipProtocolNumber;</a></div>
      <div class="Code_Segment"><a name="998350">    unsigned ttl =0;</a></div>
      <div class="Code_Segment"><a name="998351">    TosType priority;</a></div>
      <div class="Code_Segment"><a name="998336">    ...</a></div>
      <div class="Code_Segment"><a name="998439">    IpHeaderType *ipHeader = (IpHeaderType *) msg-&gt;packet;</a></div>
      <div class="Code_Segment"><a name="1036301">    ...</a></div>
      <div class="Code_Segment"><a name="998440">    ipProtocolNumber = ipHeader-&gt;ip_p;</a></div>
      <div class="Code_Segment"><a name="998357">    ...</a></div>
      <div class="Code_Segment"><a name="998444">    switch (ipProtocolNumber)</a></div>
      <div class="Code_Segment"><a name="998358">    {</a></div>
      <div class="Code_Segment"><a name="998359">        // Delivery to Transport Layer protocols.</a></div>
      <div class="Code_Segment"><a name="998360">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998361">        case IPPROTO_UDP:</a></div>
      <div class="Code_Segment"><a name="998362">        {</a></div>
      <div class="Code_Segment"><a name="998363">            SendToUdp(node, msg, priority, sourceAddress, destinationAddress,</a></div>
      <div class="Code_Segment"><a name="998364">                      interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="998365">            break;</a></div>
      <div class="Code_Segment"><a name="998366">        }</a></div>
      <div class="Code_Segment"><a name="998367">        case IPPROTO_TCP:</a></div>
      <div class="Code_Segment"><a name="998368">        {</a></div>
      <div class="Code_Segment"><a name="998369">            SendToTcp(node, msg, priority, sourceAddress, destinationAddress,</a></div>
      <div class="Code_Segment"><a name="998374">                      aCongestionExperienced);</a></div>
      <div class="Code_Segment"><a name="998375">            break;</a></div>
      <div class="Code_Segment"><a name="998376">        }</a></div>
      <div class="Code_Segment"><a name="998377">        ...</a></div>
      <div class="Code_Segment"><a name="1036302">        case IPPROTO_RSVP:</a></div>
      <div class="Code_Segment"><a name="998378">        {</a></div>
      <div class="Code_Segment"><a name="998379">            SendToRsvp(node, msg, priority, sourceAddress,</a></div>
      <div class="Code_Segment"><a name="998380">                       destinationAddress, interfaceIndex, ttl);</a></div>
      <div class="Code_Segment"><a name="998381">            break;</a></div>
      <div class="Code_Segment"><a name="998355">        }</a></div>
      <div class="Code_Segment"><a name="1036303">        ...</a></div>
      <div class="Code_New"><a name="998421">        case IPPROTO_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="998422">        {</a></div>
      <div class="Code_New"><a name="998423">            SendToMyprotocol(node, msg, priority, sourceAddress,</a></div>
      <div class="Code_New"><a name="998424">                       										  destinationAddress, ...);</a></div>
      <div class="Code_New"><a name="998425">            break;</a></div>
      <div class="Code_New"><a name="998426">        }</a></div>
      <div class="Code_Segment"><a name="998392">        ...</a></div>
      <div class="Code_Segment"><a name="998393">    }</a></div>
      <div class="Code_Segment"><a name="998394">    ...</a></div>
      <div class="Code_Segment"><a name="998395">}</a></div>
      <div class="Figure">FIGURE 4-61.&nbsp;&nbsp;<a name="998458">Delivering Packets from IP to Transport Layer Protocols</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998859">Write function SendToMyprotocol to deliver a packet from the Network Layer to MYPROTOCOL. Include this function in the file network_ip.cpp and specify its prototype in the file network_ip.h. Follow the example of function SendToUdp, which delivers a packet from the Network Layer to UDP. Function SendToUdp is shown in </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1006242', '');" title="Transport Layer">Figure&nbsp;4-62</a> and is implemented in network_ip.cpp.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="998466">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035682">void</a></div>
      <div class="Code_Segment"><a name="1035683">SendToUdp(</a></div>
      <div class="Code_Segment"><a name="1035684">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1035685">    Message *msg,</a></div>
      <div class="Code_Segment"><a name="1035686">    TosType priority,</a></div>
      <div class="Code_Segment"><a name="1035687">    NodeAddress sourceAddress,</a></div>
      <div class="Code_Segment"><a name="1035688">    NodeAddress destinationAddress,</a></div>
      <div class="Code_Segment"><a name="1035689">    int incomingInterfaceIndex)</a></div>
      <div class="Code_Segment"><a name="1035690">{</a></div>
      <div class="Code_Segment"><a name="1035691">    NetworkToTransportInfo *infoPtr;</a></div>
      <div class="Code_Segment"><a name="1035692">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035693">    MESSAGE_SetEvent(msg, MSG_TRANSPORT_FromNetwork);</a></div>
      <div class="Code_Segment"><a name="1035694">    MESSAGE_SetLayer(msg, TRANSPORT_LAYER, TransportProtocol_UDP);</a></div>
      <div class="Code_Segment"><a name="1035695">    MESSAGE_InfoAlloc(node, msg, sizeof(NetworkToTransportInfo));</a></div>
      <div class="Code_Segment"><a name="1035696">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035697">    infoPtr = (NetworkToTransportInfo *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="1035698">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035699">    SetIPv4AddressInfo(&amp;infoPtr-&gt;sourceAddr, sourceAddress);</a></div>
      <div class="Code_Segment"><a name="1035700">    SetIPv4AddressInfo(&amp;infoPtr-&gt;destinationAddr, destinationAddress);</a></div>
      <div class="Code_Segment"><a name="1035701">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035702">    infoPtr-&gt;priority = priority;</a></div>
      <div class="Code_Segment"><a name="1035703">    infoPtr-&gt;incomingInterfaceIndex = incomingInterfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1035704">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035705">    MESSAGE_Send(node, msg, PROCESS_IMMEDIATELY);</a></div>
      <div class="Code_Segment"><a name="1035706">}</a></div>
      <div class="Figure">FIGURE 4-62.&nbsp;&nbsp;<a name="1006242">Sending Packets from IP to UDP</a></div>
      <div class="Heading3Numbered">4.3.5.9  <a name="1006243">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="1006244">In this section, we describe how to collect and report statistics for a Transport Layer protocol.</a></div>
      <div class="Heading4Numbered">4.3.5.9.1  <a name="993123">Declaring Statistics Variables</a></div>
      <div class="BodyAfterHead"><a name="936157">A Transport Layer protocol can be configured to record statistics specified by the programmer, such as:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="998915">	Number of packets sent to the Application Layer </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="998916">	Number of packets received from the Application Layer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="998974">To enable statistics collection for the protocol, include the statistic collection variables in the structure used to hold the protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996018', '');" title="Transport Layer">Section&nbsp;4.3.5.4</a></span>). The statistics related variables can also be defined in a structure and then that structure is included in the state variable. For example, the data structure for UDP, <span style="font-family: &quot;Courier New&quot;">TransportDataUdp</span>, contains a pointer to the UDP statistics variable, <span style="font-family: &quot;Courier New&quot;">TransportUdpStat</span>, shown below:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1035735">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1035755">typedef struct {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1035736">    D_Int32 numPktFromApp;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1035737">    D_Int32 numPktToApp;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1035738">} TransportUdpStat;</a></span></div>
      <div class="Body"><span style="font-family: &quot;Courier New&quot;"><a name="998998">TransportDataUdp</a></span> and <span style="font-family: &quot;Courier New&quot;">TransportUdpStat</span> are defined in transport_udp.h. </div>
      <div class="Body"><a name="1004837">Also, include a variable in the protocol state structure that indicates whether statistics collection is enabled for the protocol. For example, field </a><span style="font-family: &quot;Courier New&quot;">udpStatsEnabled</span> of <span style="font-family: &quot;Courier New&quot;">TransportDataUdp</span> is a Boolean flag that indicates whether statistics collection is enabled for UDP.</div>
      <div class="Heading4Numbered">4.3.5.9.2  <a name="936225">Initializing Statistics</a></div>
      <div class="BodyAfterHead"><a name="999087">Initialize statistics variables in the protocol’s initialization function. Determine whether statistics collection is enabled for the protocol and set the statistics collection flag accordingly. For example, field </a><span style="font-family: &quot;Courier New&quot;">udpStatsEnabled</span> of <span style="font-family: &quot;Courier New&quot;">TransportDataUdp</span> is set to TRUE or FALSE by the initialization function TransportUdpInit depending upon the input configuration, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#996962', '');" title="Transport Layer">Figure&nbsp;4-53</a></span>. Function TransportUdpInit allocates memory for the statistics variable <span style="font-family: &quot;Courier New&quot;">TransportUdpStat</span> and initializes all fields of <span style="font-family: &quot;Courier New&quot;">TransportUdpStat</span> to 0, if UDP statistics collection is enabled.</div>
      <div class="Heading4Numbered">4.3.5.9.3  <a name="936297">Updating Statistics</a></div>
      <div class="BodyAfterHead"><a name="999157">After declaring and initializing the statistics variables, update their value during the protocol life cycle, as required. For example, UDP increments the value of </a><span style="font-family: &quot;Courier New&quot;">numPktToApp</span> in function TransportUdpsendToApp (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#997868', '');" title="Transport Layer">Figure&nbsp;4-57</a></span>) every time UDP sends a packet to the Application Layer, as shown below:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999144">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999183">			...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999145">    if (udpLayer-&gt;udpStatsEnabled == TRUE)</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999146">    {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999147">        udpLayer-&gt;statistics-&gt;numPktToApp++;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999148">    }</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999149">			...</a></span></div>
      <div class="Heading4Numbered">4.3.5.9.4  <a name="993131">Printing Statistics</a></div>
      <div class="BodyAfterHead"><a name="1000532">As a final step towards statistics collection, create a function to print statistics. Call this function from the finalization function of the protocol, which is discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1067242', '');" title="Transport Layer">Section&nbsp;4.3.5.9.5</a></span>. Alternatively, statistics can be printed directly in the finalization function, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#999379', '');" title="Transport Layer">Figure&nbsp;4-64</a></span>. </div>
      <div class="Heading4Numbered">4.3.5.9.5  <a name="1067242">Adding Dynamic Statistics</a></div>
      <div class="BodyAfterHead"><a name="1067246">Dynamic statistics are statistic variables whose values can be observed in the </a><span class="Variable">QualNet</span> GUI during the simulation. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.3.html#955932', '');" title="Customizing Visualize Mode of QualNet Architect">Section&nbsp;5.2.3</a></span> for adding dynamic statistics to a protocol. Refer to <span class="Variable" style="font-style: italic">QualNet User’s Guide</span> for details of viewing dynamic statistics during the simulation.</div>
      <div class="Heading3Numbered">4.3.5.10  <a name="933598">Finalization</a></div>
      <div class="BodyAfterHead"><a name="999391">The finalization function of the protocol is called by the simulator at the end of simulation. It is the last code that executes during the simulation. This function is responsible for printing statistics to the statistics file.</a></div>
      <div class="BodyAfterHead"><a name="1000559">At the end of simulation, the finalization function for each protocol is called to print the protocol statistics. As discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#934306', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.3</a></span>, the finalization function is called hierarchically. The node finalization function, PARTITION_Finalize, which is defined in <span class="Variable">QUALNET_HOME</span>/main/partition.cpp, calls the finalization function for Transport Layer, TRANSPORT_Finalize, defined in transport.cpp. TRANSPORT_Finalize calls the finalization function of each Transport Layer protocol running at the node. </div>
      <div class="Heading4Numbered">4.3.5.10.1  <a name="999396">Modifying the Transport Layer Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="999403">Call the finalization function of MYPROTOCOL, MyprotocolFinalize, from the Transport Layer finalization function, TRANSPORT_Finalize, defined in transport.cpp. If the protocol is a mandatory protocol like UDP and TCP, then make a call to the protocol's finalization function unconditionally. If the protocol is a non-mandatory protocol like RSVP-TE, then check if the protocol is enabled before making a call to the protocol's finalization function. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#936340', '');" title="Transport Layer">Figure&nbsp;4-63</a></span> shows the outline of code that needs to be added to TRANSPORT_Finalize. </div>
      <div class="Code_Segment"><a name="999424">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999450">void</a></div>
      <div class="Code_Segment"><a name="999425">TRANSPORT_Finalize(Node * node)</a></div>
      <div class="Code_Segment"><a name="999426">{</a></div>
      <div class="Code_Segment"><a name="999427">    TransportUdpFinalize(node);</a></div>
      <div class="Code_Segment"><a name="999428">    TransportTcpFinalize(node);</a></div>
      <div class="Code_Segment"><a name="999429">    ...</a></div>
      <div class="Code_Segment"><a name="999430">    			if (node-&gt;transportData.myprotocolEnabled == TRUE)</a></div>
      <div class="Code_New"><a name="999470">    {</a></div>
      <div class="Code_New"><a name="999471">        MyprotocolFinalize(node);</a></div>
      <div class="Code_New"><a name="999472">    }</a></div>
      <div class="Code_Segment"><a name="999455">}</a></div>
      <div class="Figure">FIGURE 4-63.&nbsp;&nbsp;<a name="936340">Transport Layer Finalization Function</a></div>
      <div class="Heading4Numbered">4.3.5.10.2  <a name="993555">Implementing the Protocol Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="999525">Write the finalization function for protocol, MyprotocolFinalize. If statistics collection is enabled for MYPROTOCOL, call a function to print the protocol statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#993131', '');" title="Transport Layer">Section&nbsp;4.3.5.9.4</a></span>), or add code directly to MyprotocolFinalize to print statistics. UDP follows the latter approach. Function TransportUdpFinalize, shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#999379', '');" title="Transport Layer">Section&nbsp;4-64</a></span> and implemented in transport_udp.cpp, is the finalization function for UDP. Use TransportUdpFinalize as a template to write MyprotocolFinalize.</div>
      <div class="Body"><a name="999599">Function TransportUdpFinalize calls the C function sprintf to create a single string containing the statistic name and statistic value, and then calls function IO_PrintStat to print that string to a file. Function IO_PrintStat function, defined in </a><span class="Variable">QUALNET_HOME</span>/include/fileio.h, requires the following parameters:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999614">Node pointer: Pointer to the node reporting the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999615">Layer: String indicating the layer. Set this to </a><span style="font-family: &quot;Courier New&quot;">"Transport"</span> for the Transport Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000730">Protocol: String indicating the protocol name.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000731">Interface address: Interface address. Set this to </a><span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> for Transport Layer protocols.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000732">Instance identifier: Instance identifier or port number. Set this to -1 if there is no instance identifier.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999619">Buffer: String containing the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="999672">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999347">void</a></div>
      <div class="Code_Segment"><a name="999348">TransportUdpFinalize(Node *node)</a></div>
      <div class="Code_Segment"><a name="999349">{</a></div>
      <div class="Code_Segment"><a name="999350">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="999351">    TransportDataUdp* udp = node-&gt;transportData.udp;</a></div>
      <div class="Code_Segment"><a name="999352">    TransportUdpStat* st =  udp-&gt;statistics;</a></div>
      <div class="Code_Segment"><a name="999353">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999354">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999355">    if (udp-&gt;udpStatsEnabled == TRUE) {</a></div>
      <div class="Code_Segment"><a name="999356">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999357">        sprintf (buf, "Packets from Application Layer = %d",</a></div>
      <div class="Code_Segment"><a name="999358">                       st-&gt;numPktFromApp);</a></div>
      <div class="Code_Segment"><a name="999359">        IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="999360">            node,</a></div>
      <div class="Code_Segment"><a name="999361">            "Transport",</a></div>
      <div class="Code_Segment"><a name="999362">            "UDP",</a></div>
      <div class="Code_Segment"><a name="999363">            ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="999364">            -1 /* instance Id */,</a></div>
      <div class="Code_Segment"><a name="999365">            buf);</a></div>
      <div class="Code_Segment"><a name="999366">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999367">        sprintf (buf, "Packets to Application Layer = %d",</a></div>
      <div class="Code_Segment"><a name="999368">                       st-&gt;numPktToApp);</a></div>
      <div class="Code_Segment"><a name="999369">        IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="999370">            node,</a></div>
      <div class="Code_Segment"><a name="999371">            "Transport",</a></div>
      <div class="Code_Segment"><a name="999372">            "UDP",</a></div>
      <div class="Code_Segment"><a name="999373">            ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="999374">            -1 /* instance Id */,</a></div>
      <div class="Code_Segment"><a name="999375">            buf);</a></div>
      <div class="Code_Segment"><a name="999376">    }</a></div>
      <div class="Code_Segment"><a name="999378">}</a></div>
      <div class="Figure">FIGURE 4-64.&nbsp;&nbsp;<a name="999379">Finalization Function for UDP</a></div>
      <div class="Body"><a name="933621">Like all other functions, specify the prototype of the finalization function, MyprotocolFinalize, in the protocol's header file, transport_myprotocol.h.</a></div>
      <div class="Heading3Numbered">4.3.5.11  <a name="1056868">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1056872">The final step in integrating your transport model into </a><span class="Variable">QualNet</span> is to add the source file to the <span class="Variable">QualNet</span> source tree and compile.</div>
      <div class="BodyAfterHead"><a name="1056598">If you have created the files for the transport model in an existing library or addon, then add the source file to the Makefile-common for that library or addon. For example, if you have created your model files in the Developer library, then modify </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/Makefile-common as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1035853', '');" title="Transport Layer">Figure&nbsp;4-65</a></span>. Recompile <span class="Variable">QualNet</span> after making the changes.</div>
      <div class="Code_Segment"><a name="1035837">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1035838">...</a></div>
      <div class="Code_Segment"><a name="1035839"># common sources</a></div>
      <div class="Code_Segment"><a name="1035840">#</a></div>
      <div class="Code_Segment"><a name="1035841">DEVELOPER_SRCS = \</a></div>
      <div class="Code_Segment"><a name="1035842">$(DEVELOPER_SRCDIR)/adaptation_aal5.cpp \</a></div>
      <div class="Code_Segment"><a name="1035843">$(DEVELOPER_SRCDIR)/adaptation.cpp \</a></div>
      <div class="Code_Segment"><a name="1035844">...</a></div>
      <div class="Code_Segment"><a name="1035891">$(DEVELOPER_SRCDIR)/transport_abstract_tcp_timer.cpp \</a></div>
      <div class="Code_Segment"><a name="1035892">$(DEVELOPER_SRCDIR)/transport_abstract_tcp_usrreq.cpp \</a></div>
      <div class="Code_Segment"><a name="1035888">$(DEVELOPER_SRCDIR)/transport_in_pcb.cpp \</a></div>
      <div class="Code_New"><a name="1035847">$(DEVELOPER_SRCDIR)/transport_myprotocol.cpp \</a></div>
      <div class="Code_Segment"><a name="1035901">$(DEVELOPER_SRCDIR)/transport_tcp.cpp \</a></div>
      <div class="Code_Segment"><a name="1035902">$(DEVELOPER_SRCDIR)/transport_tcp_input.cpp \</a></div>
      <div class="Code_Segment"><a name="1035851">$(DEVELOPER_SRCDIR)/transport_tcp_output.cpp \</a></div>
      <div class="Code_Segment"><a name="1035906">...</a></div>
      <div class="Figure">FIGURE 4-65.&nbsp;&nbsp;<a name="1035853">Adding Model to Makefile-common</a></div>
      <div class="Body"><a name="1067367">If you have created a new library called user_models, then follow the instructions given in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#929473', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10.5</a></span> to integrate the user_models library into <span class="Variable">QualNet</span>.</div>
      <div class="Heading3Numbered">4.3.5.12  <a name="1067274">Integrating the Protocol into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1067278">To make the new protocol available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Heading2Numbered">4.3.6  <a name="993493">Special Issues for Transport Layer Protocols</a></div>
      <div class="Heading3Numbered">4.3.6.1  <a name="993501">Setting Address for Broadcast Messages</a></div>
      <div class="BodyAfterHead"><a name="1035151">For broadcasting packets, the destination address can be set to </a><span style="font-family: &quot;Courier New&quot;">ANY_DEST</span>, or the library function NetworkIpGetInterfaceBroadcastAddress can be used to get the interface broadcast address. <span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> is a constant defined in <span class="Variable">QUALNET_HOME</span>/include/main.h and stands for any destination. Function NetworkIpGetInterfaceBroadcastAddress is defined in network_ip.h, and returns the broadcast address of the specified interface.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-3.html#1007086', '');" title="Transport Layer" name="995606">Figure&nbsp;4-66</a></span> shows a code snippet from the Bellmanford function SendRouteAdvertisement (implemented in file <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/routing_bellmanford.cpp) that sets the destination address to the interface broadcast address for the wired interface and to <span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> for the wireless interface. </div>
      <div class="Code_Segment"><a name="995607">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995630">static void SendRouteAdvertisement(</a></div>
      <div class="Code_Segment"><a name="995634">    						Node *node, RouteAdvertisementType type)</a></div>
      <div class="Code_Segment"><a name="995635"> {</a></div>
      <div class="Code_Segment"><a name="995640">  ...</a></div>
      <div class="Code_Segment"><a name="995641">  int i;</a></div>
      <div class="Code_Segment"><a name="995644">  for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="995608">    {</a></div>
      <div class="Code_Segment"><a name="995645">      NodeAddress destAddress;</a></div>
      <div class="Code_Segment"><a name="995646">      ...</a></div>
      <div class="Code_Segment"><a name="995647">      if (NetworkIpIsWiredNetwork (node, i))</a></div>
      <div class="Code_Segment"><a name="995648">       {</a></div>
      <div class="Code_Segment"><a name="995649">         destAddress = </a></div>
      <div class="Code_Segment"><a name="995664">							NetworkIpGetInterfaceBroadcastAddress(node, i);</a></div>
      <div class="Code_Segment"><a name="995653">      				}</a></div>
      <div class="Code_Segment"><a name="995654">    			else</a></div>
      <div class="Code_Segment"><a name="995655">     {</a></div>
      <div class="Code_Segment"><a name="995656">       destAddress = ANY_DEST;</a></div>
      <div class="Code_Segment"><a name="995657">     }</a></div>
      <div class="Code_Segment"><a name="995658">   ...</a></div>
      <div class="Code_Segment"><a name="995659">   }</a></div>
      <div class="Code_Segment"><a name="995660">  ...</a></div>
      <div class="Code_Segment"><a name="995661">}</a></div>
      <div class="Figure">FIGURE 4-66.&nbsp;&nbsp;<a name="1007086">Setting Broadcast Address</a></div>
      <div class="Body"><a name="1034404">&nbsp;</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <hr align="left" />
    <table align="left">
      <tr>
        <td class="WebWorks_Company_Phone_Bottom">© 2008 - 2012 SCALABLE Network Technologies, Inc. All rights reserved.</td>
      </tr>
    </table>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>