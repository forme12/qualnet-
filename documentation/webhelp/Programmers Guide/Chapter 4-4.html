<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Network Layer</title>
    <link rel="StyleSheet" href="css/Chapter%204-4.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <div>
      <img src="snt-logo-text2-transparent-small.png" />
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Chapter%204-1.05.1.html#986087">4	Developing Protocol Models in QualNet</a> &gt; 4.4  Network Layer</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading1Numbered">4.4  <a name="986087">Network Layer</a></div>
      <div class="BodyAfterHead"><a name="986098">The Network Layer resides between the Transport and MAC Layers in the </a><span class="Variable">QualNet</span> protocol stack, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-1.05.1.html#993736', '');" title="Developing Protocol Models in QualNet">Figure&nbsp;4-1</a></span>. The Network Layer provides a communication service to support the Transport Layer between two processes in two different hosts. In particular, the Network Layer moves the Transport Layer data from the source host to the destination host. It is the lowest layer to deal with the end-to-end issue. The main issues related to this layer are: </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986099">Routing: Determining the next hop and outgoing interface for a packet</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986101">Traffic Control: Controlling congestion and transmission rate</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1040899">Addressing: Identifying nodes in the network</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1040900">Internetworking: Interconnecting heterogeneous networks</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1040901">This section gives a detailed description of how to add a Network Layer protocol to </a><span class="Variable">QualNet</span>. </div>
      <div class="Heading2Numbered">4.4.1  <a name="986165">Network Layer Protocols in </a><span class="Variable">QualNet</span></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="986166">QualNet</a></span> provides an implementation of a large number of Network Layer protocols, which can be grouped into the categories listed below. </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986167">Network protocols</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1048072">Unicast routing protocols</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1048071">Multicast routing protocols</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1048077">Queues</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1048078">Schedulers</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.1.1  <a name="986175">Network Protocols</a></div>
      <div class="BodyAfterHead"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1100918', '');" title="Network Layer" name="1096353">Table&nbsp;4-7</a></span> lists the network protocols in <span class="Variable">QualNet</span>.</div>
      <div class="Anchor"><a name="1100957">&nbsp;</a></div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-7.&nbsp;&nbsp;<a name="1100918">Network Protocols in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 97.2pt">
            <div class="CellHeading"><a name="1100924">Model/Protocol</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 280.8pt">
            <div class="CellHeading"><a name="1100926">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1100928">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1100930">Fixed Comms</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1100933">Fixed Communications Model.</a></span></div>
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1101067">The Fixed Communications model enables the user to enforce a minimum drop rate for application packets and, optionally, a fixed delay for packets that are not dropped.</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1100935">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1100937">ICMP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1100940">Interet Control Message Protocol.</a></span></div>
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1101086">ICMP is an integral part of IPv4. It allows a router or destination host to communicate with the source, to report an error in IP datagram processing and for diagnostic or routing purposes.</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1100942">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1100944">ICMPv6</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1101094">Interet Control Message Protocol version6.</a></span></div>
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1101095">ICMPv6 is an integral part of IPv6. It is used by IPv6 nodes to report errors encountered in processing packets, and to perform other internet-layer functions, such as diagnostics (ICMPv6 "ping"). </a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1100949">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1100951">IGMP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1100954">Internet Group Management Protocol.</a></span></div>
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1101138">IGMP is a multicast group management protocol. It is used between routers and hosts involved in multicast data traffic. It operates between a host sending or receiving multicast data and its directly attached router.</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1100956">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1101036">Dual IP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101038">Dual IP.</a></div>
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1101177">The Dual IP protocol provides a means to IPv6 routers and hosts to maintain compatibility with IPv4 hosts and routers by enabling IPv6 routers/hosts to carry an IPv4/IPv6 datagram over the attached IPv4 infrastructures by encapsulating the datagram within an IPv4 datagram. </a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101040">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1101024">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101026">Internet Protocol version 4.</a></div>
            <div class="CellBody"><a name="1101218">The Internet Protocol is designed for use in interconnected systems of packet-switched computer communication networks. The Internet Protocol provides for transmitting blocks of data called datagrams from sources to destinations, where sources and destinations are hosts identified by fixed length addresses. The Internet Protocol also provides for fragmentation and reassembly of long datagrams.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101028">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1101018">IPv6</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101237">Internet Protocol version 6.</a></div>
            <div class="CellBody"><a name="1101251">IPv6 is the newer version of the Internet Protocol that is meant to replace IPv4. IPv6 provides for an increased address space (from 32 bits to 128 bits). Similar to IPv4, IPv6 also provides functionalities such as forwarding, fragmentation, automatic discovery of default routers, fastest forwarding process using destination cache, neighbor cache and prefix list, hierarchical networking, and simplified packet format.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101022">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1101927">Mobile IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101929">Mobile Support for IPv4.</a></div>
            <div class="CellBody"><a name="1101930">Mobility IPv4 defines a protocol that allows transparent routing of IP datagrams to Mobile Nodes as they move about from one domain to another on the Internet. </a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101932">Multimdia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1101012">NDP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101014">Neighbor Discovery Protocol.</a></div>
            <div class="CellBody"><a name="1101287">NDP is used by nodes (hosts and routers) in an IPv6 network to determine the link-layer addresses for neighbors known to reside on attached links, to find neighboring routers that are willing to forward packets on their behalf, to actively keep track of which neighbors are reachable and which are not, and to detect changed link-layer addresses.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1101016">Developer</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading3Numbered">4.4.1.2  <a name="986227">Routing Protocols	</a></div>
      <div class="BodyAfterHead"><a name="986231">In general, routing refers to moving information across an internetwork and involves the following two activities: </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986232">Determination of an optimal path from a source to a destination</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986233">Transporting packets through an internetwork (also referred to as switching)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1084391">A routing algorithm determines an optimal path and stores the information in routing tables. Routers communicate with one another and maintain their routing tables through the transmission of a variety of messages. Based on the information stored in the routing table of a router, a packet is forwarded to the next node on the path to the destination.</a></div>
      <div class="Body"><span class="Variable"><a name="1084392">QualNet</a></span> provides a variety of routing protocols, which can be grouped into the following categories:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1084393">Unicast routing for wireless ad hoc networks</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986237">Unicast routing for wired networks</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986238">Unicast routing for mixed networks</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986239">Multicast routing for wireless networks</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986240">Multicast routing for wired networks</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading4"><a name="1049065">Unicast Routing	</a></div>
      <div class="BodyAfterHead"><a name="1049066">Routing can be done in a variety of ways. Depending upon the underlying network technology and topology, different choices can be made. In general, routing protocols can be viewed as being either proactive or reactive. While a proactive routing strategy is suitable for wired networks, it may not be a good choice for mobile ad hoc networks. On the other hand, reactive routing strategies generally work well for ad hoc networks but can cause extra overhead for wired networks.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1049067">Wireless Ad Hoc Networks</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1049068">One of the primary characteristics of an ad hoc network is that the network topology is constantly changing. For this reason, it is recommended that routes be evaluated only on an as-needed basis.</a></div>
      <div class="BulletedCont"><a name="1049069">Reactive routing protocols normally have two types of routing packets: </a><span style="font-style: italic">request</span>/<span style="font-style: italic">discovery</span> and <span style="font-style: italic">reply</span> packets. Request packets are normally flooded while reply packets are unicast. These types of routing protocols,e.g., AODV, DSR and LAR1, are efficient if routes are used infrequently and may be sub-optimal.</div>
      <div class="BulletedCont"><a name="1049070">Some proactive routing protocols are also suitable for ad hoc networks. An example of this type of routing protocol is OLSR. Proactive routing protocols mainly use two types of broadcasts: periodic and triggered. They are suitable if routes are used frequently and routes always need to be optimal.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1049071">Wired Networks</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1049072">Wired networks are comparatively stable and topology changes occur less frequently than in wireless ad hoc networks.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1049073">Mixed Networks</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1049074">AODV, DYMO. OSPFv2 and OSPFv3 are some of the Network Layer routing protocols that can be used throughout a mixed network, such as switched ethernet, point-to-point, and wireless ad hoc networks connected together.</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1048755', '');" title="Network Layer" name="1049062">Table&nbsp;4-8</a></span> lists the unicast routing protocols (implemented at the Network Layer) in <span class="Variable">QualNet</span>. The table also specifies whether a routing protocol is a proactive or on-demand protocol, and if it is supported in IPv4 networks, IPv6 networks, or both. See the corresponding model library for a detailed description of each protocol and its parameters.</div>
      <div class="Note_Indented"><a name="1048998"><img class="Default" src="images/Chapter%204-4.08.1.01.jpg" width="45" height="33" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Some routing protocols are implemented at the Application Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1043002', '');" title="Application Layer">Table&nbsp;4-3</a></span>)..</div>
      <table class="Format_A" style="text-align: left; width: 468.00000000000005pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-8.&nbsp;&nbsp;<a name="1048755">Unicast Routing Protocols in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1048765">Unicast Routing Protocol</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 183.6pt">
            <div class="CellHeading"><a name="1048767">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 64.8pt">
            <div class="CellHeading"><a name="1048769">Type</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 64.8pt">
            <div class="CellHeading"><a name="1048771">IP Version(s)</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 64.8pt">
            <div class="CellHeading"><a name="1048773">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048786">AODV</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048788">Ad-hoc On-demand Distance Vector (AODV) routing protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048790">On-demand</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048792">IPv4, IPv6</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048794">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048806">DSR</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048808">Dynamic Source Routing (DSR) protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048810">On-demand</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048812">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048814">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048816">DYMO</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048818">DYnamic MANET On-demand (DYMO) routing protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048820">On-demand</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048822">IPv4, IPv6</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048824">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048848">FSRL</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048850">Landmark Ad-hoc Routing (LANMAR) protocol. </a></div>
            <div class="CellBody"><a name="1048851">This protocol uses Fisheye as the local scope routing protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048853">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048855">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048857">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048859">IARP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048861">IntrA-zone Routing Protocol (IARP).</a></div>
            <div class="CellBody"><a name="1048862">This is a vector-based proactive routing protocol and is a component of ZRP.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048864">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048866">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048868">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048870">IERP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048872">Inter-zone Routing Protocol (IERP).</a></div>
            <div class="CellBody"><a name="1048873">This is an on-demand routing protocol and is a component of ZRP.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048875">On-demand</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048877">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048879">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048892">LAR1</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048894">Location-Aided Routing (LAR) protocol, version 1.</a></div>
            <div class="CellBody"><a name="1048895">This protocol utilizes location information to improve scalability of routing.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048897">On-demand</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048899">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048901">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048925">OSPFv2</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048927">Open Shortest Path First (OSPF) routing protocol, version 2.</a></div>
            <div class="CellBody"><a name="1048928">This is a link state-based routing protocol for IPv4 networks.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048930">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048932">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048934">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048936">OSPFv3</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048938">Open Shortest Path First (OSPF) routing protocol, version 3.</a></div>
            <div class="CellBody"><a name="1048939">This is a link state-based routing protocol for IPv6 networks.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048941">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048943">IPv6</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048945">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048968">STAR</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048970">Source Tree Adaptive Routing (STAR) protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048972">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048974">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048976">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1048978">ZRP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048980">Zone Routing Protocol (ZRP).</a></div>
            <div class="CellBody"><a name="1102071">ZRP uses IARP for intrazone routing and IERP for interzone routing. It uses BRP to optimiz routing between perimeter nodes.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048982">Hybrid (Proactive and On-demand)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048984">IPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1048986">Wireless</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading4"><a name="1084872">Multicast Routing	</a></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="1084873">QualNet</a></span> implements several multicast routing protocols for wired and wireless networks.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1084874">Wireless Networks</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1049095">Although other multicast routing protocols can be used for wireless networks, ODMRP is the recommended routing protocol for wireless networks. ODMRP uses a mesh-based multicast scheme and a forwarding group concept. The on-demand routing technique used by ODMRP helps to reduce channel overhead and to improve scalability.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1049096">Wired Networks</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1049097">Wired multicast routing protocols build a source-based multicast delivery tree. The tree is built when a router receives the first multicast data packet for a particular group. All of these protocols have their own forwarding function that is called when a node needs to forward a multicast data packet.</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1049217', '');" title="Network Layer" name="1049090">Table&nbsp;4-9</a></span> lists the different multicast routing protocols in <span class="Variable">QualNet</span>. The table also specifies whether a routing protocol is a proactive or on-demand protocol. See the corresponding model library for a detailed description of each protocol and its parameters.</div>
      <div class="Note_Indented"><a name="1049268"><img class="Default" src="images/Chapter%204-4.08.1.02.jpg" width="45" height="33" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />All multicast protocols listed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1049217', '');" title="Network Layer">Table&nbsp;4-9</a></span> are supported only for IPv4 networks.</div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-9.&nbsp;&nbsp;<a name="1049217">Multicast Routing Protocols in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1049225">Multicast Routing Protocol</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 241.2pt">
            <div class="CellHeading"><a name="1049227">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 64.8pt">
            <div class="CellHeading"><a name="1049229">Type</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 72pt">
            <div class="CellHeading"><a name="1049231">Model LIbrary</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049233">DVMRP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049235">Distance Vector Multiple Routing Protocol (DVMRP)</a></div>
            <div class="CellBody"><a name="1049236">DVMRP is a multicast routing protocol designed for wired networks. It is a tree-based multicast scheme that uses reverse path multicasting.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049238">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049240">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049242">MOSPF</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049244">Multicast Open Path Shortest First (MOSPF) protocol. </a></div>
            <div class="CellBody"><a name="1049245">This is a multicast extension of </a><span style="font-size: 10.0pt">OSPFv2</span>. MOSPF is a pruned tree-based, multicast scheme that takes advantage of commonality of paths from source to destinations. </div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049247">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049249">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049251">ODMRP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049253">On-Demand Multicast Routing Protocol (ODMRP).</a></div>
            <div class="CellBody"><a name="1049254">This is a mesh-based, wireless ad-hoc routing protocol for single subnets. It applies a soft on-demand procedures to build routes and uses soft state to maintain multicast group membership.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049256">On-demand</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049258">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049260">PIM</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049262">Protocol Independent Multicast (PIM) routing protocol.</a></div>
            <div class="CellBody"><a name="1049263">PIM relies on an underlying topology-gathering protocol to populate a routing table with routes. The routing table provides the next hop router along a multicast-capable path to each destination subnet. Both sparse mode and dense mode versions of the protocol are supported.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049265">Proactive</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049267">Multimedia and Enterprise</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading3Numbered">4.4.1.3  <a name="1049269">Queues</a></div>
      <div class="BodyAfterHead"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1049280', '');" title="Network Layer" name="1049273">Table&nbsp;4-10</a></span> lists the different queue models in <span class="Variable">QualNet</span>. See the corresponding model library for a detailed description of each model and its parameters.</div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-10.&nbsp;&nbsp;<a name="1049280">Queue Models in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 97.2pt">
            <div class="CellHeading"><a name="1049286">Queue</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 280.8pt">
            <div class="CellHeading"><a name="1049288">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1049290">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049292">FIFO</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049294">First In First Out (FIFO) queue.</a></div>
            <div class="CellBody"><a name="1049295">This is the basic queue type and is also called the Drop Tail queue. Packets are enqueued as long as there is buffer space available. If the queue is full when a packet arrives, the packet is dropped.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049297">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049299">RED</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049301">Random Early Drop (RED) queue.</a></div>
            <div class="CellBody"><a name="1049302">This queue is similar to FIFO, except that when the queue length exceeds a certain threshold, arriving packets are randomly dropped with a probability that depends on the queue length.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049304">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049306">RIO</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049308">RED with In/Out bit (RIO) queue.</a></div>
            <div class="CellBody"><a name="1049309">RIO is a multiple average multiple threshold variant of RED that operates two-color and three-color modes. Twin and three RED algorithms are used in two-color and three-color modes, respectively.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049311">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049313">WRED</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049315">Weighted Random Early Drop (WRED) queue.</a></div>
            <div class="CellBody"><a name="1049316">WRED is a variant of RED and uses three RED algorithms for three drop precedence levels.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049318">Developer</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading3Numbered">4.4.1.4  <a name="1049323">Schedulers</a></div>
      <div class="BodyAfterHead"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1049343', '');" title="Network Layer" name="1049336">Table&nbsp;4-11</a></span> lists the different scheduler models in <span class="Variable">QualNet</span>. See the corresponding model library for a detailed description of each model and its parameters. </div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-11.&nbsp;&nbsp;<a name="1049343">Scheduler Models in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 97.2pt">
            <div class="CellHeading"><a name="1049349">Scheduler</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 280.8pt">
            <div class="CellHeading"><a name="1049351">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1049353">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049355">CBQ</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049357">Class-based queuing algorithm.</a></div>
            <div class="CellBody"><a name="1049358">This algorithm is usually used by DiffServ. Queues are divided into classes. The network protocol allocates bandwidth for each queue. Scheduling is based on the bandwidth available to each class.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049360">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049362">DIFFSERV</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049364">Differentiated services (DiffServ) quality of service protocol.</a></div>
            <div class="CellBody"><a name="1049365">When this option is selected, DiffServ queues and schedulers are configured. The DiffServ scheduler for IP is a combination of two schedulers: the inner and outer schedulers. Generally, the weighted fair or weighted round-robin scheduler is chosen as the inner scheduler and the strict priority scheduler is chosen as the outer scheduler.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049367">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049369">ROUND-ROBIN</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049371">Round-robin scheduler.</a></div>
            <div class="CellBody"><a name="1049372">Queues are scheduled in a round-robin fashion.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049374">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049376">SELF-CLOCKED-FAIR</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049378">Self-clocked fair scheduler.</a></div>
            <div class="CellBody"><a name="1049379">Scheduling is based on the Self-Clocked Fair Queuing (SFFQ) algorithm.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049381">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049383">STRICT-PRIORITY</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049385">Strict priority scheduler.</a></div>
            <div class="CellBody"><a name="1049386">Packets are scheduled strictly based on their priority. A packet is scheduled only when all higher priority queues are empty.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049388">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049390">WEIGHTED-FAIR</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049392">Weighted fair scheduler.</a></div>
            <div class="CellBody"><a name="1049393">Scheduling is based on the Weighted Fair Queuing (WFQ) algorithm.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049395">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1049397">WEIGHTED-ROUND-ROBIN</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049399">Weighted Round-Robin (WRR) scheduler.</a></div>
            <div class="CellBody"><a name="1049400">This is a variant of the round-robin scheduler. The round-robin scheduler services one packet from each queue in turn. The WRR scheduler services multiple packets from each queue in turn, where the number of packets serviced depends on the queue’s weight.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1049402">Developer</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading2Numbered">4.4.2  <a name="986397">Network Layer Organization: Files and Folders</a></div>
      <div class="BodyAfterHead"><a name="986398">This section briefly examines the files and folders that are relevant to Network Layer protocols. These files contain detailed comments on functions and other code components.</a></div>
      <div class="Body"><a name="997798">The Network Layer API is composed of several macros, functions, and structures. These are defined in the following header files:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="986399">QUALNET_HOME</a></span>/include/api.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="986400">This file defines the events and data structures needed to communicate between different layers of the protocol stack.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="986401">QUALNET_HOME</a></span>/include/network.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="986402">This file contains definitions common to Network Layer protocols, the network data structure in the node structure, and the prototypes of functions defined in </a><span class="Variable">QUALNET_HOME</span>/main/network.cpp.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="986403">QUALNET_HOME</a></span>/libraries/developer/src/network_ip.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="986404">This file contains definitions of data structure and parameters used in the IP implementation and prototypes of the functions defined in </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.cpp.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1049491">QUALNET_HOME</a></span>/include/mapping.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1084304">This file contains definitions of data structures and functions used for determining the network type network protocols running at a node. </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1084305">QUALNET_HOME</a></span>/include/mac.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1084306">This file contains definitions of API functions needed to communicate with the MAC Layer.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1025416">QUALNET_HOME</a></span>/include/if_queue.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1025417">This file contains definition of the class that implements queues and prototypes of functions related to queues.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1025431">QUALNET_HOME</a></span>/include/if_scheduler.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1025432">This file contains definition of the class that implements schedulers and prototypes of functions related to schedulers.</a></div>
      <div class="Body"><a name="986405">The following header files are also relevant to the Network Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="986406">QUALNET_HOME</a></span>/include/fileio.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="986407">This file contains prototypes of functions to read input files and create output files. </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="986408">QUALNET_HOME</a></span>/include/buffer.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="997770">This file contains data structures and prototypes of functions for buffer operations.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="997771">QUALNET_HOME</a></span>/include/list.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="997772">This file defines a generic doubly link list structure and prototypes of functions for list operations.</a></div>
      <div class="Body"><a name="997808">The following are the folders and source files associated with the Network Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="986414">QUALNET_HOME</a></span>/libraries/developer/src, <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="986415">This folder contains most of the Network Layer protocols implemented in </a><span class="Variable">QualNet</span>. These include network protocols, routing protocols, queuing protocols, and schedulers. The file names are indicative of the protocol for which they provide an implementation. Other libraries may contain code for Network Layer protocols as well.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="997817">QUALNET_HOME</a></span>/main/network.cpp</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="997831">This file contains Network Layer functions, including the initialization, message processing, and finalization functions.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="997819">QUALNET_HOME</a></span>/libraries/developer/src/network_ip.cpp</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="997820">This file contains functions that implement the IP protocol.</a></div>
      <div class="Heading2Numbered">4.4.3  <a name="986416">Network Layer Data Structures</a></div>
      <div class="BodyAfterHead"><a name="992151">The Network Layer data structures are defined in network.h and network_ip.h. This section describes the main data structures. (Note that only a partial description of the data structures is provided here. Refer to files network.h and network_ip.h for a complete description.)</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><span style="font-family: &quot;Courier New&quot;"><a name="986438">NetworkRoutingProtocolType</a></span><span style="font-weight: bold">: </span>This enumeration type, defined in network.h, lists all the Network Layer protocols and all routing protocols, including those running at the Application Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991127">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991133">typedef enum</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991134">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991135">    NETWORK_PROTOCOL_IP = 0,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991136">    NETWORK_PROTOCOL_IPV6,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991131">    NETWORK_PROTOCOL_MOBILE_IP,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991140">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041625">    ROUTING_PROTOCOL_AODV6,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041626">    ROUTING_PROTOCOL_DYMO,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041627">    ROUTING_PROTOCOL_DYMO6,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1095389">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1095408">    ROUTING_PROTOCOL_NONE // this must be the last one</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991149">} NetworkRoutingProtocolType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991141">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993332">NetworkRoutingAdminDistanceType</a></span><span style="font-family: Arial">:</span><span style="font-family: Arial; font-weight: bold"> </span><span style="font-family: Arial">This enumeration type, defined in network.h, assigns an administrative distance to each routing protocol that is included in the list. The administrative distance of a routing protocol determines its priority relative to other routing protocols when a route to a destination can be determined by more than one routing protocol. A protocol with a lower administrative distance has a higher priority.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment_Large"><a name="999484">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="999485">typedef enum</a></div>
      <div class="Code_Segment_Large"><a name="999486">{</a></div>
      <div class="Code_Segment_Large"><a name="999487">    ROUTING_ADMIN_DISTANCE_STATIC = 1,</a></div>
      <div class="Code_Segment_Large"><a name="999488">    ROUTING_ADMIN_DISTANCE_EBGPv4 = 20,</a></div>
      <div class="Code_Segment_Large"><a name="999489">    ...</a></div>
      <div class="Code_Segment_Large"><a name="999490">    ROUTING_ADMIN_DISTANCE_OLSR,</a></div>
      <div class="Code_Segment_Large"><a name="999492">    ROUTING_ADMIN_DISTANCE_EIGRP,</a></div>
      <div class="Code_Segment_Large"><a name="999494">    //StartRIP</a></div>
      <div class="Code_Segment_Large"><a name="999495">    ROUTING_ADMIN_DISTANCE_RIP,</a></div>
      <div class="Code_Segment_Large"><a name="999496">    //EndRIP</a></div>
      <div class="Code_Segment_Large"><a name="1041232">    ...</a></div>
      <div class="Code_Segment_Large"><a name="1041244">    </a></div>
      <div class="Code_Segment_Large"><a name="999499">    // Should always have the highest administrative distance</a></div>
      <div class="Code_Segment_Large"><a name="999500">    // (i.e., least important).</a></div>
      <div class="Code_Segment_Large"><a name="999501">    ROUTING_ADMIN_DISTANCE_DEFAULT = 255</a></div>
      <div class="Code_Segment_Large"><a name="999502">} NetworkRoutingAdminDistanceType;</a></div>
      <div class="Code_Segment_Large"><a name="1000401">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084821">NetworkProtocolType</a></span><span style="font-family: Arial">: This enumeration type, defined in </span><span class="Variable">QUALNET_HOME</span><span style="font-family: Arial">/include/mapping.h, lists all network protocols supported in </span><span class="Variable">QualNet</span><span style="font-family: Arial">.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084822">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046622">typedef enum</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046600">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046601">    INVALID_NETWORK_TYPE,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046602">    IPV4_ONLY,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046603">    IPV6_ONLY,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046604">    DUAL_IP,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046605">    ATM_NODE,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046606">    GSM_LAYER3,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046607">    CELLULAR,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046608">    NETWORK_VIRTUAL</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046609">}NetworkProtocolType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046623">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1046590">IpInterfaceInfoType</a></span>: This data structure, defined in network_ip.h, stores information for a specific interface, such as the routing protocol and scheduler running at the interface. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993333">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993334">struct IpInterfaceInfoType</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993335">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1095442">    // Constructor.  All member variables MUST be initialized in the</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1095443">    // constructor.</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1045790">    IpInterfaceInfoType();</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1095455">    Scheduler* scheduler;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993338">    Scheduler* inputScheduler;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1045798">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993339">    D_NodeAddress ipAddress;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993340">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993341">    NetworkRoutingProtocolType              routingProtocolType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993342">    void*                                   routingProtocol;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993343">    BOOL multicastEnabled;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993344">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993345">    NetworkRoutingProtocolType multicastProtocolType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993346">    void *multicastRoutingProtocol;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993347">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993348">    MacLayerAckHandlerType                  macAckHandler;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993349">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993350">    // IPv6 interface information</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993351">    NetworkType interfaceType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1046638">    BOOL isVirtualInterface;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1045804">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993352">    struct ipv6_interface_struct* ipv6InterfaceInfo;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1045799">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993353">};</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041461">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1041462">NetworkForwardingTableRow</a></span>: This data structure, defined in network_ip.h, stores one row of the forwarding table. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991674">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991681">typedef struct</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991655">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991656">    NodeAddress destAddress;       // destination address</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991657">    NodeAddress destAddressMask;   // subnet destination Mask</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991658">    int interfaceIndex;            // index of outgoing interface</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991659">    NodeAddress nextHopAddress;    // next hop IP address</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991661">    int cost;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991663">    // routing protocol type</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991664">    NetworkRoutingProtocolType protocolType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991666">    // administrative distance for the routing protocol</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991667">    NetworkRoutingAdminDistanceType adminDistance;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991669">    BOOL interfaceIsEnabled;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991670">} NetworkForwardingTableRow;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991697">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="991694">NetworkForwardingTable</a></span>: This data structure, defined in network_ip.h, stores the forwarding table. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991706">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991729">typedef struct</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991708">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991709">    int size;                        // Number of entries</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991710">    int allocatedSize;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991711">    NetworkForwardingTableRow *row;  // Pointer to first row</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991712">} NetworkForwardingTable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991704">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="992071">NetworkMulticastForwardingTableRow</a></span>: This data structure, defined in network_ip.h, stores one row of the multicast forwarding table. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992072">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992073">typedef struct</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992111">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992112">    NodeAddress sourceAddress;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992113">    NodeAddress sourceAddressMask;        // Not used</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992114">    NodeAddress multicastGroupAddress;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992115">    LinkedList *outInterfaceList;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992092">} NetworkMulticastForwardingTableRow;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992119">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="992093">NetworkMulticastForwardingTable</a></span>: This data structure, defined in network_ip.h, stores the multicast forwarding table. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992094">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992095">typedef struct</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992097">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992098">    int size;                                 // Number of entries</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992099">    int allocatedSize;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992100">    NetworkMulticastForwardingTableRow *row;  // Pointer to first row</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992102">} NetworkMulticastForwardingTable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992103">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="991833">NetworkDataIp</a></span>: This data structure, defined in network_ip.h, is the main data structure for the Network Layer and stores information about all Network Layer protocols running at the node. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991840">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991850">typedef struct struct_network_ip_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991852">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991853">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991855">    NetworkForwardingTable      forwardTable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991858">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991859">    IpInterfaceInfoType* interfaceInfo[MAX_NUM_INTERFACES];</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991867">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991878">    NetworkIpStatsType stats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991880">    LinkedList                          *multicastGroupList;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991868">    NetworkMulticastForwardingTable     multicastForwardingTable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991842">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991886">} NetworkDataIp;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991892">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1084251">NetworkData</a></span>: This data structure stores the network protocol type running at the node and a pointer to the network protocol data structure. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991970">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041651">struct struct_network_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041652">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041653">    NetworkDataIp* networkVar;  // IP state</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1102347">    NetworkProtocolType networkProtocol;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041656">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041662">    BOOL networkStats;  // TRUE if network statistics are collected</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041664">    //It is true if ARP is enabled</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041665">    BOOL isArpEnable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041666">    //It is true if RARP is enabled</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041667">    BOOL isRarpEnable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041668">    struct address_resolution_module *arModule;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1102354">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="991980">};</a></span></div>
      <div class="Heading2Numbered">4.4.4  <a name="986555">Network Layer APIs and Inter-layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1009605">This section describes the API used by the Transport Layer to communicate with the Network Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1009555', '');" title="Network Layer">Section&nbsp;4.4.4.1</a></span>), the APIs used by the Network Layer to communicate with the Transport Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1009546', '');" title="Network Layer">Section&nbsp;4.4.4.2</a></span>), the APIs used by the Network Layer protocols to communicate with the MAC Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1009570', '');" title="Network Layer">Section&nbsp;4.4.4.3</a></span>), and the APIs used by the MAC Layer to communicate with the Network Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1009582', '');" title="Network Layer">Section&nbsp;4.4.4.4</a></span>). This section also lists some of the Network Layer utility APIs (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1009728', '');" title="Network Layer">Section&nbsp;4.4.4.5</a></span>).</div>
      <div class="Body"><a name="1009988">The complete list of APIs, with their parameters and description, can be found in </a><span style="font-style: italic">API Reference Guide</span>.</div>
      <div class="Heading3Numbered">4.4.4.1  <a name="1009555">Transport Layer to Network Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1009807">The Transport Layer communicates with the Network Layer by using the API NetworkIpReceivePacketFromTransportLayer. This function sends a packet from a Transport Layer protocol (UDP, TCP or RSVP-TE) to the IP protocol at the Network Layer. The prototype for this function is contained in the file network_ip.h. The file network_ip.cpp contains the implementation of NetworkIpReceivePacketFromTransportLayer.</a></div>
      <div class="Heading3Numbered">4.4.4.2  <a name="1009546">Network Layer to Transport Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1009649">Several APIs are available for the Network Layer to communicate with the Transport Layer. The prototypes for these functions are contained in the file network_ip.h. The file network_ip.cpp contains the implementation of these functions.</a></div>
      <div class="BodyAfterHead"><a name="992250">Some of the APIs used for communication from the Network Layer to the Transport Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992251">SendToUdp: This function sends a packet to the UDP protocol at the Transport Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992287">SendToTcp: This function sends a packet to the TCP protocol at the Transport Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992285">SendToRsvp: This function sends a packet to the RSVP-TE protocol at the Transport Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.4.3  <a name="1009570">Network Layer to MAC Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1009786">A number of APIs are available at the Network Layer to communicate with the MAC Layer. The prototypes for the API functions are contained in the files network_ip.h and </a><span class="Variable">QUALNET_HOME</span>/include/mac.h. The files network_ip.cpp and <span class="Variable">QUALNET_HOME</span>/main/mac.cpp contain the implementation of these functions. </div>
      <div class="Body"><a name="1009787">Some of the APIs used for communication from the Network Layer to the MAC Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992252">NetworkIpSendRawMessage: This function adds an IP header to a packet and calls function RoutePacketAndSendToMac to add routing information to the packet. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992322">NetworkIpSendRawMessageWithDelay: This function adds an IP header to a packet and calls function RoutePacketAndSendToMac, after a specified delay, to add routing information to the packet. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992310">NetworkIpSendRawMessageToMacLayer: This function adds an IP header to a packet and sends the packet to the MAC Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992326">NetworkIpSendRawMessageToMacLayerWithDelay: This function adds an IP header to a packet and sends the packet to the MAC Layer after a specified delay.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992332">NetworkIpSendPacketToMacLayer: This function sends an IP packet to the MAC Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992346">NetworkIpSendPacketToMacLayerWithNewStrictSourceRoute: This function appends a new source route to an IP packet and sends the packet to the MAC Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009712">MAC_NetworkLayerHasPacketToSend: This function is used by the Network Layer to inform the MAC Layer that a packet is ready to be sent.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.4.4  <a name="1009582">MAC Layer to Network Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1009668">MAC Layer protocols use several APIs to communicate with the Network Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1004439', '');" title="MAC Layer">Section&nbsp;4.5.4.2</a></span>). These APIs, in turn, call functions implemented at the Network Layer. The prototypes for these Network Layer functions are contained in the file network_ip.h or network.h, and the implementation of these functions are contained in the file network_ip.cpp or <span class="Variable">QUALNET_HOME</span>/main/network.cpp.</div>
      <div class="BodyAfterHead"><a name="1009669">Some of the Network Layer functions used for communication from the MAC Layer to the Network Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009683">NetworkIpOutputQueueIsEmpty: This functions checks if the output queue at an interface is empty.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009684">NetworkIpOutputQueueDequeuePacket: This function dequeues a packet from an output queue. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009685">NetworkIpOutputQueueTopPacket: This function is used to view the top packet of a queue without dequeuing it.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009686">NetworkIpOutputQueueDequeuePacketForAPriority: This function dequeues a specific priority packet from an output queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009688"> NETWORK_ReceivePacketFromMacLayer: This function is used by the MAC Layer to pass an incoming packet to the Network Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009689">NetworkIpReceiveMacAck: This function notifies the Network Layer that a packet has been successfully delivered by the MAC protocol.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009690">NetworkIpNotificationOfPacketDrop: This function notifies the upper layer protocols when a packet is dropped at the MAC Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.4.5  <a name="1009728">Network Layer Utility APIs</a></div>
      <div class="BodyAfterHead"><a name="1009729">Several APIs are available at the Network Layer that perform tasks internal to the Network Layer. Some of these functions can be used by other layers as well. The prototypes for these API functions are contained in the file network_ip.h. The file network_ip.cpp contains the implementation of these functions. </a></div>
      <div class="Body"><a name="1009771">Some of the Network Layer utility APIs are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009751">NetworkIpSetPromiscuousMessagePeekFunction: This function registers the function that promiscuously peeks at packets with IP. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009752">NetworkIpSetMacLayerAckHandler: This function registers the function that processes MAC Layer acknowledgements with IP. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009753">NetworkIpSetRouterFunction: This function registers a routing protocol’s router function with IP. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009754">NetworkIpGetRouterFunction: This function is used by IP to get a pointer to the router function used by a routing protocol at a given interface.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009948">NetworkIpGetInterfaceAddress: This function returns the node address for the specified interface.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading2Numbered">4.4.5  <a name="986790">Adding a Network Layer Unicast Routing Protocol</a></div>
      <div class="BodyAfterHead"><a name="986791">This section provides an overview of the flow of a Network Layer unicast routing protocol and provides an outline for developing and adding a new Network Layer unicast routing protocol to </a><span class="Variable">QualNet</span>. It describes how to develop code components common to most routing protocols such as initializing, sending and receiving packets, determining routes, and collecting statistics.</div>
      <div class="Body"><a name="998942">We illustrate the process of adding a Network Layer unicast routing protocol by using as an example the implementation code for the AODV (Ad Hoc On-demand Distance Vector) routing protocol. The header file for the AODV implementation is routing_aodv.h and the source file is routing_aodv.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src. We use code snippets from these two files throughout this section to illustrate different steps in writing a Network Layer unicast routing protocol. After understanding the discussed snippets, look at the complete code for AODV to understand how a Network Layer unicast routing protocol is implemented in <span class="Variable">QualNet</span>.</div>
      <div class="Body"><a name="992908">The following list summarizes the actions that need to be performed for adding a Network Layer routing protocol to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="992912">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993059', '');" title="Network Layer">Section&nbsp;4.4.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992916">Modify the file network_ip.cpp to include the protocol’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993059', '');" title="Network Layer">Section&nbsp;4.4.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992920">Include the protocol in the list of Network Layer protocols and trace protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993167', '');" title="Network Layer">Section&nbsp;4.4.5.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992924">Define data structures for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993370', '');" title="Network Layer">Section&nbsp;4.4.5.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992928">Decide on the format for the protocol-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993447', '');" title="Network Layer">Section&nbsp;4.4.5.5.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992929">Call the protocol’s initialization function from the routing initialization function, IpRoutingInit (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993495', '');" title="Network Layer">Section&nbsp;4.4.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="994430">Write the initialization function for the protocol. The initialization function should include the following tasks:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="994434">Read and store the configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994547', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="998026">Initialize the state variables and routing table (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994662', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="998044">Register the protocol’s callback functions with IP (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994673', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="994441">Initialize timers (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994680', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001128">Call the protocol event dispatcher from the IP event dispatcher, NetworkIpLayer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995544', '');" title="Network Layer">Section&nbsp;4.4.5.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002598">Declare any new event types used by the protocol in the header file </a><span class="Variable">QUALNET_HOME</span>/include/api.h (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995693', '');" title="Network Layer">Section&nbsp;4.4.5.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001135">Write the protocol event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995693', '');" title="Network Layer">Section&nbsp;4.4.5.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001139">Modify the IP function NetworkRoutingGetAdminDistance (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995882', '');" title="Network Layer">Section&nbsp;4.4.5.7</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001136">Implement the protocol’s routing packet handler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="992954">Define an IP Protocol Number for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995901', '');" title="Network Layer">Section&nbsp;4.4.5.8.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992955">Write a function to handle routing packets (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1004990', '');" title="Network Layer">Section&nbsp;4.4.5.8.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992956">Call the routing packet handler function from the IP function DeliverPacket (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995901', '');" title="Network Layer">Section&nbsp;4.4.5.8.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992957">Write the router function and any other call back functions used by the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995933', '');" title="Network Layer">Section&nbsp;4.4.5.9</a></span>). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998086">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="992961">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996149', '');" title="Network Layer">Section&nbsp;4.4.5.10.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992965">Initialize the statistics variables in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996158', '');" title="Network Layer">Section&nbsp;4.4.5.10.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992969">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996176', '');" title="Network Layer">Section&nbsp;4.4.5.10.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992973">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996188', '');" title="Network Layer">Section&nbsp;4.4.5.10.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1096411">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1096485', '');" title="Network Layer">Section&nbsp;4.4.5.10.5</a></span>) .</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992974">Call the protocol finalization function from the IP finalization function, NetworkIpFinalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996200', '');" title="Network Layer">Section&nbsp;4.4.5.11.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992981">Write the protocol finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996234', '');" title="Network Layer">Section&nbsp;4.4.5.11.2</a></span>). Call the function to print statistics from the protocol finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">17.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992985">Include the protocol header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084720', '');" title="Network Layer">Section&nbsp;4.4.5.12</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">18.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1096436">To make the protocol available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1096532', '');" title="Network Layer">Section&nbsp;4.4.5.13</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.5.1  <a name="993055">Naming Guidelines</a></div>
      <div class="BodyAfterHead"><a name="1084789">In </a><span class="Variable">QualNet</span>, each component (file, data structure, function, etc.) is given a name that indicates the name of the protocol, the layer in which the protocol resides, and the functionality of the component, as appropriate. We recommend that when adding a new protocol, the programmer name the different components of the new protocol in a similar manner. It will be helpful to examine the implementation of AODV in <span class="Variable">QualNet</span> for hints for naming and coding different components of the new protocol.</div>
      <div class="Body"><a name="993057">In this section, we describe the steps for developing a Network Layer unicast routing protocol called “MYPROTOCOL”. We will use the string “Myprotocol” in the names of the different components of this protocol, just as the string “Aodv” appears in the names of the components of the AODV implementation. </a></div>
      <div class="Heading3Numbered">4.4.5.2  <a name="993059">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1041779">The first step towards adding a Network Layer routing protocol is creating files. Most models comprise two files: the header file and the source file. These files can be placed in any library, e.g., in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. However, it is recommended that all user-developed models be made part of a library. In our example, we will place the routing protocol in a library called user_models. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#954568', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10</a></span> for instructions for creating and activating a library.</div>
      <div class="BodyAfterHead"><a name="1041783">If it doesn’t already exist, create a directory in </a><span class="Variable">QUALNET_HOME</span>/library called user_models and a subdirectory in <span class="Variable">QUALNET_HOME</span>/library/user_models called src. Create the files for the routing protocol and place them in the folder <span class="Variable">QUALNET_HOME</span>/library/user_models/src. Name these files in a way that clearly indicates the model that they implement. For unicast routing protocols, prefix the file names with <span style="font-style: italic">routing_</span>. For multicast routing protocols, prefix the file names with <span style="font-style: italic">multicast_</span>.</div>
      <div class="Body"><a name="993061">	Examples:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993062">routing_aodv.cpp, routing_aodv.h: Implement AODV (Ad Hoc On-demand Distance Vector routing protocol)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993063">routing_dsr.cpp, routing_dsr.h: Implement DSR (Dynamic Source Routing protocol)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1042993">multicast_mospf.cpp, multicast_mospf.h: Implement the MOSPF (Multicast Open Shortest Path First) protocol.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="993067">In keeping with the naming guidelines of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993055', '');" title="Network Layer">Section&nbsp;4.4.5.1</a></span>, the header file for the example protocol is called routing_myprotocol.h, and the source file is called routing_myprotocol.cpp.</div>
      <div class="Note_Indented"><a name="993071"><img class="Default" src="images/Chapter%204-4.08.1.03.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems, even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="993072">While adding code to the files, it is important to organize the code well between the files. Generally, the header file, routing_protocol.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993073">	Prototypes for interface functions in source file, routing_myprotocol.cpp</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993074">	Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993075">	Data structure definitions and data types: </a><span style="font-family: &quot;Courier New&quot;">struct</span> and <span style="font-family: &quot;Courier New&quot;">enum</span> declarations</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="993076">The source file, routing_myprotocol.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993077">Statement to include the protocol’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="993078">	</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993079">#include “routing_myprotocol.h”</a></span></div>
      <div class="Code_Segment"><a name="993080">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993081">Statements to include standard library functions and other header files needed by the protocol source file. A typical protocol source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993082">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993083">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993084">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993086">#include "api.h"          // </a></span><span class="Variable">QUALNET_HOME</span>/include/api.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993088">#include "network_ip.h" </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041859">                 // </a></span><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.h. </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041486">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001985">Protocol initialization function, MyprotocolInit</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001986">Protocol event dispatcher function, MyprotocolHandleProtocolEvent</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1041860">Protocol packet handler function, MyprotocolHandleProtocolPacket</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001987">Protocol finalization function, MyprotocolFinalize</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001988">Additional protocol implementation functions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1002010">The file network_ip.cpp contains the IP initialization, routing initialization, event dispatcher, and finalization functions. These IP functions in turn call the routing protocol functions MyprotocolInit, MyprotocolHandleProtocolEvent and MyprotocolFinalize. Therefore, to make these protocol functions available to the IP functions, insert the following include statement in the file network_ip.cpp:</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993095">	</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1102430">#include “routing_myprotocol.h”</a></span></div>
      <div class="Heading3Numbered">4.4.5.3  <a name="993167">Including MYPROTOCOL in List of Routing Protocols</a></div>
      <div class="BodyAfterHead"><a name="1084186">Each node in </a><span class="Variable">QualNet</span> maintains a list of routing protocols running at the node. When a new Network Layer unicast routing protocol is added to <span class="Variable">QualNet</span>, it needs to be included in the list of Network Layer protocols. To do this, add the protocol name to the enumeration <span style="font-family: &quot;Courier New&quot;">NetworkRoutingProtocolType</span> defined in <span class="Variable">QUALNET_HOME</span>/include/network.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>). </div>
      <div class="Body"><a name="1084190">For our example protocol, add the entry </a><span style="font-family: &quot;Courier New&quot;">ROUTING_PROTOCOL_MYPROTOCOL</span> to <span style="font-family: &quot;Courier New&quot;">NetworkRoutingProtocolType</span><span style="font-size: 9.0pt"> </span>as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993183', '');" title="Network Layer">Figure&nbsp;4-67</a></span>.</div>
      <div class="Code_Segment"><a name="1043090">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043091">typedef enum</a></div>
      <div class="Code_Segment"><a name="1043092">{</a></div>
      <div class="Code_Segment"><a name="1043093">    NETWORK_PROTOCOL_IP = 0,</a></div>
      <div class="Code_Segment"><a name="1043094">    NETWORK_PROTOCOL_IPV6,</a></div>
      <div class="Code_Segment"><a name="1043095">    NETWORK_PROTOCOL_MOBILE_IP,</a></div>
      <div class="Code_Segment"><a name="1043096">    ...</a></div>
      <div class="Code_Segment"><a name="1043097">    ROUTING_PROTOCOL_AODV6,</a></div>
      <div class="Code_Segment"><a name="1043098">    ROUTING_PROTOCOL_DYMO,</a></div>
      <div class="Code_Segment"><a name="1043099">    ROUTING_PROTOCOL_DYMO6,</a></div>
      <div class="Code_Segment"><a name="1095486">    ...</a></div>
      <div class="Code_New"><a name="1043100">    ROUTING_PROTOCOL_MYPROTOCOL;</a></div>
      <div class="Code_Segment"><a name="1095470">    ROUTING_PROTOCOL_NONE // this must be the last one</a></div>
      <div class="Code_Segment"><a name="1043101">} NetworkRoutingProtocolType;</a></div>
      <div class="Figure">FIGURE 4-67.&nbsp;&nbsp;<a name="993183">Adding MYPROTOCOL to List of Network Layer Protocols</a></div>
      <div class="Note_Indented"><a name="1084764"><img class="Default" src="images/Chapter%204-4.08.1.04.jpg" width="48" height="32" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files.</a></div>
      <div class="Body"><span class="Variable"><a name="1084765">QualNet</a></span> provides for detailed traces of packets as they traverse the protocol stack at nodes in the network. A packet trace lists, among other information, the protocol that is handling the packet at the time of the trace. To facilitate tracing, <span class="Variable">QualNet</span> lists all protocols in an enumeration, <span style="font-family: &quot;Courier New&quot;">TraceProtocolType</span>, in the file <span class="Variable">QUALNET_HOME</span>/include/trace.h. For our example protocol, add an entry <span style="font-family: &quot;Courier New&quot;">TRACE_MYPROTOCOL</span> in<span style="font-family: &quot;Courier New&quot;"> TraceProtocolType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1004903', '');" title="Network Layer">Figure&nbsp;4-68</a></span>.</div>
      <div class="Code_Segment"><a name="1004886">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1004887">typedef enum</a></div>
      <div class="Code_Segment"><a name="1004888">{</a></div>
      <div class="Code_Segment"><a name="1004889">    TRACE_UNDEFINED = 0,</a></div>
      <div class="Code_Segment"><a name="1041250">    TRACE_TCP,            // 1</a></div>
      <div class="Code_Segment"><a name="1004890">    TRACE_UDP,                // 2</a></div>
      <div class="Code_Segment"><a name="1004891">    TRACE_IP,                 // 3</a></div>
      <div class="Code_Segment"><a name="1004892">    ...</a></div>
      <div class="Code_New"><a name="1004895">    TRACE_MYPROTCOL,</a></div>
      <div class="Code_Segment"><a name="1004899">    // Must be last one!!!</a></div>
      <div class="Code_Segment"><a name="1004900">    TRACE_ANY_PROTOCOL</a></div>
      <div class="Code_Segment"><a name="1004901">}TraceProtocolType;</a></div>
      <div class="Figure">FIGURE 4-68.&nbsp;&nbsp;<a name="1004903">Adding MYPROTOCOL to List of Trace Protocols</a></div>
      <div class="Note_Indented"><a name="1004907">Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">TRACE_ANY_PROTOCOL</span>). <img class="Default" src="images/Chapter%204-4.08.1.05.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></div>
      <div class="Body"><a name="1000417">A routing administrative distance is assigned to each routing protocol, which determines its priority relative to other routing protocols. A protocol with a lower administrative distance has a higher priority. The administrative distances of all routing protocols are defined in the enumeration </a><span style="font-family: &quot;Courier New&quot;">NetworkRoutingAdminDistanceType</span> defined in network.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>).</div>
      <div class="Body"><a name="1000421">For our example protocol, add the entry </a><span style="font-family: &quot;Courier New&quot;">ROUTING_ADMIN_DISTANCE_MYPROTOCOL</span> to <span style="font-family: &quot;Courier New&quot;">NetworkRoutingAdminDistanceType</span><span style="font-size: 9.0pt"> </span>as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1000445', '');" title="Network Layer">Figure&nbsp;4-69</a></span>. Add this entry in the proper place in the list to reflect the desired priority of MYPROTOCOL relative to the other routing protocols.</div>
      <div class="Code_Segment"><a name="1000425">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000426">typedef enum</a></div>
      <div class="Code_Segment"><a name="1000427">{</a></div>
      <div class="Code_Segment"><a name="1000428">    ROUTING_ADMIN_DISTANCE_STATIC = 1,</a></div>
      <div class="Code_Segment"><a name="1000429">    ROUTING_ADMIN_DISTANCE_EBGPv4 = 20,</a></div>
      <div class="Code_Segment"><a name="1000430">    ...</a></div>
      <div class="Code_Segment"><a name="1000432">    ROUTING_ADMIN_DISTANCE_OLSR,</a></div>
      <div class="Code_Segment"><a name="1000433">    ROUTING_ADMIN_DISTANCE_EIGRP,</a></div>
      <div class="Code_New"><a name="1000434">    ROUTING_ADMIN_DISTANCE_MYPROTOCOL,</a></div>
      <div class="Code_Segment"><a name="1000435">    //StartRIP</a></div>
      <div class="Code_Segment"><a name="1000436">    ROUTING_ADMIN_DISTANCE_RIP,</a></div>
      <div class="Code_Segment"><a name="1000437">    //EndRIP</a></div>
      <div class="Code_Segment"><a name="1000438">    ...</a></div>
      <div class="Code_Segment"><a name="1000440">    // Should always have the highest administrative distance</a></div>
      <div class="Code_Segment"><a name="1000441">    // (i.e., least important).</a></div>
      <div class="Code_Segment"><a name="1000442">    ROUTING_ADMIN_DISTANCE_DEFAULT = 255</a></div>
      <div class="Code_Segment"><a name="1000443">} NetworkRoutingAdminDistanceType;</a></div>
      <div class="Figure">FIGURE 4-69.&nbsp;&nbsp;<a name="1000445">Declaring Administrative Distance for MYPROTOCOL</a></div>
      <div class="Heading3Numbered">4.4.5.4  <a name="993370">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="993371">Each routing protocol has its own data structures, which are defined in the protocol’s header file. The data structures store information such as:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="993375">Protocol parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994547', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="993376">Protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994662', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="993380">Statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996149', '');" title="Network Layer">Section&nbsp;4.4.5.10.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="993405">Routing table (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994662', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="993406">Define an appropriate data structure for MYPROTOCOL called </a><span style="font-family: &quot;Courier New&quot;">MyprotocolData</span> in the protocol header file, routing_protocol.h. As an example, the following data structure (defined in routing_aodv.h) is used by the AODV protocol:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993407">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993408">typedef struct struct_network_aodv_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993409">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993410">    // set of user configurable parameters</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993411">    Int32        netDiameter;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993412">    clocktype    nodeTraversalTime;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993413">    clocktype    myRouteTimeout;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993414">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993415">    // set of aodv protocol dependent parameters</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993416">    AodvRoutingTable routeTable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993417">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993418">    AodvStats stats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993419">    BOOL statsCollected;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993420">    BOOL statsPrinted;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993421">    BOOL processHello;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993422">    BOOL processAck;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993423">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993424">    BOOL isExpireTimerSet;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993425">    BOOL isDeleteTimerSet;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041942">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993426">} AodvData;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993427">&nbsp;</a></div>
      <div class="BodyAfterHead"><a name="994515">In the above declaration, </a><span style="font-family: &quot;Courier New&quot;">AodvRoutingTable</span> is the data structure for the AODV routing table and <span style="font-family: &quot;Courier New&quot;">AodvStats</span> is the data structure for AODV statistics (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996149', '');" title="Network Layer">Section&nbsp;4.4.5.10.1</a></span>).</div>
      <div class="Heading3Numbered">4.4.5.5  <a name="994520">Initialization</a></div>
      <div class="BodyAfterHead"><a name="993445">In this section, we describe the tasks that need to be performed as part of the initialization process of a Network Layer routing protocol.</a></div>
      <div class="Heading4Numbered">4.4.5.5.1  <a name="993447">Determining the Protocol Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="1027284">A routing protocol may use protocol-specific configuration parameters. The configuration parameters are specified in the </a><span class="Variable">QualNet</span> configuration file. The format for specifying a routing protocol’s configuration parameters is:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1027285">[&lt;Identifier&gt;] &lt;Parameter-name&gt; [&lt;Index&gt;] &lt;Parameter-value&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1027286">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="1027287">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1027288"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;	</span>: Node identifier, subnet identifier, or IP address to which this parameter declaration is applicable, enclosed in square brackets. This specification is optional, and if it is not included, the parameter declaration applies to all nodes.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="1027289">&lt;Parameter-name&gt;	</a></span>: Name of the parameter.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1027290"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;	</span>: Instance to which this parameter declaration is applicable, enclosed in square brackets. This is used when there are multiple instances of the parameter. This specification is optional, and if it is not included, the parameter declaration applies to all instances.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><span style="font-family: &quot;Courier New&quot;"><a name="1027291">&lt;Parameter-value&gt;</a></span>	: Value to be used for the parameter.</div>
      <div class="Body"><a name="1084171">As an example, the following are some of the configuration parameters for the AODV protocol. Refer to file </a><span class="Variable">QUALNET_HOME</span>/scenarios/default/default.config for an explanation of these parameters.</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084172">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1102479">AODV-ACTIVE-ROUTE-TIMEOUT   400MS</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993598">AODV-RREQ-RETRIES           3</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993605">AODV-LOCAL-REPAIR           YES</a></span></div>
      <div class="Body"><a name="993620">A configuration variable is not always mandatory. If an optional configuration variable is not assigned a value in the configuration file, the default value is used. For example, if a user does not specify a value for </a><span style="font-family: &quot;Courier New&quot;">AODV-ACTIVE-ROUTE-TIMEOUT</span>, the default value of 300 milliseconds is used by the protocol. </div>
      <div class="Body"><a name="1002057">Decide on the format for specifying the new routing protocol’s configuration parameters. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994547', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.1</a></span> explains how to read user input specified in this format to initialize the routing protocol.</div>
      <div class="Heading4Numbered">4.4.5.5.2  <a name="993495">Calling the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="993497">The protocol stack of each node is initialized in a bottom up manner. The initialization of the Network Layer thus occurs after the layers below it have been initialized. This process is performed in the node initialization function PARTITION_InitializeNodes, implemented in </a><span class="Variable">QUALNET_HOME</span>/main/partition.cpp<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#919750', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.1</a></span>).</div>
      <div class="Body"><a name="1042817">The node initialization function, PARTITION_InitializeNodes, calls the Network Layer initialization function NETWORK_Initialize, which is implemented in the file </a><span class="Variable">QUALNET_HOME</span>/main/network.cpp. Function NETWORK_Initialize, in turn, calls the IP initialization function NetworkIpInit and the routing initialization function IpRoutingInit, which are implemented in the file network_ip.cpp. Function NetworkIpInit in turn calls function NetworkIpParseAndSetRoutingProtocolType, which reads the name of the routing protocol for each interface from the configuration file and updates the routing protocol type for that interface. Function IpRoutingInit calls the initialization function of the routing protocol configured on the interface. The code snippets from NetworkIpParseAndSetRoutingProtocolType and IpRoutingInit corresponding to AODV is shown are <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1046735', '');" title="Network Layer">Figure&nbsp;4-70</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994389', '');" title="Network Layer">Figure&nbsp;4-71</a></span>, respectively. The functions used in the example are explained below.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993832">Function IO_ReadString reads the name of the routing protocol from the configuration file. The prototype for IO_ReadString is defined in </a><span class="Variable">QUALNET_HOME</span>/include/fileio.h.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993838">Function NetworkIpGetInterfaceAddress, defined in network_ip.cpp, returns the IP address associated with an interface.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993852">Function NetworkIpAddUnicastRoutingProtocolType, defined in network_ip.cpp, initializes the routing protocol information for an interface. In the example of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1046735', '');" title="Network Layer">Figure&nbsp;4-70</a></span>, NetworkIpAddUnicastRoutingProtocolType updates the <span style="font-family: &quot;Courier New&quot;">IpInterfaceInfoType</span> structure associated with the interface (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>) by setting the <span style="font-family: &quot;Courier New&quot;">routingProtocolType</span> field to <span style="font-family: &quot;Courier New&quot;">ROUTING_PROTOCOL_AODV</span> and the <span style="font-family: &quot;Courier New&quot;">routingProtocol</span> field to <span style="font-family: &quot;Courier New&quot;">NULL</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993890">Function NetworkIpGetRoutingProtocol, defined in network_ip.cpp, returns a pointer to the data structure associated with the specified routing protocol. If the same routing protocol is running at multiple interfaces of a node, a single instance of the data structure for the routing protocol is shared by all interfaces. If the routing protocol is running at one of the interfaces and that interface has been assigned a routing protocol structure, NetworkIpGetRoutingProtocol returns a pointer to that structure; otherwise, it returns </a><span style="font-family: &quot;Courier New&quot;">NULL</span>. In the example of <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994389', '');" title="Network Layer">Figure&nbsp;4-71</a></span>, NetworkIpGetRoutingProtocol returns a pointer to the structure <span style="font-family: &quot;Courier New&quot;">AodvData</span> or <span style="font-family: &quot;Courier New&quot;">NULL</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994010">Function AodvInit, defined in routing_aodv.cpp, is the initialization function for AODV. AodvInit is called if function NetworkIpGetRoutingProtocol returns </a><span style="font-family: &quot;Courier New&quot;">NULL</span>, i.e., an instance of <span style="font-family: &quot;Courier New&quot;">AodvData</span> is not associated with any interface. In addition to performing other initializing tasks (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994539', '');" title="Network Layer">Section&nbsp;4.4.5.5.3</a></span>), AodvInit creates an instance of the AODV data structure, <span style="font-family: &quot;Courier New&quot;">AodvData</span>, and associates it with the specified interface by updating the <span style="font-family: &quot;Courier New&quot;">routingProtocol</span> field of the <span style="font-family: &quot;Courier New&quot;">IpInterfaceInfoType</span> structure associated with the interface to point to the newly created instance of <span style="font-family: &quot;Courier New&quot;">AodvData</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="993925">Function NetworkIpUpdateUnicastRoutingProtocolAndRouterFunction, defined in network_ip.cpp, is called if function NetworkIpGetRoutingProtocol returns a non-</a><span style="font-family: &quot;Courier New&quot;">NULL</span> pointer, i.e., if AODV is running at another interface and an instance of <span style="font-family: &quot;Courier New&quot;">AodvData</span> has been associated with that interface. NetworkIpUpdateUnicastRoutingProtocolAndRouterFunction associates the same instance of <span style="font-family: &quot;Courier New&quot;">AodvData</span> with the specified interface. This ensures that even if a routing protocol is running at multiple interfaces of a node, all interfaces running the same routing protocol share one instance of the protocol data structure.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1046682">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1046683">void</a></div>
      <div class="Code_Segment"><a name="1046766">NetworkIpParseAndSetRoutingProtocolType (Node *node,</a></div>
      <div class="Code_Segment"><a name="1046767">                                         const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1046768">{</a></div>
      <div class="Code_Segment"><a name="1046769">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1046770">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="1046771">    ...</a></div>
      <div class="Code_Segment"><a name="1046772">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="1046773">    {</a></div>
      <div class="Code_Segment"><a name="1046774">         ...</a></div>
      <div class="Code_Segment"><a name="1046775">         IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1046776">                node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1046777">                NetworkIpGetInterfaceAddress(node, i),</a></div>
      <div class="Code_Segment"><a name="1046778">                nodeInput,</a></div>
      <div class="Code_Segment"><a name="1046779">                "ROUTING-PROTOCOL",</a></div>
      <div class="Code_Segment"><a name="1046780">                &amp;retVal,</a></div>
      <div class="Code_Segment"><a name="1046781">                protocolString);</a></div>
      <div class="Code_Segment"><a name="1046782">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1046783">        if (retVal)</a></div>
      <div class="Code_Segment"><a name="1046784">        {</a></div>
      <div class="Code_Segment"><a name="1046785">            ...</a></div>
      <div class="Code_Segment"><a name="1046786">            else if (strcmp(protocolString, "AODV") == 0)</a></div>
      <div class="Code_Segment"><a name="1046787">            {</a></div>
      <div class="Code_Segment"><a name="1046788">                routingProtocolType = ROUTING_PROTOCOL_AODV;</a></div>
      <div class="Code_Segment"><a name="1046789">            }</a></div>
      <div class="Code_Segment"><a name="1046790">            ...  </a></div>
      <div class="Code_Segment"><a name="1046791">        }</a></div>
      <div class="Code_Segment"><a name="1046792">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1046793">       NetworkIpAddUnicastRoutingProtocolType(</a></div>
      <div class="Code_Segment"><a name="1046794">                        node,</a></div>
      <div class="Code_Segment"><a name="1046795">                        routingProtocolType,</a></div>
      <div class="Code_Segment"><a name="1046796">                        i,</a></div>
      <div class="Code_Segment"><a name="1046731">                        NETWORK_IPV4);</a></div>
      <div class="Code_Segment"><a name="1046763">     }</a></div>
      <div class="Code_Segment"><a name="1046732">     ...</a></div>
      <div class="Code_Segment"><a name="1046733">}</a></div>
      <div class="Figure">FIGURE 4-70.&nbsp;&nbsp;<a name="1046735">Initializing Routing Protocol Information for an Interface</a></div>
      <div class="Code_Segment"><a name="993853">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1046874">void</a></div>
      <div class="Code_Segment"><a name="1046826">IpRoutingInit(Node *node,</a></div>
      <div class="Code_Segment"><a name="1046827">              const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1046828">{</a></div>
      <div class="Code_Segment"><a name="1046829">     ...</a></div>
      <div class="Normal" style="margin-left: 58.5pt; margin-right: 0pt; text-indent: 0pt"><a name="1046830">for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="1046831">    {</a></div>
      <div class="Normal" style="margin-left: 76.5pt; margin-right: 0pt; text-indent: 0pt"><a name="1046832">if (NetworkIpGetInterfaceType(node, i) == NETWORK_IPV4</a></div>
      <div class="" style="margin-left: 49.5pt; text-indent: 0pt"><a name="1046833">         || NetworkIpGetInterfaceType(node, i) == NETWORK_DUAL)</a></div>
      <div class="" style="margin-left: 76.5pt; text-indent: 0pt"><a name="1046834">{</a></div>
      <div class=""><a name="1046835">   switch (ip-&gt;interfaceInfo[i]-&gt;routingProtocolType)</a></div>
      <div class="Code_Segment"><a name="1046836">          {</a></div>
      <div class="Code_Segment" style="margin-left: 0pt; text-indent: 108pt"><a name="1046837">...</a></div>
      <div class="Normal" style="margin-right: 0pt"><a name="1046838">case ROUTING_PROTOCOL_AODV:</a></div>
      <div class=""><a name="1046839">{</a></div>
      <div class=""><a name="1046840">  if (!NetworkIpGetRoutingProtocol(node,</a></div>
      <div class=""><a name="1046841">                        ROUTING_PROTOCOL_AODV))</a></div>
      <div class=""><a name="1046842">  {</a></div>
      <div class=""><a name="1046843">     AodvInit(</a></div>
      <div class=""><a name="1046844">        node,</a></div>
      <div class=""><a name="1046845">        (AodvData**)&amp;ip-&gt;interfaceInfo[i]-&gt;routingProtocol,</a></div>
      <div class=""><a name="1046846">        nodeInput,</a></div>
      <div class=""><a name="1046847">        i,</a></div>
      <div class=""><a name="1046848">        ROUTING_PROTOCOL_AODV);</a></div>
      <div class=""><a name="1046849">  }</a></div>
      <div class=""><a name="1046850">  else</a></div>
      <div class=""><a name="1046851">  {</a></div>
      <div class="" style="margin-left: 135pt; text-indent: -9pt"><a name="1046852"> NetworkIpUpdateUnicastRoutingProtocolAndRouterFunction(</a></div>
      <div class="" style="margin-left: 0pt; text-indent: 108pt"><a name="1046853">                            node,</a></div>
      <div class=""><a name="1046854">                            ROUTING_PROTOCOL_AODV,</a></div>
      <div class=""><a name="1046855">                            i);</a></div>
      <div class=""><a name="1046856">  }</a></div>
      <div class=""><a name="1046857">  break;</a></div>
      <div class="Code_Segment" style="margin-left: 0pt; text-indent: 108pt"><a name="1046858">}</a></div>
      <div class="Code_Segment" style="margin-left: 0pt; text-indent: 108pt"><a name="1046859">...</a></div>
      <div class="Code_Segment" style="text-indent: 58.5pt"><a name="1046860">}</a></div>
      <div class="Code_Segment" style="margin-left: 76.5pt; text-indent: 0pt"><a name="1046861">}</a></div>
      <div class="Code_Segment"><a name="1046862">     }</a></div>
      <div class="Code_Segment"><a name="1046863">  ...</a></div>
      <div class="Code_Segment"><a name="1046879">}</a></div>
      <div class="Figure">FIGURE 4-71.&nbsp;&nbsp;<a name="994389">Calling AODV Initialization Function from Routing Initialization Function</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994396', '');" title="Network Layer" name="994481">Figure&nbsp;4-72</a></span> shows the modifications to be made to IpRoutingInit to incorporate MYPROTOCOL in <span class="Variable">QualNet</span>. MyprotocolInit is the initialization function (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994539', '');" title="Network Layer">Section&nbsp;4.4.5.5.3</a></span>) and <span style="font-family: &quot;Courier New&quot;">MyprotocolData</span> is the protocol data structure (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993370', '');" title="Network Layer">Section&nbsp;4.4.5.4</a></span>) for MYPROTOCOL. </div>
      <div class="Code_Segment"><a name="994118">&nbsp;</a></div>
      <div class="Code_Segment"><a name="994119">void</a></div>
      <div class="Code_Segment"><a name="994120">IpRoutingInit(Node *node, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="994121">{</a></div>
      <div class="Code_Segment"><a name="994122">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1046898">    ...</a></div>
      <div class="Code_Segment"><a name="1046908">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="1046909">    {</a></div>
      <div class="Code_Segment"><a name="1046910">        if (NetworkIpGetInterfaceType(node, i) == NETWORK_IPV4</a></div>
      <div class="Code_Segment"><a name="1046911">            || NetworkIpGetInterfaceType(node, i) == NETWORK_DUAL)</a></div>
      <div class="Code_Segment"><a name="1046912">        {</a></div>
      <div class="Code_Segment"><a name="1046913">            switch (ip-&gt;interfaceInfo[i]-&gt;routingProtocolType)</a></div>
      <div class="Code_Segment"><a name="1046899">            {  </a></div>
      <div class="Code_Segment"><a name="994127">               ...</a></div>
      <div class="Code_Segment"><a name="1046920">                case ROUTING_PROTOCOL_AODV:</a></div>
      <div class="Code_Segment"><a name="1046921">                {</a></div>
      <div class="Code_Segment"><a name="1046922">                    ...</a></div>
      <div class="Code_Segment"><a name="1042084">                }</a></div>
      <div class="Code_Segment"><a name="1046950">                ...</a></div>
      <div class="Code_New"><a name="1046959">                case ROUTING_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1046960">                {</a></div>
      <div class="Code_New"><a name="1046961">                    if (!NetworkIpGetRoutingProtocol(node,</a></div>
      <div class="Code_New"><a name="1046962">                        ROUTING_PROTOCOL_MYPROTOCOL))</a></div>
      <div class="Code_New"><a name="1046963">                    {</a></div>
      <div class="Code_New"><a name="1047030">                        MyprotocolInit(</a></div>
      <div class="Code_New"><a name="1047062">                                node, </a></div>
      <div class="Code_New"><a name="1047031">                             (MyprotocolData **) <br />                                       &amp;ip-&gt;interfaceInfo[i]-&gt;routingProtocol,</a></div>
      <div class="Code_New"><a name="1047041">                               nodeInput, </a></div>
      <div class="Code_New"><a name="1047067">                               i,  </a></div>
      <div class="Code_New"><a name="1047068">                               ROUTING_PROTOCOL_MYPROTOCOL);</a></div>
      <div class="Code_New"><a name="1046969">                    }</a></div>
      <div class="Code_New"><a name="1046971">                    else</a></div>
      <div class="Code_New"><a name="1046972">                    {</a></div>
      <div class="Code_New"><a name="1046973">                        NetworkIpUpdateUnicastRoutingProtocolAndRouterFunction(</a></div>
      <div class="Code_New"><a name="1046974">                            node,</a></div>
      <div class="Code_New"><a name="1046975">                            ROUTING_PROTOCOL_MYPROTOCOL,</a></div>
      <div class="Code_New"><a name="1046976">                            i);</a></div>
      <div class="Code_New"><a name="1046977">                    }</a></div>
      <div class="Code_New"><a name="1046978">                    break;</a></div>
      <div class="Code_New"><a name="1046979">                }</a></div>
      <div class="Code_Segment"><a name="1042062">        ...</a></div>
      <div class="Code_Segment"><a name="1042063">     }</a></div>
      <div class="Code_Segment"><a name="1042064">     ...</a></div>
      <div class="Code_Segment"><a name="1042065">}</a></div>
      <div class="Figure">FIGURE 4-72.&nbsp;&nbsp;<a name="994396">Calling MYPROTOCOL Initialization Function from IP Initialization Function</a></div>
      <div class="Heading4Numbered">4.4.5.5.3  <a name="994539">Implementing the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="994540">The initialization of a Network Layer routing protocol takes place in the initialization function of the protocol that is called by the routing initialization function IpRoutingInit (see </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994389', '');" title="Network Layer">Figure&nbsp;4-71</a>). The initialization function of a routing protocol commonly performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994621">Create an instance of the protocol data structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994601">Read and store the user-specified configuration parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994541">Initialize the state variables and routing table</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994659">Register the protocol’s router function and other callback functions with IP</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994544">Schedule a timer to itself for starting the protocol</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="994545">Like all other functions belonging to the protocol, the prototype for the initialization function, MyprotocolInit, should be included in the protocol's header file, routing_protocol.h.</a></div>
      <div class="Heading5Numbered">4.4.5.5.3.1  <a name="994547">Creating an Instance and Reading Configuration Parameters</a></div>
      <div class="BodyAfterHead"><a name="994688">The initialization function initializes the protocol state. Each protocol has a structure that it uses to store state information. This may include information such as flags, connection information, routing table used by the protocol, etc. </a></div>
      <div class="Body"><a name="994689">To store the state, declare the structure to hold the protocol state in the header file, routing_protocol.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993370', '');" title="Network Layer">Section&nbsp;4.4.5.4</a></span>). As an example, see the declaration of the AODV data structure <span style="font-family: &quot;Courier New&quot;">AodvData</span> in routing_aodv.h.</div>
      <div class="Body"><a name="994693">Create an instance of the protocol state by allocating memory to the state structure. AODV performs this task in its initialization function AodvInit by calling the function MEM_malloc to allocate memory for the AODV data structure </a><span style="font-family: &quot;Courier New&quot;">AodvData</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995424', '');" title="Network Layer">Figure&nbsp;4-73</a></span>. AodvInit and the other AODV functions are implemented in routing_aodv.cpp. Data structure and constant definitions for AODV are contained in routing_aodv.h. </div>
      <div class="Body"><a name="994697">The next step is to read the user-defined configuration parameters from the input file and store them in the protocol data structure. AodvInit does this by calling function AodvInitializeConfigurableParameters. AodvInitializeConfigurableParameters, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994923', '');" title="Network Layer">Figure&nbsp;4-74</a></span>, uses IO functions such as IO_ReadTime and IO_ReadString to read parameter values from the input file and store them in the appropriate fields of the protocol data structure <span style="font-family: &quot;Courier New&quot;">AodvData</span>. If a value is not specified for a parameter in the input file, AodvInitializeConfigurableParameters stores the default value for that parameter. IO_ReadTime, IO_ReadString and other IO functions are defined in <span class="Variable">QUALNET_HOME</span>/include/fileio.h.</div>
      <div class="Code_Segment"><a name="995372">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1042148">void AodvInit(Node* node,AodvData** aodvPtr,const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="1042153">              int interfaceIndex, NetworkRoutingProtocolType aodvProtocolType)</a></div>
      <div class="Code_Segment"><a name="1042155">{</a></div>
      <div class="Code_Segment"><a name="1042157">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar</a></div>
      <div class="Code_Segment"><a name="1095506">    AodvData* aodv = (AodvData *) MEM_malloc(sizeof(AodvData));</a></div>
      <div class="Code_Segment"><a name="1042158">    ...</a></div>
      <div class="Code_Segment"><a name="995386">    (*aodvPtr) = aodv;</a></div>
      <div class="Code_Segment"><a name="995387">    ...</a></div>
      <div class="Code_Segment"><a name="995388">    // Read whether statistics needs to be collected for the protocol</a></div>
      <div class="Code_Segment"><a name="995389">    ...</a></div>
      <div class="Code_Segment"><a name="995390">    // Initialize statistical variables</a></div>
      <div class="Code_Segment"><a name="995391">    ...</a></div>
      <div class="Code_Segment"><a name="995392">    // Read user configurable parameters from the configuration file or</a></div>
      <div class="Code_Segment"><a name="1042258">    // initialize them with the default values.</a></div>
      <div class="Code_Segment"><a name="1042269">    AodvInitializeConfigurableParameters(</a></div>
      <div class="Code_Segment"><a name="1042270">        node,</a></div>
      <div class="Code_Segment"><a name="1042271">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="1042272">        aodv,</a></div>
      <div class="Code_Segment"><a name="1042259">        aodv-&gt;iface[interfaceIndex].address);    </a></div>
      <div class="Code_Segment"><a name="1042282">   // Initialize AODV routing table</a></div>
      <div class="Code_Segment"><a name="995401">   ...</a></div>
      <div class="Code_Segment"><a name="1042188">   if(aodv-&gt;iface[interfaceIndex].ip_version == NETWORK_IPV4)</a></div>
      <div class="Code_Segment"><a name="1042189">    {</a></div>
      <div class="Code_Segment"><a name="1042190">        // Set the mac status handler function</a></div>
      <div class="Code_Segment"><a name="1042191">        NetworkIpSetMacLayerStatusEventHandlerFunction(</a></div>
      <div class="Code_Segment"><a name="1042192">            node, &amp;Aodv4MacLayerStatusHandler, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1042196">        // Set the router function</a></div>
      <div class="Code_Segment"><a name="1042197">        NetworkIpSetRouterFunction(</a></div>
      <div class="Code_Segment"><a name="1042198">            node,</a></div>
      <div class="Code_Segment"><a name="1042199">            &amp;Aodv4RouterFunction,</a></div>
      <div class="Code_Segment"><a name="1042200">            interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1042202">        destAddr.networkType = NETWORK_IPV4;</a></div>
      <div class="Code_Segment"><a name="1042203">        destAddr.interfaceAddr.ipv4 = ANY_DEST;</a></div>
      <div class="Code_Segment"><a name="1042204">        protocolType = ROUTING_PROTOCOL_AODV;</a></div>
      <div class="Code_Segment"><a name="1042206">        // Set default Interface Info</a></div>
      <div class="Code_Segment"><a name="1042207">        aodv-&gt;defaultInterface = interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1042209">        SetIPv4AddressInfo(</a></div>
      <div class="Code_Segment"><a name="1042210">            &amp;aodv-&gt;defaultInterfaceAddr,</a></div>
      <div class="Code_Segment"><a name="1042211">            NetworkIpGetInterfaceAddress(node, interfaceIndex));</a></div>
      <div class="Code_Segment"><a name="1042212">    }</a></div>
      <div class="Code_Segment"><a name="1042213">    else if(aodv-&gt;iface[interfaceIndex].ip_version == NETWORK_IPV6)</a></div>
      <div class="Code_Segment"><a name="1042182">    {</a></div>
      <div class="Code_Segment"><a name="1042217">       ...</a></div>
      <div class="Code_Segment"><a name="1042222">     }</a></div>
      <div class="Code_Segment"><a name="995413">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995414">    if (aodv-&gt;processHello)</a></div>
      <div class="Code_Segment"><a name="995415">    {</a></div>
      <div class="Code_Segment"><a name="995416">       ...</a></div>
      <div class="Code_Segment"><a name="995417">        AodvSetTimer(node, MSG_NETWORK_SendHello, destAddr,</a></div>
      <div class="Code_Segment"><a name="995421">                     AODV_HELLO_INTERVAL);</a></div>
      <div class="Code_Segment"><a name="995422">    }</a></div>
      <div class="Code_Segment"><a name="995423">}</a></div>
      <div class="Figure">FIGURE 4-73.&nbsp;&nbsp;<a name="995424">AODV Initialization Function</a></div>
      <div class="Code_Segment"><a name="994845">&nbsp;</a></div>
      <div class="Code_Segment"><a name="994862">static</a></div>
      <div class="Code_Segment"><a name="1042300">void AodvInitializeConfigurableParameters(</a></div>
      <div class="Code_Segment"><a name="1042301">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1042302">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="1042303">    AodvData* aodv,</a></div>
      <div class="Code_Segment"><a name="1042304">    Address interfaceAddress)</a></div>
      <div class="Code_Segment"><a name="1042305">{</a></div>
      <div class="Code_Segment"><a name="1042306">    BOOL wasFound;</a></div>
      <div class="Code_Segment"><a name="1042307">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="994863">    UInt32 nodeId = node-&gt;nodeId;</a></div>
      <div class="Code_Segment"><a name="994878">    ...</a></div>
      <div class="Code_Segment"><a name="994886">    IO_ReadTime(</a></div>
      <div class="Code_Segment"><a name="994887">        nodeId,</a></div>
      <div class="Code_Segment"><a name="994888">        &amp;interfaceAddress,</a></div>
      <div class="Code_Segment"><a name="994889">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="994890">        "AODV-ACTIVE-ROUTE-TIMEOUT",</a></div>
      <div class="Code_Segment"><a name="994891">        &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="994892">        &amp;aodv-&gt;activeRouteTimeout);</a></div>
      <div class="Code_Segment"><a name="994893">        </a></div>
      <div class="Code_Segment"><a name="994894">    if (!wasFound)</a></div>
      <div class="Code_Segment"><a name="994895">    {</a></div>
      <div class="Code_Segment"><a name="994896">        aodv-&gt;activeRouteTimeout = AODV_DEFAULT_ACTIVE_ROUTE_TIMEOUT;</a></div>
      <div class="Code_Segment"><a name="994884">    }</a></div>
      <div class="Code_Segment"><a name="1042327">    else</a></div>
      <div class="Code_Segment"><a name="1042328">    {</a></div>
      <div class="Code_Segment"><a name="1042329">        ERROR_Assert(</a></div>
      <div class="Code_Segment"><a name="1042330">                aodv-&gt;activeRouteTimeout &gt; 0,</a></div>
      <div class="Code_Segment"><a name="1042331">        "Invalid AODV_DEFAULT_ACTIVE_ROUTE_TIMEOUT configuration");</a></div>
      <div class="Code_Segment"><a name="994879">    }</a></div>
      <div class="Code_Segment"><a name="1042335">    ...</a></div>
      <div class="Code_Segment"><a name="994906">    IO_ReadInt(</a></div>
      <div class="Code_Segment"><a name="994907">        nodeId,</a></div>
      <div class="Code_Segment"><a name="994908">        &amp;interfaceAddress,</a></div>
      <div class="Code_Segment"><a name="994909">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="994910">        "AODV-RREQ-RETRIES",</a></div>
      <div class="Code_Segment"><a name="994911">        &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="994912">        &amp;aodv-&gt;rreqRetries);</a></div>
      <div class="Code_Segment"><a name="994913">&nbsp;</a></div>
      <div class="Code_Segment"><a name="994914">    if (!wasFound)</a></div>
      <div class="Code_Segment"><a name="994915">    {</a></div>
      <div class="Code_Segment"><a name="994916">        aodv-&gt;rreqRetries = AODV_DEFAULT_RREQ_RETRIES;</a></div>
      <div class="Code_Segment"><a name="994904">    }</a></div>
      <div class="Code_Segment"><a name="1042337">    else</a></div>
      <div class="Code_Segment"><a name="1042338">    {</a></div>
      <div class="Code_Segment"><a name="1042339">        ERROR_Assert(</a></div>
      <div class="Code_Segment"><a name="1042340">                aodv-&gt;helloInterval &gt; 0,</a></div>
      <div class="Code_Segment"><a name="1042341">        "Invalid AODV_DEFAULT_HELLO_INTERVAL configuration");</a></div>
      <div class="Code_Segment"><a name="994934">    }</a></div>
      <div class="Code_Segment"><a name="1042345">   ...</a></div>
      <div class="Code_Segment"><a name="994935">}</a></div>
      <div class="Figure">FIGURE 4-74.&nbsp;&nbsp;<a name="994923">Reading AODV Configuration Parameters</a></div>
      <div class="Heading5Numbered">4.4.5.5.3.2  <a name="994662">Initializing State Variables and Routing Table</a></div>
      <div class="BodyAfterHead"><a name="994570">The initialization function of a routing protocol also initializes the state variables and routing table used by the protocol. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995348', '');" title="Network Layer">Figure&nbsp;4-75</a></span> shows code segments to initialize the state variables and routing table for AODV. </div>
      <div class="Body"><a name="995530">A routing protocol may need to maintain a list of neighbors. In this case, the list of neighbors should be initialized in the initialization function of the protocol.</a></div>
      <div class="Code_Segment"><a name="995298">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995299">void</a></div>
      <div class="Code_Segment"><a name="995300">AodvInit(</a></div>
      <div class="Code_Segment"><a name="995301">    Node* node,</a></div>
      <div class="Code_Segment"><a name="995302">    AodvData** aodvPtr,</a></div>
      <div class="Code_Segment"><a name="995303">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="995304">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1095513">    NetworkRoutingProtocolType aodvProtocolType)</a></div>
      <div class="Code_Segment"><a name="995305">{</a></div>
      <div class="Code_Segment"><a name="995306">    ...</a></div>
      <div class="Code_Segment"><a name="995325">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995326">   // Initialize AODV routing table</a></div>
      <div class="Code_Segment"><a name="995327">    for (i = 0; i &lt; AODV_ROUTE_HASH_TABLE_SIZE; i++)</a></div>
      <div class="Code_Segment"><a name="995328">    {</a></div>
      <div class="Code_Segment"><a name="995329">        (&amp;aodv-&gt;routeTable)-&gt;routeHashTable[i] = NULL;</a></div>
      <div class="Code_Segment"><a name="995330">    }</a></div>
      <div class="Code_Segment"><a name="995331">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995332">    (&amp;aodv-&gt;routeTable)-&gt;routeExpireHead = NULL;</a></div>
      <div class="Code_Segment"><a name="995333">        ...</a></div>
      <div class="Code_Segment"><a name="995334">    // Initialize aodv structure to store RREQ information</a></div>
      <div class="Code_Segment"><a name="995335">    (&amp;aodv-&gt;seenTable)-&gt;front = NULL;</a></div>
      <div class="Code_Segment"><a name="995336">    ...</a></div>
      <div class="Code_Segment"><a name="995337">    // Initialize Aodv sequence number</a></div>
      <div class="Code_Segment"><a name="995338">    aodv-&gt;seqNumber = 0;</a></div>
      <div class="Code_Segment"><a name="995339">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995340">    // Initialize Aodv Broadcast id</a></div>
      <div class="Code_Segment"><a name="995341">    aodv-&gt;floodingId = 0;</a></div>
      <div class="Code_Segment"><a name="995342">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995343">    // Initialize Last Broadcast sent</a></div>
      <div class="Code_Segment"><a name="995344">    aodv-&gt;lastBroadcastSent = (clocktype) 0;</a></div>
      <div class="Code_Segment"><a name="995345">    ...</a></div>
      <div class="Code_Segment"><a name="995346">}</a></div>
      <div class="Figure">FIGURE 4-75.&nbsp;&nbsp;<a name="995348">Initializing AODV State Variables and Routing Table</a></div>
      <div class="Heading5Numbered">4.4.5.5.3.3  <a name="994673">Registering Callback Functions with IP</a></div>
      <div class="BodyAfterHead"><a name="995256">A Network Layer routing protocol interacts with IP to route packets and to handle protocol events. To do this efficiently, the routing protocol registers the functions that perform these tasks with IP as part of initialization, by passing pointers to these functions to IP. These functions are called </a><span style="font-style: italic">callback functions</span>. When IP encounters an event that needs to be handled by the routing protocol, IP can directly call the appropriate callback function that processes that event. A routing protocol should register with IP its router function and other callback functions that handle events that are of interest to the protocol. </div>
      <div class="Body"><a name="1002124">IP callback functions implemented in </a><span class="Variable">QualNet</span> and the API functions used to register them are listed below. See network_ip.cpp for a description of parameters of these functions.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><span style="font-weight: bold"><a name="1002137">Callback Function</a></span>: Router function used by the protocol</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1002208">API to Register Function</a></span>: NetworkIpSetRouterFunction</div>
      <div class="NumberedCont" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1002269">Function Type</a></span><span style="font-weight: normal">: RouterFunctionType</span></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-weight: bold"><a name="1002148">Callback Function</a></span>: Function to handle MAC Layer status changes</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1002153">API to Register Function</a></span>: NetworkIpSetMacLayerStatusEventHandlerFunction</div>
      <div class="NumberedCont" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1002285">Function Type</a></span><span style="font-weight: normal">: MACLayerStatusEventHandlerFunctionType</span></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-weight: bold"><a name="1002303">Callback Function</a></span>: Function to promiscuously peek at packets not addressed to the node</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1002304">API to Register Function</a></span>: NetworkIpSetPromiscuousMessagePeekFunction</div>
      <div class="NumberedCont" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1002305">Function Type</a></span><span style="font-weight: normal">: PromiscuousMessagePeekFunctionType</span></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-weight: bold"><a name="1002325">Callback Function</a></span>: Function to handle MAC Layer acknowledgements</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1002326">API to Register Function</a></span>: NetworkIpSetMacLayerAckHandler</div>
      <div class="NumberedCont" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1002327">Function Type</a></span><span style="font-weight: normal">: MacLayerAckHandlerType</span></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-weight: bold"><a name="1002349">Callback Function</a></span>: Function to handle route update events</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1002350">API to Register Function</a></span>: NetworkIpSetRouteUpdateEventFunction</div>
      <div class="NumberedCont" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1002351">Function Type</a></span><span style="font-weight: normal">: NetworkRouteUpdateEventType</span></div>
      <div class="Body"><a name="1002110">As an example, the AODV initialization function AodvInit (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995424', '');" title="Network Layer">Figure&nbsp;4-73</a></span>) calls function NetworkIpSetRouterFunction to register with IP the router function used by AODV when operating with Ipv4, Aodv4RouterFunction. This enables IP to directly call Aodv4RouterFunction to determine the route for a packet if AODV is running at that interface. Similarly, AodvInit calls function NetworkIpSetMacLayerStatusEventhandlerFunction to register with IP the MAC Layer status handler function used by AODV when operating with IPv4, Aodv4MacLayerStatusHandler. This enables IP to directly call Aodv4MacLayerStatusHandler to handle a MAC Layer status change, if AODV is running at that interface. </div>
      <div class="Heading5Numbered">4.4.5.5.3.4  <a name="994680">Initializing Timers</a></div>
      <div class="BodyAfterHead"><a name="994677">A routing protocol may need to set a timer at initialization. For example, if </a><span style="font-style: italic">Hello </span>messages are enabled in AODV, function AodvInit calls function AodvSetTimer to set the initial timer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995424', '');" title="Network Layer">Figure&nbsp;4-73</a></span>). See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#920185', '');" title="Discrete-event Simulation in QualNet">Section&nbsp;3.3.2.2</a></span> for details on setting timers.</div>
      <div class="Heading3Numbered">4.4.5.6  <a name="995535">Implementing the Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="995536">In this section, we describe the steps for implementing the event dispatcher function for a Network Layer routing protocol. </a></div>
      <div class="Body"><a name="996400">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#933631', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.2</a></span>, when an event occurs, it is first handled by the node level dispatcher function NODE_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/node.cpp. If the event is for the Network Layer, NODE_ProcessEvent calls the Network Layer event dispatcher NETWORK_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/network.cpp. If IP is running at the Network Layer, NETWORK_ProcessEvent calls the IP event dispatcher NetworkIpLayer, defined in network_ip.cpp. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995544', '');" title="Network Layer" name="996401">Section&nbsp;4.4.5.6.1</a></span> describes how to modify the IP event dispatcher function to call the routing protocol’s event dispatcher. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995693', '');" title="Network Layer">Section&nbsp;4.4.5.6.2</a></span> describes how to implement the routing protocol’s event dispatcher.</div>
      <div class="Heading4Numbered">4.4.5.6.1  <a name="995544">Modifying the IP Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="995545">Function NetworkIpLayer</a><span style="font-weight: bold"> </span>implements the IP event dispatcher that informs the appropriate Network Layer protocol of received events. Messages contain the name of the protocol they are destined for. (This is the routing protocol name specified in the enumerated data type <span style="font-family: &quot;Courier New&quot;">NetworkRoutingProtocolType</span>, described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993167', '');" title="Network Layer">Section&nbsp;4.4.5.3</a></span>.) NetworkIpLayer implements a switch statement on the protocol name read from the message and calls the appropriate protocol-specific event dispatcher. </div>
      <div class="Body"><a name="996432">To enable the protocol MYPROTOCOL to receive events, add code to NetworkIpLayer to call the protocol's event dispatcher function when messages for the protocol are received. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995574', '');" title="Network Layer">Figure&nbsp;4-76</a></span> shows a code fragment from NetworkIpLayer with sample code for calling MYOPROTOCOL’s event dispatcher function MyprotocolHandleProtocolEvent.</div>
      <div class="Code_Segment"><a name="995563">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995578">void</a></div>
      <div class="Code_Segment"><a name="995579">NetworkIpLayer(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="995580">{</a></div>
      <div class="Code_Segment"><a name="995581">    switch (msg-&gt;protocolType)</a></div>
      <div class="Code_Segment"><a name="995582">    {</a></div>
      <div class="Code_Segment"><a name="995583">        case GROUP_MANAGEMENT_PROTOCOL_IGMP:</a></div>
      <div class="Code_Segment"><a name="995584">        {</a></div>
      <div class="Code_Segment"><a name="995585">            IgmpLayer(node, msg);</a></div>
      <div class="Code_Segment"><a name="995564">            break;</a></div>
      <div class="Code_Segment"><a name="995614">        }</a></div>
      <div class="Code_Segment"><a name="995589">        ...</a></div>
      <div class="Code_Segment"><a name="995592">        case ROUTING_PROTOCOL_AODV:</a></div>
      <div class="Code_Segment"><a name="995593">        {</a></div>
      <div class="Code_Segment"><a name="995594">            AodvHandleProtocolEvent(node, msg);</a></div>
      <div class="Code_Segment"><a name="995595">            break;</a></div>
      <div class="Code_Segment"><a name="995596">        }</a></div>
      <div class="Code_Segment"><a name="995613">        ...</a></div>
      <div class="Code_New"><a name="996375">        case ROUTING_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="996376">        {</a></div>
      <div class="Code_New"><a name="996377">            MyprotocolHandleProtocolEvent(node, msg);</a></div>
      <div class="Code_New"><a name="996378">            break;</a></div>
      <div class="Code_New"><a name="996379">        }</a></div>
      <div class="Code_Segment"><a name="996373">        ...</a></div>
      <div class="Code_Segment"><a name="995609"> }//switch//</a></div>
      <div class="Code_Segment"><a name="995590">}</a></div>
      <div class="Figure">FIGURE 4-76.&nbsp;&nbsp;<a name="995574">IP Event Dispatcher</a></div>
      <div class="Heading4Numbered">4.4.5.6.2  <a name="995693">Implementing the Protocol Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="995694">A routing protocol's event dispatcher should include a switch on all message types that the protocol may receive. It can then process each message type either inside the switch or by calling a function to handle the message type received. </a></div>
      <div class="Body"><a name="1000515">All event types used by </a><span class="Variable">QualNet</span> protocols are enumerated in the file <span class="Variable">QUALNET_HOME</span>/include/api.h. If the protocol being added needs additional event types, these should be included in the enumeration in file api.h, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1000542', '');" title="Network Layer">Figure&nbsp;4-77</a></span>. </div>
      <div class="Code_Segment"><a name="1000519">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000520">// /**</a></div>
      <div class="Code_Segment"><a name="1000521">// ENUM        :: MESSAGE/EVENT</a></div>
      <div class="Code_Segment"><a name="1000522">// DESCRIPTION :: Event/message types exchanged in the simulation</a></div>
      <div class="Code_Segment"><a name="1000523">// **/</a></div>
      <div class="Code_Segment"><a name="1000524">enum</a></div>
      <div class="Code_Segment"><a name="1000525">{</a></div>
      <div class="Code_Segment"><a name="1000526">    /* Special message types used for internal design. */</a></div>
      <div class="Code_Segment"><a name="1000527">    MSG_SPECIAL_Timer                          = 0,</a></div>
      <div class="Code_Segment"><a name="1000528">    ...</a></div>
      <div class="Code_Segment"><a name="1042364">    /* Message Types for Channel layer */</a></div>
      <div class="Code_Segment"><a name="1000530">    MSG_PROP_SignalArrival                     = 100,</a></div>
      <div class="Code_Segment"><a name="1000531">    MSG_PROP_SignalEnd                         = 101,</a></div>
      <div class="Code_Segment"><a name="1000532">    ...</a></div>
      <div class="Code_Segment"><a name="1000533">    /*</a></div>
      <div class="Code_Segment"><a name="1000534">     * Any other message types which have to be added should be added before</a></div>
      <div class="Code_Segment"><a name="1000535">     * MSG_DEFAULT. Otherwise the program will not work correctly.</a></div>
      <div class="Code_Segment"><a name="1000536">     */</a></div>
      <div class="Code_New"><a name="1000537">    MSG_NETWORK_MYPROTOCOL_NewEvent1,</a></div>
      <div class="Code_New"><a name="1000538">    MSG_NETWORK_MYPROTOCOL_NewEvent2,</a></div>
      <div class="Code_Segment"><a name="1000539">    MSG_DEFAULT                                = 10000</a></div>
      <div class="Code_Segment"><a name="1000540">};</a></div>
      <div class="Figure">FIGURE 4-77.&nbsp;&nbsp;<a name="1000542">Declaring New Event Types</a></div>
      <div class="Note_Indented"><a name="1041884"><img class="Default" src="images/Chapter%204-4.08.1.06.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">MSG_DEFAULT</span>).</div>
      <div class="BodyAfterHead"><a name="1009026">The event dispatcher function for a routing protocol generally handles timer events. (Packet events are handled by a separate packet handler, as discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1004990', '');" title="Network Layer">Section&nbsp;4.4.5.8.2</a></span>.) As an example, <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996457', '');" title="Network Layer">Figure&nbsp;4-78</a></span> shows the AODV event dispatcher function AodvHandleProtocolEvent. See files routing_aodv.h and routing_aodv.cpp for definitions of data structures and functions used for implementing AODV.</div>
      <div class="Body"><a name="995695">Note that once a message has been processed, it is freed by calling the API MESSAGE_Free, unless it is used to reset the timer for a future time. The event dispatcher also includes a default case in the switch statement to handle events of an unknown type.</a></div>
      <div class="Note_Indented"><a name="996504"><img class="Default" src="images/Chapter%204-4.08.1.07.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is important to free the memory after the message has been processed; otherwise, the simulator will leak memory.</a></div>
      <div class="Body"><a name="1008412">As part of handling an event, a routing protocol at a node may transmit packets to its peers using MAC Layer services. </a><span class="Variable">QualNet</span> provides the API functions listed below that enable a Network Layer protocol to send packets to the MAC Layer. These functions are implemented in the file network_ip.h. See <span style="font-style: italic">API Reference Guide</span> or the file network_ip.h for an explanation of these functions and their parameters.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1008417">NetworkIpSendPacketOnInterfaceWithDelay</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008432">NetworkIpSendRawMessage</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008437">NetworkIpSendRawMessageWithDelay</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008442">NetworkIpSendRawMessageToMacLayer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008447">NetworkIpSendRawMessageToMacLayerWithDelay</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008452">NetworkIpSendPacketToMacLayer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008479">NetworkIpSendPacketToMacLayerWithDelay</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008461">NetworkIpSendPacketOnInterface</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008466">NetworkIpSendPacketOnInterfaceWithDelay</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1008482">NetworkIpSendPacketToMacLayerWithNewStrictSourceRoute</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="995687">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995705">void</a></div>
      <div class="Code_Segment"><a name="995706">AodvHandleProtocolEvent(</a></div>
      <div class="Code_Segment"><a name="995707">    Node* node,</a></div>
      <div class="Code_Segment"><a name="995708">    Message* msg)</a></div>
      <div class="Code_Segment"><a name="995709">{</a></div>
      <div class="Code_Segment"><a name="1042376">    AodvData* aodv = NULL;</a></div>
      <div class="Code_Segment"><a name="1042377">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1042378">    if (MESSAGE_GetProtocol(msg) == ROUTING_PROTOCOL_AODV6)</a></div>
      <div class="Code_Segment"><a name="1042379">    {</a></div>
      <div class="Code_Segment"><a name="1042380">        aodv = (AodvData *) NetworkIpGetRoutingProtocol(</a></div>
      <div class="Code_Segment"><a name="1042381">                                node,</a></div>
      <div class="Code_Segment"><a name="1042382">                                ROUTING_PROTOCOL_AODV6,</a></div>
      <div class="Code_Segment"><a name="1095551">                                NETWORK_IPV6);</a></div>
      <div class="Code_Segment"><a name="1042383">    }</a></div>
      <div class="Code_Segment"><a name="1042384">    else</a></div>
      <div class="Code_Segment"><a name="1042385">    {</a></div>
      <div class="Code_Segment"><a name="1042386">        aodv = (AodvData *) NetworkIpGetRoutingProtocol(</a></div>
      <div class="Code_Segment"><a name="1042387">                                node,</a></div>
      <div class="Code_Segment"><a name="1042388">                                ROUTING_PROTOCOL_AODV,</a></div>
      <div class="Code_Segment"><a name="1095570">                                NETWORK_IPV4);</a></div>
      <div class="Code_Segment"><a name="995712">    }</a></div>
      <div class="Code_Segment"><a name="995714">    switch (MESSAGE_GetEvent(msg))</a></div>
      <div class="Code_Segment"><a name="995715">    {</a></div>
      <div class="Code_Segment"><a name="995716">        // Remove an entry from the RREQ Seen Table</a></div>
      <div class="Code_Segment"><a name="995688">        case MSG_NETWORK_FlushTables:</a></div>
      <div class="Code_Segment"><a name="995689">        {</a></div>
      <div class="Code_Segment"><a name="995724">            ...</a></div>
      <div class="Code_Segment"><a name="996466">            AodvDeleteSeenTable(&amp;aodv-&gt;seenTable);</a></div>
      <div class="Code_Segment"><a name="995727">            MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="995728">            break;</a></div>
      <div class="Code_Segment"><a name="995725">        }</a></div>
      <div class="Code_Segment"><a name="1042397">        // Check connectivity based on hello msg</a></div>
      <div class="Code_Segment"><a name="1042398">        case MSG_NETWORK_CheckNeighborTimeout:</a></div>
      <div class="Code_Segment"><a name="1042399">        {</a></div>
      <div class="Code_Segment"><a name="995733">            ...</a></div>
      <div class="Code_Segment"><a name="1042407">        }</a></div>
      <div class="Code_Segment"><a name="1042408">        // Remove the route that has not been used for awhile</a></div>
      <div class="Code_Segment"><a name="995734">        case MSG_NETWORK_CheckRouteTimeout:</a></div>
      <div class="Code_Segment"><a name="995690">        {</a></div>
      <div class="Code_Segment"><a name="1009034">            ...</a></div>
      <div class="Code_Segment"><a name="995740">        }</a></div>
      <div class="Code_Segment"><a name="1042423">        case MSG_NETWORK_DeleteRoute:</a></div>
      <div class="Code_Segment"><a name="1042424">        {</a></div>
      <div class="Code_Segment"><a name="995720">            ...</a></div>
      <div class="Code_Segment"><a name="995818">        }</a></div>
      <div class="Code_Segment"><a name="1042440">        ...</a></div>
      <div class="Code_Segment"><a name="1042441">        default:</a></div>
      <div class="Code_Segment"><a name="995819">        {</a></div>
      <div class="Code_Segment"><a name="995820">            ...</a></div>
      <div class="Code_Segment"><a name="995822">        }</a></div>
      <div class="Code_Segment"><a name="995823">    }</a></div>
      <div class="Code_Segment"><a name="995816">}</a></div>
      <div class="Figure">FIGURE 4-78.&nbsp;&nbsp;<a name="996457">AODV Event Dispatcher</a></div>
      <div class="Heading3Numbered">4.4.5.7  <a name="995882">Modifying IP Functions</a></div>
      <div class="BodyAfterHead"><a name="1000464">The IP function NetworkRoutingGetAdminDistance, implemented in network_ip.cpp, returns the administrative distance of a routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>). This function should be modified to enable IP to determine the routing distance (i.e., the relative priority) of MYPROTOCOL, if MYPROTOCOL uses the IP forwarding table. <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1000496', '');" title="Network Layer">Figure&nbsp;4-79</a> shows the modifications that need to be made to NetworkRoutingGetAdminDistance to add MYPROTOCOL.</div>
      <div class="Code_Segment"><a name="1000471">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000472">NetworkRoutingAdminDistanceType</a></div>
      <div class="Code_Segment"><a name="1000473">NetworkRoutingGetAdminDistance(</a></div>
      <div class="Code_Segment"><a name="1000474">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1000475">    NetworkRoutingProtocolType type)</a></div>
      <div class="Code_Segment"><a name="1000476">{</a></div>
      <div class="Code_Segment"><a name="1000477">    switch (type)</a></div>
      <div class="Code_Segment"><a name="1000478">    {</a></div>
      <div class="Code_Segment"><a name="1000479">        case ROUTING_PROTOCOL_STATIC:</a></div>
      <div class="Code_Segment"><a name="1000480">        {</a></div>
      <div class="Code_Segment"><a name="1000481">            return ROUTING_ADMIN_DISTANCE_STATIC;</a></div>
      <div class="Code_Segment"><a name="1000482">        }</a></div>
      <div class="Code_Segment"><a name="1000483">        ...</a></div>
      <div class="Code_Segment"><a name="1000484">        case ROUTING_PROTOCOL_BELLMANFORD:</a></div>
      <div class="Code_Segment"><a name="1000485">        {</a></div>
      <div class="Code_Segment"><a name="1000486">            return ROUTING_ADMIN_DISTANCE_BELLMANFORD;</a></div>
      <div class="Code_Segment"><a name="1000487">        }</a></div>
      <div class="Code_New"><a name="1000488">        case ROUTING_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1000489">        {</a></div>
      <div class="Code_New"><a name="1000490">            return ROUTING_ADMIN_DISTANCE_MYPROTOCOL;</a></div>
      <div class="Code_New"><a name="1000491">        }</a></div>
      <div class="Code_Segment"><a name="1000492">        ...</a></div>
      <div class="Code_Segment"><a name="1000493">    }</a></div>
      <div class="Code_Segment"><a name="1000494">}</a></div>
      <div class="Figure">FIGURE 4-79.&nbsp;&nbsp;<a name="1000496">Modifications to Function NetworkRoutingGetAdminDistance</a></div>
      <div class="Heading3Numbered">4.4.5.8  <a name="1000461">Processing Routing Packets</a></div>
      <div class="BodyAfterHead"><a name="995883">A routing protocol running at the Network Layer of a node exchanges </a><span style="font-style: italic">routing packets</span> with other nodes to maintain routing information. Routing packets are control packets that carry information for the routing protocol. These routing packets are different from <span style="font-style: italic">data packets</span>, which carry user data. Data packets are received at the Network Layer from the Transport Layer or from other nodes. Data packets received from other nodes that are addressed to the node are delivered to the Transport Layer. Data packets received from the Transport Layer and data packets received from other nodes that are not addressed to the node are sent out on the interface determined by the packets’ destination address and the routing information maintained by the routing protocol.</div>
      <div class="BodyAfterHead"><a name="996514">In this section, we describe the steps for implementing the function that processes routing packets of a Network Layer routing protocol. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995901', '');" title="Network Layer">Section&nbsp;4.4.5.8.1</a></span> describes how to modify the IP packet handling function to call the protocol’s routing packet handler. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1004990', '');" title="Network Layer">Section&nbsp;4.4.5.8.2</a></span> describes how to implement the protocol’s routing packet handler.</div>
      <div class="Heading4Numbered">4.4.5.8.1  <a name="995901">Modifying IP Packet Handler</a></div>
      <div class="BodyAfterHead"><a name="995902">The IP function DeliverPacket, defined in network_ip.cpp,</a><span style="font-weight: bold"> </span>implements the packet handler for IP. DeliverPacket sends packets received from the MAC layer to the appropriate Network Layer or Transport Layer protocol based upon the IP protocol number contained in the IP header of the received packet. To add a new routing protocol, MYPROTOCOL, at the Network Layer, assign an IP protocol number to MYPROTOCOL and modify function DeliverPacket to deliver packets to MYPROTOCOL. </div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="996590">Define an IP Protocol Number for MYPROTOCOL. File network_ip.h contains constant definitions for all Transport Layer and Network Layer protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996638', '');" title="Network Layer">Figure&nbsp;4-80</a></span>). For example, the IP Protocol Number for AODV is 123. Add a constant definition to associate an IP Protocol Number with MYPROTOCOL.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Note_Indented"><a name="996597"><img class="Default" src="images/Chapter%204-4.08.1.08.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Be sure to use an IP Protocol Number that is not already used for some other protocol.</a></div>
      <div class="Note_Indented"><a name="996598">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996599">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996600">//----------------------------------------------------------</a></div>
      <div class="Code_Segment"><a name="996601">// IP protocol numbers</a></div>
      <div class="Code_Segment"><a name="996602">//----------------------------------------------------------</a></div>
      <div class="Code_Segment"><a name="996603">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996604">// IP protocol numbers for network-layer and transport-layer protocols</a></div>
      <div class="Code_Segment"><a name="996605">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996612">...</a></div>
      <div class="Code_Segment"><a name="996666">// /**</a></div>
      <div class="Code_Segment"><a name="996667">// CONSTANT    :: IPPROTO_AODV : 123</a></div>
      <div class="Code_Segment"><a name="996668">// DESCRIPTION :: IP protocol numbers for AODV.</a></div>
      <div class="Code_Segment"><a name="996669">// **/</a></div>
      <div class="Code_Segment"><a name="996670">#define IPPROTO_AODV            123</a></div>
      <div class="Code_Segment"><a name="996671">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996672">// /**</a></div>
      <div class="Code_Segment"><a name="996673">// CONSTANT    :: IPPROTO_DSR : 135</a></div>
      <div class="Code_Segment"><a name="996674">// DESCRIPTION :: IP protocol numbers for DSR.</a></div>
      <div class="Code_Segment"><a name="996618">// **/</a></div>
      <div class="Code_Segment"><a name="996685">...</a></div>
      <div class="Code_New"><a name="996630">// /**</a></div>
      <div class="Code_New"><a name="996631">// CONSTANT    :: IPPROTO_MYPROTOCOL : 255</a></div>
      <div class="Code_New"><a name="996632">// DESCRIPTION :: IP protocol number for MYPROTOCOL.</a></div>
      <div class="Code_New"><a name="996633">// **/</a></div>
      <div class="Code_New"><a name="996634">#define IPPROTO_MYPROTOCOL      255</a></div>
      <div class="Code_Segment"><a name="996636">...</a></div>
      <div class="Figure">FIGURE 4-80.&nbsp;&nbsp;<a name="996638">Declaring IP Protocol Number for MYPROTOCOL</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="996690">Function DeliverPacket, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1004988', '');" title="Network Layer">Figure&nbsp;4-81</a></span>, performs a switch on the IP Protocol Number, <span style="font-family: &quot;Courier New&quot;">ipProtocolNumber</span>, contained in the IP header of the received packet, and calls the appropriate routine to deliver the packet to the protocol identified by <span style="font-family: &quot;Courier New&quot;">ipProtocolNumber</span>. If <span style="font-family: &quot;Courier New&quot;">ipProtocolNumber</span> corresponds to a unicast routing protocol running at the Network Layer, DeliverPacket checks if that routing protocol is running at the specified interface by calling function NetworkIpGetUnicastRoutingProtocolType. If <span style="font-family: &quot;Courier New&quot;">ipProtocolNumber</span> corresponds to the routing protocol running at that interface, DeliverPacket calls the packet handler function for that protocol. For example, DeliverPacket calls function AodvHandleProtocolPacket to deliver a packet to AODV if the IP Protocol Number read from the packet’s header is 123 and AODV is running at that interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><a name="996694">Add code to DeliverPacket to call MYPROTOCOL’s packet handler function, MyprotocolHandleProtocolPacket, with appropriate parameters, if the IP Protocol Number read from the packet’s header is </a><span style="font-family: &quot;Courier New&quot;">IPPROTO_MYPROTOCOL</span> (defined in step 1) as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1004988', '');" title="Network Layer">Figure&nbsp;4-81</a></span>.</div>
      <div class="Code_Segment"><a name="995723">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995623">static void //inline//</a></div>
      <div class="Code_Segment"><a name="995624">DeliverPacket(Node *node, Message *msg,</a></div>
      <div class="Code_Segment"><a name="995625">              int interfaceIndex, NodeAddress previousHopAddress)</a></div>
      <div class="Code_Segment"><a name="995626">{</a></div>
      <div class="Code_Segment"><a name="995632">    ...</a></div>
      <div class="Code_Segment"><a name="995642">    switch (ipProtocolNumber)</a></div>
      <div class="Code_Segment"><a name="995640">    {</a></div>
      <div class="Code_Segment"><a name="995646">        ...</a></div>
      <div class="Code_Segment"><a name="995649">        // Delivery to network-layer routing protocols.</a></div>
      <div class="Code_Segment"><a name="1042505">        ...</a></div>
      <div class="Code_Segment"><a name="1042525">        case IPPROTO_AODV:</a></div>
      <div class="Code_Segment"><a name="1042526">        {</a></div>
      <div class="Code_Segment"><a name="1042527">            if (NetworkIpGetUnicastRoutingProtocolType(node, interfaceIndex) ==</a></div>
      <div class="Code_Segment"><a name="1042528">                ROUTING_PROTOCOL_AODV)</a></div>
      <div class="Code_Segment"><a name="1042530">            {</a></div>
      <div class="Code_Segment"><a name="1042570">                Address srcAddress;</a></div>
      <div class="Code_Segment"><a name="1042571">                Address destAddress;</a></div>
      <div class="Code_Segment"><a name="1042534">                SetIPv4AddressInfo(&amp;srcAddress, sourceAddress);</a></div>
      <div class="Code_Segment"><a name="1042536">                SetIPv4AddressInfo(&amp;destAddress, destinationAddress);</a></div>
      <div class="Code_Segment"><a name="1042538">                AodvHandleProtocolPacket(node, msg, srcAddress, destAddress,</a></div>
      <div class="Code_Segment"><a name="1042542">                                         ttl, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1042545">            }</a></div>
      <div class="Code_Segment"><a name="1042546">            else</a></div>
      <div class="Code_Segment"><a name="1042547">            {</a></div>
      <div class="Code_Segment"><a name="1042548">                //Trace drop</a></div>
      <div class="Code_Segment"><a name="1042549">                ...</a></div>
      <div class="Code_Segment"><a name="1042559">                MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1042560">            }</a></div>
      <div class="Code_Segment"><a name="1042562">            break;</a></div>
      <div class="Code_Segment"><a name="1042520">        }</a></div>
      <div class="Code_New"><a name="1042521">        case IPPROTO_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="996746">        {</a></div>
      <div class="Code_New"><a name="1042599">            if (NetworkIpGetUnicastRoutingProtocolType(node, interfaceIndex) ==</a></div>
      <div class="Code_New"><a name="1042600">                ROUTING_PROTOCOL_MYPROTOCOL)</a></div>
      <div class="Code_New"><a name="996749">            {</a></div>
      <div class="Code_New"><a name="996750">                // Write Code similar to AODV. </a></div>
      <div class="Code_New"><a name="1042620">                // Call MyprotocolHandleProtocolPacket here</a></div>
      <div class="Code_New"><a name="996753">            }</a></div>
      <div class="Code_New"><a name="996754">            else</a></div>
      <div class="Code_New"><a name="996755">            {</a></div>
      <div class="Code_New"><a name="996756">                MESSAGE_Free(node, msg);</a></div>
      <div class="Code_New"><a name="996757">            }</a></div>
      <div class="Code_New"><a name="996758">            break;</a></div>
      <div class="Code_New"><a name="995647">        }</a></div>
      <div class="Code_Segment"><a name="995669">        ...</a></div>
      <div class="Code_Segment"><a name="995678">    }//switch//</a></div>
      <div class="Code_Segment"><a name="995679">}//DeliverPacket//</a></div>
      <div class="Figure">FIGURE 4-81.&nbsp;&nbsp;<a name="1004988">Delivering Packets from IP to Network Layer Routing Protocols</a></div>
      <div class="Heading4Numbered">4.4.5.8.2  <a name="1004990">Implementing the Protocol Packet Handler</a></div>
      <div class="BodyAfterHead"><a name="1004991">A routing protocol's packet handler should include a switch on all types of packets that the protocol may receive. It can then process each packet type either inside the switch or by calling a function to handle the packet type received. For example, function AodvHandleProtocolPacket, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995761', '');" title="Network Layer">Figure&nbsp;4-82</a></span> and implemented in routing_aodv.cpp, processes AODV routing packets.</div>
      <div class="Body"><a name="1008526">As part of processing a received packet, a routing protocol at a node may transmit packets to its peers. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995693', '');" title="Network Layer">Section&nbsp;4.4.5.6.2</a></span> for details of sending packets.</div>
      <div class="Body"><a name="996851">Write function MyprotocolHandleProtocolPacket to handle routing packets for MYPROTOCOL. Follow the example of AodvHandleProtocolPacket or the packet handler for some other Network Layer unicast routing protocol in </a><span class="Variable">QualNet</span>.</div>
      <div class="Code_Segment"><a name="995758">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995764">void</a></div>
      <div class="Code_Segment"><a name="995765">AodvHandleProtocolPacket(</a></div>
      <div class="Code_Segment"><a name="995766">    Node* node,</a></div>
      <div class="Code_Segment"><a name="995767">    Message* msg,</a></div>
      <div class="Code_Segment"><a name="995768">    NodeAddress srcAddr,</a></div>
      <div class="Code_Segment"><a name="995769">    NodeAddress destAddr,</a></div>
      <div class="Code_Segment"><a name="995770">    int ttl,</a></div>
      <div class="Code_Segment"><a name="995771">    int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="995772">{</a></div>
      <div class="Code_Segment"><a name="1042626">    UInt32* packetType = (UInt32* )MESSAGE_ReturnPacket(msg);</a></div>
      <div class="Code_Segment"><a name="1042627">    BOOL IPV6 = FALSE;</a></div>
      <div class="Code_Segment"><a name="1042628">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1042629">    if(srcAddr.networkType == NETWORK_IPV6)</a></div>
      <div class="Code_Segment"><a name="1042630">    {</a></div>
      <div class="Code_Segment"><a name="1042631">        IPV6 = TRUE;</a></div>
      <div class="Code_Segment"><a name="995775">    }</a></div>
      <div class="Code_Segment"><a name="1042647">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1042646">    if (AODV_DEBUG_AODV_TRACE)</a></div>
      <div class="Code_Segment"><a name="995776">    {</a></div>
      <div class="Code_Segment"><a name="995777">        AodvPrintTrace(node, msg, 'R', IPv6);</a></div>
      <div class="Code_Segment"><a name="995778">    }</a></div>
      <div class="Code_Segment"><a name="1042648">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995780">    switch (*packetType &gt;&gt; 24)</a></div>
      <div class="Code_Segment"><a name="995781">    {</a></div>
      <div class="Code_Segment"><a name="995782">        case AODV_RREQ:</a></div>
      <div class="Code_Segment"><a name="995759">        {</a></div>
      <div class="Code_Segment"><a name="995790">            ...</a></div>
      <div class="Code_Segment"><a name="995795">            AodvHandleRequest(</a></div>
      <div class="Code_Segment"><a name="995796">                node,</a></div>
      <div class="Code_Segment"><a name="995797">                msg,</a></div>
      <div class="Code_Segment"><a name="995798">                srcAddr,</a></div>
      <div class="Code_Segment"><a name="995799">                ttl,</a></div>
      <div class="Code_Segment"><a name="995800">                interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="995801">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995802">            MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="995793">            break;</a></div>
      <div class="Code_Segment"><a name="995791">        }</a></div>
      <div class="Code_Segment"><a name="995792">        ...</a></div>
      <div class="Code_Segment"><a name="995807">        default:</a></div>
      <div class="Code_Segment"><a name="995808">        {</a></div>
      <div class="Code_Segment"><a name="995809">           ERROR_Assert(FALSE, "Unknown packet type for Aodv");</a></div>
      <div class="Code_Segment"><a name="995810">           break;</a></div>
      <div class="Code_Segment"><a name="995811">        }</a></div>
      <div class="Code_Segment"><a name="995812">    }</a></div>
      <div class="Code_Segment"><a name="995760">}</a></div>
      <div class="Figure">FIGURE 4-82.&nbsp;&nbsp;<a name="995761">AODV Routing Packet Handling Function</a></div>
      <div class="Heading3Numbered">4.4.5.9  <a name="995933">Implementing Callback Functions</a></div>
      <div class="BodyAfterHead"><a name="995975">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994673', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.3</a></span>, a Network Layer routing protocol in <span class="Variable">QualNet</span> implements certain callback functions, including a router function to determine routes. When IP receives a data packet from the Transport Layer, it calls function RoutePacketAndSendToMac to determine the next hop and outgoing interface for the packet. Similarly, when IP receives a data packet from the MAC Layer that needs to be forwarded to another node, IP calls RoutePacketAndSendToMac to determine the next hop and outgoing interface for the packet. Function RoutePacketAndSendToMac calls the router function of the routing protocol running at the interface on which the packet arrives (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996057', '');" title="Network Layer">Figure&nbsp;4-83</a></span>). </div>
      <div class="Code_Segment"><a name="995988">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995994">void </a></div>
      <div class="Code_Segment"><a name="995995">RoutePacketAndSendToMac(Node *node,</a></div>
      <div class="Code_Segment"><a name="995996">                        Message *msg,</a></div>
      <div class="Code_Segment"><a name="995997">                        int incomingInterface,</a></div>
      <div class="Code_Segment"><a name="995998">                        int outgoingInterface,</a></div>
      <div class="Code_Segment"><a name="995999">                        NodeAddress previousHopAddress)</a></div>
      <div class="Code_Segment"><a name="995989">{</a></div>
      <div class="Code_Segment"><a name="995990"> ...</a></div>
      <div class="Code_Segment"><a name="996005"> if (!packetWasRouted)</a></div>
      <div class="Code_Segment"><a name="996006">        {</a></div>
      <div class="Code_Segment"><a name="996007">            RouterFunctionType routerFunction = NULL;</a></div>
      <div class="Code_Segment"><a name="996020">            routerFunction = NetworkIpGetRouterFunction(node,</a></div>
      <div class="Code_Segment"><a name="996021">                                                        interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="996023">            if (routerFunction)</a></div>
      <div class="Code_Segment"><a name="996024">            {</a></div>
      <div class="Code_Segment"><a name="996025">                (routerFunction)(node,</a></div>
      <div class="Code_Segment"><a name="996026">                                 msg,</a></div>
      <div class="Code_Segment"><a name="996027">                                 ipHeader-&gt;ip_dst,</a></div>
      <div class="Code_Segment"><a name="996028">                                 previousHopAddress,</a></div>
      <div class="Code_Segment"><a name="996029">                                 &amp;PacketWasRouted);</a></div>
      <div class="Code_Segment"><a name="996030">            }</a></div>
      <div class="Code_Segment"><a name="996032">            if (!packetWasRouted)</a></div>
      <div class="Code_Segment"><a name="996033">            {</a></div>
      <div class="Code_Segment"><a name="996034">                if (IpHeaderHasSourceRoute(ipHeader))</a></div>
      <div class="Code_Segment"><a name="996035">                {</a></div>
      <div class="Code_Segment"><a name="996036">                    SourceRouteThePacket(node, msg);</a></div>
      <div class="Code_Segment"><a name="996037">                }</a></div>
      <div class="Code_Segment"><a name="996038">                else</a></div>
      <div class="Code_Segment"><a name="996039">                {</a></div>
      <div class="Code_Segment"><a name="996040">                    RouteThePacketUsingLookupTable(node,</a></div>
      <div class="Code_Segment"><a name="996041">                                                   msg,</a></div>
      <div class="Code_Segment"><a name="996042">                                                   incomingInterface);</a></div>
      <div class="Code_Segment"><a name="996043">                }//if//</a></div>
      <div class="Code_Segment"><a name="996044">            }//if//</a></div>
      <div class="Code_Segment"><a name="996045">        }//if//</a></div>
      <div class="Code_Segment"><a name="996046">    }//if//</a></div>
      <div class="Code_Segment"><a name="996003">}//RoutePacketAndSendToMac//</a></div>
      <div class="Figure">FIGURE 4-83.&nbsp;&nbsp;<a name="996057">Calling the Router Function</a></div>
      <div class="Body"><a name="996931">The details of the router function depend upon the routing algorithm used by the protocol. As an example, function AodvRouterFunction, defined in routing_aodv.cpp, is the router function for AODV. The prototype for the function AodvRouterFunction is shown below:</a></div>
      <div class="Code_Segment_Large"><a name="1001189">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1001204">void AodvRouterFunction(</a></div>
      <div class="Code_Segment_Large"><a name="1001190">    Node *node,</a></div>
      <div class="Code_Segment_Large"><a name="1001191">    Message *msg,</a></div>
      <div class="Code_Segment_Large"><a name="1001192">    Address destAddr,</a></div>
      <div class="Code_Segment_Large"><a name="1001193">    Address previousHopAddress,</a></div>
      <div class="Code_Segment_Large"><a name="1001183">    BOOL *packetWasRouted) {}</a></div>
      <div class="Code_Segment_Large"><a name="1002486">&nbsp;</a></div>
      <div class="BodyAfterHead"><a name="1002476">Another example of a callback function is the MAC Layer status handler function. Some Network Layer routing protocols interact with the MAC Layer and update their routing information when the status of the MAC Layer changes. AODV is an example of such a protocol. AODV implements a MAC Layer status handler function, AodvMacLayerStatusHandler, to handle MAC Layer status changes. AodvMacLayerStatusHandler is defined in routing_aodv.cpp. </a></div>
      <div class="Body"><a name="1001184">Write the router function for MYPROTOCOL. Write any other callback functions that MYPROTOCOL may need. Use AODV or some other appropriate routing protocol as an example. Register all callback functions with IP in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994673', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.3</a></span>).</div>
      <div class="Heading3Numbered">4.4.5.10  <a name="1001888">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="996147">In this section, we describe how to collect and report statistics for a Network Layer routing protocol.</a></div>
      <div class="Heading4Numbered">4.4.5.10.1  <a name="996149">Declaring Statistics Variables</a></div>
      <div class="BodyAfterHead"><a name="996150">A Network Layer routing protocol can be configured to record statistics specified by the programmer, such as:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996151">	Number of request packets sent </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996152">	Number of reply packets received</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997012">Number of data packets forwarded</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="997043">To enable statistics collection for the protocol, include the statistic collection variables in the structure used to hold the protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993370', '');" title="Network Layer">Section&nbsp;4.4.5.4</a></span>). The statistics related variables can also be defined in a structure and then that structure is included in the state variable. For example, the data structure for AODV, <span style="font-family: &quot;Courier New&quot;">AodvData</span>, contains the AODV statistics variable, <span style="font-family: &quot;Courier New&quot;">AodvStats</span>, shown below:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997047">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997048">typedef struct {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997076">    D_UInt32 numRequestInitiated;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997077">    UInt32 numRequestResent;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997051">    UInt32 numRequestRelayed;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997082">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997085">    UInt32 numReplyRecved;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997090">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997093">    UInt32 numDataInitiated;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997091">    UInt32 numDataForwarded;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997097">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997081">} AodvStats;</a></span></div>
      <div class="Body"><span style="font-family: &quot;Courier New&quot;"><a name="997053">AodvData</a></span> and <span style="font-family: &quot;Courier New&quot;">AodvStats</span> are defined in routing_aodv.h.</div>
      <div class="Heading4Numbered">4.4.5.10.2  <a name="996158">Initializing Statistics</a></div>
      <div class="BodyAfterHead"><a name="996159">Initialize statistics variables in the protocol’s initialization function. Determine whether statistics collection is enabled for the protocol and set the statistics collection flag accordingly. For example, field </a><span style="font-family: &quot;Courier New&quot;">statsCollected</span> of <span style="font-family: &quot;Courier New&quot;">AodvData</span> is a Boolean flag that indicates whether statistics collection is enabled for AODV. This flag is set to TRUE or FALSE by the initialization function AodvInit depending upon the input configuration, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#997174', '');" title="Network Layer">Figure&nbsp;4-84</a></span>. Function AodvInit allocates memory for the AODV data structure <span style="font-family: &quot;Courier New&quot;">AodvData</span>, which contains the AODV statistics structure <span style="font-family: &quot;Courier New&quot;">AodvStats</span>, and initializes all fields of <span style="font-family: &quot;Courier New&quot;">AodvStats</span> to 0. </div>
      <div class="Code_Segment"><a name="997122">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997123">void</a></div>
      <div class="Code_Segment"><a name="997124">AodvInit(</a></div>
      <div class="Code_Segment"><a name="997125">    Node* node,</a></div>
      <div class="Code_Segment"><a name="997126">    AodvData** aodvPtr,</a></div>
      <div class="Code_Segment"><a name="997127">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="997128">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1095595">    NetworkRoutingProtocolType aodvProtocolType)</a></div>
      <div class="Code_Segment"><a name="997129">{</a></div>
      <div class="Code_Segment"><a name="1095619">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="997130">    AodvData* aodv = (AodvData *) MEM_malloc(sizeof(AodvData));</a></div>
      <div class="Code_Segment"><a name="997132">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="997133">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="997134">    int i = 0;</a></div>
      <div class="Code_Segment"><a name="997135">    ...</a></div>
      <div class="Code_Segment"><a name="997136">    (*aodvPtr) = aodv;</a></div>
      <div class="Code_Segment"><a name="1042712">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1042705">    memset(aodv, 0, sizeof(AodvData));</a></div>
      <div class="Code_Segment"><a name="1042703">    ...</a></div>
      <div class="Code_Segment"><a name="997137">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997138">    // Read whether statistics needs to be collected for the protocol</a></div>
      <div class="Code_Segment"><a name="997191">      IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="997192">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="997193">        ANY_ADDRESS,</a></div>
      <div class="Code_Segment"><a name="997194">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="997195">        "ROUTING-STATISTICS",</a></div>
      <div class="Code_Segment"><a name="997196">        &amp;retVal,</a></div>
      <div class="Code_Segment"><a name="997197">        buf);</a></div>
      <div class="Code_Segment"><a name="997198">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997199">    if ((retVal == FALSE) || (strcmp(buf, "NO") == 0))</a></div>
      <div class="Code_Segment"><a name="997200">    {</a></div>
      <div class="Code_Segment"><a name="997201">        aodv-&gt;statsCollected = FALSE;</a></div>
      <div class="Code_Segment"><a name="997202">    }</a></div>
      <div class="Code_Segment"><a name="997203">    else if (strcmp(buf, "YES") == 0)</a></div>
      <div class="Code_Segment"><a name="997204">    {</a></div>
      <div class="Code_Segment"><a name="997205">        aodv-&gt;statsCollected = TRUE;</a></div>
      <div class="Code_Segment"><a name="997206">    }</a></div>
      <div class="Code_Segment"><a name="997207">    else</a></div>
      <div class="Code_Segment"><a name="997208">    {</a></div>
      <div class="Code_Segment"><a name="997209">        ERROR_ReportError("Needs YES/NO against STATISTICS");</a></div>
      <div class="Code_Segment"><a name="997210">    }</a></div>
      <div class="Code_Segment"><a name="997139">    ...</a></div>
      <div class="Code_Segment"><a name="997173">}</a></div>
      <div class="Figure">FIGURE 4-84.&nbsp;&nbsp;<a name="997174">Initializing Statistics Variables for a Routing Protocol </a></div>
      <div class="Heading4Numbered">4.4.5.10.3  <a name="996176">Updating Statistics</a></div>
      <div class="BodyAfterHead"><a name="996177">After declaring and initializing the statistics variables, update their values during the protocol life cycle, as required. For example, AODV increments the value of </a><span style="font-family: &quot;Courier New&quot;">numReplyRecved</span> in function AodvHandleReply (see routing_aodv.cpp) every time AODV receives an AODV <span style="font-style: italic">reply </span>packet, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1042717', '');" title="Network Layer">Figure&nbsp;4-85</a></span>.</div>
      <div class="Code_Segment"><a name="997349">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1045848">static</a></div>
      <div class="Code_Segment"><a name="1045849">void AodvHandleReply(</a></div>
      <div class="Code_Segment"><a name="1045850">         Node* node,</a></div>
      <div class="Code_Segment"><a name="1045851">         Message* msg,</a></div>
      <div class="Code_Segment"><a name="1045852">         Address srcAddr,</a></div>
      <div class="Code_Segment"><a name="1045853">         int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1045854">         Address destAddr)</a></div>
      <div class="Code_Segment"><a name="1045855">{</a></div>
      <div class="Code_Segment"><a name="1045856">    AodvData* aodv = NULL;</a></div>
      <div class="Code_Segment"><a name="997366">    AodvRrepPacket* rrepPkt = NULL;</a></div>
      <div class="Code_Segment"><a name="1045865">    ...</a></div>
      <div class="Code_Segment"><a name="1045871">    Aodv6RrepPacket* rrep6Pkt = NULL;</a></div>
      <div class="Code_Segment"><a name="1045872">    if(srcAddr.networkType == NETWORK_IPV6)</a></div>
      <div class="Code_Segment"><a name="1045873">    {</a></div>
      <div class="Code_Segment"><a name="1045874">        aodv = (AodvData *) NetworkIpGetRoutingProtocol(</a></div>
      <div class="Code_Segment"><a name="1045875">                                    node,</a></div>
      <div class="Code_Segment"><a name="1095634">                                    ROUTING_PROTOCOL_AODV6,</a></div>
      <div class="Code_Segment"><a name="1045876">                                    NETWORK_IPV6);</a></div>
      <div class="Code_Segment"><a name="1045878">        ...</a></div>
      <div class="Code_Segment"><a name="1045889">    }</a></div>
      <div class="Code_Segment"><a name="1045890">    else</a></div>
      <div class="Code_Segment"><a name="1045891">    {</a></div>
      <div class="Code_Segment"><a name="1045892">        aodv = (AodvData *) NetworkIpGetRoutingProtocol(</a></div>
      <div class="Code_Segment"><a name="1045893">                                    node,</a></div>
      <div class="Code_Segment"><a name="1095647">                                    ROUTING_PROTOCOL_AODV,</a></div>
      <div class="Code_Segment"><a name="1045895">                                    NETWORK_IPV4);</a></div>
      <div class="Code_Segment"><a name="1045904">        ...</a></div>
      <div class="Code_Segment"><a name="1045866">    }</a></div>
      <div class="Code_Segment"><a name="997357">    ...</a></div>
      <div class="Code_Segment"><a name="997370">    aodv-&gt;stats.numReplyRecved++;</a></div>
      <div class="Code_Segment"><a name="997375">    ...</a></div>
      <div class="Code_Segment"><a name="997376">}</a></div>
      <div class="Figure">FIGURE 4-85.&nbsp;&nbsp;<a name="1042717">Updating AODV Statistics</a></div>
      <div class="Heading4Numbered">4.4.5.10.4  <a name="996188">Printing Statistics</a></div>
      <div class="BodyAfterHead"><a name="996189">As a final step towards statistics collection, create a function to print statistics. Call this function from the finalization function of the protocol, which is discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996197', '');" title="Network Layer">Section&nbsp;4.4.5.11</a></span>. Alternatively, statistics can be printed directly in the finalization function, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#997580', '');" title="Network Layer">Figure&nbsp;4-87</a></span>. </div>
      <div class="Heading4Numbered">4.4.5.10.5  <a name="1096485">Adding Dynamic Statistics</a></div>
      <div class="BodyAfterHead"><a name="1096489">Dynamic statistics are statistic variables whose values can be observed in the </a><span class="Variable">QualNet</span> GUI during the simulation. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.3.html#955932', '');" title="Customizing Visualize Mode of QualNet Architect">Section&nbsp;5.2.3</a></span> for adding dynamic statistics to a protocol. Refer to <span class="Variable" style="font-style: italic">QualNet User’s Guide</span> for details of viewing dynamic statistics during the simulation.</div>
      <div class="Heading3Numbered">4.4.5.11  <a name="996197">Finalization</a></div>
      <div class="BodyAfterHead"><a name="996198">The finalization function of the protocol is called by the simulator at the end of simulation. It is the last code that executes during the simulation. This function is responsible for printing statistics to the statistics file.</a></div>
      <div class="BodyAfterHead"><a name="997478">At the end of simulation, the finalization function for each protocol is called to print the protocol statistics. As discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#934306', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.3</a></span>, the finalization function is called hierarchically. The node finalization function, PARTITION_Finalize, which is defined in <span class="Variable">QUALNET_HOME</span>/main/partition.cpp, calls the finalization function for Network Layer, NETWORK_Finalize, defined in <span class="Variable">QUALNET_HOME</span>/main/network.cpp. If IP is running at the Network Layer, NETWORK_Finalize calls the IP finalization function, NetworkIpFinalize, defined in network_ip.cpp. NetworkIpFinalize calls the finalization function of the routing protocol running at each interface. </div>
      <div class="Heading4Numbered">4.4.5.11.1  <a name="996200"> Modifying the IP Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="996201">Call the finalization function of a Network Layer routing protocol from the IP finalization function, NetworkIpFinalize, defined in network_ip.cpp. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#997435', '');" title="Network Layer">Figure&nbsp;4-86</a></span> shows the outline of code that needs to be added to NetworkIpFinalize. Function MyprotocolFinalize is the finalization function of the protocol MYPROTOCOL.</div>
      <div class="Code_Segment"><a name="996215">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1045929">void</a></div>
      <div class="Code_Segment"><a name="1045930">NetworkIpFinalize(Node *node)</a></div>
      <div class="Code_Segment"><a name="1045931">{</a></div>
      <div class="Code_Segment"><a name="1045932">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1045933">    Scheduler *schedulerPtr = NULL;</a></div>
      <div class="Code_Segment"><a name="997400">    int i = 0;</a></div>
      <div class="Code_Segment"><a name="1045937">    ...</a></div>
      <div class="Code_Segment"><a name="997403">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="997404">    {</a></div>
      <div class="Code_Segment"><a name="997405">        ...</a></div>
      <div class="Code_Segment"><a name="1095684">        switch (NetworkIpGetUnicastRoutingProtocolType(node, i))</a></div>
      <div class="Code_Segment"><a name="997406">        {</a></div>
      <div class="Code_Segment"><a name="1045941">            case MULTICAST_PROTOCOL_STATIC:</a></div>
      <div class="Code_Segment"><a name="1045942">            {</a></div>
      <div class="Code_Segment"><a name="1045943">                RoutingMulticastStaticFinalize(node);</a></div>
      <div class="Code_Segment"><a name="1045944">                break;</a></div>
      <div class="Code_Segment"><a name="997412">            }</a></div>
      <div class="Code_Segment"><a name="1045952">            </a></div>
      <div class="Code_Segment"><a name="1045953">            ...</a></div>
      <div class="Code_Segment"><a name="997417">            case ROUTING_PROTOCOL_AODV:</a></div>
      <div class="Code_Segment"><a name="997418">            {</a></div>
      <div class="Code_Segment"><a name="997420">               AodvFinalize(node, i, NETWORK_IPV4);</a></div>
      <div class="Code_Segment"><a name="1095675">               break;</a></div>
      <div class="Code_Segment"><a name="997421">            }</a></div>
      <div class="Code_Segment"><a name="997441">            ...</a></div>
      <div class="Code_New"><a name="997422">            case ROUTING_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="997423">            {</a></div>
      <div class="Code_New"><a name="997424">                MyprotocolFinalize(node, ...);</a></div>
      <div class="Code_New"><a name="997425">                break;</a></div>
      <div class="Code_New"><a name="997401">            }</a></div>
      <div class="Code_Segment"><a name="997431">            ...</a></div>
      <div class="Code_Segment"><a name="997432">    }</a></div>
      <div class="Code_Segment"><a name="997433">    ...</a></div>
      <div class="Code_Segment"><a name="997434">}</a></div>
      <div class="Figure">FIGURE 4-86.&nbsp;&nbsp;<a name="997435">Finalization Function for IP</a></div>
      <div class="Heading4Numbered">4.4.5.11.2  <a name="996234">Implementing the Protocol Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="996235">Write the finalization function for protocol, MyprotocolFinalize. If statistics collection is enabled for MYPROTOCOL, call a function to print the protocol statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996188', '');" title="Network Layer">Section&nbsp;4.4.5.10.4</a></span>), or add code directly to MyprotocolFinalize to print statistics. AODV follows the latter approach. Function AodvFinalize, shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#997580', '');" title="Network Layer">Figure&nbsp;4-87</a></span> and implemented in routing_aodv.cpp, is the finalization function for AODV. Use AodvFinalize as a template to write MyprotocolFinalize.</div>
      <div class="Body"><a name="997594">Function AodvFinalize calls the C function sprintf to create a single string containing the statistic name and statistic value, and then calls function IO_PrintStat to print that string to a file. Function IO_PrintStat function, defined in </a><span class="Variable">QUALNET_HOME</span>/include/fileio.h, requires the following parameters:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997595">Node pointer: Pointer to the node reporting the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997596">Layer: String indicating the layer. Set this to </a><span style="font-family: &quot;Courier New&quot;">"Network"</span> for the Network Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997597">Protocol: String indicating the protocol name.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997598">Interface address: Interface address. Set this to </a><span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> for Network Layer routing protocols.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997599">Instance identifier: Instance identifier or port number. Set this to -1 if there is no instance identifier.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997600">Buffer: String containing the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="996247">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997526">void</a></div>
      <div class="Code_Segment"><a name="997527">AodvFinalize(Node* node, int i, NetworkType networkType)</a></div>
      <div class="Code_Segment"><a name="997528">{</a></div>
      <div class="Code_Segment"><a name="997529">    ...</a></div>
      <div class="Code_Segment"><a name="997534">    if (aodv-&gt;statsCollected &amp;&amp; !aodv-&gt;statsPrinted)</a></div>
      <div class="Code_Segment"><a name="997535">    {</a></div>
      <div class="Code_Segment"><a name="997536">        aodv-&gt;statsPrinted = TRUE;</a></div>
      <div class="Code_Segment"><a name="997537">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1095712">        sprintf(buf, "Number of RREQ Packets Initiated = %u",</a></div>
      <div class="Code_Segment"><a name="1095713">                (unsigned short) aodv-&gt;stats.numRequestInitiated);</a></div>
      <div class="Code_Segment"><a name="997540">        IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="997541">            node,</a></div>
      <div class="Code_Segment"><a name="997542">            "Network",</a></div>
      <div class="Code_Segment"><a name="997544">            aodvVerBuf,</a></div>
      <div class="Code_Segment"><a name="1095737">            ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="997545">            -1,</a></div>
      <div class="Code_Segment"><a name="997546">            buf);</a></div>
      <div class="Code_Segment"><a name="996248">        ...</a></div>
      <div class="Code_Segment"><a name="1095745">        sprintf(buf, "Number of RREP Packets Received = %u",</a></div>
      <div class="Code_Segment"><a name="1095746">            aodv-&gt;stats.numReplyRecved);</a></div>
      <div class="Code_Segment"><a name="1095747">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1095748">        IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="1095749">            node,</a></div>
      <div class="Code_Segment"><a name="1095750">            "Network",</a></div>
      <div class="Code_Segment"><a name="1095751">            aodvVerBuf,</a></div>
      <div class="Code_Segment"><a name="1095752">            ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="1095753">            -1,</a></div>
      <div class="Code_Segment"><a name="997554">            buf);</a></div>
      <div class="Code_Segment"><a name="1095765">        ...</a></div>
      <div class="Code_Segment"><a name="997572">   }</a></div>
      <div class="Code_Segment"><a name="997570">}</a></div>
      <div class="Figure">FIGURE 4-87.&nbsp;&nbsp;<a name="997580">Finalization Function for AODV</a></div>
      <div class="Heading3Numbered">4.4.5.12  <a name="1084720">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1084724">The final step in integrating your routing protocol into </a><span class="Variable">QualNet</span> is to add the source file to the <span class="Variable">QualNet</span> source tree and compile.</div>
      <div class="BodyAfterHead"><a name="1045120">If you have created the files for the routing protocol in an existing library or addon, then add the source file to the Makefile-common for that library or addon. For example, if you have created your model files in the Developer library, then modify </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/Makefile-common as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1045141', '');" title="Network Layer">Figure&nbsp;4-88</a></span>. Recompile <span class="Variable">QualNet</span> after making the changes.</div>
      <div class="Code_Segment"><a name="1045124">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1045125">...</a></div>
      <div class="Code_Segment"><a name="1045126"># common sources</a></div>
      <div class="Code_Segment"><a name="1045127">#</a></div>
      <div class="Code_Segment"><a name="1045128">DEVELOPER_SRCS = \</a></div>
      <div class="Code_Segment"><a name="1045129">$(DEVELOPER_SRCDIR)/adaptation_aal5.cpp \</a></div>
      <div class="Code_Segment"><a name="1045130">$(DEVELOPER_SRCDIR)/adaptation.cpp \</a></div>
      <div class="Code_Segment"><a name="1045131">...</a></div>
      <div class="Code_Segment"><a name="1045166">$(DEVELOPER_SRCDIR)/resource_manager_cbq.cpp \</a></div>
      <div class="Code_Segment"><a name="1045167">$(DEVELOPER_SRCDIR)/route_atm.cpp \</a></div>
      <div class="Code_Segment"><a name="1045134">$(DEVELOPER_SRCDIR)/routing_bellmanford.cpp \</a></div>
      <div class="Code_New"><a name="1045135">$(DEVELOPER_SRCDIR)/routing_myprotocol.cpp \</a></div>
      <div class="Code_Segment"><a name="1045172">$(DEVELOPER_SRCDIR)/routing_rip.cpp \</a></div>
      <div class="Code_Segment"><a name="1045173">$(DEVELOPER_SRCDIR)/routing_ripng.cpp \</a></div>
      <div class="Code_Segment"><a name="1045138">$(DEVELOPER_SRCDIR)/routing_static.cpp \</a></div>
      <div class="Code_Segment"><a name="1045139">...</a></div>
      <div class="Figure">FIGURE 4-88.&nbsp;&nbsp;<a name="1045141">Adding Model to Makefile-common</a></div>
      <div class="Body"><a name="1096556">If you have created a new library called user_models, then follow the instructions given in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#929473', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10.5</a></span> to integrate the user_models library into <span class="Variable">QualNet</span>.</div>
      <div class="Heading3Numbered">4.4.5.13  <a name="1096532">Integrating the Protocol into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1096536">To make the new protocol available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Heading2Numbered">4.4.6  <a name="1005225">Adding a Network Layer Multicast Routing Protocol</a></div>
      <div class="BodyAfterHead"><a name="1005226">This section provides an overview of the flow of a Network Layer multicast routing protocol and provides an outline for developing and adding a new Network Layer multicast routing protocol to </a><span class="Variable">QualNet</span>. It describes how to develop code components common to most routing protocols such as initializing, sending and receiving packets, determining routes, and collecting statistics.</div>
      <div class="Body"><a name="1045988">A multicast routing protocol performs many of the tasks performed by a unicast routing protocol. In addition, a multicast routing protocol also has to perform group management functions. In general, a multicast routing protocol employs Internet Group Management Protocol (IGMP) utilities for group management. When developing a new multicast routing protocol, the user should also refer to </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986790', '');" title="Network Layer">Section&nbsp;4.4.5</a></span>, since many of the tasks are the same as for developing a unicast routing protocol.</div>
      <div class="Body"><a name="1084679">We illustrate the process of adding a Network Layer multicast routing protocol by using as an example the implementation code for the PIM (Protocol Independent Routing) routing protocol. PIM operates in two modes, Dense Mode (PIM-DM) and Sparse Mode (PIM-SM). The header file for the PIM implementation (for both PIM-DM and PIM-SM) is </a><span class="Variable">QUALNET_HOME</span>/libraries/multimedia_enterprise/src/multicast_pim.h. The PIM implementation uses three source files, multicast_pim.cpp (for both PIM-DM and PIM-SM), multicast_pim_dm.cpp (for PIM-DM only), and multicast_pim_sm.cpp (for PIM-SM only) in <span class="Variable">QUALNET_HOME</span>/libraries/multimedia_enterprise/src. In this section, we use the PIM-DM implementation as an example and use code segments from the PIM-DM implementation files throughout this section to illustrate different steps in writing a Network Layer multicast routing protocol. After understanding the discussed code segments, look at the complete code for PIM-DM to understand how a Network Layer multicast routing protocol is implemented in <span class="Variable">QualNet</span>.</div>
      <div class="Body"><a name="1084686">The following list summarizes the actions that need to be performed for adding a Network Layer multicast routing protocol, MYPROTOCOL, to </a><span class="Variable">QualNet</span>. For those steps that are similar to the steps for writing a Network Layer unicast routing protocol, we refer the reader to the appropriate subsection of <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986790', '');" title="Network Layer">Section&nbsp;4.4.5</a></span>. The steps that are different for multicast routing protocols are described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1005232">Create header and source files. Modify the file network_ip.cpp to include the protocol’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1043017', '');" title="Network Layer">Section&nbsp;4.4.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005240">Include the protocol in the list of Network Layer protocols and trace protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1043020', '');" title="Network Layer">Section&nbsp;4.4.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005244">Define data structures for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005463', '');" title="Network Layer">Section&nbsp;4.4.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005248">Decide on the format for the protocol-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993447', '');" title="Network Layer">Section&nbsp;4.4.5.5.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005249">Call the protocol’s initialization function from the routing initialization function, IpRoutingInit (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005617', '');" title="Network Layer">Section&nbsp;4.4.6.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005253">Write the initialization function for the protocol. The initialization function should include the following tasks:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1005257">Read and store the configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005801', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005261">Initialize the state variables and data structures (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005957', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005265">Register the protocol’s callback functions with IP and IGMP (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1006011', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005269">Initialize timers (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1006058', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005270">Call the protocol event dispatcher from the IP event dispatcher, NetworkIpLayer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007032', '');" title="Network Layer">Section&nbsp;4.4.6.5.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005274">Declare any new event types used by the protocol in the header file </a><span class="Variable">QUALNET_HOME</span>/include/api.h (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007077', '');" title="Network Layer">Section&nbsp;4.4.6.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005281">Write the protocol event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007077', '');" title="Network Layer">Section&nbsp;4.4.6.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005286">Implement the protocol’s routing packet handler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1005290">Define an IP Protocol Number for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007496', '');" title="Network Layer">Section&nbsp;4.4.6.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005294">Write a function to handle routing packets (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007622', '');" title="Network Layer">Section&nbsp;4.4.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005295">Call the routing packet handler function from the IP function DeliverPacket (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007496', '');" title="Network Layer">Section&nbsp;4.4.6.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005302">Write the call back functions used by the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007760', '');" title="Network Layer">Section&nbsp;4.4.6.7</a></span>). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005303">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1005307">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996149', '');" title="Network Layer">Section&nbsp;4.4.5.10.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005311">Initialize the statistics variables in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996158', '');" title="Network Layer">Section&nbsp;4.4.5.10.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005315">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996176', '');" title="Network Layer">Section&nbsp;4.4.5.10.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1005319">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996188', '');" title="Network Layer">Section&nbsp;4.4.5.10.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1096581">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1096485', '');" title="Network Layer">Section&nbsp;4.4.5.10.5</a></span>) .</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005320">Call the protocol finalization function from the IP finalization function, NetworkIpFinalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996200', '');" title="Network Layer">Section&nbsp;4.4.5.11.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005327">Write the protocol finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996234', '');" title="Network Layer">Section&nbsp;4.4.5.11.2</a></span>). Call the function to print statistics from the protocol finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005331">Include the protocol header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084720', '');" title="Network Layer">Section&nbsp;4.4.5.12</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1096621">To make the protocol available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1008363', '');" title="Network Layer">Section&nbsp;4.4.6.10</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.6.1  <a name="1043017">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1043018">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993059', '');" title="Network Layer">Section&nbsp;4.4.5.2</a></span>), except that in keeping with the naming guidelines of <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993055', '');" title="Network Layer">Section&nbsp;4.4.5.1</a></span>, the files for the example multicast routing protocol are called multicast_myprotocol.h and multicast_myprotocol.cpp.</div>
      <div class="Heading3Numbered">4.4.6.2  <a name="1043020">Including MYPROTOCOL in List of Routing Protocols</a></div>
      <div class="BodyAfterHead"><a name="1005397">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993167', '');" title="Network Layer">Section&nbsp;4.4.5.3</a></span>), except that there is no routing administrative distance associated with a multicast protocol.</div>
      <div class="Body"><a name="1005401">For our example protocol, add the entry </a><span style="font-family: &quot;Courier New&quot;">MULTICAST_PROTOCOL_MYPROTOCOL</span> to <span style="font-family: &quot;Courier New&quot;">NetworkRoutingProtocolType</span>, defined in <span class="Variable">QUALNET_HOME</span>/include/network.h,<span style="font-size: 9.0pt"> </span>as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1006276', '');" title="Network Layer">Figure&nbsp;4-89</a></span>.</div>
      <div class="Code_Segment"><a name="1006262">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1006263">typedef enum</a></div>
      <div class="Code_Segment"><a name="1006264">{</a></div>
      <div class="Code_Segment"><a name="1043055">    NETWORK_PROTOCOL_IP = 0,</a></div>
      <div class="Code_Segment"><a name="1043056">    NETWORK_PROTOCOL_IPV6,</a></div>
      <div class="Code_Segment"><a name="1006268">    NETWORK_PROTOCOL_MOBILE_IP,</a></div>
      <div class="Code_Segment"><a name="1043061">    ...</a></div>
      <div class="Code_Segment"><a name="1043044">    ROUTING_PROTOCOL_AODV6,</a></div>
      <div class="Code_Segment"><a name="1043045">    ROUTING_PROTOCOL_DYMO,</a></div>
      <div class="Code_Segment"><a name="1006274">    ROUTING_PROTOCOL_DYMO6,</a></div>
      <div class="Code_New"><a name="1043066">    MULTICAST_PROTOCOL_MYPROTOCOL</a></div>
      <div class="Code_Segment"><a name="1043053">} NetworkRoutingProtocolType;</a></div>
      <div class="Figure">FIGURE 4-89.&nbsp;&nbsp;<a name="1006276">Adding MYPROTOCOL to List of Network Layer Protocols</a></div>
      <div class="Note_Indented"><a name="1041905"><img class="Default" src="images/Chapter%204-4.08.1.09.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files.</a></div>
      <div class="Body"><a name="1084099">Similarly, add an entry </a><span style="font-family: &quot;Courier New&quot;">TRACE_MYPROTOCOL</span> just before the entry <span style="font-family: &quot;Courier New&quot;">TRACE_ANY_PROTOCOL</span> in the enumeration <span style="font-family: &quot;Courier New&quot;">TraceProtocolType</span>, defined in the file <span class="Variable">QUALNET_HOME</span>/include/trace.h, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1004903', '');" title="Network Layer">Figure&nbsp;4-68</a></span>.</div>
      <div class="Heading3Numbered">4.4.6.3  <a name="1005463">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="1005464">Each routing protocol has its own data structures, which are defined in the protocol’s header file. The data structures store information such as:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1005468">Protocol parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994547', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005472">Protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005957', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005476">Statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996149', '');" title="Network Layer">Section&nbsp;4.4.5.10.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005480">Forwarding table (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005957', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1005481">Define an appropriate data structure for MYPROTOCOL called </a><span style="font-family: &quot;Courier New&quot;">MyprotocolData</span> in the protocol header file, multicast_myprotocol.h. As an example, the following data structure (defined in multicast_pim.h) is used by the PIM protocol:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005482">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1006225">typedef struct struct_routing_pim_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1006226">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041288">    RoutingPimInterface*        interface;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041289">    RoutingPimStats             stats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041290">    BOOL                        showStat;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041291">    BOOL                        statPrinted;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041292">    RoutingPimModeType          modeType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005528">    void*                       pimModePtr;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043120">    RandomSeed                  seed;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041300">} PimData;</a></span></div>
      <div class="Body"><span style="font-family: &quot;Courier New&quot;"><a name="1005502">PimData</a></span> stores information for both modes of PIM. In addition, if PIM is operating in dense mode, the following data structure is also used:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043133">typedef struct struct_routing_pim_dm_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043134">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043135">    RoutingPimDmStats               stats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043136">    RoutingPimDmForwardingTable     fwdTable;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043131">} PimDmData;</a></span></div>
      <div class="Body"><a name="1005503">In the above declaration, </a><span style="font-family: &quot;Courier New&quot;">RoutingPimDmForwardingTable</span> is the data structure for the PIM-DM forwarding table and <span style="font-family: &quot;Courier New&quot;">RoutingPimDmStats</span> is the data structure for PIM-DM statistics.</div>
      <div class="Heading3Numbered">4.4.6.4  <a name="1005570">Initialization</a></div>
      <div class="BodyAfterHead"><a name="1005571">In this section, we describe the tasks that need to be performed as part of the initialization process of a Network Layer multicast routing protocol.</a></div>
      <div class="Heading4Numbered">4.4.6.4.1  <a name="1005573">Determining the Protocol Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="1005574">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993447', '');" title="Network Layer">Section&nbsp;4.4.5.5.1</a></span>). </div>
      <div class="Heading4Numbered">4.4.6.4.2  <a name="1005617">Calling the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="1005618">The protocol stack of each node is initialized in a bottom-up manner. The initialization of the Network Layer occurs after the layers below it have been initialized. This process is performed in the node initialization function PARTITION_InitializeNodes, implemented in </a><span class="Variable">QUALNET_HOME</span>/main/partition.cpp<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#919750', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.1</a></span>).</div>
      <div class="Body"><a name="1005622">The node initialization function, PARTITION_InitializeNodes, calls the Network Layer initialization function NETWORK_Initialize, which is implemented in the file </a><span class="Variable">QUALNET_HOME</span>/main/network.cpp. Function NETWORK_Initialize, in turn, calls the IP initialization function NetworkIpInit and the routing initialization function IpRoutingInit, which are implemented in the file <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.cpp. Function NetworkIpInit in turn calls function NetworkIpParseAndSetRoutingProtocolType, which reads the name of the multicast protocol for each interface from the configuration file and updates the multicast protocol information for that interface. Function IpRoutingInit calls the initialization function of the routing protocol configured on the interface. The code segments from NetworkIpParseAndSetRoutingProtocolType and IpRoutingInit corresponding to PIM are shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005698', '');" title="Network Layer">Figure&nbsp;4-91</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005698', '');" title="Network Layer">Figure&nbsp;4-91</a></span>, respectively. The functions used in the example are explained below.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005626">Function IO_ReadString reads the name of the routing protocol from the configuration file. The prototype for IO_ReadString is defined in </a><span class="Variable">QUALNET_HOME</span>/include/fileio.h.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005627">Function NetworkIpGetInterfaceAddress, defined in network_ip.cpp, returns the IP address associated with an interface. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005628">Function NetworkIpAddMulticastRoutingProtocolType, defined in network_ip.cpp, initializes the multicast routing protocol information for an interface. In the example of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1047158', '');" title="Network Layer">Figure&nbsp;4-90</a></span>, NetworkIpAddMulticastRoutingProtocolType updates the <span style="font-family: &quot;Courier New&quot;">IpInterfaceInfoType</span> structure associated with the interface (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>) by setting the <span style="font-family: &quot;Courier New&quot;">multicastProtocolType</span> field to <span style="font-family: &quot;Courier New&quot;">MULTICAST_PROTOCOL_PIM</span> and the <span style="font-family: &quot;Courier New&quot;">multicastRoutingProtocol</span> field to <span style="font-family: &quot;Courier New&quot;">NULL</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005635">Function NetworkIpGetMulticastRoutingProtocol, defined in network_ip.cpp, returns a pointer to the data structure associated with the specified multicast routing protocol. If the same multicast routing protocol is running at multiple interfaces of a node, a single instance of the data structure for the multicast routing protocol is shared by all interfaces. If the multicast routing protocol is running at one of the interfaces and that interface has been assigned a multicast routing protocol structure, NetworkIpGetMulticastRoutingProtocol returns a pointer to that structure; otherwise, it returns </a><span style="font-family: &quot;Courier New&quot;">NULL</span>. In the example of <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005698', '');" title="Network Layer">Figure&nbsp;4-91</a></span>, NetworkIpGetMulticastRoutingProtocol returns a pointer to the structure <span style="font-family: &quot;Courier New&quot;">PimData</span> or <span style="font-family: &quot;Courier New&quot;">NULL</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005639">RoutingPimInit is called if function NetworkIpGetMulticastRoutingProtocol returns </a><span style="font-family: &quot;Courier New&quot;">NULL</span>, i.e., an instance of <span style="font-family: &quot;Courier New&quot;">PimData</span> is not associated with any interface. Function RoutingPimInit, defined in multicast_pim.cpp, contains code to initialize PIM. In addition to performing other initializing tasks (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994539', '');" title="Network Layer">Section&nbsp;4.4.5.5.3</a></span>), RoutingPimInit creates an instance of the PIM data structure, <span style="font-family: &quot;Courier New&quot;">PimData</span>, and associates it with the specified interface by updating the <span style="font-family: &quot;Courier New&quot;">multicastRoutingProtocol</span> field of the <span style="font-family: &quot;Courier New&quot;">IpInterfaceInfoType</span> structure associated with the interface to point to the newly created instance of <span style="font-family: &quot;Courier New&quot;">PimData</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005643">Function NetworkIpUpdateMulticastRoutingProtocolAndRouterFunction, defined in network_ip.cpp, is called if function NetworkIpGetMulticastRoutingProtocol returns a non-</a><span style="font-family: &quot;Courier New&quot;">NULL</span> pointer, i.e., if PIM is running at another interface and an instance of <span style="font-family: &quot;Courier New&quot;">PimData</span> has been associated with that interface. NetworkIpUpdateMulticastRoutingProtocolAndRouterFunction associates the same instance of <span style="font-family: &quot;Courier New&quot;">PimData</span> with the specified interface. This ensures that even if a multicast routing protocol is running at multiple interfaces of a node, all interfaces running the same multicast routing protocol share one instance of the protocol data structure.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1006345">Function IgmpSetMulticastProtocolInfo, defined in </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/multicast_igmp.cpp, is an IGMP function that registers the multicast protocol’s function to manage groups. IgmpSetMulticastProtocolInfo is called if IGMP is enabled. A pointer to the PIM function, RoutingPimLocalMembersJoinOrLeave, is passed as a parameter to IgmpSetMulticastProtocolInfo. RoutingPimLocalMembersJoinOrLeave, defined in multicast_pim.cpp, calls function RoutingPimDmLocalMembersJoinOrLeave if PIM is operating in dense mode. RoutingPimDmLocalMembersJoinOrLeave, defined in multicast_pim_dm.cpp, takes appropriate actions when a node joins or leaves a group.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1047190">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1047191">void</a></div>
      <div class="Code_Segment"><a name="1047192">NetworkIpParseAndSetRoutingProtocolType (Node *node,</a></div>
      <div class="Code_Segment"><a name="1047193">                                         const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1047194">{</a></div>
      <div class="Code_Segment"><a name="1047195">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1047196">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="1047197">    ...</a></div>
      <div class="Code_Segment"><a name="1047198">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="1047199">    {</a></div>
      <div class="Code_Segment"><a name="1047200">       ...</a></div>
      <div class="Code_Segment"><a name="1047201">        IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1047202">                 node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1047203">                 NetworkIpGetInterfaceAddress(node, i),</a></div>
      <div class="Code_Segment"><a name="1047204">                 nodeInput,</a></div>
      <div class="Code_Segment"><a name="1047205">                 "MULTICAST-PROTOCOL",</a></div>
      <div class="Code_Segment"><a name="1047206">                 &amp;retVal,</a></div>
      <div class="Code_Segment"><a name="1047207">                 protocolString);</a></div>
      <div class="Code_Segment"><a name="1047208">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1047209">              if (retVal)</a></div>
      <div class="Code_Segment"><a name="1047210">        {</a></div>
      <div class="Code_Segment"><a name="1047211">            ...</a></div>
      <div class="Code_Segment"><a name="1047212">            else if (strcmp(protocolString, "PIM") == 0)</a></div>
      <div class="Code_Segment"><a name="1047213">            {</a></div>
      <div class="Code_Segment"><a name="1047214">                    multicastProtocolType = MULTICAST_PROTOCOL_PIM;</a></div>
      <div class="Code_Segment"><a name="1047215">            }</a></div>
      <div class="Code_Segment"><a name="1047216">            ...</a></div>
      <div class="Code_Segment"><a name="1047217">        }</a></div>
      <div class="Code_Segment"><a name="1047219">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1047220">        NetworkIpAddMulticastRoutingProtocolType(</a></div>
      <div class="Code_Segment"><a name="1047221">                        node,</a></div>
      <div class="Code_Segment"><a name="1047222">                        multicastProtocolType,</a></div>
      <div class="Code_Segment"><a name="1047223">                        i);</a></div>
      <div class="Code_Segment"><a name="1047224">         }</a></div>
      <div class="Code_Segment"><a name="1047225">     }</a></div>
      <div class="Code_Segment"><a name="1047226">     ...</a></div>
      <div class="Code_Segment"><a name="1047188">}</a></div>
      <div class="Figure">FIGURE 4-90.&nbsp;&nbsp;<a name="1047158">Initializing Multicast Routing Protocol Information for an Interface</a></div>
      <div class="Code_Segment"><a name="1005651">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005652">void</a></div>
      <div class="Code_Segment"><a name="1005653">IpRoutingInit(Node *node, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1005654">{</a></div>
      <div class="Code_Segment"><a name="1005655">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1005656">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="1005657">    ...</a></div>
      <div class="Code_Segment"><a name="1005658">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="1005659">    {</a></div>
      <div class="Code_Segment"><a name="1005660">      ...</a></div>
      <div class="Normal" style="margin-left: 0pt; margin-right: 0pt; text-indent: 0pt"><a name="1047253">             switch (ip-&gt;interfaceInfo[i]-&gt;multicastProtocolType)</a></div>
      <div class="Code_Segment"><a name="1047254">      {</a></div>
      <div class="Normal" style="margin-left: 90pt; margin-right: 0pt; text-indent: 0pt"><a name="1047255">case MULTICAST_PROTOCOL_PIM:</a></div>
      <div class=""><a name="1047256">{</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: -45pt"><a name="1047257">if (!NetworkIpGetMulticastRoutingProtocol(node,</a></div>
      <div class="Code_Segment" style="margin-left: 0pt; text-indent: -45pt"><a name="1047258">                                            MULTICAST_PROTOCOL_PIM))</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: -45pt"><a name="1047259">{</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: -45pt"><a name="1047260">       RoutingPimInit(node, nodeInput, i);</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: -45pt"><a name="1047261">}</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: -45pt"><a name="1047262"> else</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: -45pt"><a name="1047263"> {</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: -45pt"><a name="1047264">    NetworkIpUpdateMulticastRoutingProtocolAndRouterFunction(</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: 0pt"><a name="1047265">        node,</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: 0pt"><a name="1047266">        MULTICAST_PROTOCOL_PIM,</a></div>
      <div class="Code_Segment" style="margin-left: 153pt; text-indent: 0pt"><a name="1047267">        i);</a></div>
      <div class="Code_Segment"><a name="1047268">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1047269">                    /* Inform IGMP about multicast routing protocol */</a></div>
      <div class="Code_Segment"><a name="1047270">                    if (ip-&gt;isIgmpEnable == TRUE)</a></div>
      <div class="Code_Segment"><a name="1047271">                    {</a></div>
      <div class="Code_Segment"><a name="1047272">                        IgmpSetMulticastProtocolInfo(</a></div>
      <div class="Code_Segment"><a name="1047273">                                       node,</a></div>
      <div class="Code_Segment"><a name="1047274">                                       i,</a></div>
      <div class="Code_Segment"><a name="1047275">                                       &amp;RoutingPimLocalMembersJoinOrLeave);</a></div>
      <div class="Code_Segment"><a name="1047276">                    }</a></div>
      <div class="Code_Segment"><a name="1047277">                }</a></div>
      <div class="Code_Segment" style="margin-left: 108pt; text-indent: 0pt"><a name="1047278">break;</a></div>
      <div class="Code_Segment"><a name="1047279">            } //end case</a></div>
      <div class="Code_Segment"><a name="1047281">            ...</a></div>
      <div class="Code_Segment"><a name="1047282">        } // end switch</a></div>
      <div class="Code_Segment"><a name="1047283">        ...</a></div>
      <div class="Code_Segment"><a name="1047284">     } // end for</a></div>
      <div class="Code_Segment"><a name="1047285">     ...</a></div>
      <div class="Code_Segment"><a name="1047296">}</a></div>
      <div class="Figure">FIGURE 4-91.&nbsp;&nbsp;<a name="1005698">Calling PIM Initialization Function from IP Initialization Function</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005780', '');" title="Network Layer" name="1084627">Figure&nbsp;4-92</a></span> shows the modifications to be made to IpRoutingInit to incorporate MYPROTOCOL in <span class="Variable">QualNet</span>. RoutingMyprotocolInit is the initialization function for MYPROTOCOL (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005789', '');" title="Network Layer">Section&nbsp;4.4.6.4.3</a></span>) and RoutingMyprotocolLocalMembersJoinOrLeave is the MYPROTOCOL function to handle members joining or leaving groups. </div>
      <div class="Code_Segment"><a name="1005730">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005731">void</a></div>
      <div class="Code_Segment"><a name="1005732">IpRoutingInit(Node *node, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1005733">{</a></div>
      <div class="Code_Segment"><a name="1005734">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1005735">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="1005736">    ...</a></div>
      <div class="Code_Segment"><a name="1005737">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="1005738">    {</a></div>
      <div class="Code_Segment"><a name="1005739">      ...</a></div>
      <div class="Code_Segment"><a name="1047310">             switch (ip-&gt;interfaceInfo[i]-&gt;multicastProtocolType)</a></div>
      <div class="Code_Segment"><a name="1047311">      {</a></div>
      <div class="Code_Segment"><a name="1047312">            case MULTICAST_PROTOCOL_PIM:</a></div>
      <div class="Code_Segment"><a name="1047411">            {</a></div>
      <div class="Code_Segment"><a name="1047412">              ...</a></div>
      <div class="Code_Segment"><a name="1047435">            } //end case</a></div>
      <div class="Code_Segment"><a name="1047306">            ...</a></div>
      <div class="Code_New"><a name="1047363">           case MULTICAST_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1047364">           {</a></div>
      <div class="Code_New"><a name="1047365">               if (!NetworkIpGetMulticastRoutingProtocol(</a></div>
      <div class="Code_New"><a name="1047402">                                            node,</a></div>
      <div class="Code_New"><a name="1047366">                                            MULTICAST_PROTOCOL_MYPROTOCOL))</a></div>
      <div class="Code_New"><a name="1047367">               {</a></div>
      <div class="Code_New"><a name="1047368">                   RoutingMyprotocolInit(node, nodeInput, i);</a></div>
      <div class="Code_New"><a name="1047369">               }</a></div>
      <div class="Code_New"><a name="1047370">               else</a></div>
      <div class="Code_New"><a name="1047371">               {</a></div>
      <div class="Code_New"><a name="1047372">                   NetworkIpUpdateMulticastRoutingProtocolAndRouterFunction(</a></div>
      <div class="Code_New"><a name="1047373">                                       node,</a></div>
      <div class="Code_New"><a name="1047374">                                       MULTICAST_PROTOCOL_MYPROTOCOL,</a></div>
      <div class="Code_New"><a name="1047375">                                       i);</a></div>
      <div class="Code_New"><a name="1047376">&nbsp;</a></div>
      <div class="Code_New"><a name="1047377">                    /* Inform IGMP about multicast routing protocol */</a></div>
      <div class="Code_New"><a name="1047378">                    if (ip-&gt;isIgmpEnable == TRUE)</a></div>
      <div class="Code_New"><a name="1047379">                    {</a></div>
      <div class="Code_New"><a name="1047380">                        IgmpSetMulticastProtocolInfo(</a></div>
      <div class="Code_New"><a name="1047381">                                   node,</a></div>
      <div class="Code_New"><a name="1047382">                                   i,</a></div>
      <div class="Code_New"><a name="1047383">                                       &amp;RoutingMyprotocolLocalMembersJoinOrLeave);</a></div>
      <div class="Code_New"><a name="1047384">                    }</a></div>
      <div class="Code_New"><a name="1047385">                }</a></div>
      <div class="Code_New"><a name="1047386">                break;</a></div>
      <div class="Code_New"><a name="1047387">            } //end case</a></div>
      <div class="Code_Segment"><a name="1005775">         ...</a></div>
      <div class="Code_Segment"><a name="1005776">      }</a></div>
      <div class="Code_Segment"><a name="1047442">   }</a></div>
      <div class="Code_Segment"><a name="1005777">     ...</a></div>
      <div class="Code_Segment"><a name="1005778">}</a></div>
      <div class="Figure">FIGURE 4-92.&nbsp;&nbsp;<a name="1005780">Calling MYPROTOCOL Initialization Function from IP Initialization Function</a></div>
      <div class="Heading4Numbered">4.4.6.4.3  <a name="1005789">Implementing the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="1005790">The initialization of a Network Layer routing protocol takes place in the initialization function of the protocol that is called by the routing initialization function IpRoutingInit (see </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005698', '');" title="Network Layer">Figure&nbsp;4-91</a>). The initialization function of a multicast routing protocol commonly performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005794">Create an instance of the protocol data structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005795">Read and store the user-specified configuration parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005796">Initialize the state variables, groups, and forwarding table</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005797">Register the protocol’s router function and other callback functions with IP and IGMP</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005798">Schedule a timer to itself for starting the protocol</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1005799">Like all other functions belonging to the protocol, the prototype for the initialization function, RoutingMyprotocolInit, should be included in the protocol's header file, multicast_myprotocol.h.</a></div>
      <div class="Heading5Numbered">4.4.6.4.3.1  <a name="1005801">Creating an Instance and Reading Configuration Parameters</a></div>
      <div class="BodyAfterHead"><a name="1005802">The initialization function initializes the protocol state. Each protocol has a structure that it uses to store state information. This may include information such as flags, connection information, forwarding table used by the protocol, etc. </a></div>
      <div class="Body"><a name="1005803">To store the state, declare the structure to hold the protocol state in the header file, multicast_myprotocol.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993370', '');" title="Network Layer">Section&nbsp;4.4.5.4</a></span>). As an example, see the declaration of the PIM-DM data structures <span style="font-family: &quot;Courier New&quot;">PimData</span> and <span style="font-family: &quot;Courier New&quot;">PimDataDm</span> in multicast_pim.h.</div>
      <div class="Body"><a name="1043200">Create an instance of the protocol state by allocating memory to the state structure. PIM-DM performs this task in its initialization function RoutingPimInit by calling the function MEM_malloc to allocate memory for the PIM-DM data structures </a><span style="font-family: &quot;Courier New&quot;">PimData</span> and <span style="font-family: &quot;Courier New&quot;">PimDmData</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005889', '');" title="Network Layer">Figure&nbsp;4-93</a></span>. RoutingPimInit and the other PIM-DM functions are implemented in multicast_pim.cpp and multicast_pim_dm.cpp. Data structure and constant definitions for PIM-DM are contained in multicast_pim.h. RoutingPimInit calls the IP function NetworkIpSetMulticastRoutingProtocol, defined in network_ip.cpp, which assigns the newly created <span style="font-family: &quot;Courier New&quot;">PimData</span> as the multicast data structure for the specified interface (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>). </div>
      <div class="Body"><a name="1006751">If MYPROTOCOL has any user-specified configuration parameters, these should be read in the protocol’s initialization function. PIM-DM does not have any user-specified configuration parameters. To understand how configuration parameters are read from an input file, refer to the AODV example in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994547', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.1</a></span>.</div>
      <div class="Code_Segment"><a name="1006628">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1006468">void RoutingPimInit(Node *node,</a></div>
      <div class="Code_Segment"><a name="1006469">                    const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="1006470">                    int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="1006471">{</a></div>
      <div class="Code_Segment"><a name="1006472">    /* Allocate PIM layer structure */</a></div>
      <div class="Code_Segment"><a name="1006473">    PimData *pim = (PimData *)</a></div>
      <div class="Code_Segment"><a name="1006474">            MEM_malloc (sizeof(PimData));</a></div>
      <div class="Code_Segment"><a name="1043210">    PimDmData* pimDmData;</a></div>
      <div class="Code_Segment"><a name="1043231">     ...</a></div>
      <div class="Code_Segment"><a name="1043237">    /* Determine PIM routing mode */</a></div>
      <div class="Code_Segment"><a name="1043238">    IO_ReadString(node-&gt;nodeId, interfaceAddress, nodeInput,</a></div>
      <div class="Code_Segment"><a name="1043242">                  "PIM-ROUTING-MODE", &amp;retVal, buf);</a></div>
      <div class="Code_Segment"><a name="1043245">    ...</a></div>
      <div class="Code_Segment"><a name="1043252">    if (strcmp(buf, "DENSE") == 0)</a></div>
      <div class="Code_Segment"><a name="1043253">    {</a></div>
      <div class="Code_Segment"><a name="1043254">        pim-&gt;modeType = ROUTING_PIM_MODE_DENSE;</a></div>
      <div class="Code_Segment"><a name="1043255">        pimDmData = (PimDmData*)</a></div>
      <div class="Code_Segment"><a name="1043256">                    MEM_malloc (sizeof(PimDmData));</a></div>
      <div class="Code_Segment"><a name="1043258">        </a></div>
      <div class="Code_Segment"><a name="1046225">        pim-&gt;pimModePtr = (void*) pimDmData;</a></div>
      <div class="Code_Segment"><a name="1043259">    }</a></div>
      <div class="Code_Segment"><a name="1043260">    ...</a></div>
      <div class="Code_Segment"><a name="1043290">    if (ip-&gt;ipForwardingEnabled == TRUE)</a></div>
      <div class="Code_Segment"><a name="1043291">    {</a></div>
      <div class="Code_Segment"><a name="1043292">        NetworkIpAddToMulticastGroupList(node, ALL_PIM_ROUTER);</a></div>
      <div class="Code_Segment"><a name="1006514">    }</a></div>
      <div class="Code_Segment"><a name="1043308">    /* Set Multicast Routing Protocol */</a></div>
      <div class="Code_Segment"><a name="1006516">    NetworkIpSetMulticastRoutingProtocol(node, pim, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1006522">    /* Inform IGMP about multicast routing protocol */</a></div>
      <div class="Code_Segment"><a name="1006523">    if (ip-&gt;isIgmpEnable == TRUE)</a></div>
      <div class="Code_Segment"><a name="1006524">    {</a></div>
      <div class="Code_Segment"><a name="1006525">        IgmpSetMulticastProtocolInfo(node, interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1006526">                &amp;RoutingPimLocalMembersJoinOrLeave);</a></div>
      <div class="Code_Segment"><a name="1006527">    }</a></div>
      <div class="Code_Segment"><a name="1043313">    if (pim-&gt;modeType == ROUTING_PIM_MODE_DENSE)</a></div>
      <div class="Code_Segment"><a name="1043314">    {</a></div>
      <div class="Code_Segment"><a name="1043315">        /* Set Router function */</a></div>
      <div class="Code_Segment"><a name="1043316">        NetworkIpSetMulticastRouterFunction(node,</a></div>
      <div class="Code_Segment"><a name="1043317">            &amp;RoutingPimDmRouterFunction, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1043320">        /* Set funtion pointer to get informed when route changed */</a></div>
      <div class="Code_Segment"><a name="1043321">        NetworkIpSetRouteUpdateEventFunction(node,</a></div>
      <div class="Code_Segment"><a name="1043322">                &amp;RoutingPimDmAdaptUnicastRouteChange);</a></div>
      <div class="Code_Segment"><a name="1043324">         /* Initialize forwarding table */</a></div>
      <div class="Code_Segment"><a name="1043325">        RoutingPimDmInitForwardingTable(node);</a></div>
      <div class="Code_Segment"><a name="1043327">        ...</a></div>
      <div class="Code_Segment"><a name="1043339">    }</a></div>
      <div class="Code_Segment"><a name="1046204">    ...</a></div>
      <div class="Code_Segment"><a name="1046206">    /* Initializes interface structure */</a></div>
      <div class="Code_Segment"><a name="1043310">    RoutingPimInitInterface(node);</a></div>
      <div class="Code_Segment"><a name="1046214">    ...</a></div>
      <div class="Code_Segment"><a name="1006539"> }</a></div>
      <div class="Figure">FIGURE 4-93.&nbsp;&nbsp;<a name="1005889">PIM Initialization Function</a></div>
      <div class="Heading5Numbered">4.4.6.4.3.2  <a name="1005957">Initializing State Variables, Groups, and Forwarding Table</a></div>
      <div class="BodyAfterHead"><a name="1005958">The state variables of the routing protocol should be initialized in the protocol’s initialization function.</a></div>
      <div class="Body"><a name="1006767">The initialization function of a multicast routing protocol also initializes the list of multicast groups used by the protocol. For PIM, this is done in RoutingPimInit by calling the IP function NetworkIpAddToMulticastGroupList, defined in network_ip.cpp. </a></div>
      <div class="Body"><a name="1043393">The initialization function of a multicast routing protocol also initializes the forwarding table used by the protocol. For PIM-DM, this is done by calling the PIM-DM function RoutingPimDmInitForwardingTable, which is shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1043416', '');" title="Network Layer">Figure&nbsp;4-94</a></span>.</div>
      <div class="Code_Segment"><a name="1043394">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043401">void RoutingPimDmInitForwardingTable(Node* node)</a></div>
      <div class="Code_Segment"><a name="1043402">{</a></div>
      <div class="Code_Segment"><a name="1043403">    PimData* pim = (PimData*)</a></div>
      <div class="Code_Segment"><a name="1043404">        NetworkIpGetMulticastRoutingProtocol(node, MULTICAST_PROTOCOL_PIM);</a></div>
      <div class="Code_Segment"><a name="1043405">    PimDmData* pimDmData = (PimDmData*)pim-&gt;pimModePtr;</a></div>
      <div class="Code_Segment"><a name="1043406">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043407">    RoutingPimDmForwardingTable* fwdTable = &amp;pimDmData-&gt;fwdTable;</a></div>
      <div class="Code_Segment"><a name="1043408">    int size = </a></div>
      <div class="Code_Segment"><a name="1043409">        sizeof(RoutingPimDmForwardingTableRow)*  PIM_INITIAL_TABLE_SIZE;</a></div>
      <div class="Code_Segment"><a name="1043410">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043411">    BUFFER_InitializeDataBuffer(&amp;fwdTable-&gt;buffer, size);</a></div>
      <div class="Code_Segment"><a name="1043412">    fwdTable-&gt;numEntries = 0;</a></div>
      <div class="Code_Segment"><a name="1043395">}</a></div>
      <div class="Figure">FIGURE 4-94.&nbsp;&nbsp;<a name="1043416">Initializing PIM-DM Forwarding Table</a></div>
      <div class="Body"><a name="1046232">A routing protocol may need to maintain certain information about its interfaces. In this case, the interface information should be initialized in the initialization function of the protocol. For PIM-DM, this is done in RoutingPimInit by calling the PIM function RoutingPimInitInterface.</a></div>
      <div class="Heading5Numbered">4.4.6.4.3.3  <a name="1006011">Registering Callback Functions with IP and IGMP</a></div>
      <div class="BodyAfterHead"><a name="1006012">Just as a unicast routing protocol, a multicast routing protocol also implements callback functions that it registers with IP during the protocol’s initialization. These callback functions are described in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#994673', '');" title="Network Layer">Section&nbsp;4.4.5.5.3.3</a></span>. In addition, a multicast routing protocol may implement the following callback function that it registers with IP during initialization:</div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1046251">Callback Function</a></span>: Multicast router function used by the protocol</div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1046252">API to Register Function</a></span>: NetworkIpSetMulticastRouterFunction</div>
      <div class="NumberedCont" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1046253">Function Type</a></span><span style="font-weight: normal">: MulticastRouterFunctionType</span></div>
      <div class="Body"><a name="1006810">In addition, a multicast protocol also interacts with the IGMP protocol and implements the following callback function that it registers with IGMP during the protocol’s initialization. See </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/multicast_igmp.cpp for a description of the function parameters.</div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1006014">Callback Function</a></span>: Function used by the protocol to handle members leaving or joining groups</div>
      <div class="NumberedCont"><span style="font-weight: bold"><a name="1006015">API to Register Function</a></span>: IgmpSetMulticastProtocolInfo</div>
      <div class="NumberedCont" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1006016">Function Type</a></span><span style="font-weight: normal">: MulticastProtocolType</span></div>
      <div class="Body"><a name="1006056">As an example, the PIM-DM initialization function RoutingPimInit (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005889', '');" title="Network Layer">Figure&nbsp;4-93</a></span>) calls function NetworkIpSetMulticastRouterFunction to register with IP the PIM-DM router function, RoutingPimDmRouterFunction. RoutingPimInit calls function NetworkIpSetSetRouteUpdateEventFunction to register with IP the PIM-DM function, RoutingPimDmAdaptUnicastRouteChange, which handles changes in the unicast routes. If IGMP is enabled, RoutingPimInit calls function IgmpSetMulticastProtocolInfo to register with IGMP the PIM function, RoutingPimLocalMembersJoinOrleave, which handles members joining or leaving multicast groups. RoutingPimLocalMembersJoinOrLeave calls function RoutingPimDmLocalMembersJoinOrLeave if PIM is operating in dense mode. RoutingPimDmLocalMembersJoinOrLeave, defined in multicast_pim_dm.cpp, takes appropriate actions when a node joins or leaves a group. </div>
      <div class="Body"><a name="1046302">Note that function IgmpSetMulticastProtocolInfo is called by function NetworkIpInit (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1005617', '');" title="Network Layer">Section&nbsp;4.4.6.4.2</a></span>) as well as function RoutingPimInit. This is because function RoutingPimLocalMembersJoinOrleave has to be registered for each interface on which PIM is running. The other callback functions are registered only once for a node.</div>
      <div class="Heading5Numbered">4.4.6.4.3.4  <a name="1006058">Initializing Timers</a></div>
      <div class="BodyAfterHead"><a name="1006059">A routing protocol may need to set a timer at initialization. For example, the PIM initialization function RoutingPimInit sets a timer of type </a><span style="font-family: &quot;Courier New&quot;">MSG_ROUTING_PimScheduleHello</span> to trigger after a random delay. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#920185', '');" title="Discrete-event Simulation in QualNet">Section&nbsp;3.3.2.2</a></span> for details on setting timers.</div>
      <div class="Heading3Numbered">4.4.6.5  <a name="1007018">Implementing the Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="1007019">In this section, we describe the steps for implementing the event dispatcher function for a Network Layer multicast routing protocol. Some steps are the same as for adding a unicast routing protocol, described in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995535', '');" title="Network Layer">Section&nbsp;4.4.5.6</a></span>.</div>
      <div class="Heading4Numbered">4.4.6.5.1  <a name="1007032">Modifying the IP Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="1007033">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995544', '');" title="Network Layer">Section&nbsp;4.4.5.6.1</a></span>). To enable the protocol MYPROTOCOL to receive events, add a case in the switch statement in the IP event dispatcher function, NetworkIpLayer, to call MYPROTOCOL’s event dispatcher function, MyprotocolHandleProtocolEvent, when the protocol type of the received message is <span style="font-family: &quot;Courier New&quot;">MULTICAST_PROTOCOL_MYPROTOCOL</span>. </div>
      <div class="Heading4Numbered">4.4.6.5.2  <a name="1007077">Implementing the Protocol Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="1007078">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995693', '');" title="Network Layer">Section&nbsp;4.4.5.6.2</a></span>). </div>
      <div class="Body"><a name="1007148">Declare any additional event types used by the protocol in the enumeration file api.h, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1000542', '');" title="Network Layer">Figure&nbsp;4-77</a></span>.</div>
      <div class="Body"><a name="1007151">Write the event dispatcher for MYPROTOCOL, MyprotocolHandleProtocolEvent, which should include a switch on all message types that the protocol may receive. The event dispatcher function for a routing protocol generally handles timer events. As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007233', '');" title="Network Layer">Figure&nbsp;4-95</a></span> shows the PIM event dispatcher function RoutingPimHandleProtocolEvent. </div>
      <div class="Body"><a name="1007400">A multicast routing protocol typically performs the following functions which are triggered by time outs:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1007409">Send </a><span style="font-style: italic">hello</span> packets and other routing packets periodically. For example, function RoutingPimHandleProtocolEvent calls function RoutingPimSendHelloPacket to send <span style="font-style: italic">hello</span> packets when the timer event <span style="font-family: &quot;Courier New&quot;">MSG_ROUTING_PimScheduleHello</span> occurs.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1007441">Perform pruning functions to handle members leaving a multicast group. For example, RoutingPimHandleProtocolEvent performs pruning operations when timer event </a><span style="font-family: &quot;Courier New&quot;">MSG_ROUTING_PimPruneTimeoutAlarm</span> occurs.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1007463">Perform grafting functions to handle members joining a multicast group. For example, RoutingPimHandleProtocolEvent performs grafting operations when timer event </a><span style="font-family: &quot;Courier New&quot;">MSG_ROUTING_PimGraftRtmxtTimeOut</span> occurs.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1008558">As part of handling an event, a routing protocol at a node may transmit packets to its peers. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995693', '');" title="Network Layer">Section&nbsp;4.4.5.6.2</a></span> for details of sending packets.</div>
      <div class="Code_Segment"><a name="1007199">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1007243">void RoutingPimHandleProtocolEvent(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="1007200">{</a></div>
      <div class="Code_Segment"><a name="1007240">    ...</a></div>
      <div class="Code_Segment"><a name="1007253">    switch (msg-&gt;eventType)</a></div>
      <div class="Code_Segment"><a name="1007254">    {</a></div>
      <div class="Code_Segment"><a name="1007255">        case MSG_ROUTING_PimScheduleHello:</a></div>
      <div class="Code_Segment"><a name="1007251">        {</a></div>
      <div class="Code_Segment"><a name="1007260">            ...</a></div>
      <div class="Code_Segment"><a name="1046329">            /* Send Hello packet on all of its interfaces */</a></div>
      <div class="Code_Segment"><a name="1046330">            RoutingPimSendHelloPacket(node, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1046340">            /* Reschedule Hello packet broadcast */</a></div>
      <div class="Code_Segment"><a name="1046341">            newMsg = MESSAGE_Alloc(node,</a></div>
      <div class="Code_Segment"><a name="1046342">                                    NETWORK_LAYER,</a></div>
      <div class="Code_Segment"><a name="1046343">                                    MULTICAST_PROTOCOL_PIM,</a></div>
      <div class="Code_Segment"><a name="1095866">                                    MSG_ROUTING_PimScheduleHello);</a></div>
      <div class="Code_Segment"><a name="1095874">            MESSAGE_AddInfo(node, newMsg, sizeof(int), INFO_TYPE_PhyIndex);</a></div>
      <div class="Code_Segment"><a name="1095876">            memcpy(MESSAGE_ReturnInfo(newMsg, INFO_TYPE_PhyIndex),</a></div>
      <div class="Code_Segment"><a name="1095877">                   &amp;interfaceIndex, sizeof(int));</a></div>
      <div class="Code_Segment"><a name="1095880">            MESSAGE_Send(node, newMsg,</a></div>
      <div class="Code_Segment"><a name="1095868">                         pim-&gt;interface[interfaceIndex].helloInterval);</a></div>
      <div class="Code_Segment"><a name="1095893">            break;</a></div>
      <div class="Code_Segment"><a name="1095863">        }</a></div>
      <div class="Code_Segment"><a name="1007264">        ...</a></div>
      <div class="Code_Segment"><a name="1007273">        case MSG_ROUTING_PimDmPruneTimeoutAlarm:</a></div>
      <div class="Code_Segment"><a name="1007269">        {</a></div>
      <div class="Code_Segment"><a name="1007286">           ...</a></div>
      <div class="Code_Segment"><a name="1007289">        }</a></div>
      <div class="Code_Segment"><a name="1007291">        ...</a></div>
      <div class="Code_Segment"><a name="1007324">        case MSG_ROUTING_PimDmGraftRtmxtTimeOut:</a></div>
      <div class="Code_Segment"><a name="1007311">        {</a></div>
      <div class="Code_Segment"><a name="1007334">           ...</a></div>
      <div class="Code_Segment"><a name="1007337">        }</a></div>
      <div class="Code_Segment"><a name="1007339">        case MSG_ROUTING_PimDmJoinTimeOut:</a></div>
      <div class="Code_Segment"><a name="1007335">        {</a></div>
      <div class="Code_Segment"><a name="1007345">           ...</a></div>
      <div class="Code_Segment"><a name="1007348">        }</a></div>
      <div class="Code_Segment"><a name="1007350">        case MSG_ROUTING_PimDmScheduleJoin:</a></div>
      <div class="Code_Segment"><a name="1007346">        {</a></div>
      <div class="Code_Segment"><a name="1007360">           ...</a></div>
      <div class="Code_Segment"><a name="1007363">        }</a></div>
      <div class="Code_Segment"><a name="1043384">        ...</a></div>
      <div class="Code_Segment"><a name="1007365">        default:</a></div>
      <div class="Code_Segment"><a name="1007366">        {</a></div>
      <div class="Code_Segment"><a name="1007367">            printf("    Event Type = %d\n", msg-&gt;eventType);</a></div>
      <div class="Code_Segment"><a name="1007368">            ERROR_Assert(FALSE, "Unknown protocol event in PIM\n");</a></div>
      <div class="Code_Segment"><a name="1007369">        }</a></div>
      <div class="Code_Segment"><a name="1007370">    }</a></div>
      <div class="Code_Segment"><a name="1007372">    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1007361">}</a></div>
      <div class="Figure">FIGURE 4-95.&nbsp;&nbsp;<a name="1007233">PIM Event Dispatcher</a></div>
      <div class="Heading3Numbered">4.4.6.6  <a name="1007486">Processing Routing Packets</a></div>
      <div class="BodyAfterHead"><a name="1007859">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1000461', '');" title="Network Layer">Section&nbsp;4.4.5.8</a></span>). </div>
      <div class="Heading4Numbered">4.4.6.6.1  <a name="1007496">Modifying IP Packet Handler</a></div>
      <div class="BodyAfterHead"><a name="1007497">To add a new multicast routing protocol, MYPROTOCOL, at the Network Layer, assign an IP protocol number to MYPROTOCOL and modify the IP function DeliverPacket to deliver packets to MYPROTOCOL. </a></div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="1007523">Define an IP Protocol Number for MYPROTOCOL, </a><span style="font-family: &quot;Courier New&quot;">IPPROTOCOL_MYPROTOCOL</span>, in the file network_ip.h. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995901', '');" title="Network Layer">Section&nbsp;4.4.5.8.1</a></span> for details.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1007559">Modify the IP function DeliverPacket, defined in network_ip.cpp, to deliver packets to MYPROTOCOL. This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995901', '');" title="Network Layer">Section&nbsp;4.4.5.8.1</a></span>). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NumberedCont"><a name="1007930">Add code to DeliverPacket to call MYPROTOCOL’s packet handler function, RoutingMyprotocolHandleProtocolPacket, with appropriate parameters, if the IP Protocol Number read from the packet’s header is </a><span style="font-family: &quot;Courier New&quot;">IPPROTO_MYPROTOCOL</span> (defined in step 1) as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007620', '');" title="Network Layer">Figure&nbsp;4-96</a></span>.</div>
      <div class="Code_Segment"><a name="1007572">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1007573">static void //inline//</a></div>
      <div class="Code_Segment"><a name="1007574">DeliverPacket(Node *node, Message *msg,</a></div>
      <div class="Code_Segment"><a name="1007575">              int interfaceIndex, NodeAddress previousHopAddress)</a></div>
      <div class="Code_Segment"><a name="1007576">{</a></div>
      <div class="Code_Segment"><a name="1007577">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1007578">    NodeAddress sourceAddress = 0;</a></div>
      <div class="Code_Segment"><a name="1007579">    NodeAddress destinationAddress =0;</a></div>
      <div class="Code_Segment"><a name="1007580">    unsigned char ipProtocolNumber;</a></div>
      <div class="Code_Segment"><a name="1007581">    unsigned ttl =0;</a></div>
      <div class="Code_Segment"><a name="1007582">    ...</a></div>
      <div class="Code_Segment"><a name="1007583">    switch (ipProtocolNumber)</a></div>
      <div class="Code_Segment"><a name="1007584">    {</a></div>
      <div class="Code_Segment"><a name="1007585">        ...</a></div>
      <div class="Code_Segment"><a name="1007586">        // Delivery to network-layer routing protocols.</a></div>
      <div class="Code_Segment"><a name="1007587">        ...</a></div>
      <div class="Code_Segment"><a name="1007882">        case IPPROTO_PIM:</a></div>
      <div class="Code_Segment"><a name="1007883">        {</a></div>
      <div class="Code_Segment"><a name="1095954">            RoutingPimHandleProtocolPacket(node, msg, sourceAddress,</a></div>
      <div class="Code_Segment"><a name="1095960">                                           interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1095955">            break;</a></div>
      <div class="Code_Segment"><a name="1007588">        }</a></div>
      <div class="Code_New"><a name="1007602">        case IPPROTO_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1007603">        {</a></div>
      <div class="Code_New"><a name="1007604">            RoutingMyprotocolHandleProtocolPacket(node, msg, ...);</a></div>
      <div class="Code_New"><a name="1007614">            break;</a></div>
      <div class="Code_New"><a name="1007615">        }</a></div>
      <div class="Code_Segment"><a name="1007616">        ...</a></div>
      <div class="Code_Segment"><a name="1007617">    }//switch//</a></div>
      <div class="Code_Segment"><a name="1007618">}//DeliverPacket//</a></div>
      <div class="Figure">FIGURE 4-96.&nbsp;&nbsp;<a name="1007620">Delivering Packets from IP to Network Layer Routing Protocols</a></div>
      <div class="Heading4Numbered">4.4.6.6.2  <a name="1007622">Implementing the Protocol Packet Handler</a></div>
      <div class="BodyAfterHead"><a name="1007648">A routing protocol's packet handler should include a switch on all types of packets that the protocol may receive. It can then process each packet type either inside the switch or by calling a function to handle the packet type received. For example, function RoutingPimHandleProtocolPacket, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1007691', '');" title="Network Layer">Figure&nbsp;4-97</a></span> and implemented in multicast_pim.cpp, processes PIM routing packets.</div>
      <div class="Body"><a name="1008575">As part of processing a received packet, a routing protocol at a node may transmit packets to its peers. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995693', '');" title="Network Layer">Section&nbsp;4.4.5.6.2</a></span> for details of sending packets.</div>
      <div class="Body"><a name="1007649">Write function RoutingMyprotocolHandleProtocolPacket to handle routing packets for MYPROTOCOL. Follow the example of RoutingPimHandleProtocolPacket or the packet handler for some other Network Layer multicast routing protocol in </a><span class="Variable">QualNet</span>.</div>
      <div class="Code_Segment"><a name="1007650">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1007944">void RoutingPimHandleProtocolPacket(Node *node, Message *msg,</a></div>
      <div class="Code_Segment"><a name="1007945">                                    NodeAddress srcAddr, int interfaceId)</a></div>
      <div class="Code_Segment"><a name="1007946">{</a></div>
      <div class="Code_Segment"><a name="1007947">    PimData* pim = (PimData*)</a></div>
      <div class="Code_Segment"><a name="1007948">        NetworkIpGetMulticastRoutingProtocol(node, MULTICAST_PROTOCOL_PIM);</a></div>
      <div class="Code_Segment"><a name="1007950">    </a></div>
      <div class="Code_Segment"><a name="1008114">    /* Get PIM Common header */</a></div>
      <div class="Code_Segment"><a name="1007951">    RoutingPimCommonHeaderType *commonHeader =</a></div>
      <div class="Code_Segment"><a name="1007952">        (RoutingPimCommonHeaderType *) MESSAGE_ReturnPacket(msg);</a></div>
      <div class="Code_Segment"><a name="1007954">    </a></div>
      <div class="Code_Segment"><a name="1008115">    /* Make sure that PIM is running over this interface */</a></div>
      <div class="Code_Segment"><a name="1007957">    if (!RoutingPimIsPimEnabledInterface(node, interfaceId))</a></div>
      <div class="Code_Segment"><a name="1007958">    {</a></div>
      <div class="Code_Segment"><a name="1007959">        MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1007960">        return;</a></div>
      <div class="Code_Segment"><a name="1007961">    }</a></div>
      <div class="Code_Segment"><a name="1007964">    switch (RoutingPimCommonHeaderGetType(commonHeader-&gt;rpChType))    {</a></div>
      <div class="Code_Segment"><a name="1007965">        case ROUTING_PIM_HELLO:</a></div>
      <div class="Code_Segment"><a name="1007651">        {</a></div>
      <div class="Code_Segment"><a name="1007991">            RoutingPimHelloPacket *helloPkt =</a></div>
      <div class="Code_Segment"><a name="1007992">                (RoutingPimHelloPacket *) MESSAGE_ReturnPacket(msg);</a></div>
      <div class="Code_Segment"><a name="1007993">            int size = MESSAGE_ReturnPacketSize(msg);</a></div>
      <div class="Code_Segment"><a name="1007994">            ...</a></div>
      <div class="Code_Segment"><a name="1043434">             if (pim-&gt;modeType == ROUTING_PIM_MODE_DENSE)</a></div>
      <div class="Code_Segment"><a name="1043435">            {</a></div>
      <div class="Code_Segment"><a name="1043436">                PimDmData* pimDmData = (PimDmData*) pim-&gt;pimModePtr;</a></div>
      <div class="Code_Segment"><a name="1043438">                pimDmData-&gt;stats.helloReceived++;</a></div>
      <div class="Code_Segment"><a name="1043440">                RoutingPimDmHandleHelloPacket(node, srcAddr, helloPkt, size,</a></div>
      <div class="Code_Segment"><a name="1096009">                                              interfaceId);</a></div>
      <div class="Code_Segment"><a name="1043441">            }</a></div>
      <div class="Code_Segment"><a name="1043442">            else</a></div>
      <div class="Code_Segment"><a name="1043443">            {</a></div>
      <div class="Code_Segment"><a name="1043444">                ...</a></div>
      <div class="Code_Segment"><a name="1008013">            }            </a></div>
      <div class="Code_Segment"><a name="1043466">            break;</a></div>
      <div class="Code_Segment"><a name="1008014">        }</a></div>
      <div class="Code_Segment"><a name="1008016">        case ROUTING_PIM_JOIN_PRUNE:</a></div>
      <div class="Code_Segment"><a name="1007987">        {</a></div>
      <div class="Code_Segment"><a name="1008024">            ...</a></div>
      <div class="Code_Segment"><a name="1008027">        }</a></div>
      <div class="Code_Segment"><a name="1008082">        ...</a></div>
      <div class="Code_Segment"><a name="1008113">        default:</a></div>
      <div class="Code_Segment"><a name="1008083">        {</a></div>
      <div class="Code_Segment"><a name="1008084">            ERROR_Assert(FALSE, "Unknown packet type\n");</a></div>
      <div class="Code_Segment"><a name="1008085">        }</a></div>
      <div class="Code_Segment"><a name="1008086">    }</a></div>
      <div class="Code_Segment"><a name="1008088">    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1008056">}</a></div>
      <div class="Figure">FIGURE 4-97.&nbsp;&nbsp;<a name="1007691">PIM Routing Packet Handling Function</a></div>
      <div class="Heading3Numbered">4.4.6.7  <a name="1007760">Implementing Callback Functions</a></div>
      <div class="BodyAfterHead"><a name="1007777">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1006011', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.3</a></span>, a Network Layer multicast routing protocol in <span class="Variable">QualNet</span> implements certain callback functions. The implementation of these functions is similar to those for a unicast routing protocol (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#995933', '');" title="Network Layer">Section&nbsp;4.4.5.9</a></span>). </div>
      <div class="Body"><a name="1008137">If the multicast protocol uses IGMP services, it should implement a callback function that handles members joining or leaving a group. As an example, function RoutingPimDmLocalMembersJoinorLeave, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1008237', '');" title="Network Layer">Figure&nbsp;4-98</a></span> and implemented in multicast_pim_dm.cpp, is the PIM-DM function that takes appropriate actions when a member joins or leaves a group. This function is called by function RoutingPimLocalMembersJoinorLeave, which is registered with IGMP during the protocol’s initialization (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1006011', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.3</a></span>).</div>
      <div class="Code_Segment"><a name="1007781">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1008139">void RoutingPimDmLocalMembersJoinOrLeave(Node *node,</a></div>
      <div class="Code_Segment"><a name="1008140">                                         NodeAddress groupAddr,</a></div>
      <div class="Code_Segment"><a name="1008141">                                         int interfaceId,</a></div>
      <div class="Code_Segment"><a name="1008142">                                         LocalGroupMembershipEventType event)</a></div>
      <div class="Code_Segment"><a name="1008143">{</a></div>
      <div class="Code_Segment"><a name="1043476">    PimData* pim = (PimData*)</a></div>
      <div class="Code_Segment"><a name="1043477">        NetworkIpGetMulticastRoutingProtocol(node, MULTICAST_PROTOCOL_PIM);</a></div>
      <div class="Code_Segment"><a name="1043478">    PimDmData* pimDmData = (PimDmData*)pim-&gt;pimModePtr;</a></div>
      <div class="Code_Segment"><a name="1043479">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043480">    RoutingPimDmForwardingTableRow* rowPtr;</a></div>
      <div class="Code_Segment"><a name="1043481">    RoutingPimDmDownstreamListItem* downstreamInfo;</a></div>
      <div class="Code_Segment"><a name="1043482">    RoutingPimInterface* thisInterface;</a></div>
      <div class="Code_Segment"><a name="1008150">    unsigned int i;</a></div>
      <div class="Code_Segment"><a name="1043490">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1008151">    rowPtr = (RoutingPimDmForwardingTableRow *)</a></div>
      <div class="Code_Segment"><a name="1008152">                     BUFFER_GetData(&amp;pimDmData-&gt;fwdTable.buffer);</a></div>
      <div class="Code_Segment"><a name="1008153">    thisInterface = &amp;pim-&gt;interface[interfaceId];</a></div>
      <div class="Code_Segment"><a name="1008154">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1008155">    switch (event)</a></div>
      <div class="Code_Segment"><a name="1008156">    {</a></div>
      <div class="Code_Segment"><a name="1008157">        case LOCAL_MEMBER_JOIN_GROUP:</a></div>
      <div class="Code_Segment"><a name="1007782">        {</a></div>
      <div class="Code_Segment"><a name="1008172">            ...</a></div>
      <div class="Code_Segment"><a name="1008185">        }</a></div>
      <div class="Code_Segment"><a name="1008186">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1008187">        case LOCAL_MEMBER_LEAVE_GROUP:</a></div>
      <div class="Code_Segment"><a name="1008174">        {</a></div>
      <div class="Code_Segment"><a name="1008196">            ...</a></div>
      <div class="Code_Segment"><a name="1008201">        }</a></div>
      <div class="Code_Segment"><a name="1008202">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1008203">        default:</a></div>
      <div class="Code_Segment"><a name="1008204">        {</a></div>
      <div class="Code_Segment"><a name="1008205">            ERROR_Assert(FALSE, "Unknown IGMP Event\n");</a></div>
      <div class="Code_Segment"><a name="1008206">        }</a></div>
      <div class="Code_Segment"><a name="1008207">    }</a></div>
      <div class="Code_Segment"><a name="1008219">}</a></div>
      <div class="Figure">FIGURE 4-98.&nbsp;&nbsp;<a name="1008237">PIM-DM Function to Handle Members Leaving or Joining a Group</a></div>
      <div class="Body"><a name="1007838">Write the callback functions that MYPROTOCOL may need. Use PIM or some other appropriate multicast routing protocol as an example. Register all callback functions with IP and IGMP in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1006011', '');" title="Network Layer">Section&nbsp;4.4.6.4.3.3</a></span>).</div>
      <div class="Heading3Numbered">4.4.6.8  <a name="1008313">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="1008334">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1001888', '');" title="Network Layer">Section&nbsp;4.4.5.10</a></span>). </div>
      <div class="Heading3Numbered">4.4.6.9  <a name="1008322">Finalization</a></div>
      <div class="BodyAfterHead"><a name="1008346">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#996197', '');" title="Network Layer">Section&nbsp;4.4.5.11</a></span>). </div>
      <div class="Heading3Numbered">4.4.6.10  <a name="1008363">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1008374">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084720', '');" title="Network Layer">Section&nbsp;4.4.5.12</a></span>). </div>
      <div class="Heading3Numbered">4.4.6.11  <a name="1096876">Integrating the Protocol into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1096880">To make the new protocol available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Heading2Numbered">4.4.7  <span class="Variable"><a name="1025555">QualNet</a></span> Queuing Protocols</div>
      <div class="BodyAfterHead"><a name="1025562">This section describes the queuing protocols implemented in </a><span class="Variable">QualNet</span>. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025570', '');" title="Network Layer">Section&nbsp;4.4.7.1</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025737', '');" title="Network Layer">Section&nbsp;4.4.7.2</a></span> describe the implementation of queues in <span class="Variable">QualNet</span>. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1043902', '');" title="Network Layer">Section&nbsp;4.4.7.3</a></span> describes how <span class="Variable">QualNet</span> protocol models use the existing queuing models. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025892', '');" title="Network Layer">Section&nbsp;4.4.7.4</a></span> describes the procedure to add a new queue model to <span class="Variable">QualNet</span>.</div>
      <div class="Heading3Numbered">4.4.7.1  <a name="1025570">Data Structures and Classes</a></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="1025574">QualNet</a></span> implements several queue management algorithms (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1049280', '');" title="Network Layer">Table&nbsp;4-10</a></span>). Queues are implemented using C++ classes. This section gives details of the base class that implements the FIFO queue and from which classes that implement other queuing disciplines are derived. This section also describes some of the data structures used in the implementation of queues. These data structures and classes are defined in <span class="Variable">QUALNET_HOME</span>/include/if_queue.h. (Note that only a partial description of the data structures is provided here. Refer to the file if_queue.h for a complete description.)</div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025575">QueueOperation</a></span><span style="font-weight: bold">: </span>This enumeration type lists the different types of dequeue operations.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025576">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025577">typedef enum</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025578">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025579">    PEEK_AT_NEXT_PACKET, // 0 : Handles false dequeue functionality</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025580">    DEQUEUE_PACKET,      // 1 : Handles dequeue functionality</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025581">    DISCARD_PACKET,      // 2 : Handles drop functionality</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1041269">    DROP_PACKET          // 3 : Handles forcefully drop functionality</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025582">} QueueOperation;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025583">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025584">PacketArrayEntry</a></span><span style="font-family: Arial; font-weight: bold">: </span><span style="font-family: Arial">This data structure represents an entry in the array of stored messages. The fields of the data structure are described below.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment_Large"><a name="1025585">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1025586">typedef struct packet_array_entry_str</a></div>
      <div class="Code_Segment_Large"><a name="1025587">{</a></div>
      <div class="Code_Segment_Large"><a name="1025588">    Message *msg;</a></div>
      <div class="Code_Segment_Large"><a name="1025589">    clocktype insertTime;</a></div>
      <div class="Code_Segment_Large"><a name="1025590">    double infoField[PACKET_ARRAY_INFO_FIELD_SIZE / sizeof(double)];</a></div>
      <div class="Code_Segment_Large"><a name="1025591">    double serviceTag;</a></div>
      <div class="Code_Segment_Large"><a name="1025592">} PacketArrayEntry;</a></div>
      <div class="Code_Segment_Large"><a name="1025593">&nbsp;</a></div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025594">msg</a></span>: A pointer to the message.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025595">insertTime</a></span>: Simulation time when the message is inserted in the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025596">infoField</a></span>: Array that stores queuing algorithm-dependent data.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025597">serviceTag</a></span>: Variable that stores user-specific data.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025598">Queue</a></span>: This is the base class that is used to derive specific queue classes. This class implements the FIFO discipline and all other queue disciplines are derived from it. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025658', '');" title="Network Layer">Figure&nbsp;4-99</a></span>, <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1043742', '');" title="Network Layer">Figure&nbsp;4-100</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1043691', '');" title="Network Layer">Figure&nbsp;4-101</a></span> show the declaration of the <span style="font-family: &quot;Courier New&quot;">Queue</span> class.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1025605">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1025606">class Queue</a></div>
      <div class="Code_Segment"><a name="1025607">{</a></div>
      <div class="Code_Segment"><a name="1025608">  protected:</a></div>
      <div class="Code_Segment"><a name="1025609">    PacketArrayEntry* packetArray;</a></div>
      <div class="Code_Segment"><a name="1025610">    int numPackets;</a></div>
      <div class="Code_Segment"><a name="1025611">    int maxPackets;</a></div>
      <div class="Code_Segment"><a name="1025612">    int infoFieldSize;</a></div>
      <div class="Code_Segment"><a name="1025613">    int bytesUsed;</a></div>
      <div class="Code_Segment"><a name="1025614">    int queueSizeInBytes;</a></div>
      <div class="Code_Segment"><a name="1025615">    int headIndex;</a></div>
      <div class="Code_Segment"><a name="1025616">    int tailIndex;</a></div>
      <div class="Code_Segment"><a name="1025617">    ...</a></div>
      <div class="Code_Segment"><a name="1025618">    // QOS interface observation statistics</a></div>
      <div class="Code_Segment"><a name="1025619">    int qDelay;</a></div>
      <div class="Code_Segment"><a name="1025620">    int totalTransmission;</a></div>
      <div class="Code_Segment"><a name="1025621">    clocktype qosMonitorInterval;</a></div>
      <div class="Code_Segment"><a name="1025622">    clocktype queueCreationTime;</a></div>
      <div class="Code_Segment"><a name="1025623">    </a></div>
      <div class="Code_Segment"><a name="1025624">    // currentPeriod statistics</a></div>
      <div class="Code_Segment"><a name="1025625">    clocktype currentStateStartTime;</a></div>
      <div class="Code_Segment"><a name="1025626">    clocktype utilizedTime;</a></div>
      <div class="Code_Segment"><a name="1025627">    ...</a></div>
      <div class="Code_Segment"><a name="1025628">    clocktype currentPeriodStartTime;</a></div>
      <div class="Code_Segment"><a name="1025629">    ...</a></div>
      <div class="Code_Segment"><a name="1025630">    // standard statistics collected</a></div>
      <div class="Code_Segment"><a name="1025631">    float delayAveragingWeight; // used to calculate running average delay</a></div>
      <div class="Code_Segment"><a name="1043557">    BOOL isCollectStats;</a></div>
      <div class="Code_Segment"><a name="1025632">    D_Float64 avgSize;</a></div>
      <div class="Code_Segment"><a name="1025633">    int peakSize;</a></div>
      <div class="Code_Segment"><a name="1025634">    int numPacketsQueued;</a></div>
      <div class="Code_Segment"><a name="1025635">    int numPacketsDequeued;</a></div>
      <div class="Code_Segment"><a name="1025636">    D_Float64 numPacketsDropped;</a></div>
      <div class="Code_Segment"><a name="1025638">     ...</a></div>
      <div class="Code_Segment"><a name="1025639">    clocktype lastChange;</a></div>
      <div class="Code_Segment"><a name="1025640">    clocktype totalDelays;</a></div>
      <div class="Code_Segment"><a name="1025641">    clocktype longestDelay;</a></div>
      <div class="Code_Segment"><a name="1025642">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1025643">    // Utility functions</a></div>
      <div class="Code_Segment"><a name="1025644">    inline int  RetriveArrayIndex(int index);</a></div>
      <div class="Code_Segment"><a name="1025645">    void UpdateQueueLengthStats(const clocktype currentTime);</a></div>
      <div class="Code_Segment"><a name="1025646">    void UpdateQueueDelayStats(int packetArrayIndex,</a></div>
      <div class="Code_Segment"><a name="1025647">                               const clocktype currentTime);</a></div>
      <div class="Code_Segment"><a name="1025648">    void FinalizeQueue(Node *node,</a></div>
      <div class="Code_Segment"><a name="1025649">                      const char *layer,</a></div>
      <div class="Code_Segment"><a name="1025650">                      const char *protocol,</a></div>
      <div class="Code_Segment"><a name="1025651">                      const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1025652">                      const int instanceId,</a></div>
      <div class="Code_Segment"><a name="1025653">                      const char *invokingProtocol);</a></div>
      <div class="Code_Segment"><a name="1025654"> public:</a></div>
      <div class="Code_Segment"><a name="1025655">   ...</a></div>
      <div class="Code_Segment"><a name="1025656">};</a></div>
      <div class="Figure">FIGURE 4-99.&nbsp;&nbsp;<a name="1025658">Declaration of Class</a><span style="font-family: &quot;Courier New&quot;"> Queue</span>: Protected Members</div>
      <div class="Code_Segment"><a name="1025659">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1025660">class Queue</a></div>
      <div class="Code_Segment"><a name="1025661">{</a></div>
      <div class="Code_Segment"><a name="1025662">  protected:</a></div>
      <div class="Code_Segment"><a name="1043688">    ...</a></div>
      <div class="Code_Segment"><a name="1043695">  public:</a></div>
      <div class="Code_Segment"><a name="1043696">    </a></div>
      <div class="Code_Segment"><a name="1043697">    Queue(){};</a></div>
      <div class="Code_Segment"><a name="1043698">    ~Queue();</a></div>
      <div class="Code_Segment"><a name="1043699">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043700">    virtual void SetupQueue(Node* node,</a></div>
      <div class="Code_Segment"><a name="1043701">                            const char queueTypeString[],</a></div>
      <div class="Code_Segment"><a name="1043702">                            const int queueSize,</a></div>
      <div class="Code_Segment"><a name="1043703">                            const int infoFieldSize = 0,</a></div>
      <div class="Code_Segment"><a name="1043704">                            const int interfaceIndex = 0, </a></div>
      <div class="Code_Segment"><a name="1043705">                            const int queueNumber = 0, </a></div>
      <div class="Code_Segment"><a name="1043706">                            const BOOL enableQueueStat = FALSE,</a></div>
      <div class="Code_Segment"><a name="1043707">                            const BOOL showQueueInGui = FALSE,</a></div>
      <div class="Code_Segment"><a name="1043708">                            const clocktype currentTime = 0,</a></div>
      <div class="Code_Segment"><a name="1043709">                            const void* configInfo = NULL);</a></div>
      <div class="Code_Segment"><a name="1043710">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043711">    virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1043712">                        const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1043713">                        BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1043714">                        const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1043715">                        const double serviceTag = 0.0);</a></div>
      <div class="Code_Segment"><a name="1043716">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043717">    virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1043718">                        const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1043719">                        BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1043720">                        const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1043721">                        TosType* tos,</a></div>
      <div class="Code_Segment"><a name="1043722">                        const double serviceTag = 0.0);</a></div>
      <div class="Code_Segment"><a name="1043723">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043725">    virtual BOOL retrieve(Message** msg,</a></div>
      <div class="Code_Segment"><a name="1043726">                          const int index,</a></div>
      <div class="Code_Segment"><a name="1043727">                          const QueueOperation operation,</a></div>
      <div class="Code_Segment"><a name="1043728">                          const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1043729">                          double* serviceTag = NULL);</a></div>
      <div class="Code_Segment"><a name="1043730">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043731">    virtual BOOL isEmpty();</a></div>
      <div class="Code_Segment"><a name="1043732">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043733">    virtual int bytesInQueue();</a></div>
      <div class="Code_Segment"><a name="1043734">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043735">    virtual int freeSpaceInQueue();</a></div>
      <div class="Code_Segment"><a name="1043736">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043737">    virtual int packetsInQueue();</a></div>
      <div class="Code_Segment"><a name="1043820">    ...</a></div>
      <div class="Code_Segment"><a name="1043741">}</a></div>
      <div class="Figure">FIGURE 4-100.&nbsp;&nbsp;<a name="1043742">Declaration of Class Queue: Public Members (Part 1)</a></div>
      <div class="Code_Segment"><a name="1043807">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043808">class Queue</a></div>
      <div class="Code_Segment"><a name="1043809">{</a></div>
      <div class="Code_Segment"><a name="1043810">  protected:</a></div>
      <div class="Code_Segment"><a name="1043811">    ...</a></div>
      <div class="Code_Segment"><a name="1043812">  public:</a></div>
      <div class="Code_Segment"><a name="1043813">    </a></div>
      <div class="Code_Segment"><a name="1043814">    Queue(){};</a></div>
      <div class="Code_Segment"><a name="1043815">    ~Queue();</a></div>
      <div class="Code_Segment"><a name="1043796">    ...</a></div>
      <div class="Code_Segment"><a name="1043805">    virtual int packetsInQueue();</a></div>
      <div class="Code_Segment"><a name="1043797">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043798">    inline int sizeOfQueue();</a></div>
      <div class="Code_Segment"><a name="1043799">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043800">    void setServiceTag(double serviceTag);</a></div>
      <div class="Code_Segment"><a name="1043743">    virtual int replicate(Queue* newQueue);</a></div>
      <div class="Code_Segment"><a name="1043744">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043745">    // Resource Management API</a></div>
      <div class="Code_Segment"><a name="1043746">    void setQueueBehavior(BOOL suspend = FALSE);</a></div>
      <div class="Code_Segment"><a name="1043747">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043748">    // QOS interface observation API</a></div>
      <div class="Code_Segment"><a name="1043749">    virtual void qosQueueInformationUpdate(int* qDelayVal,</a></div>
      <div class="Code_Segment"><a name="1043750">                                int* totalTransmissionVal,</a></div>
      <div class="Code_Segment"><a name="1043751">                                const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1043752">                                BOOL isResetTotalTransmissionVal = FALSE);</a></div>
      <div class="Code_Segment"><a name="1043753">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043754">    // CurrentPeriod statistics API</a></div>
      <div class="Code_Segment"><a name="1043755">    inline int byteDequeuedInPeriod();</a></div>
      <div class="Code_Segment"><a name="1043756">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043757">    inline clocktype utilizationInPeriod();</a></div>
      <div class="Code_Segment"><a name="1043758">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043759">    inline clocktype averageTimeInQueue();</a></div>
      <div class="Code_Segment"><a name="1043760">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043761">    inline void resetPeriod (clocktype currentTime);</a></div>
      <div class="Code_Segment"><a name="1043762">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043763">    inline clocktype periodStartTime();</a></div>
      <div class="Code_Segment"><a name="1043764">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043765">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043766">    virtual void finalize(Node* node,</a></div>
      <div class="Code_Segment"><a name="1043767">                          const char* layer,</a></div>
      <div class="Code_Segment"><a name="1043768">                          const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1043769">                          const int instanceId,</a></div>
      <div class="Code_Segment"><a name="1043770">                          const char* invokingProtocol = "IP",</a></div>
      <div class="Code_Segment"><a name="1043771">                          const char* splStatStr = NULL);</a></div>
      <div class="Code_Segment"><a name="1043772">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043773">    clocktype getPacketInsertTime(int pktIndex);</a></div>
      <div class="Code_Segment"><a name="1043774">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043689">};</a></div>
      <div class="Figure">FIGURE 4-101.&nbsp;&nbsp;<a name="1043691">Declaration of Class Queue: Public Members (Part 2)</a></div>
      <div class="NumberedCont"><a name="1025710">Some of the data members of the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class are described below. The utility functions of the <span style="font-family: &quot;Courier New&quot;">Queue</span> class are described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025737', '');" title="Network Layer">Section&nbsp;4.4.7.2</a></span>.</div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025714">packetArray</a></span>: Array of packets in the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025715">numPackets</a></span>: Number of packets in the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025716">maxPackets</a></span>: Maximum number of packets that the queue can hold.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025717">infoFieldSize</a></span>: Size of the <span style="font-family: &quot;Courier New&quot;">infoField</span> array in <span style="font-family: &quot;Courier New&quot;">PacketArrayEntry</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025718">bytesUsed</a></span>: Total number of bytes in the packets in the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025719">queueSizeInBytes</a></span>: Maximum queue size, in bytes.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025720">headIndex</a></span>: Index of the packet at the head of the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025721">tailIndex</a></span>: Index of the packet at the tail of the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025722">qDelay</a></span>: Average packet delay in the current measurement period. A measurement period is the time period from the last call to function resetPeriod (or from the beginning of simulation, if resetPeriod has not been called) to the current simulation time.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025723">totalTransmission</a></span>: Total number of bytes removed from the queue in the current measurement period.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025724">queueCreationTime</a></span>: Simulation time when the queue was created.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025725">currentPeriodStartTime</a></span>: Start time of the current measurement period.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025726">utilizedTime</a></span>: Total time that the queue was non-empty in the current measurement period.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1043838">delayAveragingWeight</a></span>: Weight used to calculate the running average delay.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025727">avgSize</a></span>: Average queue size, in bytes, since the start of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025728">peakSize</a></span>: Largest queue size, in bytes, since the start of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025729">numPacketsQueued</a></span>: Number of packets enqueued since the start of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025730">numPacketsDequeued</a></span>: Number of packets dequeued since the start of simulation. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025731">numPacketsDropped</a></span>: Number of packets dropped since the start of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025732">numBytesQueued</a></span>: Number of bytes enqueued since the start of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025733">lastChange</a></span>: Simulation time when the statistics were last updated.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025734">totalDelays</a></span>: Total of the packet delays since the start of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025735">longestDelay</a></span>: Longest packet delay since the start of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.7.2  <a name="1025737">Interface Functions</a></div>
      <div class="BodyAfterHead"><a name="1025738">The protected interface functions provided by the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class are listed below. These functions are implemented in <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/if_queue.cpp.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025739">RetriveArrayIndex: This function returns the position of a packet in the queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025740">UpdateQueueLengthStats: This function calculates the average queue size.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025741">UpdateQueueDelayStats: This function calculates the queue delay.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025742">FinalizeQueue: This is the finalization function for the queue and prints the queue statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1025743">In addition to the functions listed above, the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class contains prototypes for the following virtual functions. See file if_queue.cpp for an explanation of the parameters of these functions as well as the implementations of the functions for the base class. A class derived from the <span style="font-family: &quot;Courier New&quot;">Queue</span> class can provide alternate implementation of these functions.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025744">SetupQueue: This function initializes a queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025745">insert: This function inserts a message into a queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025746">retrieve: This function dequeues, drops, or takes a peek at a message in a queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025747">isEmpty: This function determines if a queue is empty.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025748">bytesInQueue: This function returns the total number of bytes stored in a queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1043852">freeSpaceInQueue: This function returns the total number of free bytes available in the buffer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025749">packetsInQueue: This function returns the total number of packets stored in a queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025750">sizeOfQueue: This function returns the maximum size of a queue, in bytes.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1043853">setServiceTag: This function updates the service tag of the last enqueued packet.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025751">replicate: This function replicates a queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025752">qosQueueInformationUpdate: This function updates QOS information.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025753">byteDequeuedInPeriod: This function returns the total number of bytes dequeued from a queue in a the current measurement period, i.e., the time period from the last call to function resetPeriod (or from the beginning of simulation, if resetPeriod has not been called) to the current simulation time.   </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025754">utilizationInPeriod: This function returns the queue utilization, i.e., the amount of time that the queue is non-empty, in the current measurement period.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025755">averageTimeInQueue: This function returns the average time a packet spends in a queue in the current measurement period.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025756">resetPeriod: This function resets the measurement period and the period statistics variables. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025757">periodStartTime: This function returns the start time of the current measurement period.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025758">finalize: This function outputs the final queue statistics by calling FinalizeQueue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1043861">get PacketInsertTime: This function returns the insertion time of the top packet of the queue. If the queue is empty, it returns 0.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1043868">In addition to the interface functions provided by the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class, function QUEUE_Setup is also available for implementing queue management algorithms. Function QUEUE_Setup is used to create and initialize an object of the base <span style="font-family: &quot;Courier New&quot;">Queue</span> class or an object of a class derived from the base <span style="font-family: &quot;Courier New&quot;">Queue</span> class. The prototype of QUEUE_Setup is contained in if_queue.h and the implementation is contained in if_queue.cpp. The prototype of QUEUE_Setup is shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1043926', '');" title="Network Layer">Figure&nbsp;4-102</a></span>. See file if_queue.h for a description of the function parameters.</div>
      <div class="Code_Segment_Large"><a name="1043890">&nbsp;</a></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043906">void QUEUE_Setup(</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043907">    Node* node,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043908">    Queue** queue,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043909">    const char queueTypeString[],</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043910">    const int queueSize,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043911">    const int interfaceIndex,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043912">    const int queueNumber,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043913">    const int infoFieldSize = 0,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043914">    const BOOL enableQueueStat = FALSE,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043915">    const BOOL showQueueInGui = FALSE,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043916">    const clocktype currentTime = 0,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1043900">    const void* configInfo = NULL);</a></span></div>
      <div class="Figure">FIGURE 4-102.&nbsp;&nbsp;<a name="1043926">Prototype of Function QUEUE_Setup</a></div>
      <div class="Heading3Numbered">4.4.7.3  <a name="1043902">Using the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> Class</div>
      <div class="BodyAfterHead"><a name="1025773">This section describes how protocols use the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class and interface functions to implement queues.</div>
      <div class="Body"><a name="1025774">The </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class can be used to implement queues at any layer. In this section, we illustrate the use of queues by taking code segments from the implementation of the Messenger application, which is implemented by files app_messenger.h and app_messenger.cpp in the folder <span class="Variable">QUALNET_HOME</span>/libraries/developer/src.</div>
      <div class="Heading4Numbered">4.4.7.3.1  <a name="1025775">Creating and Initializing a Queue</a></div>
      <div class="BodyAfterHead"><a name="1084536">To create a queue, declare a pointer variable that points to an object of the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class and call function QUEUE_Setup (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025737', '');" title="Network Layer">Section&nbsp;4.4.7.2</a></span>). The type of queue that is created is determined by the parameter <span style="font-family: &quot;Courier New&quot;">queueTypeString</span> of QUEUE_Setup. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084549', '');" title="Network Layer">Table&nbsp;4-12</a></span> shows the different types of queues implemented in <span class="Variable">QualNet</span>. Other queue types can be derived from the <span style="font-family: &quot;Courier New&quot;">Queue</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025892', '');" title="Network Layer">Section&nbsp;4.4.7.4</a></span>).</div>
      <table class="Format_A" style="text-align: left; width: 296.94456pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-12.&nbsp;&nbsp;<a name="1084549">Implemented Queue Types</a></div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 116.94456pt">
            <div class="CellHeading" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1084553">queueTypeString</a></span></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 180pt">
            <div class="CellHeading"><a name="1084555">Queue Type</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084557">“FIFO”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1084559">FIFO queue</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084561">“RED”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1084563">Random Early Detection queue</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084565">“RED-ECN”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1084567">RED with Explicit Congestion Notification</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084569">“WRED”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1084571">Weighted RED queue</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084573">“RIO”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1084575">RED with In/Out bit</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1084577">“ATM-RED”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1084579">RED for use in ATM networks</a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="1084583">As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025847', '');" title="Network Layer">Figure&nbsp;4-103</a></span> shows the Messenger function MessengerOutputQueueInitialize which initializes a FIFO queue by calling function QUEUE_Setup. MessengerOutputQueueInitialize is implemented in app_messenger.cpp and the data structure <span style="font-family: &quot;Courier New&quot;">MessengerState</span> is defined in app_messenger.h.</div>
      <div class="Code_Segment"><a name="1025824">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043947">static void</a></div>
      <div class="Code_Segment"><a name="1043948">MessengerOutputQueueInitialize(</a></div>
      <div class="Code_Segment"><a name="1043949">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1043950">    MessengerState *messenger)</a></div>
      <div class="Code_Segment"><a name="1043951">{</a></div>
      <div class="Code_Segment"><a name="1043952">    Queue* queuePtr = NULL;</a></div>
      <div class="Code_Segment"><a name="1043953">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043954">    // a single FIFO queue</a></div>
      <div class="Code_Segment"><a name="1043955">    QUEUE_Setup(</a></div>
      <div class="Code_Segment"><a name="1043956">        node,</a></div>
      <div class="Code_Segment"><a name="1043957">        &amp;queuePtr,</a></div>
      <div class="Code_Segment"><a name="1043958">        "FIFO",</a></div>
      <div class="Code_Segment"><a name="1043959">        DEFAULT_APP_QUEUE_SIZE,</a></div>
      <div class="Code_Segment"><a name="1043960">        APP_MESSENGER, // this is used to set the random seed</a></div>
      <div class="Code_Segment"><a name="1043961">        0,</a></div>
      <div class="Code_Segment"><a name="1043962">        0, // infoFieldSize</a></div>
      <div class="Code_Segment"><a name="1043963">        FALSE,</a></div>
      <div class="Code_Segment"><a name="1043964">        FALSE,</a></div>
      <div class="Code_Segment"><a name="1043965">        getSimTime(node),</a></div>
      <div class="Code_Segment"><a name="1043966">        NULL);</a></div>
      <div class="Code_Segment"><a name="1043967">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1043968">    messenger-&gt;queue = queuePtr;</a></div>
      <div class="Code_Segment"><a name="1025845">}</a></div>
      <div class="Figure">FIGURE 4-103.&nbsp;&nbsp;<a name="1025847">Creating and Initializing a Queue</a></div>
      <div class="Heading4Numbered">4.4.7.3.2  <a name="1025848">Performing Queue Operations</a></div>
      <div class="BodyAfterHead"><a name="1025849">Queue operations, such as insertion, deletion, and checking if the queue is empty, are performed by calling the interface functions defined for the </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025737', '');" title="Network Layer">Section&nbsp;4.4.7.2</a></span>). The interface functions for the base class, <span style="font-family: &quot;Courier New&quot;">Queue</span>, are implemented in if_queue.cpp.</div>
      <div class="Body"><a name="1025856">As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025890', '');" title="Network Layer">Figure&nbsp;4-104</a></span> shows the Messenger function MessengerSendAllFromOutputQueue. MessengerSendAllFromOutputQueue calls the <span style="font-family: &quot;Courier New&quot;">Queue</span> class interface functions retrieve and packetsInQueue to dequeue packets from a queue. Other interface functions can be called in a similar way to perform queue operations.</div>
      <div class="Code_Segment"><a name="1025857">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1025858">static void</a></div>
      <div class="Code_Segment"><a name="1025859">MessengerSendAllFromOutputQueue(Node *node, MessengerState *messenger)</a></div>
      <div class="Code_Segment"><a name="1025860">{</a></div>
      <div class="Code_Segment"><a name="1025861">    Queue* queuePtr = messenger-&gt;queue;</a></div>
      <div class="Code_Segment"><a name="1025862">    int packetIndex = 0;</a></div>
      <div class="Code_Segment"><a name="1025863">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1025864">    // Dequeue all the packets from the queue which are currently there.</a></div>
      <div class="Code_Segment"><a name="1025865">    while (queuePtr-&gt;packetsInQueue())</a></div>
      <div class="Code_Segment"><a name="1025866">    {</a></div>
      <div class="Code_Segment"><a name="1025867">        Message *queueMsg = NULL;</a></div>
      <div class="Code_Segment"><a name="1025868">        ...</a></div>
      <div class="Code_Segment"><a name="1025869">        queuePtr-&gt;retrieve(&amp;queueMsg,</a></div>
      <div class="Code_Segment"><a name="1025870">                           packetIndex,</a></div>
      <div class="Code_Segment"><a name="1025871">                           DEQUEUE_PACKET,</a></div>
      <div class="Code_Segment"><a name="1025872">                           TIME_getSimTime(node));</a></div>
      <div class="Code_Segment"><a name="1025873">        if (queueMsg != NULL)</a></div>
      <div class="Code_Segment"><a name="1025874">        {</a></div>
      <div class="Code_Segment"><a name="1025875">            if (DEBUG_QUEUE)</a></div>
      <div class="Code_Segment"><a name="1025876">            {</a></div>
      <div class="Code_Segment"><a name="1025877">                printf("\t\tDequeuing a packet from Queue\n");</a></div>
      <div class="Code_Segment"><a name="1025878">            }</a></div>
      <div class="Code_Segment"><a name="1025879">            if (TEST_VOICE_APP)</a></div>
      <div class="Code_Segment"><a name="1025880">            {</a></div>
      <div class="Code_Segment"><a name="1025881">                ...</a></div>
      <div class="Code_Segment"><a name="1025882">            }</a></div>
      <div class="Code_Segment"><a name="1025883">            messenger-&gt;messageLastSentTime = TIME_getSimTime(node);</a></div>
      <div class="Code_Segment"><a name="1025884">            // Send All Queued Messeges</a></div>
      <div class="Code_Segment"><a name="1025885">            MESSAGE_Send(node, queueMsg, PROCESS_IMMEDIATELY);</a></div>
      <div class="Code_Segment"><a name="1025886">        }</a></div>
      <div class="Code_Segment"><a name="1025887">    }</a></div>
      <div class="Code_Segment"><a name="1025888">}</a></div>
      <div class="Figure" style="margin-top: 0.0pt">FIGURE 4-104.&nbsp;&nbsp;<a name="1025890">Calling Interface Functions for Queue Operations</a></div>
      <div class="Heading3Numbered">4.4.7.4  <a name="1025892">Adding a New Queue Model</a></div>
      <div class="BodyAfterHead"><a name="1025893">This section describes the procedure to add a new queue model to </a><span class="Variable">QualNet</span>. It describes how to develop code components common to most queuing protocols such as deriving a new queue class from the base class, reading queue-specific parameters, and implementing interface functions.</div>
      <div class="BodyAfterHead"><a name="1025894">We illustrate the process of adding a queue model by using as an example the implementation code for the RED (Random Early Detection) queuing protocol. The header file for the RED implementation is queue_red.h and the source file is queue_red.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. We use code snippets from these two files throughout this section to illustrate different steps in writing a queuing protocol. After understanding the discussed snippets, look at the complete code for RED to understand how a queue model is derived from the FIFO queue model described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025570', '');" title="Network Layer">Section&nbsp;4.4.7.1</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025737', '');" title="Network Layer">Section&nbsp;4.4.7.2</a></span>.</div>
      <div class="Body"><a name="1025901">The following list summarizes the actions that need to be performed for adding a new queue model, MYQUEUE, to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="1025905">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025939', '');" title="Network Layer">Section&nbsp;4.4.7.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025909">Modify the file if_queue.cpp to include the queue model’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025939', '');" title="Network Layer">Section&nbsp;4.4.7.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025913">Define data structures for the queue model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025981', '');" title="Network Layer">Section&nbsp;4.4.7.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025917">Decide on the format for the queue model-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025994', '');" title="Network Layer">Section&nbsp;4.4.7.4.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025921">Write a function to read the queue model-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026021', '');" title="Network Layer">Section&nbsp;4.4.7.4.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025925">Derive the new queue class based on the base </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026129', '');" title="Network Layer">Section&nbsp;4.4.7.4.5</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025929">Implement interface functions for the new queue model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026202', '');" title="Network Layer">Section&nbsp;4.4.7.4.6</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025933">Modify function QUEUE_Setup to call MYQUEUE’s setup function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026261', '');" title="Network Layer">Section&nbsp;4.4.7.4.7</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1025934">Include the queue model’s header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026310', '');" title="Network Layer">Section&nbsp;4.4.7.4.8</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1096837">To make the model available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1096805', '');" title="Network Layer">Section&nbsp;4.4.7.4.9</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading4Numbered">4.4.7.4.1  <a name="1025939">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1044002">This step is similar to the one for Network Layer routing protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993059', '');" title="Network Layer">Section&nbsp;4.4.5.2</a></span>). Create the header and source files for the queue model. Name these files in a way that clearly indicates the model that they implement. For queue models, prefix the file names with <span style="font-style: italic">queue_</span>.</div>
      <div class="Body"><a name="1025941">	Examples:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025942">queue_red.cpp, queue.h: These files in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src implement the RED queueing discipline.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025943">queue_rio_ecn.cpp, queue_rio_ecn.h: These files in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src implement the RIO ECN queueing discipline.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1025944">For the example queue, MYQUEUE, create files queue_myqueue.h and queue_myqueue.cpp in the appropriate folder. If MYQUEUE is a general-purpose queue, add the files to the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/user_models/src (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993059', '');" title="Network Layer">Section&nbsp;4.4.5.2</a></span>). If MYQUEUE is meant to be used by a specific protocol, add it to the same folder as the protocol files.</div>
      <div class="Note_Indented"><a name="1025948"><img class="Default" src="images/Chapter%204-4.08.1.10.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems, even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="1025949">While adding code to the files, it is important to organize the code well between the files. Generally, the header file for the queue model, queue_myqueue.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025950">Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025951">Data structure definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025955">Class definition for the new queue model derived from the base </a><span style="font-family: &quot;Courier New&quot;">Queue</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025570', '');" title="Network Layer">Section&nbsp;4.4.7.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025956">Prototypes for any additional interface functions in the queue model’s source file</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025957">Statement to include the generic queue model’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1025958">	</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025959">#include “if_queue.h”</a></span></div>
      <div class="Body"><a name="1025961">The source file for the queue model, queue_myqueue.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025962">Statement to include the queue model’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1025963">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025964">#include “queue_myqueue.h”</a></span></div>
      <div class="Code_Segment"><a name="1025965">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025966">Statements to include standard library functions and other header files needed by the queue model’s source file. A typical queue model source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025967">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025968">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025969">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025970">#include &lt;math.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025971">#include &lt;string.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025972">#include "api.h"        // </a></span><span class="Variable">QUALNET_HOME</span>/include/api.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025973">#include "if_queue.h"   // </a></span><span class="Variable">QUALNET_HOME</span>/include/if_queue.h. This allows</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025974">                        // for the use of the base Queue class.</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025975">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025976">Function to read MYQUEUE parameters, if any, from the configuration file</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025977">Interface functions for MYQUEUE</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1025978">The file </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/if_queue.cpp contains the generic function to setup a queue, QUEUE_Setup. QUEUE_Setup in turn calls setup functions for specific queue types. To make the MYQUEUE setup function available to function QUEUE_Setup, insert the following include statement in the file if_queue.cpp:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025979">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1102596">#include “queue_myqueue.h”</a></span></div>
      <div class="Heading4Numbered">4.4.7.4.2  <a name="1025981">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="1025982">In </a><span class="Variable">QualNet</span>, queue types are defined as classes derived from the base <span style="font-family: &quot;Courier New&quot;">Queue</span> class. In addition to the variables that are part of <span style="font-family: &quot;Courier New&quot;">Queue</span> class, a queue type may require other variables. For example, the RED queue implementation uses the data structure <span style="font-family: &quot;Courier New&quot;">RedParameters</span>, defined in queue_red.h, to store the queue-specific parameters.</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025983">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025984">typedef struct</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025985">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025986">    int             minThreshold;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025987">    int             maxThreshold;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025988">    double          maxProbability;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025989">    double          queueWeight;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025990">    clocktype       typicalSmallPacketTransmissionTime;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025991">} RedParameters;</a></span></div>
      <div class="Body"><a name="1025992">For MYQUEUE, define an appropriate data structure for MYQUEUE-specific parameters, if needed, in the file queue_myqueue.h.</a></div>
      <div class="Heading4Numbered">4.4.7.4.3  <a name="1025994">Determining the Queue Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="1027382">A queue model may use model-specific configuration parameters. The configuration parameters are specified in the </a><span class="Variable">QualNet</span> configuration file. The format for specifying a queue model’s configuration parameters is:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1027383">[&lt;Identifier&gt;] &lt;Parameter-name&gt; [&lt;Index&gt;] &lt;Parameter-value&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1027384">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="1027385">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1027386"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;	</span>: Node identifier, subnet identifier, or IP address to which this parameter declaration is applicable, enclosed in square brackets. This specification is optional, and if it is not included, the parameter declaration applies to all nodes.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="1027387">&lt;Parameter-name&gt;	</a></span>: Name of the parameter.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1027388"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;	</span>: Instance to which this parameter declaration is applicable, enclosed in square brackets. This is used when there are multiple instances of the parameter. This specification is optional, and if it is not included, the parameter declaration applies to all instances.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><span style="font-family: &quot;Courier New&quot;"><a name="1027389">&lt;Parameter-value&gt;</a></span>	: Value to be used for the parameter.</div>
      <div class="Body"><a name="1026000">As an example, the following configuration specifies that the RED queue is to be used and gives the values of the parameters for the RED queue. Refer to file </a><span class="Variable">QUALNET_HOME</span>/scenarios/default/default.config for an explanation of these parameters.</div>
      <div class="Code_Segment_Large"><a name="1026001">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1102615">IP-QUEUE-TYPE         RED</a></div>
      <div class="Code_Segment_Large"><a name="1026002">RED-MIN-THRESHOLD     5</a></div>
      <div class="Code_Segment_Large"><a name="1026003">RED-MAX-THRESHOLD     15</a></div>
      <div class="Code_Segment_Large"><a name="1026004">RED-MAX-PROBABILITY   0.02</a></div>
      <div class="Code_Segment_Large"><a name="1026005">RED-QUEUE-WEIGHT      0.002</a></div>
      <div class="Code_Segment_Large"><a name="1026006">RED-SMALL-PACKET-TRANSMISSION-TIME   10MS</a></div>
      <div class="Body"><a name="1026007">A configuration parameter is not always mandatory. If an optional configuration parameter is not assigned a value, the default value is used. For example, if a user does not specify a value for </a><span style="font-family: &quot;Courier New&quot;">RED-MIN-THRESHOLD</span>, the default value of 5 (<span style="font-family: &quot;Courier New&quot;">DEFAULT_RED_MIN_THRESHOLD</span>) is used by the model. </div>
      <div class="Body"><a name="1026008">Decide on the format for specifying the new queue model’s configuration parameters. For our example queue, specify the configuration parameters in the </a><span class="Variable">QualNet</span> configuration file using the following format (<span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;</span> and <span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;</span> can also be used to qualify the parameter declarations, as described above):</div>
      <div class="Code_Segment_Large"><a name="1026009"> IP-QUEUE-TYPE         MYQUEUE</a></div>
      <div class="Code_Segment_Large"><a name="1026010"> &lt;param1&gt;              &lt;value1&gt;</a></div>
      <div class="Code_Segment_Large"><a name="1026011"> ...</a></div>
      <div class="Code_Segment_Large"><a name="1026012"> &lt;paramN&gt;              &lt;valueN&gt;</a></div>
      <div class="Code_Segment_Large"><a name="1027077">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 18pt"><span style="font-family: &quot;Courier New&quot;"><a name="1027070"> </a></span>where</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="1026014">&lt;param1&gt;</a></span>, ..., <span style="font-family: &quot;Courier New&quot;">&lt;paramN&gt;	</span>: Names of parameters for MYQUEUE.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="1026015">&lt;value1&gt;</a></span>, ..., <span style="font-family: &quot;Courier New&quot;">&lt;valueN&gt;	</span>: Values of the queue parameters.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026021', '');" title="Network Layer" name="1026019">Section&nbsp;4.4.7.4.4</a></span> explains how to read user input specified in this format.</div>
      <div class="Heading4Numbered">4.4.7.4.4  <a name="1026021">Reading Configuration Parameters</a></div>
      <div class="BodyAfterHead"><a name="1026022">This section explains how to read user-specified configuration parameters for queue models (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025994', '');" title="Network Layer">Section&nbsp;4.4.7.4.3</a></span>) and provide them to the queue setup function.</div>
      <div class="BodyAfterHead"><a name="1026029">As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026081', '');" title="Network Layer">Figure&nbsp;4-105</a></span> shows how IP function NetworkIpInitOutputQueueConfiguration reads the configuration parameters for the RED queue by calling function ReadRedConfigurationParameters and initializes a RED queue by calling the generic queue setup function QUEUE_Setup. NetworkIpInitOutputQueueConfiguration is implemented in network_ip.cpp. ReadRedConfigurationParameters is implemented in queue_red.cpp. QUEUE_Setup is implemented in if_queue.cpp.</div>
      <div class="Code_Segment"><a name="1026030">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026031">void</a></div>
      <div class="Code_Segment"><a name="1026032">NetworkIpInitOutputQueueConfiguration(</a></div>
      <div class="Code_Segment"><a name="1026033">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1026034">    const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="1026035">    int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="1026036">{</a></div>
      <div class="Code_Segment"><a name="1026037">    ...</a></div>
      <div class="Code_Segment"><a name="1026038">    for (i = 0; i &lt; numPriorities; i++)</a></div>
      <div class="Code_Segment"><a name="1026039">    {</a></div>
      <div class="Code_Segment"><a name="1026040">        Queue* queue = NULL;</a></div>
      <div class="Code_Segment"><a name="1026041">        char queueTypeString[MAX_STRING_LENGTH] = {0};</a></div>
      <div class="Code_Segment"><a name="1026042">        ...</a></div>
      <div class="Code_Segment"><a name="1026043">        void* spConfigInfo = NULL; // Queue Specific configurations.</a></div>
      <div class="Code_Segment"><a name="1026044">       </a></div>
      <div class="Code_Segment"><a name="1026045">        IO_ReadStringInstance(</a></div>
      <div class="Code_Segment"><a name="1026046">            node, node-&gt;nodeId, interfaceIndex, nodeInput, "IP-QUEUE-TYPE",</a></div>
      <div class="Code_Segment"><a name="1026047">            i, TRUE, &amp;wasFound,  queueTypeString);</a></div>
      <div class="Code_Segment"><a name="1026048">        ...</a></div>
      <div class="Code_Segment"><a name="1026049">        </a></div>
      <div class="Code_Segment"><a name="1026050">        if (!strcmp(queueTypeString, "FIFO"))</a></div>
      <div class="Code_Segment"><a name="1026051">        {</a></div>
      <div class="Code_Segment"><a name="1026052">            // No specific configuration for FIFO</a></div>
      <div class="Code_Segment"><a name="1026053">        }</a></div>
      <div class="Code_Segment"><a name="1026054">        else if (!strcmp(queueTypeString, "RED"))</a></div>
      <div class="Code_Segment"><a name="1026055">        {</a></div>
      <div class="Code_Segment"><a name="1026056">            IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1026057">                node, node-&gt;nodeId, interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1026058">                nodeInput, "ECN", &amp;wasFound, buf);</a></div>
      <div class="Code_Segment"><a name="1026059">            if (wasFound &amp;&amp; (!strcmp(buf, "YES")))</a></div>
      <div class="Code_Segment"><a name="1026060">            {</a></div>
      <div class="Code_Segment"><a name="1026061">                ...</a></div>
      <div class="Code_Segment"><a name="1026062">            }</a></div>
      <div class="Code_Segment"><a name="1026063">            else</a></div>
      <div class="Code_Segment"><a name="1026064">            {</a></div>
      <div class="Code_Segment"><a name="1026065">                RedParameters* redParams = NULL;</a></div>
      <div class="Code_Segment"><a name="1026066">                ReadRedConfigurationParameters(node, interfaceIndex, nodeInput,</a></div>
      <div class="Code_Segment"><a name="1026067">                                               enableQueueStat, i, &amp;redParams);</a></div>
      <div class="Code_Segment"><a name="1026068">                spConfigInfo = (void*)(redParams);</a></div>
      <div class="Code_Segment"><a name="1026069">            }</a></div>
      <div class="Code_Segment"><a name="1026070">        }</a></div>
      <div class="Code_Segment"><a name="1026071">         else </a></div>
      <div class="Code_Segment"><a name="1026072">         ...</a></div>
      <div class="Code_Segment"><a name="1026073">       // Initialize Queue depending on queueTypeString specification</a></div>
      <div class="Code_Segment"><a name="1026074">        QUEUE_Setup(node, &amp;queue, queueTypeString, queueSize, interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044131">                    priority, 0, enableQueueStat, node-&gt;guiOption,</a></div>
      <div class="Code_Segment"><a name="1026076">                    getSimTime(node), spConfigInfo);</a></div>
      <div class="Code_Segment"><a name="1026077">       ...</a></div>
      <div class="Code_Segment"><a name="1026078">    }</a></div>
      <div class="Code_Segment"><a name="1026079">}</a></div>
      <div class="Figure" style="margin-top: 0.0pt">FIGURE 4-105.&nbsp;&nbsp;<a name="1026081">Setting Up Queues</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026127', '');" title="Network Layer" name="1026085">Figure&nbsp;4-106</a></span> shows the RED queue function ReadRedConfigurationParameters. ReadRedConfigurationParameters uses IO functions such as IO_ReadTimeInstance and IO_ReadIntInstance to read parameter values from the input file and store them in the appropriate fields of the RED queue data structure <span style="font-family: &quot;Courier New&quot;">RedParameters</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025981', '');" title="Network Layer">Section&nbsp;4.4.7.4.2</a></span>). If a value is not specified for a parameter in the input file, ReadRedConfigurationParameters stores the default value for that parameter. IO_ReadTimeInstance, IO_ReadIntInstance, and other IO functions are defined in <span class="Variable">QUALNET_HOME</span>/include/fileio.h.</div>
      <div class="Body"><a name="1026089">For the example queue, MYQUEUE, write a function to read user-specified configuration parameters if MYQUEUE uses such parameters.</a></div>
      <div class="Code_Segment"><a name="1026090">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026091">void ReadRedConfigurationParameters(</a></div>
      <div class="Code_Segment"><a name="1026092">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1026093">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1026094">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="1026095">    BOOL enableQueueStat,</a></div>
      <div class="Code_Segment"><a name="1026096">    int queueIndex,</a></div>
      <div class="Code_Segment"><a name="1026097">    RedParameters** redConfigParams)</a></div>
      <div class="Code_Segment"><a name="1026098">{</a></div>
      <div class="Code_Segment"><a name="1026099">    BOOL retVal = FALSE;</a></div>
      <div class="Code_Segment"><a name="1026102">    RedParameters* red = NULL;</a></div>
      <div class="Code_Segment"><a name="1026103">    int nodeId = node-&gt;nodeId;</a></div>
      <div class="Code_Segment"><a name="1026104">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026105">    red = (RedParameters*) MEM_malloc(sizeof(RedParameters));</a></div>
      <div class="Code_Segment"><a name="1026106">    memset(red, 0, sizeof(RedParameters));</a></div>
      <div class="Code_Segment"><a name="1026107">     IO_ReadTimeInstance(</a></div>
      <div class="Code_Segment"><a name="1026108">        node,</a></div>
      <div class="Code_Segment"><a name="1047473">        nodeId,</a></div>
      <div class="Code_Segment"><a name="1026109">        interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1026110">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="1026111">        "RED-SMALL-PACKET-TRANSMISSION-TIME",</a></div>
      <div class="Code_Segment"><a name="1026112">        queueIndex,  // parameterInstanceNumber</a></div>
      <div class="Code_Segment"><a name="1026113">        TRUE,      // fallbackIfNoInstanceMatch</a></div>
      <div class="Code_Segment"><a name="1026114">        &amp;retVal,</a></div>
      <div class="Code_Segment"><a name="1026115">        &amp;(red-&gt;typicalSmallPacketTransmissionTime));</a></div>
      <div class="Code_Segment"><a name="1026116">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026117">    if (!retVal)</a></div>
      <div class="Code_Segment"><a name="1026118">    {</a></div>
      <div class="Code_Segment"><a name="1026119">        red-&gt;typicalSmallPacketTransmissionTime =</a></div>
      <div class="Code_Segment"><a name="1026120">                DEFAULT_RED_SMALL_PACKET_TRANSMISSION_TIME;</a></div>
      <div class="Code_Segment"><a name="1026121">    }</a></div>
      <div class="Code_Segment"><a name="1026122">    ...</a></div>
      <div class="Code_Segment"><a name="1026123">    // Attch Info</a></div>
      <div class="Code_Segment"><a name="1026124">    *redConfigParams = red;</a></div>
      <div class="Code_Segment"><a name="1026125">}</a></div>
      <div class="Figure">FIGURE 4-106.&nbsp;&nbsp;<a name="1026127">Reading Queue Configuration Parameters</a></div>
      <div class="Heading4Numbered">4.4.7.4.5  <a name="1026129">Deriving New Queue Class from Base </a><span style="font-family: &quot;Courier New&quot;">Queue</span> Class</div>
      <div class="BodyAfterHead"><a name="1026133">In </a><span class="Variable">QualNet</span> all queues are implemented as classes derived from the base <span style="font-family: &quot;Courier New&quot;">Queue</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025570', '');" title="Network Layer">Section&nbsp;4.4.7.1</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025737', '');" title="Network Layer">Section&nbsp;4.4.7.2</a></span>). This section describes how to implement a new queue type as a class derived from the base <span style="font-family: &quot;Courier New&quot;">Queue</span> class by taking as an example the implementation of the RED queue.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026200', '');" title="Network Layer" name="1026140">Figure&nbsp;4-107</a></span> shows the declaration of the class <span style="font-family: &quot;Courier New&quot;">RedQueue</span> that implements the RED queue model. <span style="font-family: &quot;Courier New&quot;">RedQueue</span> is declared in queue_red.h and is derived from the base class <span style="font-family: &quot;Courier New&quot;">Queue</span>. One of the variables declared in <span style="font-family: &quot;Courier New&quot;">RedQueue</span> is a pointer to the data structure <span style="font-family: &quot;Courier New&quot;">RedParameters</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1025981', '');" title="Network Layer">Section&nbsp;4.4.7.4.2</a></span>) which stores the RED queue configurable parameters. Class <span style="font-family: &quot;Courier New&quot;">RedQueue</span> also contains prototypes of interface functions that are specific to RED queue or that override the base <span style="font-family: &quot;Courier New&quot;">Queue</span> class functions. Implementation of these functions is discussed in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026202', '');" title="Network Layer">Section&nbsp;4.4.7.4.6</a></span>.</div>
      <div class="Body"><a name="1026147">For the example queue, MYQUEUE, declare a class </a><span style="font-family: &quot;Courier New&quot;">Myqueue</span> derived from the base class <span style="font-family: &quot;Courier New&quot;">Queue</span> in the file queue_myqueue.h. </div>
      <div class="Code_Segment"><a name="1026148">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044144">class RedQueue:public Queue</a></div>
      <div class="Code_Segment"><a name="1044145">{</a></div>
      <div class="Code_Segment"><a name="1044146">    protected:</a></div>
      <div class="Code_Segment"><a name="1044147">      clocktype         startIdleTime; // Start of idle time</a></div>
      <div class="Code_Segment"><a name="1044148">      double            averageQueueSize;</a></div>
      <div class="Code_Segment"><a name="1044150">      RedParameters*    redParams;</a></div>
      <div class="Code_Segment"><a name="1044152">      int               packetCount; // packet since last marked packet</a></div>
      <div class="Code_Segment"><a name="1044153">      RandomSeed        randomDropSeed; // A random seed</a></div>
      <div class="Code_Segment"><a name="1044155">      // Utility Functions</a></div>
      <div class="Code_Segment"><a name="1044156">      void UpdateAverageQueueSize(const BOOL queueIsEmpty,</a></div>
      <div class="Code_Segment"><a name="1044157">                                  const int numPackets,</a></div>
      <div class="Code_Segment"><a name="1044158">                                  const double queueWeight,</a></div>
      <div class="Code_Segment"><a name="1044159">                                  const clocktype smallPktTxTime,</a></div>
      <div class="Code_Segment"><a name="1044160">                                  const clocktype startIdleTime,</a></div>
      <div class="Code_Segment"><a name="1044161">                                  double* avgQueueSize,</a></div>
      <div class="Code_Segment"><a name="1044162">                                  const clocktype theTime);</a></div>
      <div class="Code_Segment"><a name="1044164">      BOOL RedDropThePacket();</a></div>
      <div class="Code_Segment"><a name="1044166">    public:</a></div>
      <div class="Code_Segment"><a name="1044167">      virtual void SetupQueue(Node* node,</a></div>
      <div class="Code_Segment"><a name="1044168">                              const char queueTypeString[],</a></div>
      <div class="Code_Segment"><a name="1044169">                              const int queueSize,</a></div>
      <div class="Code_Segment"><a name="1044170">                              const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044171">                              const int queueNumber,</a></div>
      <div class="Code_Segment"><a name="1044172">                              const int infoFieldSize = 0,</a></div>
      <div class="Code_Segment"><a name="1044173">                              const BOOL enableQueueStat = FALSE,</a></div>
      <div class="Code_Segment"><a name="1044174">                              const BOOL showQueueInGui = FALSE,</a></div>
      <div class="Code_Segment"><a name="1044175">                              const clocktype currentTime = 0,</a></div>
      <div class="Code_Segment"><a name="1044176">                              const void* configInfo = NULL);</a></div>
      <div class="Code_Segment"><a name="1044178">      virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044179">                          const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1044180">                          BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044181">                          const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044182">                          const double serviceTag = 0.0);</a></div>
      <div class="Code_Segment"><a name="1044184">      virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044185">                          const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1044186">                          BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044187">                          const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044188">                          TosType* tos,</a></div>
      <div class="Code_Segment"><a name="1044189">                          const double serviceTag = 0.0);</a></div>
      <div class="Code_Segment"><a name="1044192">      virtual BOOL retrieve(Message** msg,</a></div>
      <div class="Code_Segment"><a name="1044193">                            const int index,</a></div>
      <div class="Code_Segment"><a name="1044194">                            const QueueOperation operation,</a></div>
      <div class="Code_Segment"><a name="1044195">                            const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044196">                            double* serviceTag = NULL);</a></div>
      <div class="Code_Segment"><a name="1044198">      virtual void finalize(Node* node,</a></div>
      <div class="Code_Segment"><a name="1044199">                            const char* layer,</a></div>
      <div class="Code_Segment"><a name="1044200">                            const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044201">                            const int instanceId,</a></div>
      <div class="Code_Segment"><a name="1044202">                            const char* invokingProtocol = "IP",</a></div>
      <div class="Code_Segment"><a name="1044203">                            const char* splStatStr = NULL);</a></div>
      <div class="Code_Segment"><a name="1044204">};</a></div>
      <div class="Figure">FIGURE 4-107.&nbsp;&nbsp;<a name="1026200">Deriving a New Queue from </a><span style="font-family: &quot;Courier New&quot;">Queue</span> Class</div>
      <div class="Heading4Numbered">4.4.7.4.6  <a name="1026202">Implementing Interface Functions</a></div>
      <div class="BodyAfterHead"><a name="1026203">The next step in adding a new queue type is to implement the interface functions for the derived queue class (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026129', '');" title="Network Layer">Section&nbsp;4.4.7.4.5</a></span>). The derived queue class inherits the functions of the base class, but any additional functions that are declared in the derived queue class and any functions that override the base class functions need to be implemented. For the example queue, MYQUEUE, add these functions in the file queue_myqueue.cpp. </div>
      <div class="Body"><a name="1026210">As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026259', '');" title="Network Layer">Figure&nbsp;4-108</a></span> shows the implementation of the <span style="font-family: &quot;Courier New&quot;">RedQueue</span> function insert. The <span style="font-family: &quot;Courier New&quot;">RedQueue</span> function insert performs tasks specific to the RED queue model, and then calls the insert function of the base class <span style="font-family: &quot;Courier New&quot;">Queue</span>.</div>
      <div class="Code_Segment"><a name="1026211">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044243">void RedQueue::insert(</a></div>
      <div class="Code_Segment"><a name="1044244">    Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044245">    const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1044246">    BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044247">    const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044248">    TosType* tos,</a></div>
      <div class="Code_Segment"><a name="1044249">    const double serviceTag</a></div>
      <div class="Code_Segment"><a name="1044250">    )</a></div>
      <div class="Code_Segment"><a name="1044251">{</a></div>
      <div class="Code_Segment"><a name="1044252">    ...</a></div>
      <div class="Code_Segment"><a name="1044255">    if (!(MESSAGE_ReturnPacketSize(msg) &lt;= (queueSizeInBytes - bytesUsed)))</a></div>
      <div class="Code_Segment"><a name="1044256">    {</a></div>
      <div class="Code_Segment"><a name="1044257">        // No space for this item in the queue</a></div>
      <div class="Code_Segment"><a name="1044258">        *QueueIsFull = TRUE;</a></div>
      <div class="Code_Segment"><a name="1044260">        // Update Generic Drop Stats</a></div>
      <div class="Code_Segment"><a name="1044261">        numPacketsDropped++;</a></div>
      <div class="Code_Segment"><a name="1044262">        numBytesDropped += MESSAGE_ReturnPacketSize(msg);</a></div>
      <div class="Code_Segment"><a name="1044264">        return;</a></div>
      <div class="Code_Segment"><a name="1044265">    }</a></div>
      <div class="Code_Segment"><a name="1044266">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044267">    // Update Average Queue Size.</a></div>
      <div class="Code_Segment"><a name="1044268">    UpdateAverageQueueSize(</a></div>
      <div class="Code_Segment"><a name="1044269">        isEmpty(),</a></div>
      <div class="Code_Segment"><a name="1044270">        packetsInQueue(),</a></div>
      <div class="Code_Segment"><a name="1044271">        redParams-&gt;queueWeight,</a></div>
      <div class="Code_Segment"><a name="1044272">        redParams-&gt;typicalSmallPacketTransmissionTime,</a></div>
      <div class="Code_Segment"><a name="1044273">        startIdleTime,</a></div>
      <div class="Code_Segment"><a name="1044274">        &amp;averageQueueSize,</a></div>
      <div class="Code_Segment"><a name="1044275">        currentTime);</a></div>
      <div class="Code_Segment"><a name="1044276">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044277">    if (RedDropThePacket())</a></div>
      <div class="Code_Segment"><a name="1044278">    {</a></div>
      <div class="Code_Segment"><a name="1044279">         ...</a></div>
      <div class="Code_Segment"><a name="1044282">        // A router has decided from its active queue management</a></div>
      <div class="Code_Segment"><a name="1044283">        // mechanism, to drop a packet.</a></div>
      <div class="Code_Segment"><a name="1044284">        *QueueIsFull = TRUE;</a></div>
      <div class="Code_Segment"><a name="1044286">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044334">        // Update Generic Drop Stats</a></div>
      <div class="Code_Segment"><a name="1044287">        numPacketsDropped++;</a></div>
      <div class="Code_Segment"><a name="1044288">        numBytesDropped += MESSAGE_ReturnPacketSize(msg);</a></div>
      <div class="Code_Segment"><a name="1044289">        return;</a></div>
      <div class="Code_Segment"><a name="1044290">    }</a></div>
      <div class="Code_Segment"><a name="1044292">    // Inserting a packet in the queue</a></div>
      <div class="Code_Segment"><a name="1044293">     Queue::insert(msg,</a></div>
      <div class="Code_Segment"><a name="1044294">                  infoField,</a></div>
      <div class="Code_Segment"><a name="1044295">                  QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044296">                  currentTime,</a></div>
      <div class="Code_Segment"><a name="1044297">                  serviceTag);</a></div>
      <div class="Code_Segment"><a name="1044240">}</a></div>
      <div class="Figure">FIGURE 4-108.&nbsp;&nbsp;<a name="1026259">Implementation of an Interface Function</a></div>
      <div class="Heading4Numbered">4.4.7.4.7  <a name="1026261">Modifying the Queue Setup Function</a></div>
      <div class="BodyAfterHead"><a name="1026262">Function QUEUE_Setup, implemented in if_queue.cpp, is used by protocols to set up a queue. To add the example queue, MYQUEUE, modify QUEUE_Setup as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026308', '');" title="Network Layer">Figure&nbsp;4-109</a></span>.</div>
      <div class="Code_Segment"><a name="1026266">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026267">void QUEUE_Setup(</a></div>
      <div class="Code_Segment"><a name="1044341">   Node* node,</a></div>
      <div class="Code_Segment"><a name="1044342">    Queue** queue,</a></div>
      <div class="Code_Segment"><a name="1044343">    const char queueTypeString[],</a></div>
      <div class="Code_Segment"><a name="1044344">    const int queueSize,</a></div>
      <div class="Code_Segment"><a name="1044345">    const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044346">    const int queueNumber,</a></div>
      <div class="Code_Segment"><a name="1044347">    const int infoFieldSize,</a></div>
      <div class="Code_Segment"><a name="1044348">    const BOOL enableQueueStat,</a></div>
      <div class="Code_Segment"><a name="1044349">    const BOOL showQueueInGui,</a></div>
      <div class="Code_Segment"><a name="1044350">    const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1026276">    const void* configInfo)</a></div>
      <div class="Code_Segment"><a name="1026277">{</a></div>
      <div class="Code_Segment"><a name="1026278">    if (!strcmp(queueTypeString, "FIFO"))</a></div>
      <div class="Code_Segment"><a name="1026279">    {</a></div>
      <div class="Code_Segment"><a name="1044359">       *queue = new Queue;</a></div>
      <div class="Code_Segment"><a name="1044360">        (*queue)-&gt;SetupQueue(node,</a></div>
      <div class="Code_Segment"><a name="1044361">                             queueTypeString,</a></div>
      <div class="Code_Segment"><a name="1044362">                             queueSize,</a></div>
      <div class="Code_Segment"><a name="1044363">                             interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044364">                             queueNumber,</a></div>
      <div class="Code_Segment"><a name="1044365">                             infoFieldSize,</a></div>
      <div class="Code_Segment"><a name="1044366">                             enableQueueStat,</a></div>
      <div class="Code_Segment"><a name="1026286">                             showQueueInGui);</a></div>
      <div class="Code_Segment"><a name="1026287">    }</a></div>
      <div class="Code_Segment"><a name="1026288">    else if (!strcmp(queueTypeString, "RED"))</a></div>
      <div class="Code_Segment"><a name="1026289">    {</a></div>
      <div class="Code_Segment"><a name="1026290">        *queue = new RedQueue;</a></div>
      <div class="Code_Segment"><a name="1026291">        ...</a></div>
      <div class="Code_Segment"><a name="1026292">    }</a></div>
      <div class="Code_Segment"><a name="1026293">    ...</a></div>
      <div class="Code_New"><a name="1026294">    else if (!strcmp(queueTypeString, "MYQUEUE"))</a></div>
      <div class="Code_New"><a name="1026295">    {</a></div>
      <div class="Code_New"><a name="1026296">        *queue = new Myqueue;</a></div>
      <div class="Code_New"><a name="1044375">        (*queue)-&gt;SetupQueue(node,</a></div>
      <div class="Code_New"><a name="1044376">                             queueTypeString,</a></div>
      <div class="Code_New"><a name="1044377">                             queueSize,</a></div>
      <div class="Code_New"><a name="1044378">                             interfaceIndex,</a></div>
      <div class="Code_New"><a name="1044379">                             queueNumber,</a></div>
      <div class="Code_New"><a name="1044380">                             infoFieldSize,</a></div>
      <div class="Code_New"><a name="1044381">                             enableQueueStat,</a></div>
      <div class="Code_New"><a name="1044382">                             showQueueInGui,</a></div>
      <div class="Code_New"><a name="1044396">                             ...);</a></div>
      <div class="Code_New"><a name="1026304">    }</a></div>
      <div class="Code_Segment"><a name="1026305">    ...</a></div>
      <div class="Code_Segment"><a name="1026306">}</a></div>
      <div class="Figure">FIGURE 4-109.&nbsp;&nbsp;<a name="1026308">Modifying Function QUEUE_Setup</a></div>
      <div class="Heading4Numbered">4.4.7.4.8  <a name="1026310">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1026314">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084720', '');" title="Network Layer">Section&nbsp;4.4.5.12</a></span>). </div>
      <div class="Heading4Numbered">4.4.7.4.9  <a name="1096805">Integrating the Model into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1096809">To make the new model available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Heading2Numbered">4.4.8  <span class="Variable"><a name="1026315">QualNet</a></span> Schedulers</div>
      <div class="BodyAfterHead"><a name="1084475">This section describes the scheduling schemes implemented in </a><span class="Variable">QualNet</span>. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026330', '');" title="Network Layer">Section&nbsp;4.4.8.1</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026451', '');" title="Network Layer">Section&nbsp;4.4.8.2</a></span> describe the implementation of schedulers in <span class="Variable">QualNet</span>. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026477', '');" title="Network Layer">Section&nbsp;4.4.8.3</a></span> describes how <span class="Variable">QualNet</span> protocol models use the existing scheduler models. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026595', '');" title="Network Layer">Section&nbsp;4.4.8.4</a></span> describes the procedure to add a new scheduler model to <span class="Variable">QualNet</span>.</div>
      <div class="Heading3Numbered">4.4.8.1  <a name="1026330">Data Structures and Classes</a></div>
      <div class="Body"><span class="Variable"><a name="1084358">QualNet</a></span> implements several scheduling schemes (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1049343', '');" title="Network Layer">Table&nbsp;4-11</a></span>). Schedulers are implemented using C++ classes. This section gives details of the base class used for deriving specific classes that implement different scheduling schemes. This section also describes some of the data structures used in the implementation of schedulers. These data structures and classes are defined in <span class="Variable">QUALNET_HOME</span>/include/if_scheduler.h. (Note that only a partial description of the data structures is provided here. Refer to the file if_scheduler.h for a complete description.) </div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026335">QueueData</a></span><span style="font-weight: bold">: </span>This structure contains information for one queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026336">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026337">typedef struct queue_data_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026338">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026339">    Queue* queue;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026340">    int priority;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026341">    float weight;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1044416">    float rawWeight;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026342">    char* infoField;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026343">} QueueData;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026344">&nbsp;</a></div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026345">queue</a></span>: A pointer to an object of the <span style="font-family: &quot;Courier New&quot;">Queue</span> class implementing the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026346">priority</a></span>: Priority of the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026347">weight</a></span>: Weight of the queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1044417">rawWeight</a></span>: Raw weight, i.e., without normalization.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026348">infoField</a></span>: User-specified data.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026353">Scheduler</a></span>: This is the base class that is used to derive specific scheduler classes. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026386', '');" title="Network Layer">Figure&nbsp;4-110</a></span>, <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1044557', '');" title="Network Layer">Figure&nbsp;4-111</a></span>, and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026437', '');" title="Network Layer">Figure&nbsp;4-112</a></span> show the declaration of the <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1026357">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026358">class Scheduler</a></div>
      <div class="Code_Segment"><a name="1026359">{</a></div>
      <div class="Code_Segment"><a name="1026360">    protected:</a></div>
      <div class="Code_Segment"><a name="1026361">      QueueData*    queueData;</a></div>
      <div class="Code_Segment"><a name="1026362">      int           numQueues;</a></div>
      <div class="Code_Segment"><a name="1026363">      int           maxQueues;</a></div>
      <div class="Code_Segment"><a name="1026364">      int           infoFieldSize;</a></div>
      <div class="Code_Segment"><a name="1026365">      int           packetsLostToOverflow;</a></div>
      <div class="Code_Segment"><a name="1026366">      </a></div>
      <div class="Code_Segment"><a name="1026367">      // CurrentPeriod statistics</a></div>
      <div class="Code_Segment"><a name="1026368">      clocktype               currentStateStartTime;</a></div>
      <div class="Code_Segment"><a name="1026369">      clocktype               utilizedTime;</a></div>
      <div class="Code_Segment"><a name="1026370">      BOOL                    stateIsIdle;</a></div>
      <div class="Code_Segment"><a name="1026371">      int                     bytesDequeuedInPeriod;</a></div>
      <div class="Code_Segment"><a name="1026372">      int                     packetsDequeuedInPeriod;</a></div>
      <div class="Code_Segment"><a name="1026373">      clocktype               currentPeriodStartTime;</a></div>
      <div class="Code_Segment"><a name="1026374">      clocktype               queueDelaysDuringPeriod;</a></div>
      <div class="Code_Segment"><a name="1026375">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026376">      // Scheduler statistic collection</a></div>
      <div class="Code_Segment"><a name="1026377">      BOOL                    schedulerStatEnabled;</a></div>
      <div class="Code_Segment"><a name="1026378">      void*         schedGraphStatPtr;</a></div>
      <div class="Code_Segment"><a name="1026379">      // Utility function for packet retrieval from specified priority queue</a></div>
      <div class="Code_Segment"><a name="1026380">      QueueData*    SelectSpecificPriorityQueue(int priority);</a></div>
      <div class="Code_Segment"><a name="1026381">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026382">    public:</a></div>
      <div class="Code_Segment"><a name="1026383">       ...</a></div>
      <div class="Code_Segment"><a name="1026384">}</a></div>
      <div class="Figure">FIGURE 4-110.&nbsp;&nbsp;<a name="1026386">Declaration of Class</a><span style="font-family: &quot;Courier New&quot;"> Scheduler</span>: Protected Members</div>
      <div class="Code_Segment"><a name="1026387">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026388">class Scheduler</a></div>
      <div class="Code_Segment"><a name="1026389">{</a></div>
      <div class="Code_Segment"><a name="1026390">    protected:</a></div>
      <div class="Code_Segment"><a name="1026391">    ...</a></div>
      <div class="Code_Segment"><a name="1026392">  </a></div>
      <div class="Code_Segment"><a name="1044427">    public:</a></div>
      <div class="Code_Segment"><a name="1044428">      void setRawWeight(const int priority, double rawWeight);</a></div>
      <div class="Code_Segment"><a name="1044429">      void normalizeWeight();</a></div>
      <div class="Code_Segment"><a name="1044430">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044431">      virtual int numQueue();</a></div>
      <div class="Code_Segment"><a name="1044432">      virtual int GetQueuePriority(int queueIndex);</a></div>
      <div class="Code_Segment"><a name="1044433">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044434">      virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044435">                          BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044436">                          const int priority,</a></div>
      <div class="Code_Segment"><a name="1044437">                          const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1044438">                          const clocktype currentTime) = 0;</a></div>
      <div class="Code_Segment"><a name="1044439">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044440">      virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044441">                          BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044442">                          const int priority,</a></div>
      <div class="Code_Segment"><a name="1044443">                          const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1044444">                          const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044445">                          TosType* tos) = 0;</a></div>
      <div class="Code_Segment"><a name="1044567">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044447">      virtual BOOL retrieve(const int priority,</a></div>
      <div class="Code_Segment"><a name="1044448">                            const int index,</a></div>
      <div class="Code_Segment"><a name="1044449">                            Message** msg,</a></div>
      <div class="Code_Segment"><a name="1044450">                            int* msgPriority,</a></div>
      <div class="Code_Segment"><a name="1044451">                            const QueueOperation operation,</a></div>
      <div class="Code_Segment"><a name="1044452">                            const clocktype currentTime) = 0;</a></div>
      <div class="Code_Segment"><a name="1044453">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1096057">      virtual void setQueueBehavior(const int priority,</a></div>
      <div class="Code_Segment"><a name="1096058">                                    QueueBehavior suspend = RESUME);</a></div>
      <div class="Code_Segment"><a name="1044454"> </a></div>
      <div class="Code_Segment"><a name="1096113">      virtual QueueBehavior getQueueBehavior(const int priority);</a></div>
      <div class="Code_Segment"><a name="1096074"> </a></div>
      <div class="Code_Segment"><a name="1096129">      virtual BOOL isEmpty(const int priority);</a></div>
      <div class="Code_Segment"><a name="1044455">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044456">      virtual int bytesInQueue(const int priority);</a></div>
      <div class="Code_Segment"><a name="1044457">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044458">      virtual int numberInQueue(const int priority);</a></div>
      <div class="Code_Segment"><a name="1044459">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044460">      virtual int addQueue(Queue* queue,</a></div>
      <div class="Code_Segment"><a name="1044461">                            const int priority = ALL_PRIORITIES,</a></div>
      <div class="Code_Segment"><a name="1044462">                            const double weight = 1.0) = 0;</a></div>
      <div class="Code_Segment"><a name="1044463">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044464">      virtual void removeQueue(const int priority) = 0;</a></div>
      <div class="Code_Segment"><a name="1044465">      ...</a></div>
      <div class="Figure">FIGURE 4-111.&nbsp;&nbsp;<a name="1044557">Declaration of Class</a><span style="font-family: &quot;Courier New&quot;"> Scheduler</span>: Public Members (Part 1)</div>
      <div class="Code_Segment"><a name="1044520">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044521">class Scheduler</a></div>
      <div class="Code_Segment"><a name="1044522">{</a></div>
      <div class="Code_Segment"><a name="1044523">    protected:</a></div>
      <div class="Code_Segment"><a name="1044524">      ...</a></div>
      <div class="Code_Segment"><a name="1044549">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044526">    public:</a></div>
      <div class="Code_Segment"><a name="1044518">      ...</a></div>
      <div class="Code_Segment"><a name="1044538">      virtual void removeQueue(const int priority) = 0;</a></div>
      <div class="Code_Segment"><a name="1044529">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044466">      virtual void swapQueue(Queue* queue, const int priority) = 0;</a></div>
      <div class="Code_Segment"><a name="1044467">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044468">      virtual void qosInformationUpdate(int queueIndex,</a></div>
      <div class="Code_Segment"><a name="1044469">                                int* qDelayVal,</a></div>
      <div class="Code_Segment"><a name="1044470">                                int* totalTransmissionVal,</a></div>
      <div class="Code_Segment"><a name="1044471">                                const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044472">                                BOOL isResetTotalTransmissionVal = FALSE);</a></div>
      <div class="Code_Segment"><a name="1044580">      // Scheduler current period statistic collection</a></div>
      <div class="Code_Segment"><a name="1044581">      //virtual int bytesDequeuedInPeriod(const int priority);</a></div>
      <div class="Code_Segment"><a name="1044582">      //virtual clocktype utilizationInPeriod(const int priority);</a></div>
      <div class="Code_Segment"><a name="1044583">      //virtual clocktype averageTimeInQueueDuringPeriod(const int priority);</a></div>
      <div class="Code_Segment"><a name="1044584">      //virtual int resetPeriod(const clocktype currentTime);</a></div>
      <div class="Code_Segment"><a name="1044480">      //virtual clocktype periodStartTime();</a></div>
      <div class="Code_Segment"><a name="1044592">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044481">      // Scheduler statistic collection for graph</a></div>
      <div class="Code_Segment"><a name="1044482">      virtual void collectGraphData(int priority,</a></div>
      <div class="Code_Segment"><a name="1044483">                                    int packetSize,</a></div>
      <div class="Code_Segment"><a name="1044484">                                    const clocktype currentTime);</a></div>
      <div class="Code_Segment"><a name="1044485">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044486">      virtual void invokeQueueFinalize(Node* node,</a></div>
      <div class="Code_Segment"><a name="1044487">                          const char* layer,</a></div>
      <div class="Code_Segment"><a name="1044488">                          const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044489">                          const int instanceId,</a></div>
      <div class="Code_Segment"><a name="1044490">                          const char* invokingProtocol = "IP",</a></div>
      <div class="Code_Segment"><a name="1044491">                          const char* splStatStr = NULL);</a></div>
      <div class="Code_Segment"><a name="1044493">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1096082">      virtual void invokeQueueFinalize(Node* node,</a></div>
      <div class="Code_Segment"><a name="1096083">                          const char* layer,</a></div>
      <div class="Code_Segment"><a name="1096084">                          const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1096085">                          const int instanceId,</a></div>
      <div class="Code_Segment"><a name="1096086">                          const int fcsQosQueue,</a></div>
      <div class="Code_Segment"><a name="1096087">                          const char* invokingProtocol = "IP",</a></div>
      <div class="Code_Segment"><a name="1044494">                          const char* splStatStr = NULL);</a></div>
      <div class="Code_Segment"><a name="1096099">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1096106">      virtual void finalize(Node* node,</a></div>
      <div class="Code_Segment"><a name="1044495">                          const char* layer,</a></div>
      <div class="Code_Segment"><a name="1044496">                          const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044497">                          const char* invokingProtocol = "IP",</a></div>
      <div class="Code_Segment"><a name="1044498">                          const char* splStatStr = NULL) = 0;</a></div>
      <div class="Code_Segment"><a name="1044499">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044500">      // Virtual Destructor for Scheduler Class</a></div>
      <div class="Code_Segment"><a name="1044501">      virtual ~Scheduler(){};</a></div>
      <div class="Code_Segment"><a name="1044421">};</a></div>
      <div class="Figure">FIGURE 4-112.&nbsp;&nbsp;<a name="1026437">Declaration of Class</a><span style="font-family: &quot;Courier New&quot;"> Scheduler</span>: Public Members (Part 2)</div>
      <div class="NumberedCont"><a name="1026438">Some of the data members of the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class are described below. The utility functions of the <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class are described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026451', '');" title="Network Layer">Section&nbsp;4.4.8.2</a></span>.</div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026442">queueData</a></span>: List of queues controlled by the scheduler.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026443">numQueues</a></span>: Number of queues instantiated by the scheduler.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026444">maxQueues</a></span>: Current maximum size of <span style="font-family: &quot;Courier New&quot;">queueData</span>. This can be changed during execution.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026445">infoFieldSize</a></span>: Size of <span style="font-family: &quot;Courier New&quot;">infoField</span> field of <span style="font-family: &quot;Courier New&quot;">QueueData</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026446">packetsLostToOverflow</a></span>: Total number of packets dropped by all queues controlled by the scheduler.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026447">currentStateStartTime</a></span>: Start time of the current measurement period.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026448">schedulerStatEnabled</a></span><span style="font-family: Arial">: Indication whether statistics collection is enabled for the scheduler.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1026449">schedGraphStatPtr</a></span>: Pointer to the structure <span style="font-family: &quot;Courier New&quot;">SchedGraphStat</span>. This structure stores information for collecting and printing dynamic statistics.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.4.8.2  <a name="1026451">Interface Functions</a></div>
      <div class="BodyAfterHead"><a name="1026452">The protected interface function provided by the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class is listed below. This function is implemented in <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/if_scheduler.cpp.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026453">SelectSpecificPriorityQueue: This function returns a pointer to the </a><span style="font-family: &quot;Courier New&quot;">QueueData</span> structure associated with the queue with the specified priority </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1026454">In addition to the above function, the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class contains prototypes for the following virtual functions. Some of these functions for the base class are also implemented in the file if_scheduler.cpp. A class derived from the <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class can provide alternate implementation of these functions and should provide implementations for the other virtual functions.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026455">numQueue: This function returns the number of queues associated with the scheduler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026456">GetQueuePriority: This function returns the priority of the specified queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026457">insert: This function inserts a packet in the specified queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026458">retrieve: This function dequeues or takes a peek at a packet in the specified queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026459">isEmpty: This function determines if the queue with the specified priority is empty.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026460">bytesInQueue: This function returns the total number of bytes stored in a specific queue, or the total number of bytes stored in all queues associated with the scheduler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026461">numberInQueue: This function returns the total number of messages in a specific queue, or the total number of bytes in all queues associated with the scheduler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026462">addQueue: This function adds a queue to the scheduler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026463">removeQueue: This function removes a queue from the scheduler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026464">swapQueue: This function swaps a new queue and an existing queue with the specified priority. if no queue exists with the specified priority, this function adds a queue with that priority.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026465">qosInformatiopnUpdate: This function enables QOS monitoring for the specified queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026466">collectGraphData: This function enables performance data collection for the scheduler.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026467">invokeQueueFinalize: This function invokes the queue finalization function.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026468">finalize: This function outputs the final scheduler statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1026469">In addition to the interface functions provided by the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class, function SCHEDULER_Setup is also available for implementing scheduling disciplines. Function SCHEDULE_Setup is used to create and initialize an object of the base <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class or an object of a class derived from the base <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class. The prototype of SCHEDULER_Setup is contained in if_scheduler.h and the implementation is contained in if_scheuler.cpp. The prototype of SCHEDULER_Setup is shown below. See file if_scheduler.h for a description of the function parameters.</div>
      <div class="Code_Segment_Large"><a name="1026470">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1026471">void SCHEDULER_Setup(</a></div>
      <div class="Code_Segment_Large"><a name="1026472">    Scheduler** scheduler,</a></div>
      <div class="Code_Segment_Large"><a name="1026473">    const char schedulerTypeString[],</a></div>
      <div class="Code_Segment_Large"><a name="1026474">    BOOL enableSchedulerStat = false,</a></div>
      <div class="Code_Segment_Large"><a name="1026475">    const char* graphDataStr = "NA");</a></div>
      <div class="Heading3Numbered">4.4.8.3  <a name="1026477">Using the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> Class</div>
      <div class="BodyAfterHead"><a name="1026478">This section describes how protocols use the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class and interface functions to implement schedulers.</div>
      <div class="Body"><a name="1084011">The </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class can be used to implement schedulers at any layer. In this section, we illustrate the use of schedulers by taking code segments from the implementation of the IP protocol, which is implemented by files network_ip.h and network_ip.cpp in the folder <span class="Variable">QUALNET_HOME</span>/libraries/developer/src.</div>
      <div class="Heading4Numbered">4.4.8.3.1  <a name="1026480">Creating and Initializing a Scheduler</a></div>
      <div class="BodyAfterHead"><a name="1026481">To create a scheduler, declare a pointer variable that points to an object of the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class and call function SCHEDULER_Setup (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026451', '');" title="Network Layer">Section&nbsp;4.4.8.2</a></span>). The type of scheduler that is created is determined by the second parameter (<span style="font-family: &quot;Courier New&quot;">schedulerTypeString</span>) of SCHEDULER_Setup. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026494', '');" title="Network Layer">Table&nbsp;4-13</a></span> shows the different types of schedulers implemented in <span class="Variable">QualNet</span>. Other scheduler types can be derived from the <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026595', '');" title="Network Layer">Section&nbsp;4.4.8.4</a></span>).</div>
      <table class="Format_A" style="text-align: left; width: 316.8pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-13.&nbsp;&nbsp;<a name="1026494">Implemented Scheduler Types</a></div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 136.8pt">
            <div class="CellHeading" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1026498">schedulerTypeString</a></span></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 180pt">
            <div class="CellHeading"><a name="1026500">Scheduler Type</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026502">“STRICT-PRIORITY”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1026504">Strict priority scheduler</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026506">“ROUND-ROBIN”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1026508">Round robin scheduler</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026510">“WEIGHTED-ROUND-ROBIN”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1026512">Weighted round robin scheduler</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026514">“WEIGHTED-FAIR”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1026516">Weighted fair queuing scheduler</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026518">“SELF-CLOCKED-FAIR”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1026520">Self-clocked fair queuing scheduler</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1044608">“ATM”</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1044610">Scheduler for ATM networks</a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="1026524">As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026547', '');" title="Network Layer">Figure&nbsp;4-113</a></span> shows the IP function NetworkIpInitCpuQueueConfiguration which initializes a strict priority scheduler by calling function SCHEDULER_Setup.</div>
      <div class="Code_Segment"><a name="1026525">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044624">void</a></div>
      <div class="Code_Segment"><a name="1044625">NetworkIpInitCpuQueueConfiguration(</a></div>
      <div class="Code_Segment"><a name="1044626">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1044627">    const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1044628">{</a></div>
      <div class="Code_Segment"><a name="1044733">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1044734">    Scheduler *cpuSchedulerPtr = NULL;</a></div>
      <div class="Code_Segment"><a name="1044735">    Queue* queue = NULL;</a></div>
      <div class="Code_Segment"><a name="1044736">    queue = new Queue;</a></div>
      <div class="Code_Segment"><a name="1044737">    BOOL enableQueueStat = FALSE;</a></div>
      <div class="Code_Segment"><a name="1044738">    BOOL enableSchedulerStat = FALSE;</a></div>
      <div class="Code_Segment"><a name="1044739">    char buf[MAX_STRING_LENGTH] = {0};</a></div>
      <div class="Code_Segment"><a name="1044740">    BOOL wasFound = FALSE;</a></div>
      <div class="Code_Segment"><a name="1044638">    int queueSize = DEFAULT_CPU_QUEUE_SIZE;</a></div>
      <div class="Code_Segment"><a name="1044639">    if (ip-&gt;backplaneType == BACKPLANE_TYPE_CENTRAL)</a></div>
      <div class="Code_Segment"><a name="1044640">    {</a></div>
      <div class="Code_Segment"><a name="1044643">        queueSize = DEFAULT_CPU_QUEUE_SIZE * (node-&gt;numberInterfaces);</a></div>
      <div class="Code_Segment"><a name="1044644">    }</a></div>
      <div class="Code_Segment"><a name="1044646">    IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1044647">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1044648">        ANY_ADDRESS,</a></div>
      <div class="Code_Segment"><a name="1044649">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="1044650">        "INPUT-QUEUE-STATISTICS",</a></div>
      <div class="Code_Segment"><a name="1044651">        &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="1044652">        buf);</a></div>
      <div class="Code_Segment"><a name="1044654">    if (wasFound &amp;&amp; (!strcmp(buf, "YES")))</a></div>
      <div class="Code_Segment"><a name="1044655">    {</a></div>
      <div class="Code_Segment"><a name="1044656">        enableQueueStat = TRUE;</a></div>
      <div class="Code_Segment"><a name="1044657">    }</a></div>
      <div class="Code_Segment"><a name="1044659">    IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1044660">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1044661">        ANY_ADDRESS,</a></div>
      <div class="Code_Segment"><a name="1044662">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="1044663">        "INPUT-SCHEDULER-STATISTICS",</a></div>
      <div class="Code_Segment"><a name="1044664">        &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="1044665">        buf);</a></div>
      <div class="Code_Segment"><a name="1044667">    if (wasFound &amp;&amp; (!strcmp(buf, "YES")))</a></div>
      <div class="Code_Segment"><a name="1044668">    {</a></div>
      <div class="Code_Segment"><a name="1044669">        enableSchedulerStat = TRUE;</a></div>
      <div class="Code_Segment"><a name="1044670">    }</a></div>
      <div class="Code_Segment"><a name="1044672">    queue-&gt;SetupQueue(node, "FIFO", queueSize, 0, 0, 0, enableQueueStat);</a></div>
      <div class="Code_Segment"><a name="1044680">    </a></div>
      <div class="Code_Segment"><a name="1044731">    SCHEDULER_Setup(&amp;cpuSchedulerPtr,</a></div>
      <div class="Code_Segment"><a name="1044681">                    "STRICT-PRIORITY",</a></div>
      <div class="Code_Segment"><a name="1044682">                    enableSchedulerStat);</a></div>
      <div class="Code_Segment"><a name="1044684">    ip-&gt;cpuScheduler = cpuSchedulerPtr;</a></div>
      <div class="Code_Segment"><a name="1044686">    // Scheduler add Queue Functionality</a></div>
      <div class="Code_Segment"><a name="1044687">    cpuSchedulerPtr-&gt;addQueue(queue);</a></div>
      <div class="Code_Segment"><a name="1026526">}</a></div>
      <div class="Figure">FIGURE 4-113.&nbsp;&nbsp;<a name="1026547">Creating and Initializing a Scheduler</a></div>
      <div class="Heading4Numbered">4.4.8.3.2  <a name="1026548">Performing Scheduler Operations</a></div>
      <div class="BodyAfterHead"><a name="1026549">Scheduler operations, such as adding and removing a queue and inserting and deleting a packet from a queue with a specified priority, are performed by calling the interface functions defined for the </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026451', '');" title="Network Layer">Section&nbsp;4.4.8.2</a></span>). The base class, <span style="font-family: &quot;Courier New&quot;">Scheduler</span>, implements some of the interface functions. The implementation of these functions can be found in if_scheduler.cpp. Implementation of the other interface functions are provided by the implementation of schedulers derived from the base class.</div>
      <div class="Body"><a name="1026556">As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026547', '');" title="Network Layer">Figure&nbsp;4-113</a></span> shows how the IP function NetworkIpInitCpuQueueConfiguration adds a queue by calling the <span style="font-family: &quot;Courier New&quot;">Scheduler</span> function addQueue. As another example, <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026593', '');" title="Network Layer">Figure&nbsp;4-114</a></span> shows how the <span style="font-family: &quot;Courier New&quot;">Scheduler</span> function insert is used by the IP function NetworkIpQueueInsert to insert a packet in a queue controlled by the scheduler at the interface. NetworkIpInitCpuQueueConfiguration and NetworkIpQueueInsert are implemented in network_ip.cpp. Other <span style="font-family: &quot;Courier New&quot;">Scheduler</span> interface functions can be called in a similar way to perform scheduler operations.</div>
      <div class="Code_Segment"><a name="1026560">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026561">void</a></div>
      <div class="Code_Segment"><a name="1026562">NetworkIpQueueInsert(</a></div>
      <div class="Code_Segment"><a name="1026563">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1026564">    Scheduler *scheduler,</a></div>
      <div class="Code_Segment"><a name="1026565">    Message *msg,</a></div>
      <div class="Code_Segment"><a name="1026566">    NodeAddress nextHopAddress,</a></div>
      <div class="Code_Segment"><a name="1026567">    NodeAddress destinationAddress,</a></div>
      <div class="Code_Segment"><a name="1026568">    int outgoingInterface,</a></div>
      <div class="Code_Segment"><a name="1026569">    int networkType,</a></div>
      <div class="Code_Segment"><a name="1026570">    BOOL *queueIsFull,</a></div>
      <div class="Code_Segment"><a name="1041278">    int incomingInterface,</a></div>
      <div class="Code_Segment"><a name="1047478">    BOOL isOutputQueue)</a></div>
      <div class="Code_Segment"><a name="1026571">{</a></div>
      <div class="Code_Segment"><a name="1026572">    int queueIndex = ALL_PRIORITIES;</a></div>
      <div class="Code_Segment"><a name="1026573">    IpHeaderType *ipHeader = NULL;</a></div>
      <div class="Code_Segment"><a name="1026574">    QueuedPacketInfo *infoPtr;</a></div>
      <div class="Code_Segment"><a name="1096141">    BOOL isResolved = FALSE;</a></div>
      <div class="Code_Segment"><a name="1096142">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044765">    ipHeader = (IpHeaderType*) MESSAGE_ReturnPacket(msg);</a></div>
      <div class="Code_Segment"><a name="1096154">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026575">    // Tack on the nextHopAddress to the message using the insidious "info"</a></div>
      <div class="Code_Segment"><a name="1026576">    // field.</a></div>
      <div class="Code_Segment"><a name="1095053">    ...</a></div>
      <div class="Code_Segment"><a name="1095073">    MESSAGE_InfoAlloc(node, msg, sizeof(QueuedPacketInfo));</a></div>
      <div class="Code_Segment"><a name="1095054">    infoPtr = (QueuedPacketInfo *) MESSAGE_ReturnInfo(msg); </a></div>
      <div class="Code_Segment"><a name="1026580">    ...</a></div>
      <div class="Code_Segment"><a name="1026581">    // Call the Scheduler "insertFunction"</a></div>
      <div class="Code_Segment"><a name="1095091">    queueIndex = GenericPacketClassifier(scheduler,</a></div>
      <div class="Code_Segment"><a name="1095092">        (int) ReturnPriorityForPHB(node,</a></div>
      <div class="Code_Segment"><a name="1026582">        IpHeaderGetTOS(ipHeader-&gt;ip_v_hl_tos_len)));</a></div>
      <div class="Code_Segment"><a name="1026584">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026585">    (*scheduler).insert(msg,</a></div>
      <div class="Code_Segment"><a name="1026586">                        queueIsFull,</a></div>
      <div class="Code_Segment"><a name="1026587">                        queueIndex,</a></div>
      <div class="Code_Segment"><a name="1026588">                        NULL, //const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1026589">                        getSimTime(node));</a></div>
      <div class="Code_Segment"><a name="1026590">   }</a></div>
      <div class="Figure">FIGURE 4-114.&nbsp;&nbsp;<a name="1026593">Calling Interface Functions for Scheduler Operations</a></div>
      <div class="Heading3Numbered">4.4.8.4  <a name="1026595">Adding a New Scheduler</a></div>
      <div class="BodyAfterHead"><a name="1026596">This section describes the procedure to add a new scheduler to </a><span class="Variable">QualNet</span>. It describes how to derive a new scheduler class from the base class and how to implement interface functions.</div>
      <div class="BodyAfterHead"><a name="1026597">We illustrate the process of adding a scheduler model by using as an example the implementation code for the strict priority scheduler. The header file for the strict priority scheduler implementation is sch_strictprio.h and the source file is sch_strictprio.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. We use code snippets from these two files throughout this section to illustrate different steps in writing a scheduler model. After understanding the discussed snippets, look at the complete code for the strict priority scheduler to understand how a scheduler model is derived from the base <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026330', '');" title="Network Layer">Section&nbsp;4.4.8.1</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026451', '');" title="Network Layer">Section&nbsp;4.4.8.2</a></span>.</div>
      <div class="Body"><a name="1026604">The following list summarizes the actions that need to be performed for adding a new scheduler model, MYSCHEDULER, to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="1026608">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026634', '');" title="Network Layer">Section&nbsp;4.4.8.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1026612">Modify the file if_scheduler.cpp to include the scheduler’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026634', '');" title="Network Layer">Section&nbsp;4.4.8.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1026616">Define data structures for the scheduler model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026674', '');" title="Network Layer">Section&nbsp;4.4.8.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1026620">Derive the new scheduler class based on the base </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084424', '');" title="Network Layer">Section&nbsp;4.4.8.4.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1026624">Implement interface functions for the new scheduler model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026743', '');" title="Network Layer">Section&nbsp;4.4.8.4.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1026625">Modify function SCHEDULER_Setup to call MYSCHEDULER’s constructor function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026786', '');" title="Network Layer">Section&nbsp;4.4.8.4.5</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1026629">Include the scheduler’s header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026825', '');" title="Network Layer">Section&nbsp;4.4.8.4.6</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1096758">To make the model available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1096738', '');" title="Network Layer">Section&nbsp;4.4.8.4.7</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading4Numbered">4.4.8.4.1  <a name="1026634">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1044776">This step is similar to the one for Network Layer routing protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993059', '');" title="Network Layer">Section&nbsp;4.4.5.2</a></span>). Create the header and source files for the scheduler model. Name these files in a way that clearly indicates the model that they implement. For scheduler models, prefix the file names with <span style="font-style: italic">sch_</span>.</div>
      <div class="Body"><a name="1026636">	Examples:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026637">sch_roundrobin.cpp, sch_roundrobin.h: These files in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src implement the round-robin scheduler.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026638">sch_strictprio.cpp, sch_strictprio.h: These files in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src implement the strict priority scheduler.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1044820">For the example scheduler, MYSCHEDULER, create files sch_myscheduler.h and sch_myscheduler.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/user_models/src (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#993059', '');" title="Network Layer">Section&nbsp;4.4.5.2</a></span>).</div>
      <div class="Note_Indented"><a name="1026643"><img class="Default" src="images/Chapter%204-4.08.1.11.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems, even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="1026644">While adding code to the files, it is important to organize the code well between the files. Generally, the header file for the scheduler model, sch_myscheduler.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026645">Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026646">Data structure definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026647">Class definition for the new scheduler model derived from the base </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026330', '');" title="Network Layer">Section&nbsp;4.4.8.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026651">Prototypes for any additional interface functions in the scheduler model’s source file</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026652">Statement to include the generic scheduler header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1026653">	</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026654">#include “if_scheduler.h”</a></span></div>
      <div class="Body"><a name="1026656">The source file for the scheduler model, sch_myscheduler.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026657">Statement to include the scheduler model’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1026658">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026659">#include “sch_myscheduler.h”</a></span></div>
      <div class="Code_Segment"><a name="1026660">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026661">Statements to include standard library functions and other header files needed by the queue model’s source file. A typical queue model source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026662">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026663">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026664">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026665">#include &lt;math.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026666">#include &lt;string.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026667">#include "api.h"         // </a></span><span class="Variable">QUALNET_HOME</span>/include/api.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026668">#include "sch_graph.h"   </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1044836">                   // </a></span><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/sch_graph.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026669">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1026670">Interface functions for MYSCHEDULER</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1026671">The file </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/if_scheduler.cpp contains the generic function to setup a scheduler, SCHEDULER_Setup. SCHEDULER_Setup in turn calls constructor functions for specific scheduler types. To make the MYSCHEDULER constructor function available to function SCHEDULER_Setup, insert the following include statement in the file if_scheduler.cpp:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026672">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1102649">#include “sch_myscheduler.h”</a></span></div>
      <div class="Heading4Numbered">4.4.8.4.2  <a name="1026674">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="1026675">In </a><span class="Variable">QualNet</span>, scheduler types are defined as classes derived from the base <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class. In addition to the variables that are part of <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class, a scheduler type may require other variables. For example, the strict priority scheduler implementation uses the data structure <span style="font-family: &quot;Courier New&quot;">StrictPriorityStat</span>, defined in sch_strictprio.h, to store the statistic variables.</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026676">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026677">typedef struct</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026678">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026679">    unsigned int packetQueued;      // Total packet queued</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026680">    unsigned int packetDequeued;    // Total packet dequeued</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026681">    unsigned int packetDropped;     // Total packet dropped</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1026682">}StrictPriorityStat;</a></span></div>
      <div class="Body"><a name="1026683">For MYSCHEDULER, define an appropriate data structure for MYSCHEDULER-specific variables, if needed, in the file sch_myscheduler.h.</a></div>
      <div class="Heading4Numbered">4.4.8.4.3  <a name="1084424">Deriving New Scheduler Class from Base </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> Class</div>
      <div class="BodyAfterHead"><a name="1084425">In </a><span class="Variable">QualNet</span> all schedulers are implemented as classes derived from the base <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026330', '');" title="Network Layer">Section&nbsp;4.4.8.1</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026451', '');" title="Network Layer">Section&nbsp;4.4.8.2</a></span>). This section describes how to implement a new scheduler as a class derived from the base <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class by taking as an example the implementation of the strict priority scheduler.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026741', '');" title="Network Layer" name="1026696">Figure&nbsp;4-115</a></span> shows the declaration of the class <span style="font-family: &quot;Courier New&quot;">StrictPriorityScheduler</span> that implements the strict priority scheduler. <span style="font-family: &quot;Courier New&quot;">StrictPriorityScheduler</span> is declared in sch_strictprio.h and is derived from the base class <span style="font-family: &quot;Courier New&quot;">Scheduler</span>. Class <span style="font-family: &quot;Courier New&quot;">StrictPriorityScheduler</span> declares a variable which is a pointer to the statistics data structure <span style="font-family: &quot;Courier New&quot;">StrictPriorityStat</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026674', '');" title="Network Layer">Section&nbsp;4.4.8.4.2</a></span>) which stores the strict priority scheduler statistics. Class <span style="font-family: &quot;Courier New&quot;">StrictPriorityScheduler</span> also contains prototypes of interface functions that override the base <span style="font-family: &quot;Courier New&quot;">Scheduler</span> class functions. Implementation of these functions is discussed in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026743', '');" title="Network Layer">Section&nbsp;4.4.8.4.4</a></span>.</div>
      <div class="Body"><a name="1026703">For the example scheduler, MYSCHEDULER, declare a class </a><span style="font-family: &quot;Courier New&quot;">Myscheduler</span> derived from the base class <span style="font-family: &quot;Courier New&quot;">Scheduler</span> in the file sch_myscheduler.h. </div>
      <div class="Code_Segment"><a name="1026704">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044868">class StrictPriorityScheduler : public Scheduler</a></div>
      <div class="Code_Segment"><a name="1044869">{</a></div>
      <div class="Code_Segment"><a name="1044870">    protected:</a></div>
      <div class="Code_Segment"><a name="1044871">      StrictPriorityStat* stats;</a></div>
      <div class="Code_Segment"><a name="1044872">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044873">    public:</a></div>
      <div class="Code_Segment"><a name="1044874">      StrictPriorityScheduler(BOOL enableSchedulerStat,</a></div>
      <div class="Code_Segment"><a name="1044875">                            const char graphDataStr[]);</a></div>
      <div class="Code_Segment"><a name="1044876">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1096163">      virtual ~StrictPriorityScheduler();</a></div>
      <div class="Code_Segment"><a name="1044877">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1096179">      virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044878">                          BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044879">                          const int queueIndex,</a></div>
      <div class="Code_Segment"><a name="1044880">                          const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1044881">                          const clocktype currentTime);</a></div>
      <div class="Code_Segment"><a name="1044882">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044883">      virtual void insert(Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044884">                          BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044885">                          const int queueIndex,</a></div>
      <div class="Code_Segment"><a name="1044886">                          const void* infoField,</a></div>
      <div class="Code_Segment"><a name="1044887">                          const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044888">                          TosType* tos);</a></div>
      <div class="Code_Segment"><a name="1044889">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044890">      virtual BOOL retrieve(const int priority,</a></div>
      <div class="Code_Segment"><a name="1044891">                            const int index,</a></div>
      <div class="Code_Segment"><a name="1044892">                            Message** msg,</a></div>
      <div class="Code_Segment"><a name="1044893">                            int* msgPriority,</a></div>
      <div class="Code_Segment"><a name="1044894">                            const QueueOperation operation,</a></div>
      <div class="Code_Segment"><a name="1044895">                            const clocktype currentTime);</a></div>
      <div class="Code_Segment"><a name="1044896">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044897">      virtual int addQueue(Queue* queue,</a></div>
      <div class="Code_Segment"><a name="1044898">                          const int priority = ALL_PRIORITIES,</a></div>
      <div class="Code_Segment"><a name="1044899">                          const double weight = 1.0);</a></div>
      <div class="Code_Segment"><a name="1044900">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044901">      virtual void removeQueue(const int priority);</a></div>
      <div class="Code_Segment"><a name="1044902">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044903">      virtual void swapQueue(Queue* queue, const int priority);</a></div>
      <div class="Code_Segment"><a name="1044904">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044905">      virtual void finalize(Node* node,</a></div>
      <div class="Code_Segment"><a name="1044906">                          const char* layer,</a></div>
      <div class="Code_Segment"><a name="1044907">                          const int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1044908">                          const char* invokingProtocol = "IP",</a></div>
      <div class="Code_Segment"><a name="1044909">                          const char* splStatStr = NULL);</a></div>
      <div class="Code_Segment"><a name="1044865">};</a></div>
      <div class="Figure">FIGURE 4-115.&nbsp;&nbsp;<a name="1026741">Deriving a New Scheduler from </a><span style="font-family: &quot;Courier New&quot;">Scheduler</span> Class</div>
      <div class="Heading4Numbered">4.4.8.4.4  <a name="1026743">Implementing Interface Functions</a></div>
      <div class="BodyAfterHead"><a name="1026744">The next step in adding a new scheduler type is to implement the interface functions for the derived scheduler class (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084424', '');" title="Network Layer">Section&nbsp;4.4.8.4.3</a></span>). The derived scheduler class inherits the functions of the base class, but any functions that are declared in the derived queue class and any functions that override the base class functions need to be implemented. In addition, any virtual functions of the base class that are not implemented by the base class should be implemented in the derived class. For the example scheduler, MYSCHEDULER, add these functions in the file sch_myscheduler.cpp. </div>
      <div class="Body"><a name="1026751">As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026784', '');" title="Network Layer">Figure&nbsp;4-116</a></span> shows the implementation of the <span style="font-family: &quot;Courier New&quot;; font-size: 9.0pt">StrictPriorityScheduler</span> function insert.</div>
      <div class="Code_Segment"><a name="1026752">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044930">void StrictPriorityScheduler::insert(</a></div>
      <div class="Code_Segment"><a name="1044931">    Message* msg,</a></div>
      <div class="Code_Segment"><a name="1044932">    BOOL* QueueIsFull,</a></div>
      <div class="Code_Segment"><a name="1044933">    const int priority,</a></div>
      <div class="Code_Segment"><a name="1044934">    const void *infoField,</a></div>
      <div class="Code_Segment"><a name="1044935">    const clocktype currentTime,</a></div>
      <div class="Code_Segment"><a name="1044936">    TosType* tos</a></div>
      <div class="Code_Segment"><a name="1044937">    )</a></div>
      <div class="Code_Segment"><a name="1044938">{</a></div>
      <div class="Code_Segment"><a name="1044939">    QueueData* qData = NULL;</a></div>
      <div class="Code_Segment"><a name="1044940">    int queueIndex;</a></div>
      <div class="Code_Segment"><a name="1044941">    int i;</a></div>
      <div class="Code_Segment"><a name="1045053">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044943">    queueIndex = numQueues;</a></div>
      <div class="Code_Segment"><a name="1044944">    for (i = 0; i &lt; numQueues; i ++)</a></div>
      <div class="Code_Segment"><a name="1044945">    {</a></div>
      <div class="Code_Segment"><a name="1044946">        if (queueData[i].priority == priority)</a></div>
      <div class="Code_Segment"><a name="1044947">        {</a></div>
      <div class="Code_Segment"><a name="1044948">            queueIndex = i;</a></div>
      <div class="Code_Segment"><a name="1044949">            break;</a></div>
      <div class="Code_Segment"><a name="1044950">        }</a></div>
      <div class="Code_Segment"><a name="1044951">    }</a></div>
      <div class="Code_Segment"><a name="1044954">    ERROR_Assert((queueIndex &gt;= 0) &amp;&amp; (queueIndex &lt; numQueues),</a></div>
      <div class="Code_Segment"><a name="1044955">        "Queue does not exist!!!\n");</a></div>
      <div class="Code_Segment"><a name="1045052">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1044957">    // The priority queue in which incoming packet will be inserted</a></div>
      <div class="Code_Segment"><a name="1044958">    qData = &amp;queueData[queueIndex];</a></div>
      <div class="Code_Segment"><a name="1044961">    ...</a></div>
      <div class="Code_Segment"><a name="1044968">    // Insert the packet in the queue</a></div>
      <div class="Code_Segment"><a name="1044969">    if(tos == NULL)</a></div>
      <div class="Code_Segment"><a name="1044970">    {</a></div>
      <div class="Code_Segment"><a name="1044971">        qData-&gt;queue-&gt;insert(msg, infoField, QueueIsFull, currentTime);</a></div>
      <div class="Code_Segment"><a name="1044972">    }</a></div>
      <div class="Code_Segment"><a name="1044973">    else</a></div>
      <div class="Code_Segment"><a name="1044974">    {</a></div>
      <div class="Code_Segment"><a name="1044975">        qData-&gt;queue-&gt;insert(msg, infoField, QueueIsFull, currentTime, tos);</a></div>
      <div class="Code_Segment"><a name="1045046">    }</a></div>
      <div class="Code_Segment"><a name="1045051">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1045047">    if (!*QueueIsFull)</a></div>
      <div class="Code_Segment"><a name="1045048">    {</a></div>
      <div class="Code_Segment"><a name="1044980">        ...</a></div>
      <div class="Code_Segment"><a name="1044986">        // Update packet enqueue status</a></div>
      <div class="Code_Segment"><a name="1044987">        stats[queueIndex].packetQueued++;</a></div>
      <div class="Code_Segment"><a name="1044988">    }</a></div>
      <div class="Code_Segment"><a name="1044989">    else</a></div>
      <div class="Code_Segment"><a name="1044990">    {</a></div>
      <div class="Code_Segment"><a name="1044991">        ...</a></div>
      <div class="Code_Segment"><a name="1044996">        // Update packet dequeue status</a></div>
      <div class="Code_Segment"><a name="1044997">        stats[queueIndex].packetDropped++;</a></div>
      <div class="Code_Segment"><a name="1044998">    }</a></div>
      <div class="Code_Segment"><a name="1044999">}</a></div>
      <div class="Figure">FIGURE 4-116.&nbsp;&nbsp;<a name="1026784">Implementation of an Interface Function</a></div>
      <div class="Heading4Numbered">4.4.8.4.5  <a name="1026786">Modifying the Scheduler Setup Function</a></div>
      <div class="BodyAfterHead"><a name="1026787">Function SCHEDULER_Setup, implemented in if_scheduler.cpp, is used by protocols to set up a scheduler. To add the example scheduler, MYSCHEDULER modify SCHEDULER_Setup as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1026823', '');" title="Network Layer">Figure&nbsp;4-117</a></span>.</div>
      <div class="Code_Segment"><a name="1026791">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026792">void SCHEDULER_Setup(</a></div>
      <div class="Code_Segment"><a name="1026793">    Scheduler** scheduler,</a></div>
      <div class="Code_Segment"><a name="1026794">    const char schedulerTypeString[],</a></div>
      <div class="Code_Segment"><a name="1026795">    BOOL enableSchedulerStat,</a></div>
      <div class="Code_Segment"><a name="1026796">    const char* graphDataStr)</a></div>
      <div class="Code_Segment"><a name="1026797">{</a></div>
      <div class="Code_Segment"><a name="1026798">    if (!strcmp(schedulerTypeString, "STRICT-PRIORITY"))</a></div>
      <div class="Code_Segment"><a name="1026799">    {</a></div>
      <div class="Code_Segment"><a name="1026800">        *scheduler = </a></div>
      <div class="Code_Segment"><a name="1026801">                 new StrictPriorityScheduler(enableSchedulerStat, graphDataStr);</a></div>
      <div class="Code_Segment"><a name="1026802">    }</a></div>
      <div class="Code_Segment"><a name="1026803">    else if (!strcmp(schedulerTypeString, "ROUND-ROBIN"))</a></div>
      <div class="Code_Segment"><a name="1026804">    {</a></div>
      <div class="Code_Segment"><a name="1026805">        *scheduler = </a></div>
      <div class="Code_Segment"><a name="1026806">               new RoundRobinScheduler(enableSchedulerStat, graphDataStr);</a></div>
      <div class="Code_New"><a name="1026807">    }</a></div>
      <div class="Code_New"><a name="1026808">    else if (!strcmp(schedulerTypeString, "MYSCHEDULER"))</a></div>
      <div class="Code_New"><a name="1026809">    {</a></div>
      <div class="Code_New"><a name="1026810">        *scheduler = new Myscheduler(enableSchedulerStat, graphDataStr);</a></div>
      <div class="Code_New"><a name="1026811">    }</a></div>
      <div class="Code_Segment"><a name="1026812">    ...</a></div>
      <div class="Code_Segment"><a name="1026813">    if (*scheduler == NULL)</a></div>
      <div class="Code_Segment"><a name="1026814">    {</a></div>
      <div class="Code_Segment"><a name="1026815">        // Error:</a></div>
      <div class="Code_Segment"><a name="1026816">        char errStr[MAX_STRING_LENGTH] = {0};</a></div>
      <div class="Code_Segment"><a name="1026817">        sprintf(errStr, "Scheduler Error: Failed to assign memory for"</a></div>
      <div class="Code_Segment"><a name="1026818">            " scheduler %s", schedulerTypeString);</a></div>
      <div class="Code_Segment"><a name="1026819">        ERROR_ReportError(errStr);</a></div>
      <div class="Code_Segment"><a name="1026820">    }</a></div>
      <div class="Code_Segment"><a name="1026821">}</a></div>
      <div class="Figure">FIGURE 4-117.&nbsp;&nbsp;<a name="1026823">Modifying Function SCHEDULER_Setup</a></div>
      <div class="Heading4Numbered">4.4.8.4.6  <a name="1026825">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1026829">This step is similar to the one for adding a unicast routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1084720', '');" title="Network Layer">Section&nbsp;4.4.5.12</a></span>).</div>
      <div class="Heading4Numbered">4.4.8.4.7  <a name="1096738">Integrating the Model into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1096742">To make the new model available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Body"><a name="1040890">&nbsp;</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <hr align="left" />
    <table align="left">
      <tr>
        <td class="WebWorks_Company_Phone_Bottom">© 2008 - 2012 SCALABLE Network Technologies, Inc. All rights reserved.</td>
      </tr>
    </table>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>