<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Physical Layer</title>
    <link rel="StyleSheet" href="css/Chapter%204-6.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <div>
      <img src="snt-logo-text2-transparent-small.png" />
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Chapter%204-1.05.1.html#970593">4	Developing Protocol Models in QualNet</a> &gt; 4.6  Physical Layer</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading1Numbered">4.6  <a name="970593">Physical Layer</a></div>
      <div class="BodyAfterHead"><a name="970602">The Physical Layer is the lowest layer in the </a><span class="Variable">QualNet</span> protocol stack (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-1.05.1.html#993736', '');" title="Developing Protocol Models in QualNet">Figure&nbsp;4-1</a></span>). It transmits and receives data over physical media. The Physical Layer interfaces with peer Physical Layer entities in other nodes via the communication medium to provide services to the MAC Layer.</div>
      <div class="Body"><a name="970603">To model the Physical Layer in a simulation we need to incorporate characteristics of the transmitter and the receiver. Modeling the Physical Layer requires modeling all aspects of a wireless system: modulation, coding, noise, interference and antenna gains. In </a><span class="Variable">QualNet</span>, a Physical Layer model consists of two parts: a PHY component and an antenna component. The PHY component models signal transmission and reception and reflects the effects of the MAC scheme, node status, physical parameters, distortions from the channel, and interference from neighbor nodes. The antenna component models the functions and properties of the antenna.</div>
      <div class="Body"><a name="1006759">This section gives a detailed description of how to add a PHY model and an antenna model to </a><span class="Variable">QualNet</span>. Modeling the communication medium is covered in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-7.html#1024331', '');" title="Communication Medium">Section&nbsp;4.7</a></span> and modeling node mobility is covered in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-8.html#970593', '');" title="Node Mobility">Section&nbsp;4.8</a></span>.</div>
      <div class="Heading2Numbered">4.6.1  <a name="970604">Physical Layer Models in </a><span class="Variable">QualNet</span></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="996376">QualNet</a></span> provides a number of PHY and antenna models. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1078485', '');" title="Physical Layer">Table&nbsp;4-16</a></span> lists the different PHY models. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1025707', '');" title="Physical Layer">Table&nbsp;4-17</a></span> lists the different antenna models. See the corresponding model library for a detailed description of each model and its parameters.</div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-16.&nbsp;&nbsp;<a name="1078485">PHY Models in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 97.2pt">
            <div class="CellHeading"><a name="1078491">PHY Model</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 280.8pt">
            <div class="CellHeading"><a name="1078493">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1078495">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1078497">PHY802.11a</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078499">Models the IEEE 802.11a PHY specification.</a></div>
            <div class="CellBody"><a name="1078500">This radio operates in the 5 GHz frequency band, uses Orthogonal Frequency Division Multiplexing (OFDM) and supports the following data rates (in Mbits/s): 6, 9, 12, 18, 24, 36, 48, 54.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078502">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1078504">PHY802.11b</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078506">Models the IEEE 802.11b PHY specification.</a></div>
            <div class="CellBody"><a name="1078507">This radio operates in the 2.4 GHz frequency band, uses Direct Sequence Spread Spectrum (DSSS) and supports the following data rates (in Mbits/s): 1, 2, 5.5, 11.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078509">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1078964">PHY802.11n</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078966">Models the IEEE 802.11n PHY specification.</a></div>
            <div class="CellBody"><a name="1078967">This model improves the network throughput over the IEEE 802.11a and 802.11g standards and achieves a maximum net data rate from 54 to 600 Mbps.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078969">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078511">PHY802.15.4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078513">Models the IEEE 802.15.4 PHY specification.</a></div>
            <div class="CellBody"><a name="1078514">This radio uses different waveforms in different frequency bands to support different data rates.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078516">Sensor Networks</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078518">PHY802.16</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078520">Models the IEEE 802.16 PHY specification.</a></div>
            <div class="CellBody"><a name="1078521">This radio uses OFDM and uses the following modulation and encoding combinations: QPSK 1/2, QPSK 3/4, 16QAM 1/2, 16QAM 3/4, 64QAM 1/2, 64QAM 2/3, and 64QAM 3/4.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078523">Advanced Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1078525">PHY-ABSTRACT</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078527">Abstract PHY model.</a></div>
            <div class="CellBody"><a name="1078528">This is a generic PHY model and can be used to simulate different PHYs. This model simulates a PHY that is capable of carrier sensing and is able to work with both BER-based and SNR threshold-based reception models.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078530">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078532">PHY-GSM</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078534">Models the GSM Physical Layer.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078536">Cellular</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078538">PHY-LTE</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078540">Models the LTE Physical Layer.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078542">LTE</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1078551">PHY-UMTS</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078553">Models the PHY layer for UMTS systems.</a></div>
            <div class="CellBody"><a name="1078554">(To select this protocol, parameter </a><span style="font-family: &quot;Courier New&quot;">PHY-MODEL</span> should be set to <span style="font-family: &quot;Courier New&quot;">PHY-CELLULAR</span> and  parameter <span style="font-family: &quot;Courier New&quot;">CELLULAR-PHY-MODEL</span> should be set to <span style="font-family: &quot;Courier New&quot;">PHY-UMTS</span>.)</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1078556">UMTS</a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="1025739">&nbsp;</a></div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-17.&nbsp;&nbsp;<a name="1025707">Antenna Models in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 97.2pt">
            <div class="CellHeading"><a name="1025713">Antenna Model </a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 280.8pt">
            <div class="CellHeading"><a name="1025715">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1025717">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1025719">OMNIDIRECTIONAL</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025721">Omnidirectional antenna model.</a></div>
            <div class="CellBody"><a name="1025722">This is the model for the basic antenna, which yields the same antenna gain irrespective of the signal direction.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025724">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025726">SWITCHED-BEAM</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025728">Switched-beam antenna model.</a></div>
            <div class="CellBody"><a name="1025729">The switched-beam antenna can switch among multiple antenna patterns and uses the pattern that yields the maximum antenna gain.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025731">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025733">STEERABLE</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025735">Steerable antenna model.</a></div>
            <div class="CellBody"><a name="1025736">The steerable antenna can rotate the antenna and uses the direction that yields the maximum antenna gain.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025738">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025778">PATTERNED</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025781">Patterned antenna model.</a></div>
            <div class="CellBody"><a name="1025796">This antenna model uses antenna pattern files in the NSMA and Open ASCII formats in addition to the traditional format.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1025783">Wireless</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading2Numbered">4.6.2  <a name="996375">Physical Layer Organization: Files and Folders</a></div>
      <div class="BodyAfterHead"><a name="996579">In this section, we briefly examine the files and folders that are relevant to Physical Layer models. These files contain detailed comments on functions and other code components.</a></div>
      <div class="BodyAfterHead"><a name="970605">The Physical Layer API is composed of several macros, functions, and structures. These are defined in the following header files:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="996591">QUALNET_HOME</a></span>/include/api.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="970610">This file defines the events and data structures needed to communicate between different layers of the protocol stack.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="996599">QUALNET_HOME</a></span>/include/phy.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="970611">This file contains definitions common to Physical Layer models, the Physical Layer data structure in the node structure, and prototypes of functions defined in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/phy.cpp.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="996662">QUALNET_HOME</a></span>/include/antenna.h and <span class="Variable">QUALNET_HOME</span>/libraries/wireless/srcantenna_global.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="996663">These files contain definitions common to antenna models and prototypes of functions defined in antenna.cpp and antenna_global.cpp in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src, respectively.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="996625">QUALNET_HOME</a></span>/include/mac.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="996613">This file contains definitions of API functions needed to communicate with the MAC Layer.</a></div>
      <div class="Body"><a name="996646">Additionally, the following header file is also relevant to the Physical Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="996647">QUALNET_HOME</a></span>/include/fileio.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="996648">This file contains prototypes of functions to read input files and create output files. </a></div>
      <div class="Body"><a name="996683">The following are the folders and source files associated with the Physical Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="996684">QUALNET_HOME</a></span>/libraries/wireless/src</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="996658">This folder contains the source and header files for the various Physical Layer models implemented in </a><span class="Variable">QualNet</span>. The file names are based on the name of the model that they implement, e.g., to see the implementation for IEEE 802.11a, look at files phy_802_11.cpp and phy_802_11.h in this folder.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="996617">QUALNET_HOME</a></span>/libraries/wireless/src/phy.cpp</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="996614">This file contains generic Physical Layer functions, including the initialization, message processing and finalization functions.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="970614">antenna.cpp and antenna_global.cpp in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="970615">These files contain implementation of generic antenna functions and the implementation of the omni-directional antenna model.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="970616">QUALNET_HOME</a></span>/libraries/wireless/src/prop_range.cpp</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="970617">This file implements the radio-range program, which calculates the likely propagation range of a node, under no interference conditions, using the parameters specified in the configuration file.</a></div>
      <div class="Heading2Numbered">4.6.3  <a name="996391">Physical Layer Data Structures</a></div>
      <div class="BodyAfterHead"><a name="996395">The Physical Layer data structures are defined in </a><span class="Variable">QUALNET_HOME</span>/include/phy.h. This section describes the main data structures. (Note that only a partial description of the data structures is provided here. Refer to file phy.h for a complete description.)</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><span style="font-family: &quot;Courier New&quot;"><a name="996757">PhyModel</a></span>: This is an enumeration type that lists all the PHY models.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996758">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996821">enum PhyModel{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996822">    PHY802_11a,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996823">    PHY802_11b,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996824">    PHY_ABSTRACT,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996825">    PHY_GSM,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996826">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996830">    PHY_NONE</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996772">};</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996834">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996844">PhyRxModel</a></span><span style="font-family: Arial">: This is an enumeration type that lists all the reception models. A reception model simulates the scheme used by the PHY model to determine the quality of the received signal.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1001005">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1001021">enum PhyRxModel{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075360">    RX_802_11a,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075361">    RX_802_11b,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075362">    RX_802_16,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075363">    RX_UMTS,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075364">    RX_802_15_4,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075365">    SNR_THRESHOLD_BASED,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075366">    BER_BASED,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1001017">    PCOM_BASED</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075382">};</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1001029">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1000994">AntennaModel</a></span>: This structure holds information about an antenna model. Enumeration types <span style="font-family: &quot;Courier New&quot;">AntennaModelType</span> and <span style="font-family: &quot;Courier New&quot;">AntennaPatternType</span> are declared in antenna_global.h.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996845">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016081">struct AntennaModel {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016082">    AntennaModelType   antennaModelType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016083">    int                numModels;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016084">    AntennaPatternType antennaPatternType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016085">    void               *antennaVar;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996881">}AntennaModel;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996869">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="996870">PhyData</a></span>: This is the main data structure used by the Physical Layer and stores information about the Physical Layer models running at a specific interface. Some important fields of this structure are explained below.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1023807">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1078626">struct PhyData {</a></div>
      <div class="Code_Segment"><a name="1023808">    int            phyIndex;</a></div>
      <div class="Code_Segment"><a name="1023809">    int            macInterfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1023810">    Address*       networkAddress;</a></div>
      <div class="Code_Segment"><a name="1023811">    D_BOOL*        channelListenable;</a></div>
      <div class="Code_Segment"><a name="1023812">    D_BOOL*        channelListening;</a></div>
      <div class="Code_Segment"><a name="1023813">    BOOL           phyStats;</a></div>
      <div class="Code_Segment"><a name="1023814">    int            channelIndexForTransmission;</a></div>
      <div class="Code_Segment"><a name="1023816">    PhyModel       phyModel;</a></div>
      <div class="Code_Segment"><a name="1023817">    PhyRxModel     phyRxModel;</a></div>
      <div class="Code_Segment"><a name="1023818">    double         phyRxSnrThreshold;</a></div>
      <div class="Code_Segment"><a name="1023819">    double         noise_mW_hz;</a></div>
      <div class="Code_Segment"><a name="1023820">    int            numBerTables;</a></div>
      <div class="Code_Segment"><a name="1023821">    PhyBerTable*   snrBerTables;</a></div>
      <div class="Code_Segment"><a name="1023822">    RandomSeed     seed;</a></div>
      <div class="Code_Segment"><a name="1023823">    void*          phyVar;</a></div>
      <div class="Code_Segment"><a name="1023825">    double         systemLoss_dB;</a></div>
      <div class="Code_Segment"><a name="1023826">    AntennaModel*  antennaData;</a></div>
      <div class="Code_Segment"><a name="1023829">    BOOL           contentionFreeProp;</a></div>
      <div class="Code_Segment"><a name="1025359">    void *         nodeLinkLossList;</a></div>
      <div class="Code_Segment"><a name="1025360">    void*          nodeLinkDelayList;</a></div>
      <div class="Code_Segment"><a name="1075389">    ...</a></div>
      <div class="Code_Segment"><a name="1023831">    double         noiseFactor;</a></div>
      <div class="Code_Segment"><a name="996988">};</a></div>
      <div class="Figure">FIGURE 4-155.&nbsp;&nbsp;<span style="font-family: &quot;Courier New&quot;"><a name="1023800">PhyData</a></span> Data Structure</div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1023801">phyIndex</a></span>: This is the Physical Layer index of the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997106">macInterfaceIndex</a></span>: This is the MAC Layer index of the interface. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997107">networkAddress</a></span>: This is the network address of the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997108">channelListenable</a></span>: This is a bit mask that indicates which channels the node can potentially listen to. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997163">channelListening</a></span>: This is a bit mask that indicates which channels the node is currently listening to. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997164">phyStats</a></span>: This variable indicates whether statistics collection is enabled for the Physical Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997110">channelIndexForTransmission</a></span>: This is the index of the channel on which the node is currently transmitting. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997111">phyModel</a></span>: This variable indicates the PHY model in use at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997112">phyRxModel</a></span>: This variable indicates the reception model in use at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997113">phyRxSnrThreshold</a></span>: This is the SNR threshold for the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997114">noise_mW_hz</a></span>: This variable stores the noise floor at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025534">numBerTables</a></span>: This variable stores the number of BER tables to be used.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997191">snrBerTables</a></span>: This is a pointer to the BER tables to be used for determining quality of received signals.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025538">seed</a></span>: This variable is used to store the seed for the PHY model in use at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="997199">phyVar</a></span>: This is a pointer to the data structure for the PHY model in use at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025546">systemLoss_db</a></span>: This variable stores the total loss in dB which is the sum of connection loss, mismatch loss, cable loss and the loss caused in antenna energy conversion.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025547">antennaData</a></span>: This is a pointer to the data structure for the antenna model in use at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025548">contentionFreeProp</a></span>: This variable indicates whether contention free propagation is enabled.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1025543">noiseFactor</a></span>: This variable stores the noise factor of the interface for the PHY 802.16 model.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading2Numbered">4.6.4  <a name="996387">Physical Layer APIs and Inter-layer Communication</a></div>
      <div class="BodyAfterHead"><a name="997364">This section describes the APIs used by the MAC Layer to communicate with the Physical Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1008609', '');" title="Physical Layer">Section&nbsp;4.6.4.1</a></span>), the APIs used by the Physical Layer to communicate with the MAC Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1008855', '');" title="Physical Layer">Section&nbsp;4.6.4.2</a></span>), the APIs used by PHY models to communicate with the communication medium (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1008869', '');" title="Physical Layer">Section&nbsp;4.6.4.3</a></span>), and the APIs used by the communication medium to communicate with PHY models (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1008921', '');" title="Physical Layer">Section&nbsp;4.6.4.4</a></span>). This section also describes the APIs used by PHY Models to communicate with antenna models (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1008957', '');" title="Physical Layer">Section&nbsp;4.6.4.5</a></span>) and lists some of the Physical Layer utility APIs (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1008960', '');" title="Physical Layer">Section&nbsp;4.6.4.6</a></span>).</div>
      <div class="Body"><a name="1008798">The complete list of APIs, with their parameters and description, can be found in </a><span style="font-style: italic">API Reference Guide</span>. </div>
      <div class="Heading3Numbered">4.6.4.1  <a name="1008609">MAC Layer to Physical Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1008810">MAC Layer protocols use several APIs to communicate with the Physical Layer. The prototypes for these API functions are contained in the file phy.h. </a></div>
      <div class="BodyAfterHead"><a name="1008811">Some of the functions used for communication from the MAC Layer to the Physical Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008812">PHY_StartTransmittingSignal: This function is used by the MAC Layer to send a packet to the Physical Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008813">PHY_StartListeningToChannel: This function is used by the MAC Layer to direct the Physical Layer to start listening to the specified channel.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008617">PHY_StopListeningToChannel: This function is used by the MAC Layer to direct the Physical Layer to stop listening to the specified channel.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1020149">PHY_SetTransmissionChannel: This function is used by the MAC Layer to set the channel for transmission.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.6.4.2  <a name="1008855">Physical Layer to MAC Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1008856">Physical Layer protocols use several APIs to communicate with the MAC Layer. The prototypes for these API functions are contained in the file </a><span class="Variable">QUALNET_HOME</span>/include/mac.h. The file <span class="Variable">QUALNET_HOME</span>/main/mac.cpp contains the implementation of these functions.</div>
      <div class="BodyAfterHead"><a name="1008857">Some of the functions used for communication from the Physical Layer to the MAC Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008858">MAC_ReceivePacketFromPhy: This function delivers a packet from the Physical Layer to the MAC Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008849">MAC_ReceivePhyStatusChangeNotification: This function notifies the MAC Layer of a status change at the Physical Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.6.4.3  <a name="1008869">PHY Models to Communication Medium Communication</a></div>
      <div class="BodyAfterHead"><a name="1016154">The communication medium provides the API PROP_ReleaseSignal to enable PHY entities to communicate with the communication medium. A PHY model calls the API PROP_ReleaseSignal to transmit a signal.</a></div>
      <div class="Body"><a name="1009108">The prototype for PROP_ReleaseSignal is contained in the file </a><span class="Variable">QUALNET_HOME</span>/include/propagation.h.</div>
      <div class="Heading3Numbered">4.6.4.4  <a name="1008921">Communication Medium to PHY Models Communication</a></div>
      <div class="BodyAfterHead"><a name="1008926">The communication medium uses the APIs listed below to communicate with PHY models. The prototypes for these functions are contained in phy.h. The file phy.cpp contains the implementation of these functions.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008927">PHY_SignalArrivalFromChannel: This function indicates the start of a signal.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008937">PHY_SignalEndFromChannel: This function indicates the end of a signal.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.6.4.5  <a name="1008957">PHY Model to Antenna Models Communication</a></div>
      <div class="BodyAfterHead"><a name="1008968">PHY models use several APIs to communicate with antenna models. The prototypes for these functions are contained in the file phy.h. The file phy.cpp contains the implementation of these functions.</a></div>
      <div class="Body"><a name="1008969">Some of the APIs used for communication from PHY models to antenna models are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008986">PHY_LockAntennaDirection: This function locks the direction of the antenna.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009001">PHY_UnlockAntennaDirection: This function unlocks the direction of the antenna.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.6.4.6  <a name="1008960">Physical Layer Utility APIs</a></div>
      <div class="BodyAfterHead"><a name="1008929">Several APIs are available at the Physical Layer that perform tasks internal to the Physical Layer. Some of these functions can be used by other layers, as well. Some of the Physical Layer utility APIs are listed below.</a></div>
      <div class="Body"><a name="1009024">The prototypes for the following utility API functions are contained in the file phy.h. The file phy.cpp contains the implementation of these functions. </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1006629">PHY_GetTxDataRate: This function returns the transmission data rate.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008513">PHY_GetRxDataRate: This function returns the reception data rate.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1006634">PHY_SetLowestTxDataRateType: This function sets the lowest transmission data rate type.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1008524">PHY_SetHighestTxDataRateType: This function sets the highest transmission data rate type.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1006640">PHY_GetTransmissionDuration: This function returns the transmission duration of a signal.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1025363">The prototypes for the following utility API functions are contained in the file </a><span class="Variable">QUALNET_HOME</span>/include/antenna.h. The file <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna.cpp contains the implementation of these functions. </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025364">ANTENNA_IsInOmnidirectionalMode: This function indicates whether the antenna is operating in the omni-directional mode.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009056">ANTENNA_GainForThisDirection: This function returns the antenna gain for the specified direction.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1009061">ANTENNA_GainForThisSignal: This function returns the antenna gain for the specified signal.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading2Numbered">4.6.5  <a name="999006">Adding a PHY Model </a></div>
      <div class="BodyAfterHead"><a name="999217">Although the working of each PHY model is different, there are certain functions that are performed by most PHY models. This section provides an outline for developing and adding a PHY model to </a><span class="Variable">QualNet</span>. We illustrate the process of adding a PHY model by using as an example the implementation code for the IEEE 802.11a PHY specification. The header file for the IEEE 802.11a implementation is phy_802_11.h and the source file is phy_802_11.cpp in the folder <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src. We use code snippets from these two files throughout this section to illustrate different steps in developing a PHY model. After understanding the discussed snippets, look at the complete code for IEEE 802.11a to understand how a PHY model is implemented in <span class="Variable">QualNet</span>.</div>
      <div class="Body"><a name="999219">The following list summarizes the actions that need to be performed for adding a PHY model, PHY_MYPHY, to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="999223">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005710', '');" title="Physical Layer">Section&nbsp;4.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999227">Modify the file phy.cpp to include the model’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005710', '');" title="Physical Layer">Section&nbsp;4.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999231">Include the PHY model in the list of PHY models and the reception model, MYRXMODEL, in the list of reception models (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005744', '');" title="Physical Layer">Section&nbsp;4.6.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999235">Define data structures for the PHY model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017273', '');" title="Physical Layer">Section&nbsp;4.6.6.5</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999239">Decide on the format for the PHY model-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005786', '');" title="Physical Layer">Section&nbsp;4.6.6.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999240">Call the PHY model’s initialization function from the Physical Layer initialization function, PHY_CreateAPhyForMac (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005800', '');" title="Physical Layer">Section&nbsp;4.6.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999244">Write the initialization function for the PHY model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000038', '');" title="Physical Layer">Section&nbsp;4.6.5.5.3</a></span>). The initialization function should include the following tasks:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="999248">Declare and initialize the state variables.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="999252">Read and store the configuration parameters for the PHY model.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1006180">Initialize the antenna model.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1006183">Set the transmission channel.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999261">Call the PHY model’s event handler from the Physical Layer event dispatcher, PHY_ProcessEvent (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000109', '');" title="Physical Layer">Section&nbsp;4.6.5.6</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999276">Modify Physical Layer functions to integrate the new PHY model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000135', '');" title="Physical Layer">Section&nbsp;4.6.5.7</a></span>). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999282">Write a function to handle outgoing packets (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002403', '');" title="Physical Layer">Section&nbsp;4.6.5.8.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999286">Write functions to process the start and end of an incoming packet (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002637', '');" title="Physical Layer">Section&nbsp;4.6.5.8.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999287">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="999291">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004592', '');" title="Physical Layer">Section&nbsp;4.6.5.9.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="999295">Initialize the statistics variables in the PHY model’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004612', '');" title="Physical Layer">Section&nbsp;4.6.5.9.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="999299">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004822', '');" title="Physical Layer">Section&nbsp;4.6.5.9.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="999303">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004882', '');" title="Physical Layer">Section&nbsp;4.6.5.9.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1076160">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1076240', '');" title="Physical Layer">Section&nbsp;4.6.5.9.5</a></span>) .</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999304">Call the PHY model finalization function from the Physical Layer finalization function, PHY_Finalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005038', '');" title="Physical Layer">Section&nbsp;4.6.5.10.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999311">Write the PHY model finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005088', '');" title="Physical Layer">Section&nbsp;4.6.5.10.2</a></span>). Call the function to print statistics from the PHY model finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1020646">Modify the file prop_range.cpp to enable the radio-range utility function to calculate the propagation range of a node using the new PHY model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1043871', '');" title="Physical Layer">Section&nbsp;4.6.5.11</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999215">Include the PHY model header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1024035', '');" title="Physical Layer">Section&nbsp;4.6.5.12</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">17.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1076189">To make the model available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1076273', '');" title="Physical Layer">Section&nbsp;4.6.5.13</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.6.5.1  <a name="999538">Naming Guidelines</a></div>
      <div class="BodyAfterHead"><a name="999539">In </a><span class="Variable">QualNet</span>, each component (file, data structure, function, etc.) is given a name that indicates the name of the protocol or model, the layer in which the protocol resides, and the functionality of the component, as appropriate. We recommend that when adding a new PHY model, the programmer name the different components of the new model in a similar manner. It will be helpful to examine the implementation of the IEEE 802.11a PHY model in <span class="Variable">QualNet</span> for hints for naming and coding different components of the new PHY model.</div>
      <div class="BodyAfterHead"><a name="999540">In this section, we describe the steps for developing a PHY model called “PHY_MYPHY”. We will use the string “PhyMyphy” in the names of the different components of this model, just as the string “Phy802_11” appears in the names of the components of the IEEE 802.11a implementation.</a></div>
      <div class="Heading3Numbered">4.6.5.2  <a name="999542">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1023886">The first step towards adding a PHY model is creating files. Most models comprise two files: the header file and the source file. These files can be placed in any library, e.g., in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src. However, it is recommended that all user-developed models be made part of a library. In our example, we will place the PHY model in a library called user_models. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#954568', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10</a></span> for instructions for creating and activating a library.</div>
      <div class="BodyAfterHead"><a name="1023890">If it doesn’t already exist, create a directory in </a><span class="Variable">QUALNET_HOME</span>/libraries called user_models and a subdirectory in <span class="Variable">QUALNET_HOME</span>/libraries/user_models called src. Create the files for the PHY model and place them in the folder <span class="Variable">QUALNET_HOME</span>/libraries/user_models/src. Name these files in a way that clearly indicates the model that they implement. Prefix the file names with <span style="font-style: italic">phy_</span> to designate the files as PHY model files.</div>
      <div class="Body" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: italic; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="font-style: normal"><a name="999544">Examples</a></span>:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999545">phy_802_11.h, phy_802_11.cpp: These files, in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src, implement the IEEE 802.11a and IEEE 802.11b PHY models. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999546">phy_abstract.h, phy_abstract.cpp: These files, in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src, implement the abstract PHY model.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1016169">In keeping with the naming guidelines of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999538', '');" title="Physical Layer">Section&nbsp;4.6.5.1</a></span>, the header file for the example PHY model is called phy_myphy.h, and the source file is called phy_myphy.cpp.</div>
      <div class="Note_Indented"><a name="1016173"><img class="Default" src="images/Chapter%204-6.10.1.1.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="999555">While adding code to the files, it is important to organize the code well between the files. Generally, the header file, phy_myphy.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999557">Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999558">Data structure definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1020167">Prototypes for interface functions in the source file, phy_myphy.cpp</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="999559">The source file, phy_myphy.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999560">Statement to include the PHY model’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Declaration"><a name="999561">	</a></div>
      <div class="Declaration"><a name="1078646">#include “phy_myphy.h”</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999562">Statements to include standard library functions and other header files needed by the PHY model’s source file. A typical PHY model source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999563">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999564">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999565">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999566">#include &lt;string.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999643">#include &lt;math.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999644">#include "api.h" </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999645">#include "antenna.h"</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016132">#include "antenna_global.h"</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999634">#include “antenna_switched.h”  //For switched beam antenna model </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999655">#include “antenna_steerable.h” //For steerable antenna model </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016115">#include “antenna_patterned.h” //For patterned antenna model</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999570">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999571">Initialization function for the PHY model, PhyMyphyInit</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999670">Finalization function for the PHY model, PhyMyphyFinalize</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999572">PHY model implementation functions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="999573">The file </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/phy.cpp contains the layer level initialization function and functions to implement the PHY model functionality. These layer level functions in turn call the PHY model’s initialization, event handler and finalization functions. Therefore, to make these PHY model functions available to the layer level functions, insert the following include statement in the file phy.cpp:</div>
      <div class="Declaration"><a name="999574">	</a></div>
      <div class="Declaration"><a name="1078657">#include “phy_myphy.h”</a></div>
      <div class="Heading3Numbered">4.6.5.3  <a name="999415">Including PHY_MYPHY in List of PHY Models</a></div>
      <div class="BodyAfterHead"><a name="999431">Each node in </a><span class="Variable">QualNet</span> hosts an operating protocol stack. For each layer in the stack, a list of protocols/models running at that layer is maintained. When a new PHY model is added to <span class="Variable">QualNet</span>, it needs to be included in the list of PHY models. To do this, add the PHY model’s name to the enumeration <span style="font-family: &quot;Courier New&quot;">PhyModel</span> defined in phy.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#996391', '');" title="Physical Layer">Section&nbsp;4.6.3</a></span>). </div>
      <div class="Body"><a name="999435">For our example PHY model, add the entry </a><span style="font-family: &quot;Courier New&quot;">PHY_MYPHY</span><span style="font-weight: bold"> </span>to <span style="font-family: &quot;Courier New&quot;">PhyModel</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999455', '');" title="Physical Layer">Figure&nbsp;4-156</a></span>.</div>
      <div class="Code_Segment"><a name="999439">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023927">enum PhyModel{</a></div>
      <div class="Code_Segment"><a name="1023928">    PHY802_11a,</a></div>
      <div class="Code_Segment"><a name="1023929">    PHY802_11b,</a></div>
      <div class="Code_Segment"><a name="1023930">    PHY_ABSTRACT,</a></div>
      <div class="Code_Segment"><a name="1023931">    PHY_GSM,</a></div>
      <div class="Code_Segment"><a name="1023932">    ...</a></div>
      <div class="Code_Segment"><a name="1023946">    PHY_NONE,</a></div>
      <div class="Code_New"><a name="1023945">    PHY_MYPHY</a></div>
      <div class="Code_Segment"><a name="999453">};</a></div>
      <div class="Figure">FIGURE 4-156.&nbsp;&nbsp;<a name="999455">Adding PHY_MYPHY to List of PHY Models</a></div>
      <div class="Note_Indented"><a name="999429">Always add to the end of lists in header files.<img class="Default" src="images/Chapter%204-6.10.1.2.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></a></div>
      <div class="Body"><a name="1000938">To add a new reception model, add the entry </a><span style="font-family: &quot;Courier New&quot;">RX_MYRXMODEL</span> to the enumeration <span style="font-family: &quot;Courier New&quot;">PhyRxModel</span> defined in phy.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#996391', '');" title="Physical Layer">Section&nbsp;4.6.3</a></span>), as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000955', '');" title="Physical Layer">Figure&nbsp;4-157</a></span>.</div>
      <div class="Code_Segment"><a name="1000959">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1075419">enum PhyRxModel{</a></div>
      <div class="Code_Segment"><a name="1075431">    RX_802_11a,</a></div>
      <div class="Code_Segment"><a name="1075432">    RX_802_11b,</a></div>
      <div class="Code_Segment"><a name="1075433">    RX_802_16,</a></div>
      <div class="Code_Segment"><a name="1075434">    RX_UMTS,</a></div>
      <div class="Code_Segment"><a name="1075435">    RX_802_15_4,</a></div>
      <div class="Code_Segment"><a name="1075436">    SNR_THRESHOLD_BASED,</a></div>
      <div class="Code_Segment"><a name="1075437">    BER_BASED,</a></div>
      <div class="Code_Segment"><a name="1075424">    PCOM_BASED,</a></div>
      <div class="Code_New"><a name="1075425">    RX_MYRXMODEL</a></div>
      <div class="Code_Segment"><a name="1000953">};</a></div>
      <div class="Figure">FIGURE 4-157.&nbsp;&nbsp;<a name="1000955">Adding MYRXMODEL to List of Reception Models</a></div>
      <div class="Heading3Numbered">4.6.5.4  <a name="999464">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="999465">Each PHY model has its own data structures, which are defined in the model’s header file. The data structures store information such as:</a></div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="999469">PHY parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005800', '');" title="Physical Layer">Section&nbsp;4.6.6.6.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="999477">Statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004592', '');" title="Physical Layer">Section&nbsp;4.6.5.9.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="999478">Define an appropriate data structure, </a><span style="font-family: &quot;Courier New&quot;">PhyDataMyphy</span>, for PHY_MYPHY in the model’s header file, phy_myphy.h. As an example, the following data structure, defined in phy_802_11.h, is used by the IEEE 802.11a PHY model:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999479">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025231">typedef struct struct_phy_802_11_str {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025232">    PhyData*  thisPhy;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025234">    int       txDataRateTypeForBC;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025235">    int       txDataRateType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025236">    D_Float32 txPower_dBm;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025237">    float     txDefaultPower_dBm[PHY802_11_NUM_DATA_RATES];</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025239">    int       rxDataRateType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025240">    double    rxSensitivity_mW[PHY802_11_NUM_DATA_RATES];</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025242">    int       numDataRates;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025243">    int       dataRate[PHY802_11_NUM_DATA_RATES];</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025244">    double    numDataBitsPerSymbol[PHY802_11_NUM_DATA_RATES];</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025245">    int       lowestDataRateType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025246">    int       highestDataRateType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025248">    double    directionalAntennaGain_dB;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025250">    Message*  rxMsg;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025251">    double    rxMsgPower_mW;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025252">    clocktype rxTimeEvaluated;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025253">    BOOL      rxMsgError;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025254">    clocktype rxEndTime;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025255">    Orientation rxDOA;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025257">    Message *txEndTimer;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1075461">    D_Int32   channelBandwidth;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025258">    clocktype rxTxTurnaroundTime;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025259">    double    noisePower_mW;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025260">    double    interferencePower_mW;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025262">    PhyStatusType mode;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025263">    PhyStatusType previousMode;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025265">    Phy802_11Stats  stats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025266">} PhyData802_11;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999816">&nbsp;</a></div>
      <div class="Body"><a name="999416">In the above declaration, </a><span style="font-family: &quot;Courier New&quot;">Phy802_11Stats</span> is the statistics data structure for the IEEE 802.11a PHY model. See the declaration of <span style="font-family: &quot;Courier New&quot;">PhyData802_11</span> in phy_802_11.h for a description of the fields of the data structure.</div>
      <div class="Heading3Numbered">4.6.5.5  <a name="999860">Initialization</a></div>
      <div class="BodyAfterHead"><a name="999861">In this section, we describe the tasks that need to be performed as part of the initialization process of a PHY model.</a></div>
      <div class="Heading4Numbered">4.6.5.5.1  <a name="999863">Determining the PHY Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="999864">A PHY model may use model-specific configuration parameters for its operation. The configuration parameters are specified in the </a><span class="Variable">QualNet</span> configuration file. The format for specifying a PHY model’s configuration parameters is:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999866">[&lt;Identifier&gt;] &lt;Parameter-name&gt; [&lt;Index&gt;] &lt;Parameter-value&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017329">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="999867">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="999870"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;	</span>: Node identifier, subnet identifier, or IP address to which this parameter declaration is applicable, enclosed in square brackets. This specification is optional, and if it is not included, the parameter declaration applies to all nodes.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><span style="font-family: &quot;Courier New&quot;"><a name="1020280">&lt;Parameter-name&gt;	</a></span>: Name of the parameter.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1020297"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;	</span>: Instance to which this parameter declaration is applicable, enclosed in square brackets. This is used when there are multiple instances of the parameter. This specification is optional, and if it is not included, the parameter declaration applies to all instances.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><span style="font-family: &quot;Courier New&quot;"><a name="999871">&lt;Parameter-value&gt;	</a></span>: Value to be used for the parameter. </div>
      <div class="Body"><a name="999872">Generally, a PHY model requires the transmission power and receiver sensitivity at different transmission rates to be specified. As an example, the following parameters specify a transmission power of 20dBm and a receiver sensitivity of -85.0 dBm for the IEEE 802.11a PHY model when operating at 6Mbps:</a></div>
      <div class="Code_Segment_Large"><a name="999875">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1078680">PHY-MODEL                         PHY802.11a</a></div>
      <div class="Code_Segment_Large"><a name="1008020">PHY802.11a-TX-POWER--6MBPS        20.0</a></div>
      <div class="Code_Segment_Large"><a name="999942">PHY802.11a-RX-SENSITIVITY--6MBPS  -85.0</a></div>
      <div class="Body"><a name="999877">Decide on the format for specifying the new PHY model’s configuration parameters. For our example PHY model, specify the configuration parameters in the </a><span class="Variable">QualNet</span> configuration file using the following format (<span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;</span> and <span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;</span> can also be used to qualify the parameter declarations, as described above):</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999880"> PHY-MODEL                  PHY_MYPHY</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1008029"> &lt;param1&gt;                   &lt;value1&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999881"> ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999882"> &lt;paramN&gt;                   &lt;valueN&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017381">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="999883"> where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="999884">&lt;param1&gt;</a></span>, ..., <span style="font-family: &quot;Courier New&quot;">&lt;paramN&gt;</span>	: Names of parameters for PHY_MYPHY.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="999885">&lt;value1&gt;</a></span>, ..., <span style="font-family: &quot;Courier New&quot;">&lt;valueN&gt;</span>	: Values of the PHY parameters.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000038', '');" title="Physical Layer" name="1020326">Section&nbsp;4.6.5.5.3</a></span> explains how to read user input specified in this format to initialize the model.</div>
      <div class="Heading4Numbered">4.6.5.5.2  <a name="999955">Calling the PHY Model Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="999956">The protocol stack of each node is initialized in a bottom up manner. For a wireless network, the MAC Layer and Physical Layer at an interface are initialized together, with the Physical Layer initialization taking place before the MAC Layer initialization. This process is performed in the node initialization function PARTITION_InitializeNodes, implemented in </a><span class="Variable">QUALNET_HOME</span>/main/partition.cpp<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#919750', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.1</a></span>).</div>
      <div class="BodyAfterHead"><a name="1016379">The node initialization function, PARTITION_InitializeNodes, calls the MAC Layer initialization function MAC_Initialize. Function MAC_Initialize reads the configuration file for lines starting with the keywords </a><span style="font-family: &quot;Courier New&quot;">SUBNET</span> or <span style="font-family: &quot;Courier New&quot;">LINK</span>. If the input line begins with the keyword <span style="font-family: &quot;Courier New&quot;">SUBNET</span>, MAC_Initialize calls the function ProcessInputFileSubnetLine. If the input line begins with the keyword <span style="font-family: &quot;Courier New&quot;">LINK</span>, MAC_Initialize calls the function ProcessInputFileLinkLine. Function ProcessInputFileSubnetLine assigns an IP address to the subnet interface for each node in the subnet and calls function AddNodeToSubnet for each node. Function AddNodeToSubnet initializes the interface information for the subnet interface. Functions MAC_Initialize, ProcessInputFileSubnetLine, ProcessInputFileLinkLine, and AddNodeToSubnet are implemented in the file <span class="Variable">QUALNET_HOME</span>/main/mac.cpp.</div>
      <div class="Body"><a name="1000632">For a wireless MAC protocol, function AddNodeToSubnet initializes the Physical Layer model specified for the interface by calling the function PHY_CreateAPhyForMac. For example, if IEEE 802.11a is specified as the PHY model running at the interface, AddNodeToSubnet calls PHY_CreateAPhyForMac with </a><span style="font-family: &quot;Courier New&quot;">PHY802_11a</span> as the <span style="font-family: &quot;Courier New&quot;">PhyModel</span> parameter. Modify AddNodeToSubnet to call PHY_CreateAPhyForMac with <span style="font-family: &quot;Courier New&quot;">PHY_MYPHY</span> as the <span style="font-family: &quot;Courier New&quot;">PhyModel</span> parameter if PHY_MYPHY is specified as the PHY model for the interface, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000374', '');" title="Physical Layer">Figure&nbsp;4-158</a></span>. Function PHY_CreateAPhyForMac is implemented in phy.cpp.</div>
      <div class="Code_Segment"><a name="1000376">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000377">static void //inline//</a></div>
      <div class="Code_Segment"><a name="1000378">AddNodeToSubnet(</a></div>
      <div class="Code_Segment"><a name="1000379">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1000380">    const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="1000381">    ...</a></div>
      <div class="Code_Segment"><a name="1000387">    int         subnetListIndex)</a></div>
      <div class="Code_Segment"><a name="1000388">{</a></div>
      <div class="Code_Segment"><a name="1000389">    int interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1000390">    ...</a></div>
      <div class="Code_Segment"><a name="1000591">    IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1000592">        node,</a></div>
      <div class="Code_Segment"><a name="1025385">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1000593">        interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1000594">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="1000595">        "PHY-MODEL",</a></div>
      <div class="Code_Segment"><a name="1000596">        &amp;phyModelFound,</a></div>
      <div class="Code_Segment"><a name="1000433">        phyModelName);</a></div>
      <div class="Code_Segment"><a name="1000429">    ...</a></div>
      <div class="Code_Segment"><a name="1000543">    if (strncmp(macProtocolName, "FCSC-", 5) == 0) {</a></div>
      <div class="Code_Segment"><a name="1000452">    ...</a></div>
      <div class="Code_Segment"><a name="1000464">    }</a></div>
      <div class="Code_Segment"><a name="1000465">    else {</a></div>
      <div class="Code_Segment"><a name="1000466">        PhyModel phyModel = PHY802_11b;</a></div>
      <div class="Code_Segment"><a name="1000483">        ...</a></div>
      <div class="Code_Segment"><a name="1000534">        if (strncmp(phyModelName, "FCSC-", 5) == 0) {</a></div>
      <div class="Code_Segment"><a name="1000484">            ...</a></div>
      <div class="Code_Segment"><a name="1000536">        }</a></div>
      <div class="Code_Segment"><a name="1000748">        else if (strcmp(phyModelName, "PHY802.11a") == 0) {</a></div>
      <div class="Code_Segment"><a name="1000493">            PHY_CreateAPhyForMac(</a></div>
      <div class="Code_Segment"><a name="1000494">                    node,</a></div>
      <div class="Code_Segment"><a name="1000495">                    nodeInput,</a></div>
      <div class="Code_Segment"><a name="1000496">                    interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1000497">                    &amp;address,</a></div>
      <div class="Code_Segment"><a name="1000498">                    PHY802_11a,</a></div>
      <div class="Code_Segment"><a name="1000499">                    &amp;node-&gt;macData[interfaceIndex]-&gt;phyNumber);</a></div>
      <div class="Code_Segment"><a name="1000501">            phyModel = PHY802_11a;</a></div>
      <div class="Code_Segment"><a name="1000502">        }</a></div>
      <div class="Code_New"><a name="1000503">        else if (strcmp(phyModelName, "PHY_MYPHY") == 0) {</a></div>
      <div class="Code_New"><a name="1000504">            PHY_CreateAPhyForMac(</a></div>
      <div class="Code_New"><a name="1000505">                    node,</a></div>
      <div class="Code_New"><a name="1000506">                    nodeInput,</a></div>
      <div class="Code_New"><a name="1000507">                    interfaceIndex,</a></div>
      <div class="Code_New"><a name="1000508">                    &amp;address,</a></div>
      <div class="Code_New"><a name="1000509">                    PHY_MYPHY,</a></div>
      <div class="Code_New"><a name="1000510">                    &amp;node-&gt;macData[interfaceIndex]-&gt;phyNumber);</a></div>
      <div class="Code_New"><a name="1000512">            phyModel = PHY_MYPHY;</a></div>
      <div class="Code_New"><a name="1000481">        }</a></div>
      <div class="Code_Segment"><a name="1000516">        ...</a></div>
      <div class="Code_Segment"><a name="1000518">}</a></div>
      <div class="Figure">FIGURE 4-158.&nbsp;&nbsp;<a name="1000374">Calling the Physical Layer Initialization Function</a></div>
      <div class="Body"><a name="1000736">Function PHY_CreateAPhyForMac, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999513', '');" title="Physical Layer">Figure&nbsp;4-159</a></span>, performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001072">Reads and stores the listenable and listening channel masks from the configuration file.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001084">Reads and stores the generic Physical Layer parameters from the configuration file. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001089">Reads the reception model to be used for the interface and sets the receiver parameters (SNR threshold or BER tables) accordingly. For example, if the reception model is specified to be IEEE 802.11a, PHY_CreateAPhyForMac calls the IEEE 802.11a function Phy802_11aSetBerTable to set up the BER tables.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1044163">Calls the initialization function for the PHY model running at the interface. For example, if IEEE 802.11a is specified as the PHY model running at the interface, PHY_CreateAPhyForMac calls the IEEE 802.11a initialization function Phy802_11Init, which is implemented in phy_802_11.cpp. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1044164">To add your PHY model to </a><span class="Variable">QualNet</span>, make the following modifications to PHY_CreateAPhyForMac, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999513', '');" title="Physical Layer">Figure&nbsp;4-159</a></span>:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001134">Call the function MyrxmodelSetBerTable to set up the BER tables according to the desired reception scheme, if MYRXMODEL is specified as the reception model to be used at the interface.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001138">Call the PHY_MYPHY initialization function, PhyMyphyInit, if PHY_MYPHY is specified as the PHY model for the interface. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1001143">The prototypes for the functions MyrxmodelSetBerTable and PhyMyphyInit should be included in the header file, phy_myphy.h.</a></div>
      <div class="Code_Segment"><a name="1000373">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000370">void PHY_CreateAPhyForMac(Node *node, const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="1000164">                          int interfaceIndex, Address *networkAddress,</a></div>
      <div class="Code_Segment"><a name="1000166">                          PhyModel phyModel, int* phyNumber)</a></div>
      <div class="Code_Segment"><a name="1000168">{</a></div>
      <div class="Code_Segment"><a name="1000169">    char buf[10*MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1000171">    ...</a></div>
      <div class="Code_Segment"><a name="1000176">    int phyIndex = node-&gt;numberPhys;</a></div>
      <div class="Code_Segment"><a name="1000178">    PhyData *thisPhy;</a></div>
      <div class="Code_Segment"><a name="1000187">    ...</a></div>
      <div class="Code_Segment"><a name="1000191">    thisPhy = (PhyData *)MEM_malloc(sizeof(PhyData));</a></div>
      <div class="Code_Segment"><a name="1000189">    memset(thisPhy, 0, sizeof(PhyData));</a></div>
      <div class="Code_Segment"><a name="1075484">    node-&gt;phyData[phyIndex] = thisPhy;</a></div>
      <div class="Code_Segment"><a name="1000195">    ...</a></div>
      <div class="Code_Segment"><a name="1000198">    thisPhy-&gt;phyModel = phyModel;</a></div>
      <div class="Code_Segment"><a name="1020384">    assert(phyModel == PHY802_11a ||</a></div>
      <div class="Code_Segment"><a name="1020385">           phyModel == PHY802_11b ||</a></div>
      <div class="Code_New"><a name="1020398">           phyModel == PHY_MYPHY ||</a></div>
      <div class="Code_Segment"><a name="1020386">           ...</a></div>
      <div class="Code_Segment"><a name="1020413">           phyModel == PHY802_15_4);  </a></div>
      <div class="Code_Segment"><a name="1020410">    ...</a></div>
      <div class="Code_Segment"><a name="1000806">    // Set PHY-RX-MODEL</a></div>
      <div class="Code_Segment"><a name="1000808">     IO_ReadString(node, node-&gt;nodeId, interfaceIndex, nodeInput,</a></div>
      <div class="Code_Segment"><a name="1000812">                  "PHY-RX-MODEL", &amp;wasFound, buf);</a></div>
      <div class="Code_Segment"><a name="1000816">    if (wasFound) {</a></div>
      <div class="Code_Segment"><a name="1000817">        if (strcmp(buf, "PHY802.11a") == 0) {</a></div>
      <div class="Code_Segment"><a name="1000818">            thisPhy-&gt;phyRxModel = RX_802_11a;</a></div>
      <div class="Code_Segment"><a name="1000819">            Phy802_11aSetBerTable(thisPhy);</a></div>
      <div class="Code_Segment"><a name="1000820">        }</a></div>
      <div class="Code_New"><a name="1000821">        else if (strcmp(buf, "MYRXMODEL") == 0) {</a></div>
      <div class="Code_New"><a name="1000822">            thisPhy-&gt;phyRxModel = RX_MYRXMODEL;</a></div>
      <div class="Code_New"><a name="1000823">            MyrxmodelSetBerTable(thisPhy);</a></div>
      <div class="Code_New"><a name="1000824">        }</a></div>
      <div class="Code_Segment"><a name="1000825">        else</a></div>
      <div class="Code_Segment"><a name="1001038">        ...</a></div>
      <div class="Code_Segment"><a name="1001039">    }</a></div>
      <div class="Code_Segment"><a name="1000869">    else {</a></div>
      <div class="Code_Segment"><a name="1000870">        ...</a></div>
      <div class="Code_Segment"><a name="1000872">    }</a></div>
      <div class="Code_Segment"><a name="1000803">    ...</a></div>
      <div class="Code_Segment"><a name="1000213">    switch(thisPhy-&gt;phyModel) {</a></div>
      <div class="Code_Segment"><a name="1000214">        case PHY802_11b:</a></div>
      <div class="Code_Segment"><a name="1000215">        case PHY802_11a: {</a></div>
      <div class="Code_Segment"><a name="1000216">            Phy802_11Init(node, phyIndex, nodeInput);</a></div>
      <div class="Code_Segment"><a name="1000218">            break;</a></div>
      <div class="Code_Segment"><a name="1000219">        }</a></div>
      <div class="Code_New"><a name="1000220">        case PHY_MYPHY: {</a></div>
      <div class="Code_New"><a name="1000221">            PhyMyphyInit(node, phyIndex, nodeInput);</a></div>
      <div class="Code_New"><a name="1000223">            break;</a></div>
      <div class="Code_New"><a name="1000224">        }</a></div>
      <div class="Code_Segment"><a name="1000258">        ...</a></div>
      <div class="Code_Segment"><a name="1000261">    }/*switch*/</a></div>
      <div class="Code_Segment"><a name="1000211">} //PHY_CreateAPhyForMacLayer//</a></div>
      <div class="Figure">FIGURE 4-159.&nbsp;&nbsp;<a name="999513">Calling the PHY Model Initialization Function</a></div>
      <div class="Heading4Numbered">4.6.5.5.3  <a name="1000038">Implementing the PHY Model Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="1000039">The initialization of a PHY model takes place in the initialization function of the model that is called by the Physical Layer initialization function PHY_CreateAPhyForMac. The initialization function of a PHY model commonly performs the following tasks:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000040">Create an instance of the PHY model data structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000041">Read and store the PHY model’s parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1001171">Initialize the state variables of the PHY model</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000042">Initialize the antenna model</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000043">Set the transmission channel</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1001176">The initialization function initializes the PHY model state. Each PHY model has a structure that it uses to store state information. This may include information such as the model state and parameters, statistics variables, etc. Each instance of the PHY model maintains its own state variable.</a></div>
      <div class="Body"><a name="1000051">To store the state, declare the structure to hold the PHY model’s state in the header file, phy_myphy.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999464', '');" title="Physical Layer">Section&nbsp;4.6.5.4</a></span>). As an example, see the declaration of the IEEE 802.11a data structure <span style="font-family: &quot;Courier New&quot;">PhyData802_11</span> in phy_802_11.h.</div>
      <div class="Body"><a name="1000055">Create an instance of the PHY model state by allocating memory to the state structure. IEEE 802.11a performs this task in its initialization function Phy802_11Init by calling the function MEM_malloc to allocate memory for the IEEE 802.11a data structure </a><span style="font-family: &quot;Courier New&quot;">PhyData802_11</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999516', '');" title="Physical Layer">Figure&nbsp;4-160</a></span>. Phy802_11Init and the other IEEE 802.11a functions are implemented in phy_802_11.cpp. Data structure and constant definitions for IEEE 802.11a are contained in phy_802_11.h. </div>
      <div class="Body"><a name="1000059">Phy802_11Init also sets up pointers between the newly created instance of the IEEE 802.11a data structure </a><span style="font-family: &quot;Courier New&quot;">PhyData802_11</span> and the data structure that stores the Physical Layer information for the interface, <span style="font-family: &quot;Courier New&quot;">phyData[phyIndex]</span>.</div>
      <div class="Body"><a name="1000060">Next, Phy802_11Init initializes the antenna model by calling function ANTENNA_Init. Function ANTENNA_Init is implemented in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna.cpp.</div>
      <div class="BodyAfterHead"><a name="1000061">The initialization function of a PHY model also stores the values of parameters that it requires in its operation. These parameters may be default parameters or user-specified configuration parameters. Phy802_11Init sets the default parameters for IEEE 802.11a by calling function Phy802_11aInitializeDefaultParameters. Some configurable parameters are read within Phy802_11Init and the others are read by calling function Phy802_11aSetUserConfigurableParameters. </a></div>
      <div class="Body"><a name="1001280">The configurable parameters are read using IO functions such as IO_ReadBool, IO_ReadInt and IO_ReadDouble to read parameter values from the input file and set the appropriate fields of the PHY model data structure </a><span style="font-family: &quot;Courier New&quot;">PhyData802_11</span>. IO_ReadBool, IO_ReadInt, IO_ReadDouble and other IO functions are defined in <span class="Variable">QUALNET_HOME</span>/include/fileio.h.</div>
      <div class="Body"><a name="1001277">The state variables for the PHY model are also initialized in the initialization function. For example, Phy802_11Init initializes the PHY model status, message buffer, etc.</a></div>
      <div class="Body"><a name="1001324">The initialization function also initializes the channels on which the PHY model can transmit by calling function PHY_SetTransmissionChannel, which is defined in phy.h.</a></div>
      <div class="Code_Segment"><a name="1000065">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001330">void Phy802_11Init(</a></div>
      <div class="Code_Segment"><a name="1001331">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1001332">    const int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1001333">    const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1001334">{</a></div>
      <div class="Code_Segment"><a name="1001335">    BOOL   wasFound;</a></div>
      <div class="Code_Segment"><a name="1001336">    ...</a></div>
      <div class="Code_Segment"><a name="1001341">    PhyData802_11 *phy802_11 =</a></div>
      <div class="Code_Segment"><a name="1001342">        (PhyData802_11 *)MEM_malloc(sizeof(PhyData802_11));</a></div>
      <div class="Code_Segment"><a name="1001344">    memset(phy802_11, 0, sizeof (PhyData802_11));</a></div>
      <div class="Code_Segment"><a name="1025402">    node-&gt;phyData[phyIndex]-&gt;phyVar = (void*)phy802_11;</a></div>
      <div class="Code_Segment"><a name="1001346">    phy802_11-&gt;thisPhy = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1001348">    ...</a></div>
      <div class="Code_Segment"><a name="1001349">    // Antenna model initialization</a></div>
      <div class="Code_Segment"><a name="1001350">    //</a></div>
      <div class="Code_Segment"><a name="1000066">    ANTENNA_Init(node, phyIndex, nodeInput);</a></div>
      <div class="Code_Segment"><a name="1001358">    ...</a></div>
      <div class="Code_Segment"><a name="1001361">    if (node-&gt;phyData[phyIndex]-&gt;phyModel == PHY802_11a) {</a></div>
      <div class="Code_Segment"><a name="1001362">        Phy802_11aInitializeDefaultParameters(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1001363">        Phy802_11aSetUserConfigurableParameters(node, phyIndex, nodeInput);</a></div>
      <div class="Code_Segment"><a name="1001364">    }</a></div>
      <div class="Code_Segment"><a name="1001365">    else if (node-&gt;phyData[phyIndex]-&gt;phyModel == PHY802_11b) {</a></div>
      <div class="Code_Segment"><a name="1001366">        ...</a></div>
      <div class="Code_Segment"><a name="1001359">    }</a></div>
      <div class="Code_Segment"><a name="1001325">    ...</a></div>
      <div class="Code_Segment"><a name="1001373">    IO_ReadBool(</a></div>
      <div class="Code_Segment"><a name="1001377">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1001378">        node-&gt;phyData[phyIndex]-&gt;networkAddress,</a></div>
      <div class="Code_Segment"><a name="1001379">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="1001380">        "PHY802.11-AUTO-RATE-FALLBACK",</a></div>
      <div class="Code_Segment"><a name="1001381">        &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="1001371">        &amp;yes);</a></div>
      <div class="Code_Segment"><a name="1001385">   ...</a></div>
      <div class="Code_Segment"><a name="1001389">    // Initialize status of phy</a></div>
      <div class="Code_Segment"><a name="1001390">    //</a></div>
      <div class="Code_Segment"><a name="1001391">    phy802_11-&gt;rxMsg = NULL;</a></div>
      <div class="Code_Segment"><a name="1001392">    ...</a></div>
      <div class="Code_Segment"><a name="1001402">    phy802_11-&gt;mode = PHY_IDLE;</a></div>
      <div class="Code_Segment"><a name="1025403">    Phy802_11ChangeState(node, phyIndex, PHY_IDLE);</a></div>
      <div class="Code_Segment"><a name="1001405">    //</a></div>
      <div class="Code_Segment"><a name="1001406">    // Setting up the channel to use for both TX and RX</a></div>
      <div class="Code_Segment"><a name="1001407">    //</a></div>
      <div class="Code_Segment"><a name="1001408">    for (i = 0; i &lt; numChannels; i++) {</a></div>
      <div class="Code_Segment"><a name="1001409">        if (phy802_11-&gt;thisPhy-&gt;channelListening[i] == TRUE) {</a></div>
      <div class="Code_Segment"><a name="1001410">            break;</a></div>
      <div class="Code_Segment"><a name="1001411">        }</a></div>
      <div class="Code_Segment"><a name="1001412">    }</a></div>
      <div class="Code_Segment"><a name="1001413">    assert(i != numChannels);</a></div>
      <div class="Code_Segment"><a name="1001414">    PHY_SetTransmissionChannel(node, phyIndex, i);</a></div>
      <div class="Code_Segment"><a name="1001416">    return;</a></div>
      <div class="Code_Segment"><a name="1001417">}</a></div>
      <div class="Figure">FIGURE 4-160.&nbsp;&nbsp;<a name="999516">IEEE 802.11a Initialization Function</a></div>
      <div class="Heading3Numbered">4.6.5.6  <a name="1000109">Implementing the Event Handler</a></div>
      <div class="BodyAfterHead"><a name="1000110">In this section, we describe the steps for implementing the event handler function for a PHY model. </a></div>
      <div class="Body"><a name="1043854">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#933631', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.2</a></span>, when an event occurs, it is first handled by the node level dispatcher function NODE_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/node.cpp. If the event is for the Physical Layer, NODE_ProcessEvent calls the Physical Layer event dispatcher PHY_ProcessEvent, defined in phy.cpp. </div>
      <div class="BodyAfterHead"><a name="1001475">Function PHY_ProcessEvent implements the Physical Layer event dispatcher that informs the appropriate PHY model of received events. Messages contain the index of the interface for which the event has occurred. The API function MESSAGE_GetInstanceId returns the interface index. PHY_ProcessEvent implements a switch statement on the PHY model that is running at the interface read from the message and calls the appropriate model-specific event handler. For example, if IEEE 802.11a is running at the interface, PHY_ProcessEvent calls the IEEE 802.11a event handler function, Phy802_11TransmissionEnd, which is implemented in phy_802_11.cpp.</a></div>
      <div class="Body"><a name="1001569">For the Physical Layer, there is only one event of interest, </a><span style="font-family: &quot;Courier New&quot;">MSG_PHY_TransmissionEnd</span>, which is a timer event. <span style="font-family: &quot;Courier New&quot;">MSG_PHY_TransmissionEnd</span> indicates the end of transmission of a packet by a node. To enable the PHY model PHY_MYPHY to process events, add code to PHY_ProcessEvent to call PHY_MYPHY's event handler function when messages for PHY_MYPHY are received. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1001471', '');" title="Physical Layer">Figure&nbsp;4-161</a></span> shows a code fragment from PHY_ProcessEvent with sample code for calling PHY_MYPHY’s event handler function PhyMyphyTransmissionEnd.</div>
      <div class="Body"><a name="1001701">Write the event handler function PhyMyphyTransmissionEnd to take appropriate actions when the event </a><span style="font-family: &quot;Courier New&quot;">MSG_PHY_TransmissionEnd</span> occurs. Include the prototype for PhyMyphyTransmissionEnd in the header file, phy_myphy.h.</div>
      <div class="Code_Segment"><a name="1001480">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001617">void PHY_ProcessEvent(Node *node, Message *msg) {</a></div>
      <div class="Code_Segment"><a name="1001618">    int phyIndex = MESSAGE_GetInstanceId(msg);</a></div>
      <div class="Code_Segment"><a name="1001619">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001620">   ...</a></div>
      <div class="Code_Segment"><a name="1025408">   switch(node-&gt;phyData[phyIndex]-&gt;phyModel) {</a></div>
      <div class="Code_Segment"><a name="1001621">        case PHY802_11b:</a></div>
      <div class="Code_Segment"><a name="1001622">        case PHY802_11a: {</a></div>
      <div class="Code_Segment"><a name="1001623">            switch (msg-&gt;eventType) {</a></div>
      <div class="Code_Segment"><a name="1001624">                case MSG_PHY_TransmissionEnd: {</a></div>
      <div class="Code_Segment"><a name="1001625">                    Phy802_11TransmissionEnd(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1001626">                    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1001628">                    break;</a></div>
      <div class="Code_Segment"><a name="1001629">                }</a></div>
      <div class="Code_Segment"><a name="1001631">                default: abort();</a></div>
      <div class="Code_Segment"><a name="1001632">            }</a></div>
      <div class="Code_Segment"><a name="1001634">            break;</a></div>
      <div class="Code_Segment"><a name="1001635">        }</a></div>
      <div class="Code_New"><a name="1001637">        case PHY_MYPHY: {</a></div>
      <div class="Code_New"><a name="1001638">            switch (msg-&gt;eventType) {</a></div>
      <div class="Code_New"><a name="1001639">                case MSG_PHY_TransmissionEnd: {</a></div>
      <div class="Code_New"><a name="1001640">                    PhyMyphyTransmissionEnd(node, phyIndex);</a></div>
      <div class="Code_New"><a name="1001641">                    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_New"><a name="1001643">                    break;</a></div>
      <div class="Code_New"><a name="1001644">                }</a></div>
      <div class="Code_New"><a name="1001646">                 default: abort();</a></div>
      <div class="Code_New"><a name="1001647">            }</a></div>
      <div class="Code_New"><a name="1001649">            break;</a></div>
      <div class="Code_New"><a name="1001481">        }</a></div>
      <div class="Code_Segment"><a name="1001657">        ...</a></div>
      <div class="Code_Segment"><a name="1001663">   }</a></div>
      <div class="Code_Segment"><a name="1001664">}</a></div>
      <div class="Figure">FIGURE 4-161.&nbsp;&nbsp;<a name="1001471">Physical Layer Event Dispatcher</a></div>
      <div class="Heading3Numbered">4.6.5.7  <a name="1000135">Modifying Generic Physical Layer Functions</a></div>
      <div class="BodyAfterHead"><a name="1000139">The Physical Layer implements several generic functions that are called by MAC protocols or by communication media models. These generic functions, in turn, call the function for the PHY model that is running at the interface. For example, a MAC protocol sends a packet to the Physical Layer by calling function PHY_StartTransmittingSignal. PHY_StartTransmittingSignal, in turn, calls the function for the PHY model running at the interface. If IEEE 802.11a is running at the interface, PHY_StartTransmittingSignal calls function Phy802_11StartTransmittingSignal. </a></div>
      <div class="Body"><a name="1001903">To add the new PHY model, PHY_MYPHY, to </a><span class="Variable">QualNet</span>, these generic Physical Layer functions should be modified so that the appropriate PHY_MYPHY function is called when PHY_MYPHY is running at the interface. As an example, <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1001865', '');" title="Physical Layer">Figure&nbsp;4-162</a></span> shows the modifications required for function PHY_StartTransmitingSignal, where PhyMyphyStartTransmittingSignal is the MYPHY function that transmits a packet received from the MAC Layer.</div>
      <div class="Code_Segment"><a name="1001928">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001963">void PHY_StartTransmittingSignal(</a></div>
      <div class="Code_Segment"><a name="1001929">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1001930">    int phyNum,</a></div>
      <div class="Code_Segment"><a name="1001931">    Message *msg,</a></div>
      <div class="Code_Segment"><a name="1001932">    BOOL useMacLayerSpecifiedDelay,</a></div>
      <div class="Code_Segment"><a name="1075492">    clocktype delayUntilAirborne,</a></div>
      <div class="Code_Segment"><a name="1001933">    NodeAddress destAddr)</a></div>
      <div class="Code_Segment"><a name="1001934">{</a></div>
      <div class="Code_Segment"><a name="1025409">    ...</a></div>
      <div class="Code_Segment"><a name="1001935">    switch(node-&gt;phyData[phyNum]-&gt;phyModel) {</a></div>
      <div class="Code_Segment"><a name="1001936">        case PHY802_11b:</a></div>
      <div class="Code_Segment"><a name="1001937">        case PHY802_11a: {</a></div>
      <div class="Code_Segment"><a name="1001938">            Phy802_11StartTransmittingSignal(</a></div>
      <div class="Code_Segment"><a name="1001939">                node, phyNum, msg,</a></div>
      <div class="Code_Segment"><a name="1001940">                useMacLayerSpecifiedDelay, delayUntilAirborne);</a></div>
      <div class="Code_Segment"><a name="1001942">            break;</a></div>
      <div class="Code_Segment"><a name="1001943">        }</a></div>
      <div class="Code_New"><a name="1001945">        case PHY_MYPHY: {</a></div>
      <div class="Code_New"><a name="1001946">            PhyMyphyStartTransmittingSignal(</a></div>
      <div class="Code_New"><a name="1001947">                node, phyNum, msg,</a></div>
      <div class="Code_New"><a name="1001948">                useMacLayerSpecifiedDelay, delayUntilAirborne);</a></div>
      <div class="Code_New"><a name="1001950">            break;</a></div>
      <div class="Code_New"><a name="1001923">        }</a></div>
      <div class="Code_Segment"><a name="1001861">        ...</a></div>
      <div class="Code_Segment"><a name="1001862">   }</a></div>
      <div class="Code_Segment"><a name="1001863">}</a></div>
      <div class="Figure">FIGURE 4-162.&nbsp;&nbsp;<a name="1001865">Modifying a Generic Physical Layer Function</a></div>
      <div class="Body"><a name="1001831">The generic Physical Layer functions that need to be modified are listed below. Depending upon the functionality of the new PHY model being added, not all these functions may need to be modified, or additional functions may need to be written.</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1001979">PHY_StartTransmittingSignal</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001986">PHY_GetStatus</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001987">PHY_SignalArrivalFromChannel</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001988">PHY_SignalEndFromChannel</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001989">PHY_GetTxDataRate</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001990">PHY_GetRxDataRate</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001993">PHY_SetTxDataRateType</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001994">PHY_GetRxDataRateType</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001995">PHY_GetTxDataRateType</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001996">PHY_SetLowestTxDataRateType</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001999">PHY_GetLowestTxDataRateType</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002009">PHY_SetHighestTxDataRateType</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002015">PHY_GetHighestTxDataRateType</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002021">PHY_SetHighestTxDataRateTypeForBC</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002022">PHY_GetHighestTxDataRateTypeForBC</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001997">PHY_GetTransmissionDuration</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">17.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002029">PHY_SetTransmitPower</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">18.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002032">PHY_GetTransmitPower</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">19.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002030">PHY_GetLastSignalsAngleOfArrival</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">20.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002037">PHY_TerminateCurrentReceive</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">21.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002038">PHY_StartTransmittingSignalDirectionally</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">22.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002039">PHY_LockAntennaDirection</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">23.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002040">PHY_UnlockAntennaDirection</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">24.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002041">PHY_MediumIsIdle</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">25.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002042">PHY_MediumIsIdleInDirection</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">26.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002052">PHY_SetSensingDirection</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">27.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002053">PHY_PropagationRange</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1001805">The modifications to these functions are similar to the modifications shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1001865', '');" title="Physical Layer">Figure&nbsp;4-162</a></span>.</div>
      <div class="Heading3Numbered">4.6.5.8  <a name="1002177">Interfacing with MAC Layer and Communication Medium</a></div>
      <div class="BodyAfterHead"><a name="1002200">A PHY model interacts with a wireless MAC protocol in the following ways:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1002205">When the MAC protocol is ready to transmit a packet, it sends the packet to the Physical Layer. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002403', '');" title="Physical Layer">Section&nbsp;4.6.5.8.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002209">When the Physical Layer receives a packet from another node, it sends it to the MAC Layer. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002637', '');" title="Physical Layer">Section&nbsp;4.6.5.8.2</a></span>. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002255">When the status of the Physical Layer changes, the Physical Layer notifies the MAC Layer of the status change. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002637', '');" title="Physical Layer">Section&nbsp;4.6.5.8.2</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002367">The Physical Layer implements several utility functions for use by MAC protocols to perform various tasks, such as locking or unlocking the antenna, setting and retrieving data rates, getting the transmission duration, etc. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000135', '');" title="Physical Layer">Section&nbsp;4.6.5.7</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1002266">A PHY model interacts with a communication medium model in the following ways:</a></div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="1002321">When the PHY model has a packet to send, it adds a Physical Layer header and sends the packet to the communication medium. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002403', '');" title="Physical Layer">Section&nbsp;4.6.5.8.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002325">The communication medium indicates to the PHY model the beginning and end of a transmission from another node. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002637', '');" title="Physical Layer">Section&nbsp;4.6.5.8.2</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading4Numbered">4.6.5.8.1  <a name="1002403"> Processing Outgoing Packets</a></div>
      <div class="BodyAfterHead"><a name="1002404">When a MAC protocol has a packet to send to the Physical Layer, the MAC protocol calls function PHY_StartTransmittingSignal. PHY_StartTransmittingSignal calls the transmit function of the PHY model running at the interface to process the packet from the MAC Layer. For example, if IEEE 802.11a is running at the interface, PHY_StartTransmittingSignal calls the IEEE 802.11a function Phy802_11StartTransmittingSignal (see.</a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000135', '');" title="Physical Layer">Section&nbsp;4.6.5.7</a></span>). </div>
      <div class="Body"><a name="1002408">Phy802_11StartTransmittingSignal calls the IEEE 802.11a function StartTransmittingSignal to transmit a packet. StartTransmittingSignal and the other IEEE 802.11a functions are implemented in phy_802_11.cpp. StartTransmittingSignal performs the following tasks (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002971', '');" title="Physical Layer">Figure&nbsp;4-163</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002400', '');" title="Physical Layer">Figure&nbsp;4-164</a></span>):</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002885">StartTransmittingSignal calls function PHY_GetTransmissionChannel to get the index of the channel on which to transmit the signal. PHY_GetTransmissionChannel is defined in phy.h.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002889">If PHY is currently receiving a signal, i.e., the status of PHY is </a><span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span>, the PHY model updates the interference power, and resets the receive parameters by calling Phy802_11UnlockSignal.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002893">StartTransmittingSignal changes the status of PHY to </a><span style="font-family: &quot;Courier New&quot;">PHY_TRANSMITTING</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002905">StartTransmittingSignal calculates the transmission duration of the packet by calling Phy802_11GetFrameDuration, and adds a Physical Layer header to the packet by calling MESSAGE_AddHeader.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002910">StartTransmittingSignal calls function PHY_StopListeningToChannel to stop receiving on the channel.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002915">StartTransmittingSignal calls the communication medium function PROP_ReleaseSignal to transmit the packet. PROP_ReleaseSignal is defined in </a><span class="Variable">QUALNET_HOME</span>/include/propagation.h.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002920">StartTransmittingSignal schedules a self-timer of type </a><span style="font-family: &quot;Courier New&quot;">MSG_PHY_TransmissionEnd</span> to indicate the end of transmission of the packet.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1002412">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1002486">static</a></div>
      <div class="Code_Segment"><a name="1002487">void StartTransmittingSignal(</a></div>
      <div class="Code_Segment"><a name="1002488">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1002489">    int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1002490">    Message* packet,</a></div>
      <div class="Code_Segment"><a name="1002491">    BOOL useMacLayerSpecifiedDelay,</a></div>
      <div class="Code_Segment"><a name="1002492">    clocktype initDelayUntilAirborne,</a></div>
      <div class="Code_Segment"><a name="1002493">    BOOL sendDirectionally,</a></div>
      <div class="Code_Segment"><a name="1002494">    double azimuthAngle)</a></div>
      <div class="Code_Segment"><a name="1002495">{</a></div>
      <div class="Code_Segment"><a name="1002496">    ...</a></div>
      <div class="Code_Segment"><a name="1075508">    clocktype delayUntilAirborne = initDelayUntilAirborne;</a></div>
      <div class="Code_Segment"><a name="1002497">    PhyData* thisPhy = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1002498">    PhyData802_11* phy802_11 = (PhyData802_11 *)thisPhy-&gt;phyVar;</a></div>
      <div class="Code_Segment"><a name="1002499">    int channelIndex;</a></div>
      <div class="Code_Segment"><a name="1002500">    Message *endMsg;</a></div>
      <div class="Code_Segment"><a name="1002501">    int packetsize = MESSAGE_ReturnPacketSize(packet);</a></div>
      <div class="Code_Segment"><a name="1002502">    clocktype duration;</a></div>
      <div class="Code_Segment"><a name="1002504">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1002438">    PHY_GetTransmissionChannel(node, phyIndex, &amp;channelIndex);</a></div>
      <div class="Code_Segment"><a name="1007861">    ...</a></div>
      <div class="Code_Segment"><a name="1007862">    if (phy802_11-&gt;mode == PHY_RECEIVING) {</a></div>
      <div class="Code_Segment"><a name="1007863">        if (thisPhy-&gt;antennaModel == ANTENNA_OMNIDIRECTIONAL) {</a></div>
      <div class="Code_Segment"><a name="1002513">            phy802_11-&gt;interferencePower_mW += phy802_11-&gt;rxMsgPower_mW;</a></div>
      <div class="Code_Segment"><a name="1002514">        }</a></div>
      <div class="Code_Segment"><a name="1002515">        else {</a></div>
      <div class="Code_Segment"><a name="1002516">            if (!sendDirectionally) {</a></div>
      <div class="Code_Segment"><a name="1002517">               ANTENNA_SetToDefaultMode(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1002518">            }//if//</a></div>
      <div class="Code_Segment"><a name="1002519">            ...</a></div>
      <div class="Code_Segment"><a name="1002527">            PHY_SignalInterference(</a></div>
      <div class="Code_Segment"><a name="1002528">                node,</a></div>
      <div class="Code_Segment"><a name="1002529">                phyIndex,</a></div>
      <div class="Code_Segment"><a name="1002530">                channelIndex,</a></div>
      <div class="Code_Segment"><a name="1002531">                NULL,</a></div>
      <div class="Code_Segment"><a name="1002532">                NULL,</a></div>
      <div class="Code_Segment"><a name="1002533">                &amp;(phy802_11-&gt;interferencePower_mW));</a></div>
      <div class="Code_Segment"><a name="1002534">        }</a></div>
      <div class="Code_Segment"><a name="1002535">        Phy802_11UnlockSignal(phy802_11);</a></div>
      <div class="Code_Segment"><a name="1002536">    }</a></div>
      <div class="Code_Segment"><a name="1006704">    Phy802_11ChangeState(node, phyIndex, PHY_TRANSMITTING);</a></div>
      <div class="Code_Segment"><a name="1006719">    ...</a></div>
      <div class="Code_Segment"><a name="1006726">}</a></div>
      <div class="Figure">FIGURE 4-163.&nbsp;&nbsp;<a name="1002971">Processing Outgoing Packets: Calculating Interference Power</a></div>
      <div class="Code_Segment"><a name="1002934">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1002935">static</a></div>
      <div class="Code_Segment"><a name="1002936">void StartTransmittingSignal(</a></div>
      <div class="Code_Segment"><a name="1002937">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1002938">    ...</a></div>
      <div class="Code_Segment"><a name="1002966">    BOOL sendDirectionally,</a></div>
      <div class="Code_Segment"><a name="1002943">    double azimuthAngle)</a></div>
      <div class="Code_Segment"><a name="1002944">{</a></div>
      <div class="Code_Segment"><a name="1002951">    ...</a></div>
      <div class="Code_Segment"><a name="1025415">    Phy802_11ChangeState(node, phyIndex, PHY_TRANSMITTING);</a></div>
      <div class="Code_Segment"><a name="1002541">    duration =</a></div>
      <div class="Code_Segment"><a name="1002542">        Phy802_11GetFrameDuration(</a></div>
      <div class="Code_Segment"><a name="1002543">            thisPhy, phy802_11-&gt;txDataRateType, packetsize);</a></div>
      <div class="Code_Segment"><a name="1002545">    MESSAGE_AddHeader(node, packet, sizeof(Phy802_11PlcpHeader),</a></div>
      <div class="Code_Segment"><a name="1002546">                      TRACE_802_11);</a></div>
      <div class="Code_Segment"><a name="1002548">    char* plcpl = MESSAGE_ReturnPacket(packet);</a></div>
      <div class="Code_Segment"><a name="1002509">    memcpy(plcpl, &amp;phy802_11-&gt;txDataRateType, sizeof(int));</a></div>
      <div class="Code_Segment"><a name="1002566">    ...</a></div>
      <div class="Code_Segment"><a name="1002567">    PHY_StopListeningToChannel(node, phyIndex, channelIndex);</a></div>
      <div class="Code_Segment"><a name="1002572">    ...</a></div>
      <div class="Code_Segment"><a name="1002575">    if (AntennaIsInOmnidirectionalMode(node, phyIndex)) {</a></div>
      <div class="Code_Segment"><a name="1002578">        PROP_ReleaseSignal(</a></div>
      <div class="Code_Segment"><a name="1002579">            node,</a></div>
      <div class="Code_Segment"><a name="1002580">            packet,</a></div>
      <div class="Code_Segment"><a name="1002581">            phyIndex,</a></div>
      <div class="Code_Segment"><a name="1002582">            channelIndex,</a></div>
      <div class="Code_Segment"><a name="1002583">            phy802_11-&gt;txPower_dBm,</a></div>
      <div class="Code_Segment"><a name="1002584">            duration,</a></div>
      <div class="Code_Segment"><a name="1002585">            delayUntilAirborne);</a></div>
      <div class="Code_Segment"><a name="1002586">    } else {</a></div>
      <div class="Code_Segment"><a name="1002589">        PROP_ReleaseSignal(</a></div>
      <div class="Code_Segment"><a name="1002590">            node,</a></div>
      <div class="Code_Segment"><a name="1002591">            packet,</a></div>
      <div class="Code_Segment"><a name="1002592">            phyIndex,</a></div>
      <div class="Code_Segment"><a name="1002593">            channelIndex,</a></div>
      <div class="Code_Segment"><a name="1002594">            (float)(phy802_11-&gt;txPower_dBm -</a></div>
      <div class="Code_Segment"><a name="1002595">             phy802_11-&gt;directionalAntennaGain_dB),</a></div>
      <div class="Code_Segment"><a name="1002596">            duration,</a></div>
      <div class="Code_Segment"><a name="1002597">            delayUntilAirborne);</a></div>
      <div class="Code_Segment"><a name="1002573">    }//if//</a></div>
      <div class="Code_Segment"><a name="1002602">    ...</a></div>
      <div class="Code_Segment"><a name="1002605">    endMsg = MESSAGE_Alloc(node,</a></div>
      <div class="Code_Segment"><a name="1002606">                            PHY_LAYER,</a></div>
      <div class="Code_Segment"><a name="1002607">                            0,</a></div>
      <div class="Code_Segment"><a name="1002608">                            MSG_PHY_TransmissionEnd);</a></div>
      <div class="Code_Segment"><a name="1002610">    MESSAGE_SetInstanceId(endMsg, (short) phyIndex);</a></div>
      <div class="Code_Segment"><a name="1002611">    MESSAGE_Send(node, endMsg, delayUntilAirborne + duration + 1);</a></div>
      <div class="Code_Segment"><a name="1002612">    ...</a></div>
      <div class="Code_Segment"><a name="1002603">}</a></div>
      <div class="Figure">FIGURE 4-164.&nbsp;&nbsp;<a name="1002400">Processing Outgoing Packets: Sending Packet to Communication Medium</a></div>
      <div class="Heading4Numbered">4.6.5.8.2  <a name="1002637">Processing Incoming Packets</a></div>
      <div class="BodyAfterHead"><a name="1002638">When the PHY model at a node transmits a packet, it calls the communication medium function PROP_ReleaseSignal (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002403', '');" title="Physical Layer">Section&nbsp;4.6.5.8.1</a></span>). Based on the relative positions of the nodes and the transmission parameters, such as transmit power, antenna gain, and data rate, the communication medium determines which nodes can receive the signal. For each of the neighbor nodes that can receive the signal transmitted by a node, the communication medium makes two function calls: function PHY_SignalArrivalFromChannel to indicate the start of a packet, and function PHY_SignalEndFromChannel to indicate the end of a packet.</div>
      <div class="Body"><a name="1004151">PHY_SignalArrivalFromChannel and PHY_SignalEndFromChannel call the functions for the PHY model running at the interface (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000135', '');" title="Physical Layer">Section&nbsp;4.6.5.7</a></span>). For example, if IEEE 802.11a is running at the interface, PHY_SignalArrivalFromChannel calls the function Phy802_11SignalArrivalFromChannel, and PHY_SignalEndFromChannel calls the function Phy802_11SignalEndFromChannel.</div>
      <div class="Body"><a name="1004152">Phy802_11SignalArrivalFromChannel, shown in </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1002634', '');" title="Physical Layer">Figure&nbsp;4-165</a> and <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1003258', '');" title="Physical Layer">Figure&nbsp;4-166</a>, performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004190">If the PHY model status is </a><span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span>, i.e., the node is already receiving another signal, Phy802_11SignalArrivalFromChannel calculates the receive power and determines if there are any errors in the portion of the packet received so far by calling function Phy802_11CheckRxPacketError. Phy802_11SignalArrivalFromChannel then adds the receive power to the interference power.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004207">If the PHY model status is </a><span style="font-family: &quot;Courier New&quot;">PHY_IDLE</span> or <span style="font-family: &quot;Courier New&quot;">PHY_SENSING</span>, Phy802_11SignalArrivalFromChannel calculates the interference power and received power.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004266">If the received power is greater than the receiver sensitivity, Phy802_11SignalArrivalFromChannel locks on to the signal by calling Phy802_11LockSignal, changes status to </a><span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span>, and informs the MAC Layer of the status change by calling Phy802_11ReportExtendedStatusToMac.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004289">If the received power is less than the receiver sensitivity, Phy802_11SignalArrivalFromChannel calls function Phy802_11CarrierSensing to determine if the signal strength is high enough to trigger a status change. If a status change is triggered, Phy802_11SignalArrivalFromChannel updates the status and informs the MAC Layer of the status change by calling Phy802_11ReportStatusToMac.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1002648">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1002996">void Phy802_11SignalArrivalFromChannel(</a></div>
      <div class="Code_Segment"><a name="1002997">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1002998">    int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1002999">    int channelIndex,</a></div>
      <div class="Code_Segment"><a name="1003000">    PropRxInfo *propRxInfo)</a></div>
      <div class="Code_Segment"><a name="1003001">{</a></div>
      <div class="Code_Segment"><a name="1003002">    PhyData *thisPhy = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1003003">    PhyData802_11* phy802_11 = (PhyData802_11*) thisPhy-&gt;phyVar;</a></div>
      <div class="Code_Segment"><a name="1003004">    assert(phy802_11-&gt;mode != PHY_TRANSMITTING);</a></div>
      <div class="Code_Segment"><a name="1003005">    ...</a></div>
      <div class="Code_Segment"><a name="1003006">    switch (phy802_11-&gt;mode) {</a></div>
      <div class="Code_Segment"><a name="1003007">        case PHY_RECEIVING: {</a></div>
      <div class="Code_Segment"><a name="1075515">            double rxPower_mW =</a></div>
      <div class="Code_Segment"><a name="1075516">                NON_DB(ANTENNA_GainForThisSignal(node, phyIndex, propRxInfo) +</a></div>
      <div class="Code_Segment"><a name="1075517">                       propRxInfo-&gt;rxPower_dBm);</a></div>
      <div class="Code_Segment"><a name="1003011">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1003012">            if (!phy802_11-&gt;rxMsgError) {</a></div>
      <div class="Code_Segment"><a name="1003013">               phy802_11-&gt;rxMsgError =</a></div>
      <div class="Code_Segment"><a name="1003014">                  Phy802_11CheckRxPacketError(node, phy802_11, NULL);</a></div>
      <div class="Code_Segment"><a name="1003015">            }//if//</a></div>
      <div class="Code_Segment"><a name="1003016">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1003017">            phy802_11-&gt;rxTimeEvaluated = getSimTime(node);</a></div>
      <div class="Code_Segment"><a name="1003018">            phy802_11-&gt;interferencePower_mW += rxPower_mW;</a></div>
      <div class="Code_Segment"><a name="1003019">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1003020">            break;</a></div>
      <div class="Code_Segment"><a name="1003021">        }</a></div>
      <div class="Code_Segment"><a name="1004039">        case PHY_IDLE:</a></div>
      <div class="Code_Segment"><a name="1004040">        case PHY_SENSING:</a></div>
      <div class="Code_Segment"><a name="1004041">        {</a></div>
      <div class="Code_Segment"><a name="1003022">           ...</a></div>
      <div class="Code_Segment"><a name="1004048">        }</a></div>
      <div class="Code_Segment"><a name="1004058">        default:</a></div>
      <div class="Code_Segment"><a name="1004056">            abort();</a></div>
      <div class="Code_Segment"><a name="1003023">         }//switch (phy802_11-&gt;mode)//</a></div>
      <div class="Code_Segment"><a name="1003113">}</a></div>
      <div class="Figure">FIGURE 4-165.&nbsp;&nbsp;<a name="1002634">Processing Start of Incoming Signal in </a><span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span> Mode</div>
      <div class="Code_Segment"><a name="1003137">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1003355">void Phy802_11SignalArrivalFromChannel(...)</a></div>
      <div class="Code_Segment"><a name="1003360">{</a></div>
      <div class="Code_Segment"><a name="1003144">    ...</a></div>
      <div class="Code_Segment"><a name="1003148">    switch (phy802_11-&gt;mode) {</a></div>
      <div class="Code_Segment"><a name="1003149">        ...</a></div>
      <div class="Code_Segment"><a name="1003284">        case PHY_IDLE:</a></div>
      <div class="Code_Segment"><a name="1003170">        case PHY_SENSING:</a></div>
      <div class="Code_Segment"><a name="1003171">        {</a></div>
      <div class="Code_Segment"><a name="1003172">            double rxInterferencePower_mW = NON_DB(</a></div>
      <div class="Code_Segment"><a name="1003173">                ANTENNA_GainForThisSignal(node, phyIndex, propRxInfo) +</a></div>
      <div class="Code_Segment"><a name="1003174">                propRxInfo-&gt;rxPower_dBm);</a></div>
      <div class="Code_Segment"><a name="1003175">            double rxPowerInOmni_mW = NON_DB(</a></div>
      <div class="Code_Segment"><a name="1003176">                ANTENNA_DefaultGainForThisSignal(node, phyIndex, propRxInfo) +</a></div>
      <div class="Code_Segment"><a name="1003177">                propRxInfo-&gt;rxPower_dBm);</a></div>
      <div class="Code_Segment"><a name="1003179">            </a></div>
      <div class="Code_Segment"><a name="1003182">            if (rxPowerInOmni_mW &gt;= phy802_11-&gt;rxSensitivity_mW[0]) {</a></div>
      <div class="Code_Segment"><a name="1003183">                PropTxInfo *propTxInfo</a></div>
      <div class="Code_Segment"><a name="1003184">                    = (PropTxInfo *)MESSAGE_ReturnInfo(propRxInfo-&gt;txMsg);</a></div>
      <div class="Code_Segment"><a name="1003186">                ...</a></div>
      <div class="Code_Segment"><a name="1076010">                if (!AntennaIsLocked(node, phyIndex)) {</a></div>
      <div class="Code_Segment"><a name="1076011">                   ANTENNA_SetToBestGainConfigurationForThisSignal(</a></div>
      <div class="Code_Segment"><a name="1076012">                       node, phyIndex, propRxInfo);</a></div>
      <div class="Code_Segment"><a name="1003192">                   PHY_SignalInterference(...);</a></div>
      <div class="Code_Segment"><a name="1003199">                } </a></div>
      <div class="Code_Segment"><a name="1004133">                else {</a></div>
      <div class="Code_Segment"><a name="1003201">                    rxPower_mW = rxInterferencePower_mW;</a></div>
      <div class="Code_Segment"><a name="1003202">                }</a></div>
      <div class="Code_Segment"><a name="1003204">                Phy802_11LockSignal(...);</a></div>
      <div class="Code_Segment"><a name="1003213">                Phy802_11ChangeState(node, phyIndex, PHY_RECEIVING);</a></div>
      <div class="Code_Segment"><a name="1003214">                Phy802_11ReportExtendedStatusToMac(...);</a></div>
      <div class="Code_Segment"><a name="1003220">            } </a></div>
      <div class="Code_Segment"><a name="1004134">            else {</a></div>
      <div class="Code_Segment"><a name="1003222">                PhyStatusType newMode;</a></div>
      <div class="Code_Segment"><a name="1003228">                phy802_11-&gt;interferencePower_mW += rxInterferencePower_mW;</a></div>
      <div class="Code_Segment"><a name="1003230">                if (Phy802_11CarrierSensing(node, phy802_11)) {</a></div>
      <div class="Code_Segment"><a name="1003231">                   newMode = PHY_SENSING;</a></div>
      <div class="Code_Segment"><a name="1003232">                } else {</a></div>
      <div class="Code_Segment"><a name="1003233">                   newMode = PHY_IDLE;</a></div>
      <div class="Code_Segment"><a name="1003234">                }//if//</a></div>
      <div class="Code_Segment"><a name="1003236">                if (newMode != phy802_11-&gt;mode) {</a></div>
      <div class="Code_Segment"><a name="1025439">                    Phy802_11ChangeState(node, phyIndex, newMode);</a></div>
      <div class="Code_Segment"><a name="1003239">                    Phy802_11ReportStatusToMac(node, phyIndex, newMode);</a></div>
      <div class="Code_Segment"><a name="1003244">                }//if//</a></div>
      <div class="Code_Segment"><a name="1003245">            }//if//</a></div>
      <div class="Code_Segment"><a name="1003248">            break;</a></div>
      <div class="Code_Segment"><a name="1003249">        }</a></div>
      <div class="Code_Segment"><a name="1003250">        ...</a></div>
      <div class="Code_Segment"><a name="1003254">    }//switch (phy802_11-&gt;mode)//</a></div>
      <div class="Code_Segment"><a name="1003255">}</a></div>
      <div class="Figure">FIGURE 4-166.&nbsp;&nbsp;<a name="1003258">Processing Start of Incoming Signal in </a><span style="font-family: &quot;Courier New&quot;">PHY_IDLE</span> and <span style="font-family: &quot;Courier New&quot;">PHY_SENSING</span> Modes</div>
      <div class="Body"><a name="1004341">Phy802_11SignalEndFromChannel, shown in </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1003958', '');" title="Physical Layer">Figure&nbsp;4-167</a> and <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004552', '');" title="Physical Layer">Figure&nbsp;4-168</a>, performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004342">Phy802_11SignalEndFromChannel checks if there are any errors in the received packet by calling Phy802_11CheckRxPacketError.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004359">If the PHY model status is </a><span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span> and the received signal is the one that the PHY model had locked on to, Phy802_11SignalEndFromChannel stops receiving the signal and calls Phy802_11UnlockSignal.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004372">Phy802_11SignalEndFromChannel calls Phy802_11CarrierSensing and changes the PHY model status to </a><span style="font-family: &quot;Courier New&quot;">PHY_SENSING</span> or <span style="font-family: &quot;Courier New&quot;">PHY_IDLE</span> depending on the interference power.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1043857">If the packet was received without any errors, Phy802_11SignalEndFromChannel removes the Physical Layer header and sends the packet to the MAC Layer by calling MAC_ReceicePacketFromPhy. MAC_ReceicePacketFromPhy is implemented in </a><span class="Variable">QUALNET_HOME</span>/main/mac.cpp.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004390">If the packet was received with errors, Phy802_11SignalEndFromChannel reports the status change to the MAC Layer by calling Phy802_11ReportStatusToMac and drops the packet.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004399">If the PHY model status is not </a><span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span> or the received signal is not the one that the PHY model had locked on to, Phy802_11SignalEndFromChannel updates the interference power. If the PHY model status is not <span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span>, Phy802_11SignalEndFromChannel calls Phy802_11CarrierSensing and changes the PHY model status to <span style="font-family: &quot;Courier New&quot;">PHY_SENSING</span> or <span style="font-family: &quot;Courier New&quot;">PHY_IDLE</span> depending on the interference power.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004423">If the PHY model status changes, Phy802_11SignalEndFromChannel reports the status change to the MAC Layer by calling Phy802_11ReportStatusToMac.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1003906">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1003907">void Phy802_11SignalEndFromChannel(</a></div>
      <div class="Code_Segment"><a name="1003908">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1003909">    int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1003910">    int channelIndex,</a></div>
      <div class="Code_Segment"><a name="1003911">    PropRxInfo *propRxInfo)</a></div>
      <div class="Code_Segment"><a name="1003912">{</a></div>
      <div class="Code_Segment"><a name="1003913">    PhyData *thisPhy = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1003914">    PhyData802_11* phy802_11 = (PhyData802_11*) thisPhy-&gt;phyVar;</a></div>
      <div class="Code_Segment"><a name="1003915">    double sinr = -1.0;</a></div>
      <div class="Code_Segment"><a name="1025446">    BOOL receiveErrorOccurred = FALSE;</a></div>
      <div class="Code_Segment"><a name="1003916">    ...</a></div>
      <div class="Code_Segment"><a name="1076084">    assert(phy802_11-&gt;mode != PHY_TRANSMITTING);</a></div>
      <div class="Code_Segment"><a name="1003917">    if (phy802_11-&gt;mode == PHY_RECEIVING) {</a></div>
      <div class="Code_Segment"><a name="1003918">        if (phy802_11-&gt;rxMsgError == FALSE) {</a></div>
      <div class="Code_Segment"><a name="1003919">            phy802_11-&gt;rxMsgError =</a></div>
      <div class="Code_Segment"><a name="1003920">                Phy802_11CheckRxPacketError(node, phy802_11, &amp;sinr);</a></div>
      <div class="Code_Segment"><a name="1003921">            phy802_11-&gt;rxTimeEvaluated = getSimTime(node);</a></div>
      <div class="Code_Segment"><a name="1003922">        }//if</a></div>
      <div class="Code_Segment"><a name="1003923">    }//if//</a></div>
      <div class="Code_Segment"><a name="1003924">   receiveErrorOccurred = phy802_11-&gt;rxMsgError;</a></div>
      <div class="Code_Segment"><a name="1003925">    // If the phy is still receiving this signal, forward the frame</a></div>
      <div class="Code_Segment"><a name="1003926">    // to the MAC layer.</a></div>
      <div class="Code_Segment"><a name="1003927">    if ((phy802_11-&gt;mode == PHY_RECEIVING) &amp;&amp;</a></div>
      <div class="Code_Segment"><a name="1003928">        (phy802_11-&gt;rxMsg == propRxInfo-&gt;txMsg))</a></div>
      <div class="Code_Segment"><a name="1003929">    {</a></div>
      <div class="Code_Segment"><a name="1003930">        ...</a></div>
      <div class="Code_Segment"><a name="1003931">    }</a></div>
      <div class="Code_Segment"><a name="1003932">    else {</a></div>
      <div class="Code_Segment"><a name="1003933">        PhyStatusType newMode;</a></div>
      <div class="Code_Segment"><a name="1003934">        double rxPower_mW =</a></div>
      <div class="Code_Segment"><a name="1003935">            NON_DB(ANTENNA_GainForThisSignal(node, phyIndex, propRxInfo) +</a></div>
      <div class="Code_Segment"><a name="1003936">                   propRxInfo-&gt;rxPower_dBm);</a></div>
      <div class="Code_Segment"><a name="1003937">        phy802_11-&gt;interferencePower_mW -= rxPower_mW;</a></div>
      <div class="Code_Segment"><a name="1003938">        if (phy802_11-&gt;interferencePower_mW &lt; 0.0) {</a></div>
      <div class="Code_Segment"><a name="1003939">            phy802_11-&gt;interferencePower_mW = 0.0;</a></div>
      <div class="Code_Segment"><a name="1003940">        }</a></div>
      <div class="Code_Segment"><a name="1003941">        if (phy802_11-&gt;mode != PHY_RECEIVING) {</a></div>
      <div class="Code_Segment"><a name="1003942">           if (Phy802_11CarrierSensing(node, phy802_11) == TRUE) {</a></div>
      <div class="Code_Segment"><a name="1003943">               newMode = PHY_SENSING;</a></div>
      <div class="Code_Segment"><a name="1003944">           } else {</a></div>
      <div class="Code_Segment"><a name="1003945">               newMode = PHY_IDLE;</a></div>
      <div class="Code_Segment"><a name="1003946">           }//if//</a></div>
      <div class="Code_Segment"><a name="1003947">           if (newMode != phy802_11-&gt;mode) {</a></div>
      <div class="Code_Segment"><a name="1025455">               Phy802_11ChangeState(node, phyIndex, newMode);</a></div>
      <div class="Code_Segment"><a name="1003950">               Phy802_11ReportStatusToMac(</a></div>
      <div class="Code_Segment"><a name="1003951">                   node,</a></div>
      <div class="Code_Segment"><a name="1003952">                   phyIndex,</a></div>
      <div class="Code_Segment"><a name="1003953">                   newMode);</a></div>
      <div class="Code_Segment"><a name="1003954">           }//if//</a></div>
      <div class="Code_Segment"><a name="1003955">        }//if//</a></div>
      <div class="Code_Segment"><a name="1003956">    }//if//</a></div>
      <div class="Code_Segment"><a name="1003957">}</a></div>
      <div class="Figure">FIGURE 4-167.&nbsp;&nbsp;<a name="1003958">Processing End of Incoming Signal in Non-receiving Mode</a></div>
      <div class="Code_Segment"><a name="1003397">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1003476">void Phy802_11SignalEndFromChannel(...)</a></div>
      <div class="Code_Segment"><a name="1003874">{</a></div>
      <div class="Code_Segment"><a name="1076091">    ...</a></div>
      <div class="Code_Segment"><a name="1003883">    assert(phy802_11-&gt;mode != PHY_TRANSMITTING);</a></div>
      <div class="Code_Segment"><a name="1003884">    if (phy802_11-&gt;mode == PHY_RECEIVING) {</a></div>
      <div class="Code_Segment"><a name="1003885">        if (phy802_11-&gt;rxMsgError == FALSE) {</a></div>
      <div class="Code_Segment"><a name="1003886">            phy802_11-&gt;rxMsgError =</a></div>
      <div class="Code_Segment"><a name="1003887">                Phy802_11CheckRxPacketError(node, phy802_11, &amp;sinr);</a></div>
      <div class="Code_Segment"><a name="1003888">            phy802_11-&gt;rxTimeEvaluated = getSimTime(node);</a></div>
      <div class="Code_Segment"><a name="1003889">        }//if</a></div>
      <div class="Code_Segment"><a name="1003890">    }//if//</a></div>
      <div class="Code_Segment"><a name="1003497">    receiveErrorOccurred = phy802_11-&gt;rxMsgError;</a></div>
      <div class="Code_Segment"><a name="1003504">    if ((phy802_11-&gt;mode == PHY_RECEIVING) &amp;&amp;</a></div>
      <div class="Code_Segment"><a name="1003505">        (phy802_11-&gt;rxMsg == propRxInfo-&gt;txMsg))</a></div>
      <div class="Code_Segment"><a name="1003506">    {</a></div>
      <div class="Code_Segment"><a name="1076043">        Message *newMsg;</a></div>
      <div class="Code_Segment"><a name="1076044">        if (!ANTENNA_IsLocked(node, phyIndex)) {</a></div>
      <div class="Code_Segment"><a name="1076045">            ANTENNA_SetToDefaultMode(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1003803">            ...</a></div>
      <div class="Code_Segment"><a name="1003518">            PHY_SignalInterference(node, phyIndex, channelIndex, NULL,</a></div>
      <div class="Code_Segment"><a name="1003523">                                   NULL, &amp;(phy802_11-&gt;interferencePower_mW));</a></div>
      <div class="Code_Segment"><a name="1003525">        }//if//</a></div>
      <div class="Code_Segment"><a name="1025469">        ...</a></div>
      <div class="Code_Segment"><a name="1003528">        Phy802_11UnlockSignal(phy802_11);</a></div>
      <div class="Code_Segment"><a name="1003530">        if (Phy802_11CarrierSensing(node, phy802_11) == TRUE) {</a></div>
      <div class="Code_Segment"><a name="1025483">            Phy802_11ChangeState(node, phyIndex, PHY_SENSING);</a></div>
      <div class="Code_Segment"><a name="1003533">        }</a></div>
      <div class="Code_Segment"><a name="1003534">        else {</a></div>
      <div class="Code_Segment"><a name="1025471">            Phy802_11ChangeState(node, phyIndex, PHY_IDLE);</a></div>
      <div class="Code_Segment"><a name="1003537">        }</a></div>
      <div class="Code_Segment"><a name="1003539">        if (!receiveErrorOccurred) {</a></div>
      <div class="Code_Segment"><a name="1003540">            newMsg = MESSAGE_Duplicate(node, propRxInfo-&gt;txMsg);</a></div>
      <div class="Code_Segment"><a name="1003542">            MESSAGE_RemoveHeader(</a></div>
      <div class="Code_Segment"><a name="1003543">                node, newMsg, sizeof(Phy802_11PlcpHeader), TRACE_802_11);</a></div>
      <div class="Code_Segment"><a name="1025490">            ...</a></div>
      <div class="Code_Segment"><a name="1003545">            MESSAGE_SetInstanceId(newMsg, (short) phyIndex);</a></div>
      <div class="Code_Segment"><a name="1003546">            MAC_ReceivePacketFromPhy(node,</a></div>
      <div class="Code_Segment"><a name="1003903">                                     node-&gt;phyData[phyIndex]-&gt;macInterfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1003549">                                     newMsg);</a></div>
      <div class="Code_Segment"><a name="1003551">            phy802_11-&gt;stats.totalRxSignalsToMac++;</a></div>
      <div class="Code_Segment"><a name="1003552">        }</a></div>
      <div class="Code_Segment"><a name="1003553">        else {</a></div>
      <div class="Code_Segment"><a name="1003554">            Phy802_11ReportStatusToMac(node, phyIndex, phy802_11-&gt;mode);</a></div>
      <div class="Code_Segment"><a name="1003559">            phy802_11-&gt;stats.totalSignalsWithErrors++;</a></div>
      <div class="Code_Segment"><a name="1003560">        }//if//</a></div>
      <div class="Code_Segment"><a name="1003561">    }</a></div>
      <div class="Code_Segment"><a name="1003562">    else {</a></div>
      <div class="Code_Segment"><a name="1003563">            ...</a></div>
      <div class="Code_Segment"><a name="1003593">    }//if//</a></div>
      <div class="Code_Segment"><a name="1003453">}</a></div>
      <div class="Figure">FIGURE 4-168.&nbsp;&nbsp;<a name="1004552">Processing End of Incoming Signal in </a><span style="font-family: &quot;Courier New&quot;">PHY_RECEIVING</span> Mode</div>
      <div class="Heading3Numbered">4.6.5.9  <a name="1004589">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="1004590">In this section, we describe how to collect and report statistics for a PHY model.</a></div>
      <div class="Heading4Numbered">4.6.5.9.1  <a name="1004592">Declaring Statistics Variables</a></div>
      <div class="BodyAfterHead"><a name="1004593">A PHY model can be configured to record statistics specified by the programmer, such as:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004594">Number of signals transmitted </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004595">Number of signals received with errors</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004596">Number of signals received without errors</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1004597">To enable statistics collection for the PHY model, include the statistic collection variables in the structure used to hold the PHY model state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999464', '');" title="Physical Layer">Section&nbsp;4.6.5.4</a></span>). The statistics related variables can also be defined in a structure and then that structure is included in the state variable. For example, the data structure for IEEE 802.11a, <span style="font-family: &quot;Courier New&quot;">PhyData802_11</span>, contains the IEEE 802.11a statistics variable, <span style="font-family: &quot;Courier New&quot;">Phy802_3Stats</span>, shown below:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><a name="1004601">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025292">typedef struct phy_802_11_stats_str {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025293">    D_Int32 totalTxSignals;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025294">    D_Int32 totalRxSignalsToMac;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025295">    D_Int32 totalSignalsLocked;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025296">    D_Int32 totalSignalsWithErrors;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025297">    D_Float64 energyConsumed;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025298">    D_Clocktype turnOnTime;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1004609">} Phy802_11Stats;</a></span></div>
      <div class="Body"><span style="font-family: &quot;Courier New&quot;"><a name="1004610">PhyData802_11</a></span> and <span style="font-family: &quot;Courier New&quot;">Phy802_11Stats</span> are defined in phy_802_11.h.</div>
      <div class="Heading4Numbered">4.6.5.9.2  <a name="1004612">Initializing Statistics</a></div>
      <div class="BodyAfterHead"><a name="1004613">Initialize statistics variables in the PHY model’s initialization function. For example, the IEEE 802.11a initialization function Phy802_11Init, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004553', '');" title="Physical Layer">Figure&nbsp;4-169</a></span>, initializes all fields of the statistics variable <span style="font-family: &quot;Courier New&quot;">Phy802_11Stats</span> to 0. </div>
      <div class="Code_Segment"><a name="1004617">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1004756">void Phy802_11Init(</a></div>
      <div class="Code_Segment"><a name="1004757">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1004758">    const int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1004759">    const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1004760">{</a></div>
      <div class="Code_Segment"><a name="1004761">    BOOL   wasFound;</a></div>
      <div class="Code_Segment"><a name="1004770">    ...</a></div>
      <div class="Code_Segment"><a name="1004774">    //</a></div>
      <div class="Code_Segment"><a name="1004775">    // Initialize phy statistics variables</a></div>
      <div class="Code_Segment"><a name="1004776">    //</a></div>
      <div class="Code_Segment"><a name="1004777">    phy802_11-&gt;stats.totalRxSignalsToMac = 0;</a></div>
      <div class="Code_Segment"><a name="1004778">    phy802_11-&gt;stats.totalSignalsLocked = 0;</a></div>
      <div class="Code_Segment"><a name="1004779">    phy802_11-&gt;stats.totalSignalsWithErrors = 0;</a></div>
      <div class="Code_Segment"><a name="1004780">    phy802_11-&gt;stats.totalTxSignals = 0;</a></div>
      <div class="Code_Segment"><a name="1004781">    phy802_11-&gt;stats.energyConsumed = 0.0;</a></div>
      <div class="Code_Segment"><a name="1004782">    phy802_11-&gt;stats.turnOnTime = getSimTime(node);</a></div>
      <div class="Code_Segment"><a name="1004783">    ...</a></div>
      <div class="Code_Segment"><a name="1004772">}</a></div>
      <div class="Figure">FIGURE 4-169.&nbsp;&nbsp;<a name="1004553">Initializing Statistics Variables for IEEE 802.11a </a></div>
      <div class="Heading4Numbered">4.6.5.9.3  <a name="1004822">Updating Statistics</a></div>
      <div class="BodyAfterHead"><a name="1004823">After declaring and initializing the statistics variables, update their value during the execution of the PHY model, as required. For example, IEEE 802.11a increments the value of </a><span style="font-family: &quot;Courier New&quot;">totalRxSignalsToMac</span> in function Phy802_11SignalEndFromChannel (implemented in phy_802_11.cpp) every time IEEE 802.11a sends a received packet to the MAC Layer, as shown in <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004552', '');" title="Physical Layer">Figure&nbsp;4-168</a>.</div>
      <div class="Heading4Numbered">4.6.5.9.4  <a name="1004882"> Printing Statistics</a></div>
      <div class="BodyAfterHead"><a name="1004955">As a final step towards statistics collection, create a function to print statistics. Call this function from the finalization function of the PHY model, which is discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005088', '');" title="Physical Layer">Section&nbsp;4.6.5.10.2</a></span>. Alternatively, the statistics can be printed from the finalization function directly.</div>
      <div class="Heading4Numbered">4.6.5.9.5  <a name="1076240">Adding Dynamic Statistics</a></div>
      <div class="BodyAfterHead"><a name="1076244">Dynamic statistics are statistic variables whose values can be observed in the </a><span class="Variable">QualNet</span> GUI during the simulation. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.3.html#955932', '');" title="Customizing Visualize Mode of QualNet Architect">Section&nbsp;5.2.3</a></span> for adding dynamic statistics to a protocol. Refer to <span class="Variable" style="font-style: italic">QualNet User’s Guide</span> for details of viewing dynamic statistics during the simulation.</div>
      <div class="Heading3Numbered">4.6.5.10  <a name="1005031">Finalization</a></div>
      <div class="BodyAfterHead"><a name="1005032">The finalization function of the PHY model is called by the simulator at the end of simulation. It is the last code that executes during the simulation. This function is responsible for printing statistics to the statistics file.</a></div>
      <div class="BodyAfterHead"><a name="1043860">At the end of simulation, the finalization function for each model is called to print the model statistics. As discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#934306', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.3</a></span>, the finalization function is called hierarchically. The node finalization function, PARTITION_Finalize, which is defined in <span class="Variable">QUALNET_HOME</span>/main/partition.cpp, calls the finalization function for the Physical Layer, PHY_Finalize, defined in phy.cpp. PHY_Finalize calls the finalization function of the PHY model running at each interface. </div>
      <div class="Heading4Numbered">4.6.5.10.1  <a name="1005038">Modifying the Physical Layer Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="1005039">Call the finalization function of the PHY model from the Physical Layer finalization function, PHY_Finalize, defined in phy.cpp. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005086', '');" title="Physical Layer">Figure&nbsp;4-170</a></span> shows the outline of code that needs to be added to PHY_Finalize. Function PhyMyphyFinalize is the finalization function of the PHY model PHY_MYPHY (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005088', '');" title="Physical Layer">Section&nbsp;4.6.5.10.2</a></span>).</div>
      <div class="Code_Segment"><a name="1005046">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005167">void PHY_Finalize(Node *node) {</a></div>
      <div class="Code_Segment"><a name="1005168">    int phyNum;</a></div>
      <div class="Code_Segment"><a name="1005169">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005170">    for (phyNum = 0; (phyNum &lt; node-&gt;numberPhys); phyNum++) {</a></div>
      <div class="Code_Segment"><a name="1005171">        ...</a></div>
      <div class="Code_Segment"><a name="1076100">        switch(node-&gt;phyData[phyNum]-&gt;phyModel) {</a></div>
      <div class="Code_Segment"><a name="1005172">            case PHY802_11b:</a></div>
      <div class="Code_Segment"><a name="1005173">            case PHY802_11a: {</a></div>
      <div class="Code_Segment"><a name="1005174">                Phy802_11Finalize(node, phyNum);</a></div>
      <div class="Code_Segment"><a name="1005175">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005176">                break;</a></div>
      <div class="Code_Segment"><a name="1005177">            }</a></div>
      <div class="Code_New"><a name="1005075">            case PHY_MYPHY:</a></div>
      <div class="Code_New"><a name="1005076">            {</a></div>
      <div class="Code_New"><a name="1005077">                PhyMyphyFinalize(node, phyNum);</a></div>
      <div class="Code_New"><a name="1005078">                break;</a></div>
      <div class="Code_New"><a name="1005079">            }</a></div>
      <div class="Code_Segment"><a name="1005080">            ...</a></div>
      <div class="Code_Segment"><a name="1005081">        }</a></div>
      <div class="Code_Segment"><a name="1005082">   }</a></div>
      <div class="Code_Segment"><a name="1005084">}</a></div>
      <div class="Figure">FIGURE 4-170.&nbsp;&nbsp;<a name="1005086">Physical Layer Finalization Function</a></div>
      <div class="Heading4Numbered">4.6.5.10.2  <a name="1005088">Implementing the PHY Model Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="1005089">Write the finalization function for the PHY model PHY_MYPHY, PhyMyphyFinalize. If statistics collection is enabled for the Physical Layer, call the function to print the PHY model’s statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1004882', '');" title="Physical Layer">Section&nbsp;4.6.5.9.4</a></span>) from the finalization function, or add code directly to PhyMyphyFinalize to print statistics. Use the IEEE 802.11a finalization function, Phy802_11Finalize, shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005114', '');" title="Physical Layer">Figure&nbsp;4-171</a></span>, as a template. Phy802_11Finalize is implemented in phy_802_11.cpp.</div>
      <div class="Body"><a name="1043866">Function Phy802_11Finalize calls the C function sprintf to create a single string containing the statistic name and statistic value, and then calls function IO_PrintStat to print that string to a file. Function IO_PrintStat function, defined in </a><span class="Variable">QUALNET_HOME</span>/include/fileio.h, requires the following parameters:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1043867">Node pointer: Pointer to the node reporting the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005314">Layer: String indicating the layer. Set this to </a><span style="font-family: &quot;Courier New&quot;">"Physical"</span> for the Physical Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005315">Protocol: String indicating the model name.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005316">Interface address: Interface address. Set this to </a><span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> for PHY models.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005317">Instance identifier: Physical channel index.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005307">Buffer: String containing the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1005097">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005248">void Phy802_11Finalize(Node *node, const int phyIndex) {</a></div>
      <div class="Code_Segment"><a name="1005249">    PhyData* thisPhy = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1005250">    PhyData802_11* phy802_11 = (PhyData802_11*) thisPhy-&gt;phyVar;</a></div>
      <div class="Code_Segment"><a name="1005251">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1005252">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005253">    if (thisPhy-&gt;phyStats == FALSE) {</a></div>
      <div class="Code_Segment"><a name="1005254">        return;</a></div>
      <div class="Code_Segment"><a name="1005255">    }</a></div>
      <div class="Code_Segment"><a name="1005257">    assert(thisPhy-&gt;phyStats == TRUE);</a></div>
      <div class="Code_Segment"><a name="1005259">    sprintf(buf, "Signals transmitted = %d",</a></div>
      <div class="Code_Segment"><a name="1005260">            (int) phy802_11-&gt;stats.totalTxSignals);</a></div>
      <div class="Code_Segment"><a name="1005261">    IO_PrintStat(node, "Physical", "802.11", ANY_DEST, phyIndex, buf);</a></div>
      <div class="Code_Segment"><a name="1005263">    sprintf(buf, "Signals received and forwarded to MAC = %d",</a></div>
      <div class="Code_Segment"><a name="1005264">            (int) phy802_11-&gt;stats.totalRxSignalsToMac);</a></div>
      <div class="Code_Segment"><a name="1005265">    IO_PrintStat(node, "Physical", "802.11", ANY_DEST, phyIndex, buf);</a></div>
      <div class="Code_Segment"><a name="1005281">...</a></div>
      <div class="Code_Segment"><a name="1005282">}</a></div>
      <div class="Figure">FIGURE 4-171.&nbsp;&nbsp;<a name="1005114">Finalization Function for IEEE 802.11a</a></div>
      <div class="Body"><a name="1005028">As for all other functions, specify the prototype of the finalization function in the PHY model's header file, phy_myphy.h.</a></div>
      <div class="Heading3Numbered">4.6.5.11  <a name="1043871">Modifying Radio-range Utility Function</a></div>
      <div class="BodyAfterHead"><a name="1043872">The file </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/prop_range.cpp implements the radio-range program, which calculates the likely propagation range of a node, under no interference conditions, using the parameters specified in the configuration file. Modify this file, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1020742', '');" title="Physical Layer">Figure&nbsp;4-172</a></span>, to incorporate PHY_MYPHY. </div>
      <div class="Code_Segment"><a name="1020723">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1020750">/*</a></div>
      <div class="Code_Segment"><a name="1020751"> * Calculates prop range</a></div>
      <div class="Code_Segment"><a name="1020752"> */</a></div>
      <div class="Code_Segment"><a name="1020759">...</a></div>
      <div class="Code_Segment"><a name="1020764">#include "phy_abstract.h"</a></div>
      <div class="Code_New"><a name="1020886">#include "phy_myphy.h"</a></div>
      <div class="Code_Segment"><a name="1020765">#include "propagation.h"</a></div>
      <div class="Code_Segment"><a name="1020766">...</a></div>
      <div class="Code_Segment"><a name="1020771">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1020772">int main(int argc, char **argv) {</a></div>
      <div class="Code_Segment"><a name="1020773">    NodeInput       nodeInput;</a></div>
      <div class="Code_Segment"><a name="1020740">    int             numNodes = 0;</a></div>
      <div class="Code_Segment"><a name="1020784">    ...</a></div>
      <div class="Code_Segment"><a name="1020974">    PHY_Init(node, &amp;nodeInput);</a></div>
      <div class="Code_Segment"><a name="1025491">    PHY_GlobalBerInit(&amp;nodeInput);</a></div>
      <div class="Code_Segment"><a name="1020975">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1020976">    { </a></div>
      <div class="Code_Segment"><a name="1020977">        int interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1020971">        ...</a></div>
      <div class="Code_Segment"><a name="1020787">        IO_ReadString(node-&gt;nodeId, &amp;networkAddress, &amp;nodeInput,</a></div>
      <div class="Code_Segment"><a name="1020966">                      "PHY-MODEL", &amp;found, phyModelName);</a></div>
      <div class="Code_Segment"><a name="1020794">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1020795">        assert(found == TRUE);</a></div>
      <div class="Code_Segment"><a name="1020796">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1020797">        if (strcmp(phyModelName, "PHY802.11a") == 0) {</a></div>
      <div class="Code_Segment"><a name="1020798">            PHY_CreateAPhyForMac(node, &amp;nodeInput, interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1020799">                                 &amp;networkAddress, PHY802_11a,</a></div>
      <div class="Code_Segment"><a name="1020803">                                 &amp;node-&gt;macData[interfaceIndex]-&gt;phyNumber);</a></div>
      <div class="Code_Segment"><a name="1020805">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1020806">            phyModel = PHY802_11a;</a></div>
      <div class="Code_Segment"><a name="1020807">        }</a></div>
      <div class="Code_Segment"><a name="1020785">        else</a></div>
      <div class="Code_New"><a name="1020856">           if (strcmp(phyModelName, "PHY_MYPHY") == 0) {</a></div>
      <div class="Code_New"><a name="1020857">            PHY_CreateAPhyForMac(node, &amp;nodeInput, interfaceIndex,</a></div>
      <div class="Code_New"><a name="1020858">                                 &amp;networkAddress, PHY_MYPHY,</a></div>
      <div class="Code_New"><a name="1020859">                                 &amp;node-&gt;macData[interfaceIndex]-&gt;phyNumber);</a></div>
      <div class="Code_New"><a name="1020860">&nbsp;</a></div>
      <div class="Code_New"><a name="1020861">            phyModel = PHY_MYPHY;</a></div>
      <div class="Code_New"><a name="1020862">        }</a></div>
      <div class="Code_New"><a name="1020863">        else</a></div>
      <div class="Code_Segment"><a name="1020811">         ...</a></div>
      <div class="Code_Segment"><a name="1020913">        else {</a></div>
      <div class="Code_Segment"><a name="1020914">            ERROR_ReportError("Unknown PHY-MODEL");</a></div>
      <div class="Code_Segment"><a name="1020915">        }</a></div>
      <div class="Code_Segment"><a name="1020916">    }</a></div>
      <div class="Code_Segment"><a name="1020918">    PROP_Init(node, 0, &amp;nodeInput);</a></div>
      <div class="Code_Segment"><a name="1020920">    propProfile = node-&gt;partitionData-&gt;propChannel[0].profile;</a></div>
      <div class="Code_Segment"><a name="1020922">    thisRadio = node-&gt;phyData[radioNumber];</a></div>
      <div class="Code_Segment"><a name="1020812">    distance = PHY_PropagationRange(node, radioNumber, TRUE);</a></div>
      <div class="Code_Segment"><a name="1020817">    return 0;</a></div>
      <div class="Code_Segment"><a name="1020818">}</a></div>
      <div class="Figure">FIGURE 4-172.&nbsp;&nbsp;<a name="1020742">Modifying Radio-range Utility Function</a></div>
      <div class="Heading3Numbered">4.6.5.12  <a name="1024035">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1024772">The final step in integrating your PHY model into </a><span class="Variable">QualNet</span> is to add the source file to the <span class="Variable">QualNet</span> source tree and compile.</div>
      <div class="BodyAfterHead"><a name="1024773">If you have created the files for the PHY model in an existing library or addon, then add the source file to the Makefile-common for that library or addon. For example, if you have created your model files in the Wireless library, then modify </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/Makefile-common as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1024794', '');" title="Physical Layer">Figure&nbsp;4-173</a></span>. Recompile <span class="Variable">QualNet</span> after making the changes.</div>
      <div class="Code_Segment"><a name="1024777">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024778">...</a></div>
      <div class="Code_Segment"><a name="1024779"># common sources</a></div>
      <div class="Code_Segment"><a name="1024780">#</a></div>
      <div class="Code_Segment"><a name="1024842">WIRELESS_SRCS = \</a></div>
      <div class="Code_Segment"><a name="1024843">$(WIRELESS_DIR)/antenna.cpp \</a></div>
      <div class="Code_Segment"><a name="1024783">$(WIRELESS_DIR)/antenna_global.cpp \</a></div>
      <div class="Code_Segment"><a name="1024784">...</a></div>
      <div class="Code_Segment"><a name="1024823">$(WIRELESS_DIR)/phy_802_11.cpp \</a></div>
      <div class="Code_Segment"><a name="1024787">$(WIRELESS_DIR)/phy_abstract.cpp \</a></div>
      <div class="Code_Segment"><a name="1076109">$(WIRELESS_DIR)/phy_cellular.cpp \</a></div>
      <div class="Code_New"><a name="1024788">$(</a><span style="font-weight: normal">WIRELESS_DIR</span>)/phy_myphy.cpp \</div>
      <div class="Code_Segment"><a name="1024836">$(WIRELESS_DIR)/propagation.cpp \</a></div>
      <div class="Code_Segment"><a name="1076144">$(WIRELESS_DIR)/prop_itm.cpp \</a></div>
      <div class="Code_Segment"><a name="1024837">$(WIRELESS_DIR)/prop_plmatrix.cpp \</a></div>
      <div class="Code_Segment"><a name="1024791">$(WIRELESS_DIR)/routing_aodv.cpp \</a></div>
      <div class="Code_Segment"><a name="1024792">...</a></div>
      <div class="Figure">FIGURE 4-173.&nbsp;&nbsp;<a name="1024794">Adding Model to Makefile-common</a></div>
      <div class="Body"><a name="1076268">If you have created a new library called user_models, then follow the instructions given in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#929473', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10.5</a></span> to integrate the user_models library into <span class="Variable">QualNet</span>.</div>
      <div class="Heading3Numbered">4.6.5.13  <a name="1076273">Integrating the Model into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1076277">To make the new model available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Heading2Numbered">4.6.6  <a name="1005662">Adding an Antenna Model </a></div>
      <div class="BodyAfterHead"><a name="1005663">Although the working of each antenna is different, there are certain functions that are performed by most antenna models. This section provides an overview of the flow of an antenna model and provides an outline for developing and adding an antenna model, MYANTENNA, to </a><span class="Variable">QualNet</span>. The new antenna model may use a new antenna pattern type, MYPATTERN.</div>
      <div class="Body"><a name="1005664">The following list summarizes the actions that need to be performed for adding an antenna model, MYANTENNA, to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1005668">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005710', '');" title="Physical Layer">Section&nbsp;4.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005672">Modify the files antenna.cpp and antenna_global.cpp to include the antenna model’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005710', '');" title="Physical Layer">Section&nbsp;4.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1019280">Modify the file phy.cpp and the source files for any PHY models that use the new antenna model to include the antenna model’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005710', '');" title="Physical Layer">Section&nbsp;4.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005676">Include the antenna model in the list of antennas (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005744', '');" title="Physical Layer">Section&nbsp;4.6.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1017256">If the antenna model uses a new antenna pattern type, include it in the list of antenna pattern types (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017276', '');" title="Physical Layer">Section&nbsp;4.6.6.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005680">Define data structures for the antenna model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017273', '');" title="Physical Layer">Section&nbsp;4.6.6.5</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005684">Decide on the format for the antenna model-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005786', '');" title="Physical Layer">Section&nbsp;4.6.6.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005685">Call the antenna model’s initialization function from the antenna initialization function, ANTENNA_Init (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005800', '');" title="Physical Layer">Section&nbsp;4.6.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1018714">Modify function ANTENNA_GlobalAntennaModelInit to read the antenna model’s configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017129', '');" title="Physical Layer">Section&nbsp;4.6.6.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1018728">If the antenna model uses antenna pattern files of a new type, then modify function ANTENNA_GlobalAntennaPatternInit to read pattern files of the new type (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005855', '');" title="Physical Layer">Section&nbsp;4.6.6.6.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005689">Write the initialization function for the antenna model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1018447', '');" title="Physical Layer">Section&nbsp;4.6.6.6.5</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005701">Modify the generic antenna functions to integrate the new antenna model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005927', '');" title="Physical Layer">Section&nbsp;4.6.6.7</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1005705">Write functions to implement the antenna model functionality (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1006016', '');" title="Physical Layer">Section&nbsp;4.6.6.8</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1019931">Modify Physical Layer and PHY model functions to integrate the new antenna model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1019006', '');" title="Physical Layer">Section&nbsp;4.6.6.9</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1006258">Include the antenna model header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1006019', '');" title="Physical Layer">Section&nbsp;4.6.6.10</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1076353">To make the model available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1076403', '');" title="Physical Layer">Section&nbsp;4.6.6.11</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.6.6.1  <a name="1044118">Naming Guidelines</a></div>
      <div class="BodyAfterHead"><a name="1044119">In </a><span class="Variable">QualNet</span>, each component (file, data structure, function, etc.) is given a name that indicates the name of the model, the layer in which the model resides, and the functionality of the component, as appropriate. We recommend that when adding a new antenna model, the programmer name the different components of the new model in a similar manner. It will be helpful to examine the implementation of the patterned antenna model in <span class="Variable">QualNet</span> for hints for naming and coding different components of the new antenna model.</div>
      <div class="BodyAfterHead"><a name="1005708">In this section, we describe the steps for developing an antenna model called “MYANTENNA”. We will use the string “Myantenna” in the names of the different components of this model, just as the string “AntennaPatterned” appears in the names of the components of the patterned antenna implementation.</a></div>
      <div class="Heading3Numbered">4.6.6.2  <a name="1005710">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1024103">This step is similar to the one for PHY models (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#999542', '');" title="Physical Layer">Figure&nbsp;4.6.5.2</a></span>). Create the header and source files for the antenna model. Name these files in a way that clearly indicates the model that they implement. For antenna models, prefix the file names with <span style="font-style: italic">antenna_</span>.</div>
      <div class="Body" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: italic; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="font-style: normal"><a name="1005712">Examples</a></span>:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005713">antenna_steerable.h, antenna_steerable.cpp: These files, in the directory </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src, implement the steerable antenna model.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005714">antenna_patterened.h, antenna_patterened.cpp: These files, in the directory </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src, implement the patterned antenna model.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1005718">In keeping with the naming guidelines of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1044118', '');" title="Physical Layer">Section&nbsp;4.6.6.1</a></span>, the header file for the example antenna model is called antenna_myantenna.h, and the source file is called antenna_myantenna.cpp.</div>
      <div class="Note_Indented"><a name="1005722"><img class="Default" src="images/Chapter%204-6.10.1.3.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="1005723">While adding code to the files, it is important to organize the code well between the files. Generally, the header file, antenna_myantenna.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005724">Prototypes for interface functions in the source file, antenna_myantenna.cpp</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005725">Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005726">Data structure definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1005727">The source file, antenna_myantenna.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005728">Statement to include the antenna model’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Declaration"><a name="1005729">	</a></div>
      <div class="Declaration"><a name="1078733">#include “antenna_myantenna.h”</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005730">Statements to include standard library functions and other header files needed by the antenna model’s source file. A typical antenna source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005731">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005732">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005733">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016632">#include &lt;string.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016633">#include &lt;math.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016634">#include "partition.h"        // </a></span><span class="Variable">QUALNET_HOME</span>/main/partition.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005736">#include "api.h"              // </a></span><span class="Variable">QUALNET_HOME</span>/include/api.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005737">#include "antenna.h"          </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024162">                     // </a></span><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016398">#include "antenna_global.h"   </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024163">                 // </a></span><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna_global.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005738">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005739">Initialization function for the antenna model, MyantennaInit</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005740">Antenna model implementation functions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1005741">The files antenna.cpp and antenna_global.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src contain the layer level initialization function and functions to implement the antenna functionality. These layer level functions in turn call the antenna model’s initialization and implementation functions. Therefore, to make these antenna model functions available to the layer level functions, insert the following include statement in the files antenna.cpp and antenna_global.cpp:</div>
      <div class="Declaration"><a name="1005742">	</a></div>
      <div class="Declaration"><a name="1078749">#include “antenna_myantenna.h”</a></div>
      <div class="Body"><a name="1019296">This include statement should also be included in the file </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/phy.cpp and the source files for any PHY models that use the antenna model.</div>
      <div class="Heading3Numbered">4.6.6.3  <a name="1005744">Including MYANTENNA in List of Antenna Models</a></div>
      <div class="BodyAfterHead"><a name="1005745">When a new antenna model is added to </a><span class="Variable">QualNet</span>, it needs to be included in the list of antenna models. To do this, add the antenna model’s name to the enumeration <span style="font-family: &quot;Courier New&quot;">AntennaModelType</span> defined in <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna_global.h. </div>
      <div class="Body"><a name="1005751">For our example model, add the entry </a><span style="font-family: &quot;Courier New&quot;">ANTENNA_MYANTENNA</span><span style="font-weight: bold"> </span>to <span style="font-family: &quot;Courier New&quot;">AntennaModelType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005761', '');" title="Physical Layer">Figure&nbsp;4-174</a></span>.</div>
      <div class="Code_Segment"><a name="1005753">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005754">enum AntennaModelType {</a></div>
      <div class="Code_Segment"><a name="1005755">    ANTENNA_OMNIDIRECTIONAL,</a></div>
      <div class="Code_Segment"><a name="1005756">    ANTENNA_SWITCHED_BEAM,</a></div>
      <div class="Code_Segment"><a name="1005757">    ANTENNA_STEERABLE,</a></div>
      <div class="Code_Segment"><a name="1016420">    ANTENNA_PATTERNED,</a></div>
      <div class="Code_New"><a name="1005758">    ANTENNA_MYANTENNA</a></div>
      <div class="Code_Segment"><a name="1005759">};</a></div>
      <div class="Figure">FIGURE 4-174.&nbsp;&nbsp;<a name="1005761">Adding MYANTENNA to List of Antenna Models</a></div>
      <div class="Note_Indented"><a name="1005762">&nbsp;</a></div>
      <div class="Note_Indented"><a name="1078773">Always add to the end of lists in header files<img class="Default" src="images/Chapter%204-6.10.1.4.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />.</a></div>
      <div class="Note_Indented"><a name="1078766">&nbsp;</a></div>
      <div class="Heading3Numbered">4.6.6.4  <a name="1017276">Including MYPATTERN in List of Antenna Pattern Types</a></div>
      <div class="BodyAfterHead"><a name="1017277">If the new antenna model uses a new antenna pattern type, it needs to be included in the list of antenna pattern types. To do this, add the antenna pattern type’s name to the enumeration </a><span style="font-family: &quot;Courier New&quot;">AntennaPatternType</span> defined in antenna_global.h. </div>
      <div class="Body"><a name="1017278">For our example model, the pattern type used is called MYPATTERN. Add the entry </a><span style="font-family: &quot;Courier New&quot;">ANTENNA_MYPATTERN</span><span style="font-weight: bold"> </span>to <span style="font-family: &quot;Courier New&quot;">AntennaPatternType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017291', '');" title="Physical Layer">Figure&nbsp;4-175</a></span>.</div>
      <div class="Code_Segment"><a name="1017282">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1017396">enum AntennaPatternType {</a></div>
      <div class="Code_Segment"><a name="1017397">    ANTENNA_PATTERN_TRADITIONAL,</a></div>
      <div class="Code_Segment"><a name="1017398">    ANTENNA_PATTERN_ASCII2D,</a></div>
      <div class="Code_Segment"><a name="1017399">    ANTENNA_PATTERN_ASCII3D,</a></div>
      <div class="Code_Segment"><a name="1017400">    ANTENNA_PATTERN_NSMA,</a></div>
      <div class="Code_Segment"><a name="1017401">    ANTENNA_PATTERN_EBE,</a></div>
      <div class="Code_Segment"><a name="1017402">    ANTENNA_PATTERN_ASAPS,</a></div>
      <div class="Code_New"><a name="1017410">    ANTENNA_MYPATTERN</a></div>
      <div class="Code_Segment"><a name="1017289">};</a></div>
      <div class="Figure">FIGURE 4-175.&nbsp;&nbsp;<a name="1017291">Adding MYPATTERN to List of Antenna Pattern Types</a></div>
      <div class="Heading3Numbered">4.6.6.5  <a name="1017273">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="1005768">Each antenna model has its own data structure, which is defined in the antenna model’s header file. The data structure stores antenna model-specific information.</a></div>
      <div class="Body"><a name="1005769">Define an appropriate data structure, </a><span style="font-family: &quot;Courier New&quot;">AntennaMyantenna</span>, for MYANTENNA in the antenna model’s header file, antenna_myantenna.h. As an example, the following data structure, defined in <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna_patterned.h, is used by the patterned antenna:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1005770">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017234">typedef struct struct_Antenna_Patterned {</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017235">    int                     modelIndex;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017236">    int                     numPatterns;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017237">    int                     patternIndex;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017238">    float                   antennaHeight;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017239">    float                   antennaGain_dB;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1017240">    AntennaPattern          *pattern;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1016441">} AntennaPatterned;</a></span></div>
      <div class="Heading3Numbered">4.6.6.6  <a name="1005783">Initialization</a></div>
      <div class="BodyAfterHead"><a name="1005784">In this section, we describe the tasks that need to be performed as part of the initialization process of an antenna model.</a></div>
      <div class="Heading4Numbered">4.6.6.6.1  <a name="1005786">Determining the Configuration Format for Input Parameters</a></div>
      <div class="BodyAfterHead"><a name="1005787">An antenna model may use model-specific configuration parameters for its operation. Configuration parameters for antenna models can be specified in the configuration file, e.g., default.config, or in an antenna models configuration file, e.g., default.antenna-models. It is recommended that the configuration parameters for the new antenna model, MYANTENNA, be specified in the antenna models configuration file. The format for specifying an antenna model’s configuration parameters in the antenna models configuration file is:</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1020344">&lt;Parameter-name&gt; [&lt;Index&gt;] &lt;Parameter-value&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1020345">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="1020346">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="1020348">&lt;Parameter-name&gt;	</a></span>: Name of the parameter.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><a name="1020349"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;	</span>: Instance to which this parameter declaration is applicable, enclosed in square brackets. This is used when there are multiple instances of the parameter. This specification is optional, and if it is not included, the parameter declaration applies to all instances.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="1020350">&lt;Parameter-value&gt;	</a></span>: Value to be used for the parameter. </div>
      <div class="Body"><a name="1005792">For example, the following lines from the file default.antenna-models show a part of the specification of an antenna model, </a><span style="font-family: &quot;Courier New&quot;">DEFAULT1-STEERABLE</span>, which is a steerable antenna with the specified parameters:</div>
      <div class="Code_Segment_Large"><a name="1017011">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1078786">ANTENNA-MODEL-NAME      DEFAULT1-STEERABLE</a></div>
      <div class="Code_Segment_Large"><a name="1017001">ANTENNA-MODEL-TYPE      STEERABLE</a></div>
      <div class="Code_Segment_Large"><a name="1017002">ANTENNA-MODEL-CLASS     DYNAMIC</a></div>
      <div class="Code_Segment_Large"><a name="1017003">ANTENNA-GAIN            0.0</a></div>
      <div class="Code_Segment_Large"><a name="1017004">ANTENNA-HEIGHT          1.5</a></div>
      <div class="Code_Segment_Large"><a name="1016997">ANTENNA-EFFICIENCY      0.8</a></div>
      <div class="Code_Segment_Large"><a name="1017221">...</a></div>
      <div class="Body"><a name="1016998">The following line from the configuration file, defualt.config, specifies that </a><span style="font-family: &quot;Courier New&quot;">DEFAULT1-STEERABLE</span> is the antenna model to be used for node 18:</div>
      <div class="Declaration"><a name="1017031">&nbsp;</a></div>
      <div class="Declaration"><a name="1078793">[18] ANTENNA-MODEL DEFAULT1-STEERABLE</a></div>
      <div class="Body"><a name="1005798">Decide on the format for specifying the new antenna model’s configuration parameters. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017129', '');" title="Physical Layer">Section&nbsp;4.6.6.6.3</a></span> explains how to read user input specified in this format. As an example, the following specification defines an antenna model, <span style="font-family: &quot;Courier New&quot;">DEFAULT1-MYANTENNA</span>, which is an antenna of type MYANTENNA, and has the parameter values listed. This antenna model uses an antenna pattern of type MYPATTERN (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017276', '');" title="Physical Layer">Section&nbsp;4.6.6.4</a></span>).</div>
      <div class="Declaration"><a name="1017158">&nbsp;</a></div>
      <div class="Declaration"><a name="1018432">ANTENNA-MODEL-NAME      DEFAULT1-MYANTENNA</a></div>
      <div class="Declaration"><a name="1017159">ANTENNA-MODEL-TYPE      MYANTENNA</a></div>
      <div class="Declaration"><a name="1017160">ANTENNA-MODEL-CLASS     DYNAMIC</a></div>
      <div class="Declaration"><a name="1017173">ANTENNA-GAIN            0.0</a></div>
      <div class="Declaration"><a name="1017174">ANTENNA-HEIGHT          1.5</a></div>
      <div class="Declaration"><a name="1017197">ANTENNA-EFFICIENCY      0.8</a></div>
      <div class="Declaration"><a name="1018417">ANTENNA-MISMATCH-LOSS   0.3</a></div>
      <div class="Declaration"><a name="1018418">ANTENNA-CABLE-LOSS      0.0</a></div>
      <div class="Declaration"><a name="1018419">ANTENNA-CONNECTION-LOSS 0.2</a></div>
      <div class="Declaration"><a name="1018420">ANTENNA-PATTERN-NAME    PATTERN-MYPATTERN</a></div>
      <div class="Declaration"><a name="1018421">ANTENNA-PATTERN-NUM-PATTERNS    1</a></div>
      <div class="Declaration"><a name="1018422">ANTENNA-PATTERN-TYPE    MYPATTERN</a></div>
      <div class="Declaration"><a name="1017222">ANTENNA-PATTERN-PATTERN-FILE    default.mypattern</a></div>
      <div class="Heading4Numbered">4.6.6.6.2  <a name="1005800">Calling the Antenna Model Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="1005801">The initialization function of an antenna model is called from the layer level antenna initialization function, ANTENNA_Init, implemented in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna.cpp. ANTENNA_Init is called by the initialization function of the PHY model running at the interface. For example, if IEEE 802.11a is running at an interface, the PHY model is initialized by calling the IEEE 802.11a initialization function Phy802_11Init (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1000038', '');" title="Physical Layer">Section&nbsp;4.6.5.5.3</a></span>), which in turn calls function ANTENNA_Init.</div>
      <div class="Body"><a name="1017101">Function ANTENNA_Init reads the name of the antenna model specified for the interface, and calls the function ANTENNA_InitFromConfigFile if an omni-directional, steerable, or switched-beam antenna model is specified for the interface. (Configuration parameters for these three antenna models can be specified in the main configuration file as well as the antenna models configuration file.) If a different name is specified for the antenna model, ANTENNA_Init calls function ANTENNA_GlobalAntennaModelGet. If the antenna model has already been encountered before and has an entry in the global antenna structure, ANTENNA_GlobalAntennaModelGet returns a pointer to the structure for the antenna model. If the antenna model has not been encountered before, i.e., ANTENNA_GlobalAntennaModelGet returns a null pointer, ANTENNA_Init calls functions ANTENNA_MakeAntennaModelInput and ANTENNA_GlobalAntennaModelInit to create and initialize an entry for the antenna model in the global antenna structure. ANTENNA_GlobalAntennaModelInit also reads and stores the configuration parameters for the antenna model.</a></div>
      <div class="Body"><a name="1017777">Function ANTENNA_MakeAntennaModelInput is implemented in antenna.cpp. Functions ANTENNA_GlobalAntennaModelGet and ANTENNA_GlobalAntennaModelInit are implemented in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/antenna_global.cpp. Function IO_ReadString reads the name of the antenna model from the configuration file. The prototype for IO_ReadString is defined in <span class="Variable">QUALNET_HOME</span>/include/fileio.h</div>
      <div class="Body"><a name="1017781">ANTENNA_Init then calls the initialization function for the antenna model. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005853', '');" title="Physical Layer">Figure&nbsp;4-176</a></span> shows the modifications that need to be made to ANTENNA_Init to incorporate MYANTENNA in <span class="Variable">QualNet</span>. ANTENNA_MyantennaInit is the initialization function for MYANTENNA.</div>
      <div class="Code_Segment"><a name="1016457">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1016709">void ANTENNA_Init( Node* node, int phyIndex, const NodeInput* nodeInput)</a></div>
      <div class="Code_Segment"><a name="1016710">   {</a></div>
      <div class="Code_Segment"><a name="1016714">    PhyData* phyData = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1016715">    ...</a></div>
      <div class="Code_Segment"><a name="1016721">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1016722">    IO_ReadString(node-&gt;nodeId, phyData-&gt;networkAddress, nodeInput,</a></div>
      <div class="Code_Segment"><a name="1016726">                  "ANTENNA-MODEL", &amp;wasFound, buf);</a></div>
      <div class="Code_Segment"><a name="1016730">    if (!wasFound || (strcmp(buf, "OMNIDIRECTIONAL") == 0)</a></div>
      <div class="Code_Segment"><a name="1016731">        || (strcmp(buf, "SWITCHED-BEAM") == 0)</a></div>
      <div class="Code_Segment"><a name="1016732">        || (strcmp(buf, "STEERABLE") == 0))</a></div>
      <div class="Code_Segment"><a name="1016733">    {</a></div>
      <div class="Code_Segment"><a name="1016734">        ANTENNA_InitFromConfigFile(node, phyIndex,nodeInput);</a></div>
      <div class="Code_Segment"><a name="1016735">    }</a></div>
      <div class="Code_Segment"><a name="1016736">    else</a></div>
      <div class="Code_Segment"><a name="1016737">    {</a></div>
      <div class="Code_Segment"><a name="1016738">        antennaModel</a></div>
      <div class="Code_Segment"><a name="1016739">            = ANTENNA_GlobalAntennaModelGet(node-&gt;partitionData, buf);</a></div>
      <div class="Code_Segment"><a name="1016742">        // Create a new global antenna structure</a></div>
      <div class="Code_Segment"><a name="1016743">        if (antennaModel == NULL)</a></div>
      <div class="Code_Segment"><a name="1016744">        {</a></div>
      <div class="Code_Segment"><a name="1016913">            NodeInput* antennaModelInput</a></div>
      <div class="Code_Segment"><a name="1016746">                = ANTENNA_MakeAntennaModelInput(nodeInput, buf);</a></div>
      <div class="Code_Segment"><a name="1016939">            ...</a></div>
      <div class="Code_Segment"><a name="1016940">            ANTENNA_GlobalAntennaModelInit(node, </a></div>
      <div class="Code_Segment"><a name="1016941">                phyIndex ,antennaModelInput, buf);</a></div>
      <div class="Code_Segment"><a name="1016772">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1016773">            antennaModel</a></div>
      <div class="Code_Segment"><a name="1016774">                = ANTENNA_GlobalAntennaModelGet(node-&gt;partitionData, buf);</a></div>
      <div class="Code_Segment"><a name="1016776">            ...</a></div>
      <div class="Code_Segment"><a name="1016793">        }</a></div>
      <div class="Code_Segment"><a name="1016794">        ...</a></div>
      <div class="Code_Segment"><a name="1017844">        if (antennaModel-&gt;antennaModelType == ANTENNA_OMNIDIRECTIONAL)</a></div>
      <div class="Code_Segment"><a name="1016798">        {</a></div>
      <div class="Code_Segment"><a name="1016799">            ANTENNA_OmniDirectionalInit(node, phyIndex, antennaModel);</a></div>
      <div class="Code_Segment"><a name="1016800">            return;</a></div>
      <div class="Code_Segment"><a name="1016801">        }</a></div>
      <div class="Code_Segment"><a name="1017821">        ...</a></div>
      <div class="Code_Segment"><a name="1017831">        else if (antennaModel-&gt;antennaModelType == ANTENNA_PATTERNED)</a></div>
      <div class="Code_Segment"><a name="1017832">        {</a></div>
      <div class="Code_Segment"><a name="1017833">            ANTENNA_PatternedInit(node, phyIndex, antennaModel);</a></div>
      <div class="Code_Segment"><a name="1017834">            return;</a></div>
      <div class="Code_Segment"><a name="1017829">        }</a></div>
      <div class="Code_New"><a name="1016802">        else if (antennaModel-&gt;antennaModelType == ANTENNA_MYANTENNA)</a></div>
      <div class="Code_New"><a name="1016803">        {</a></div>
      <div class="Code_New"><a name="1016804">            ANTENNA_MyantennaInit(node, phyIndex, antennaModel);</a></div>
      <div class="Code_New"><a name="1016805">            return;</a></div>
      <div class="Code_New"><a name="1016806">        }</a></div>
      <div class="Code_Segment"><a name="1016807">        else</a></div>
      <div class="Code_Segment"><a name="1016966">        ...</a></div>
      <div class="Code_Segment"><a name="1016817">    }//end of else</a></div>
      <div class="Code_Segment"><a name="1016829">}</a></div>
      <div class="Figure">FIGURE 4-176.&nbsp;&nbsp;<a name="1005853">Calling Antenna Model Initialization Function from ANTENNA_Init</a></div>
      <div class="Heading4Numbered">4.6.6.6.3  <a name="1017129">Reading Configuration Parameters</a></div>
      <div class="BodyAfterHead"><a name="1017130">Function ANTENNA_GlobalAntennaModelInit reads the configuration parameters associated with an antenna model from the antenna models configuration file and stores them in the global antenna data structure. Parameters for each antenna model are stored in a data structure of type </a><span style="font-family: &quot;Courier New&quot;">AntennaModelGlobal</span>, which is defined in antenna_global.h.</div>
      <div class="Body"><a name="1024210">In addition to ANTENNA_Init, function ANTENNA_GlobalAntennaModelInit also needs to be modified to incorporate MYANTENNA in </a><span class="Variable">QualNet</span>. ANTENNA_GlobalAntennaModelInit is implemented in antennna_global.cpp. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017504', '');" title="Physical Layer">Figure&nbsp;4-177</a></span> shows the modifications needed to add the antenna model, MYANTENNA. If MYANTENNA uses any additional configuration parameters (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005786', '');" title="Physical Layer">Section&nbsp;4.6.6.6.1</a></span>), then add appropriate fields to the data structure <span style="font-family: &quot;Courier New&quot;">AntennaModelGlobal</span> and modify ANTENNA_GlobalAntennaModelInit to read those parameters and store them in <span style="font-family: &quot;Courier New&quot;">AntennaModelGlobal</span>.</div>
      <div class="Code_Segment"><a name="1017512">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1017854">void ANTENNA_GlobalAntennaModelInit(</a></div>
      <div class="Code_Segment"><a name="1017513">     Node* node, int  phyIndex, const NodeInput* antennaModelInput,</a></div>
      <div class="Code_Segment"><a name="1017516">     const char* antennaModelName)</a></div>
      <div class="Code_Segment"><a name="1017517">{</a></div>
      <div class="Code_Segment"><a name="1017518">    char    buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1017519">    BOOL    wasFound;</a></div>
      <div class="Code_Segment"><a name="1017535">    ...</a></div>
      <div class="Code_Segment"><a name="1017541">    // Get new model</a></div>
      <div class="Code_Segment"><a name="1018334">    AntennaModelGlobal* antennaModel =</a></div>
      <div class="Code_Segment"><a name="1018335">        &amp;node-&gt;partitionData-&gt;antennaModels[</a></div>
      <div class="Code_Segment"><a name="1018336">                                       node-&gt;partitionData-&gt;numAntennaModels];</a></div>
      <div class="Code_Segment"><a name="1017545">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1017546">    // Read in antenna model</a></div>
      <div class="Code_Segment"><a name="1017547">    // Model name initialization with</a></div>
      <div class="Code_Segment"><a name="1017548">    // ANTENNA-MODEL (required)</a></div>
      <div class="Code_Segment"><a name="1017549">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1017550">    strcpy(antennaModel-&gt;antennaModelName, antennaModelName);</a></div>
      <div class="Code_Segment"><a name="1017552">    IO_ReadString(node-&gt;nodeId, phyData-&gt;networkAddress, antennaModelInput,</a></div>
      <div class="Code_Segment"><a name="1017556">                  "ANTENNA-MODEL-TYPE", &amp;wasFound, buf);</a></div>
      <div class="Code_Segment"><a name="1017559">    ...</a></div>
      <div class="Code_Segment"><a name="1017565">    if (strcmp(buf, "OMNIDIRECTIONAL") == 0)</a></div>
      <div class="Code_Segment"><a name="1017566">    {</a></div>
      <div class="Code_Segment"><a name="1017567">        antennaModel-&gt;antennaModelType = ANTENNA_OMNIDIRECTIONAL;</a></div>
      <div class="Code_Segment"><a name="1017568">    }</a></div>
      <div class="Code_New"><a name="1017569">    else if (strcmp(buf, "MYANTENNA") == 0)</a></div>
      <div class="Code_New"><a name="1017570">    {</a></div>
      <div class="Code_New"><a name="1017571">        antennaModel-&gt;antennaModelType = ANTENNA_MYANTENNA;</a></div>
      <div class="Code_New"><a name="1017572">    }</a></div>
      <div class="Code_Segment"><a name="1017573">    ...</a></div>
      <div class="Code_Segment"><a name="1017608">    IO_ReadFloat(node-&gt;nodeId, phyData-&gt;networkAddress, antennaModelInput,</a></div>
      <div class="Code_Segment"><a name="1017612">                 "ANTENNA-HEIGHT", &amp;wasFound,  &amp;height);</a></div>
      <div class="Code_Segment"><a name="1017617">    if (wasFound)</a></div>
      <div class="Code_Segment"><a name="1017618">    {</a></div>
      <div class="Code_Segment"><a name="1017619">        ERROR_Assert(height &gt;= 0 ,  "Illegal height given in the file.\n");</a></div>
      <div class="Code_Segment"><a name="1017621">         antennaModel-&gt;height = (float) height;</a></div>
      <div class="Code_Segment"><a name="1017622">    }</a></div>
      <div class="Code_Segment"><a name="1017623">    else</a></div>
      <div class="Code_Segment"><a name="1017624">    {</a></div>
      <div class="Code_Segment"><a name="1017625">        antennaModel-&gt;height = ANTENNA_DEFAULT_HEIGHT;</a></div>
      <div class="Code_Segment"><a name="1017606">    }</a></div>
      <div class="Code_Segment"><a name="1017640">    ...</a></div>
      <div class="Code_Segment"><a name="1018363">    if (antennaModel-&gt;antennaModelType != ANTENNA_OMNIDIRECTIONAL)</a></div>
      <div class="Code_Segment"><a name="1018364">    {</a></div>
      <div class="Code_Segment"><a name="1018365">        antennaModel-&gt;antennaPatterns =</a></div>
      <div class="Code_Segment"><a name="1018366">            ANTENNA_GlobalModelAssignPattern(node, phyIndex,</a></div>
      <div class="Code_Segment"><a name="1018367">                                             antennaModelInput, antennaModel);</a></div>
      <div class="Code_Segment"><a name="1018369">    }</a></div>
      <div class="Code_Segment"><a name="1018371">    node-&gt;partitionData-&gt;numAntennaModels++;</a></div>
      <div class="Code_Segment"><a name="1018361">    return;</a></div>
      <div class="Code_Segment"><a name="1017641">}</a></div>
      <div class="Figure">FIGURE 4-177.&nbsp;&nbsp;<a name="1017504">Modifications to Function ANTENNA_GlobalAntennaModelInit</a></div>
      <div class="Heading4Numbered">4.6.6.6.4  <a name="1005855">Reading Antenna Pattern Files</a></div>
      <div class="BodyAfterHead"><a name="1005856">If the antenna model is a directional antenna, ANTENNA_GlobalAntennaModelInit calls function ANTENNA_GlobalModelAssignPattern (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017504', '');" title="Physical Layer">Figure&nbsp;4-177</a></span>) to associate the proper antenna pattern type with the antenna model. ANTENNA_GlobalModelAssignPattern reads the antenna pattern name associated with the antenna model. If the antenna pattern name has not been encountered before, ANTENNA_GlobalModelAssignPattern calls function ANTENNA_GlobalAntennaPatternInit to initialize the structure associated with the antenna pattern type. ANTENNA_GlobalModelAssignPattern and ANTENNA_GlobalAntennaPatternInit are implemented in antenna_global.cpp.</div>
      <div class="Body"><a name="1018569">If the new antenna model uses a new antenna pattern type, then ANTENNA_GlobalAntennaPatternInit should be modified to read pattern files of the new type. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005925', '');" title="Physical Layer">Figure&nbsp;4-178</a></span> shows the modification required to ANTENNA_GlobalAntennaPatternInit to read an antenna pattern file of type MYPATTERN where ANTENNA_ReturnMypatternPatternFile is the function to read a pattern file of type MYPATTERN and store the pattern data in the antenna data structure.</div>
      <div class="Body"><a name="1017989">If the antenna model uses a new antenna pattern type, write the function ANTENNA_ReturnMypatternPatternFile. Like all other functions belonging to the antenna model, the prototype for ANTENNA_ReturnMypatternPatternFile should be included in the antenna’s header file, antenna_myantenna.h.</a></div>
      <div class="Code_Segment"><a name="1005872">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018594">void ANTENNA_GlobalAntennaPatternInit(</a></div>
      <div class="Code_Segment"><a name="1018595">     Node* node,</a></div>
      <div class="Code_Segment"><a name="1018596">     int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1018597">     const NodeInput* antennaModelInput,</a></div>
      <div class="Code_Segment"><a name="1018598">     AntennaModelGlobal* antennaModel,</a></div>
      <div class="Code_Segment"><a name="1018599">     const char* antennaPatternName)</a></div>
      <div class="Code_Segment"><a name="1018600">{</a></div>
      <div class="Code_Segment"><a name="1018601">    char    buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1018602">    BOOL    wasFound;</a></div>
      <div class="Code_Segment"><a name="1018603">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018604">    PhyData *phyData = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1018605">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018606">    ...</a></div>
      <div class="Code_Segment"><a name="1018609">    AntennaPattern* antennaPatterns =</a></div>
      <div class="Code_Segment"><a name="1018610">        &amp;node-&gt;partitionData-&gt;antennaPatterns[</a></div>
      <div class="Code_Segment"><a name="1018611">                                   node-&gt;partitionData-&gt;numAntennaPatterns];</a></div>
      <div class="Code_Segment"><a name="1018612">    strcpy(antennaPatterns-&gt;antennaPatternName , antennaPatternName);</a></div>
      <div class="Code_Segment"><a name="1018613">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018614">    IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1018615">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1018616">        phyData-&gt;networkAddress,</a></div>
      <div class="Code_Segment"><a name="1018617">        antennaModelInput,</a></div>
      <div class="Code_Segment"><a name="1018618">        "ANTENNA-PATTERN-TYPE",</a></div>
      <div class="Code_Segment"><a name="1018619">        &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="1017858">        buf);</a></div>
      <div class="Code_Segment"><a name="1018627">    ...</a></div>
      <div class="Code_Segment"><a name="1018634">    // Assign pattern</a></div>
      <div class="Code_Segment"><a name="1018635">    if (strcmp(buf, "ASCII2D") == 0)</a></div>
      <div class="Code_Segment"><a name="1018636">    {</a></div>
      <div class="Code_Segment"><a name="1018637">        antennaPatterns-&gt;antennaPatternType = ANTENNA_PATTERN_ASCII2D;</a></div>
      <div class="Code_Segment"><a name="1018638">        ANTENNA_ReturnAsciiPatternFile(node, phyIndex,antennaModelInput,</a></div>
      <div class="Code_Segment"><a name="1018639">            antennaPatterns);</a></div>
      <div class="Code_Segment"><a name="1018640">    }</a></div>
      <div class="Code_Segment"><a name="1018641">&nbsp;</a></div>
      <div class="Code_New"><a name="1018642">    else if (strcmp(buf, "MYPATTERN") == 0)</a></div>
      <div class="Code_New"><a name="1018643">    {</a></div>
      <div class="Code_New"><a name="1018644">        antennaPatterns-&gt;antennaPatternType = ANTENNA_MYPATTERN;</a></div>
      <div class="Code_New"><a name="1018645">        ANTENNA_ReturnMypatternPatternFile(node, phyIndex,antennaModelInput,</a></div>
      <div class="Code_New"><a name="1018646">            antennaPatterns);</a></div>
      <div class="Code_New"><a name="1018647">    }</a></div>
      <div class="Code_Segment"><a name="1018632">    ...</a></div>
      <div class="Code_Segment"><a name="1018651">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018653">    node-&gt;partitionData-&gt;numAntennaPatterns++;</a></div>
      <div class="Code_Segment"><a name="1018654">    return;</a></div>
      <div class="Code_Segment"><a name="1005923">}</a></div>
      <div class="Figure">FIGURE 4-178.&nbsp;&nbsp;<a name="1005925">Reading Antenna Pattern Files</a></div>
      <div class="Heading4Numbered">4.6.6.6.5  <a name="1018447">Implementing the Antenna Model Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="1018448">The initialization of an antenna model takes place in the initialization function of the antenna that is called by the layer-level antenna initialization function ANTENNA_Init (see </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005853', '');" title="Physical Layer">Figure&nbsp;4-176</a>). The initialization function of an antenna model commonly performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1018452">Create an instance of the antenna model data structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1018453">Copies the antenna parameters in the antenna model data structure from the global antenna structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1018457">As an example, </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1018506', '');" title="Physical Layer">Figure&nbsp;4-179</a> shows the initialization function for the patterned antenna model, ANTENNA_PatternedInit. ANTENNA_PatternedInit performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1018458">ANTENNA_PatternedInit creates an instance of the patterned antenna data structure, </a><span style="font-family: &quot;Courier New&quot;">AntennaPatterned</span>, by calling function AntennaPatternedAlloc.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1018459">ANTENNA_PatternedInit initializes the fields of the patterned antenna data structure with the values read into the global antenna structure (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017129', '');" title="Physical Layer">Section&nbsp;4.6.6.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1018463">ANTENNA_PatternedInit creates an instance of the generic antenna data structure, </a><span style="font-family: &quot;Courier New&quot;">AntennaModel</span>, and initializes the <span style="font-family: &quot;Courier New&quot;">antennaData</span> field of the Physical Layer data structure for that interface to point to the newly created generic antenna data structure.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1018464">ANTENNA_PatternedInit initializes the fields of the generic antenna data structure with the appropriate antenna model type and antenna pattern type, and makes the </a><span style="font-family: &quot;Courier New&quot;">antennaVar</span> field of the generic antenna data structure point to the newly created instance of the patterned antenna data structure, <span style="font-family: &quot;Courier New&quot;">AntennaPatterned</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1018465">ANTENNA_PatternedInit and AntennaPatternedAlloc are implemented in antenna_patterned.cpp.</a></div>
      <div class="Body"><a name="1018466">Write the initialization function for MYANTENNA, ANTENNA_MyantennaInit, to perform similar tasks for MYANTENNA. Like all other functions belonging to the antenna model, the prototype for the initialization function, ANTENNA_MyantennaInit, should be included in the antenna’s header file, antenna_myantenna.h.</a></div>
      <div class="Code_Segment"><a name="1018467">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018468">void ANTENNA_PatternedInit(</a></div>
      <div class="Code_Segment"><a name="1018469">     Node* node,</a></div>
      <div class="Code_Segment"><a name="1018470">     int  phyIndex,</a></div>
      <div class="Code_Segment"><a name="1018471">     const  AntennaModelGlobal* antennaModel)</a></div>
      <div class="Code_Segment"><a name="1018472">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018473">{</a></div>
      <div class="Code_Segment"><a name="1018474">    PhyData* phyData = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1018475">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018476">    phyData-&gt;antennaData =</a></div>
      <div class="Code_Segment"><a name="1018477">        (AntennaModel*) MEM_malloc(sizeof(AntennaModel));</a></div>
      <div class="Code_Segment"><a name="1018478">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018479">    ERROR_Assert(phyData-&gt;antennaData ,</a></div>
      <div class="Code_Segment"><a name="1018480">        "memory allocation problem for phyData-&gt;antennaData.\n");</a></div>
      <div class="Code_Segment"><a name="1018481">    memset(phyData-&gt;antennaData, 0,sizeof(AntennaModel));</a></div>
      <div class="Code_Segment"><a name="1018482">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018483">    AntennaPatterned *antennaVars = AntennaPatternedAlloc();</a></div>
      <div class="Code_Segment"><a name="1018484">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018485">    antennaVars-&gt;patternIndex = ANTENNA_PATTERN_NOT_SET;</a></div>
      <div class="Code_Segment"><a name="1018486">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018487">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018488">    // init structure</a></div>
      <div class="Code_Segment"><a name="1018489">    antennaVars-&gt;modelIndex = 0;</a></div>
      <div class="Code_Segment"><a name="1018490">    antennaVars-&gt;numPatterns = antennaModel-&gt;antennaPatterns-&gt;numOfPatterns;</a></div>
      <div class="Code_Segment"><a name="1018491">    antennaVars-&gt;antennaHeight = antennaModel-&gt;height;</a></div>
      <div class="Code_Segment"><a name="1018492">    antennaVars-&gt;antennaGain_dB = antennaModel-&gt;antennaGain_dB;</a></div>
      <div class="Code_Segment"><a name="1018493">    antennaVars-&gt;patternIndex = ANTENNA_DEFAULT_PATTERN;</a></div>
      <div class="Code_Segment"><a name="1018494">    antennaVars-&gt;pattern = antennaModel-&gt;antennaPatterns;</a></div>
      <div class="Code_Segment"><a name="1018495">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018496">    // Assign antenna model based on Node's model type</a></div>
      <div class="Code_Segment"><a name="1018497">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018498">    phyData-&gt;antennaData-&gt;antennaVar = antennaVars;</a></div>
      <div class="Code_Segment"><a name="1018499">    phyData-&gt;antennaData-&gt;antennaModelType = antennaModel-&gt;antennaModelType;</a></div>
      <div class="Code_Segment"><a name="1018500">    phyData-&gt;antennaData-&gt;numModels++;</a></div>
      <div class="Code_Segment"><a name="1018501">    phyData-&gt;antennaData-&gt;antennaPatternType =</a></div>
      <div class="Code_Segment"><a name="1018502">    antennaModel-&gt;antennaPatterns-&gt;antennaPatternType;</a></div>
      <div class="Code_Segment"><a name="1018503">    phyData-&gt;systemLoss_dB = antennaModel-&gt;systemLoss_dB;</a></div>
      <div class="Code_Segment"><a name="1018504">}</a></div>
      <div class="Figure">FIGURE 4-179.&nbsp;&nbsp;<a name="1018506">Antenna Model Initialization Function</a></div>
      <div class="Heading3Numbered">4.6.6.7  <a name="1005927">Modifying Generic Antenna Functions</a></div>
      <div class="BodyAfterHead"><a name="1018061">An antenna model implements several functions that are used by PHY models. These antenna model functions are called indirectly by PHY models. For example, if IEEE 802.11a is used as the PHY model, and the PHY needs to lock the antenna in the direction of maximum gain, the IEEE 802.11a function Phy802_11LockAntennaDirection calls the generic antenna function ANTENNA_LockAntennaDirection. ANTENNA_LockAntennaDirection calls the antenna locking function for the antenna model that is in use. For example, if the patterned antenna is in use, ANTENNA_LockAntennaDirection calls function AntennaPatternedLockAntennaDirection. Phy802_11LockAntennaDirection is implemented in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/phy_802_11.cpp. ANTENNA_LockAntennaDirection and the other generic antenna functions are implemented in antenna.cpp. AntennaPatternedLockAntennaDirection and the other functions for the patterned antenna are implemented in antenna_patterned.cpp.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005960', '');" title="Physical Layer" name="1005932">Figure&nbsp;4-180</a></span> shows the modifications that need to be made to ANTENNA_LockAntennaDirection to incorporate MYANTENNA in <span class="Variable">QualNet</span>. AntennaMyantennaLockAntennaDirection is the MYANTENNA function to lock the antenna direction.</div>
      <div class="Code_Segment"><a name="1005933">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018083">void ANTENNA_LockAntennaDirection(Node* node, int phyIndex)</a></div>
      <div class="Code_Segment"><a name="1018084">{</a></div>
      <div class="Code_Segment"><a name="1018085">    PhyData* phyData = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1018086">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018087">    switch (phyData-&gt;antennaData-&gt;antennaModelType)</a></div>
      <div class="Code_Segment"><a name="1018088">    {</a></div>
      <div class="Code_Segment"><a name="1018089">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018090">        case ANTENNA_OMNIDIRECTIONAL:</a></div>
      <div class="Code_Segment"><a name="1018091">        {</a></div>
      <div class="Code_Segment"><a name="1018092">            break;</a></div>
      <div class="Code_Segment"><a name="1018093">        }</a></div>
      <div class="Code_Segment"><a name="1018094">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018095">        case ANTENNA_SWITCHED_BEAM:</a></div>
      <div class="Code_Segment"><a name="1018096">        {</a></div>
      <div class="Code_Segment"><a name="1018097">            AntennaSwitchedBeamLockAntennaDirection(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1018098">            break;</a></div>
      <div class="Code_Segment"><a name="1018099">        }</a></div>
      <div class="Code_Segment"><a name="1018100">        case ANTENNA_STEERABLE:</a></div>
      <div class="Code_Segment"><a name="1018101">        {</a></div>
      <div class="Code_Segment"><a name="1018102">            AntennaSteerableLockAntennaDirection(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1018103">            break;</a></div>
      <div class="Code_Segment"><a name="1018104">        }</a></div>
      <div class="Code_Segment"><a name="1018105">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018106">        case ANTENNA_PATTERNED:</a></div>
      <div class="Code_Segment"><a name="1018107">        {</a></div>
      <div class="Code_Segment"><a name="1018108">            AntennaPatternedLockAntennaDirection(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1018109">            break;</a></div>
      <div class="Code_Segment"><a name="1018110">        }</a></div>
      <div class="Code_Segment"><a name="1018111">&nbsp;</a></div>
      <div class="Code_New"><a name="1018141">    case ANTENNA_MYANTENNA:</a></div>
      <div class="Code_New"><a name="1018142">        AntennaMyantennaLockAntennaDirection(node, phyIndex);</a></div>
      <div class="Code_New"><a name="1018143">        break;</a></div>
      <div class="Code_New"><a name="1018138">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018112">        default:</a></div>
      <div class="Code_Segment"><a name="1018113">        {</a></div>
      <div class="Code_Segment"><a name="1018114">            char err[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1018115">            sprintf(err, "Unknown ANTENNA-MODEL %s for phy %d.\n",</a></div>
      <div class="Code_Segment"><a name="1018116">                phyData-&gt;antennaData-&gt;antennaModelType, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1018117">            ERROR_ReportError(err);</a></div>
      <div class="Code_Segment"><a name="1018118">            break;</a></div>
      <div class="Code_Segment"><a name="1018119">        }</a></div>
      <div class="Code_Segment"><a name="1018120">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1018121">    }//switch//</a></div>
      <div class="Code_Segment"><a name="1005934">}</a></div>
      <div class="Figure">FIGURE 4-180.&nbsp;&nbsp;<a name="1005960">Modifying a Generic Antenna Function</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1018252', '');" title="Physical Layer" name="1005964">Table&nbsp;4-18</a></span> lists the generic antenna functions which should be modified to incorporate a new antenna model. Depending on the antenna's characteristics not all of the functions may need to be modified. The modifications to these functions are similar to the modification to ANTENNA_LockAntennaDirection, shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1005960', '');" title="Physical Layer">Figure&nbsp;4-180</a></span>. These generic functions are implemented in antenna.cpp.</div>
      <table class="Format_A" style="text-align: left; width: 446.4pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-18.&nbsp;&nbsp;<a name="1018252">Generic Antenna Functions&nbsp;</a></div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 230.4pt">
            <div class="CellHeading"><a name="1018256">Function</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 216pt">
            <div class="CellHeading"><a name="1018258">Explanation</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><span style="font-size: 10.0pt"><a name="1018260">ANTENNA_</a></span>IsInOmnidirectionalMode</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018262">Indicates if the antenna is operating in omni-directional mode.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018264">ANTENNA_ReturnHeight</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018266">Returns the antenna height.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><span style="font-size: 10.0pt"><a name="1018268">ANTENNA_</a></span>ReturnPatternIndex</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018270">Returns the antenna pattern index.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><span style="font-size: 10.0pt"><a name="1018272">ANTENNA_</a></span>GainForThisDirection</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018274">Returns the antenna gain value for a specified direction.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><span style="font-size: 10.0pt"><a name="1018304">ANTENNA_</a></span>GainForThisDirectionWithPatternIndex</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018306">Returns the antenna gain value for a specified direction and pattern index.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018276">ANTENNA_DefaultGainForThisSignal</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018278">Returns the default antenna gain value for a specified signal.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018280">ANTENNA_LockAntennaDirection</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1018282">For directional antennas, locks the direction in which maximum gain was observed.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018284">ANTENNA_UnlockAntennaDirection</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1018286">Unlocks the antenna's direction.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018288">ANTENNA_IsLocked</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1018290">Checks if the antenna's direction is locked.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018292">ANTENNA_SetToDefaultMode</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1018294">Sets the antenna to use the default mode.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018296">ANTENNA_SetToBestGainConfigurationForThisSignal</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1018298">If the antenna's direction is not locked, identifies the radiation pattern that provides the best gain for a given signal and uses it for further reception.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1018300">ANTENNA_SetBestConfigurationForAzimuth</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1018302">Sets the antenna to the best configuration for a specified azimuth.</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading3Numbered">4.6.6.8  <a name="1006016">Implementing Antenna Functions</a></div>
      <div class="BodyAfterHead"><a name="1006017">The functionality of an antenna model is implemented by means of several functions which are called by the PHY model and the propagation model. Write functions to implement the functionality of MYANTENNA. Include these functions in the antenna source file, antenna_myantenna.cpp, and define the prototypes of interface functions in the antenna header file, antenna_myantenna.h.</a></div>
      <div class="Heading3Numbered">4.6.6.9  <a name="1019006">Integrating with PHY Models</a></div>
      <div class="BodyAfterHead"><a name="1019007">Several Physical Layer and PHY model functions refer to antenna model functions and data structures directly. These functions should be modified to integrate MYANTENNA into </a><span class="Variable">QualNet</span>. Modifications required for these functions are shown in this section. Note that additional modifications to Physical Layer and PHY model functions may be necessary, depending upon the functionality of the antenna model and PHY models.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1019097', '');" title="Physical Layer" name="1043755">Figure&nbsp;4-181</a></span> shows the modifications for function PHY_PropagationRange. It assumes that the MYANTENNA data structure, <span style="font-family: &quot;Courier New&quot;">AntennaMyantenna</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1017273', '');" title="Physical Layer">Section&nbsp;4.6.6.5</a></span>), contains the fields <span style="font-family: &quot;Courier New&quot;">antennaGain_dB</span> and <span style="font-family: &quot;Courier New&quot;">antennaHeight</span>. PHY_PropagationRange is implemented in <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/phy.cpp.</div>
      <div class="Code_Segment"><a name="1019051">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019112">double PHY_PropagationRange(Node* node,</a></div>
      <div class="Code_Segment"><a name="1019113">                            int   interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1019052">                            BOOL  printAllDataRates) </a></div>
      <div class="Code_Segment"><a name="1019122">{</a></div>
      <div class="Code_Segment"><a name="1019117">    ...</a></div>
      <div class="Code_Segment"><a name="1019125">    AntennaOmnidirectional* omniDirectional;</a></div>
      <div class="Code_Segment"><a name="1019126">    AntennaSwitchedBeam* switchedBeam;</a></div>
      <div class="Code_Segment"><a name="1019127">    AntennaSteerable* steerable;</a></div>
      <div class="Code_Segment"><a name="1019123">    AntennaPatterned* patterned;</a></div>
      <div class="Code_New"><a name="1019202">    AntennaMyantenna* myantenna;</a></div>
      <div class="Code_Segment"><a name="1019118">    ...</a></div>
      <div class="Code_Segment"><a name="1019132">    switch (thisRadio-&gt;antennaData-&gt;antennaModelType)</a></div>
      <div class="Code_Segment"><a name="1019133">    {</a></div>
      <div class="Code_Segment"><a name="1019134">    case ANTENNA_OMNIDIRECTIONAL:</a></div>
      <div class="Code_Segment"><a name="1019135">        {</a></div>
      <div class="Code_Segment"><a name="1019136">            ...</a></div>
      <div class="Code_Segment"><a name="1019141">        }</a></div>
      <div class="Code_Segment"><a name="1019142">    ...</a></div>
      <div class="Code_Segment"><a name="1019158">    case ANTENNA_PATTERNED:</a></div>
      <div class="Code_Segment"><a name="1019159">        {</a></div>
      <div class="Code_Segment"><a name="1019160">            patterned =</a></div>
      <div class="Code_Segment"><a name="1019161">                (AntennaPatterned*)thisRadio-&gt;antennaData-&gt;antennaVar;</a></div>
      <div class="Code_Segment"><a name="1019162">            txAntennaGain_dB = patterned-&gt;antennaGain_dB;</a></div>
      <div class="Code_Segment"><a name="1019163">            txAntennaHeight = patterned-&gt;antennaHeight;</a></div>
      <div class="Code_Segment"><a name="1019164">            break;</a></div>
      <div class="Code_Segment"><a name="1019165">        }</a></div>
      <div class="Code_New"><a name="1019189">    case ANTENNA_MYANTENNA:</a></div>
      <div class="Code_New"><a name="1019190">        {</a></div>
      <div class="Code_New"><a name="1019191">            myantenna =</a></div>
      <div class="Code_New"><a name="1019192">                (AntennaMyantenna*)thisRadio-&gt;antennaData-&gt;antennaVar;</a></div>
      <div class="Code_New"><a name="1019193">            txAntennaGain_dB = myantenna-&gt;antennaGain_dB;</a></div>
      <div class="Code_New"><a name="1019194">            txAntennaHeight = myantenna-&gt;antennaHeight;</a></div>
      <div class="Code_New"><a name="1019195">            break;</a></div>
      <div class="Code_New"><a name="1019196">        }</a></div>
      <div class="Code_Segment"><a name="1019166">    default:</a></div>
      <div class="Code_Segment"><a name="1019167">        {</a></div>
      <div class="Code_Segment"><a name="1019168">            ...</a></div>
      <div class="Code_Segment"><a name="1019173">        }</a></div>
      <div class="Code_Segment"><a name="1019174">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019119">    }</a></div>
      <div class="Code_Segment"><a name="1019120">    ...</a></div>
      <div class="Code_Segment"><a name="1019201">}</a></div>
      <div class="Figure">FIGURE 4-181.&nbsp;&nbsp;<a name="1019097">Modifications to Function PHY_PropagationRange</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1019342', '');" title="Physical Layer" name="1019407">Figure&nbsp;4-182</a></span> shows the modifications for function Phy802_11Init, which is implemented in phy_802_11.cpp.</div>
      <div class="Code_Segment"><a name="1019298">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019350">void Phy802_11Init(</a></div>
      <div class="Code_Segment"><a name="1019351">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1019352">    const int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1019353">    const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1019354">{</a></div>
      <div class="Code_Segment"><a name="1019355">    BOOL   wasFound;</a></div>
      <div class="Code_Segment"><a name="1019356">    BOOL   yes;</a></div>
      <div class="Code_Segment"><a name="1019357">    int dataRateForBroadcast;</a></div>
      <div class="Code_Segment"><a name="1019358">    int i;</a></div>
      <div class="Code_Segment"><a name="1019299">    int numChannels = PROP_NumberChannels(node);</a></div>
      <div class="Code_Segment"><a name="1019362">    ...</a></div>
      <div class="Code_Segment"><a name="1019373">    // Antenna model initialization</a></div>
      <div class="Code_Segment"><a name="1019374">    //</a></div>
      <div class="Code_Segment"><a name="1019375">    ANTENNA_Init(node, phyIndex, nodeInput);</a></div>
      <div class="Code_Segment"><a name="1019376">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019377">    ERROR_Assert(((phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019378">                == ANTENNA_OMNIDIRECTIONAL) ||</a></div>
      <div class="Code_Segment"><a name="1019379">           (phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019380">                == ANTENNA_SWITCHED_BEAM) ||</a></div>
      <div class="Code_Segment"><a name="1019381">           (phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019382">                == ANTENNA_STEERABLE) ||</a></div>
      <div class="Code_New"><a name="1019390">           (phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_New"><a name="1019391">                == ANTENNA_MYANTENNA) ||</a></div>
      <div class="Code_Segment"><a name="1019383">           (phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019384">                == ANTENNA_PATTERNED)) ,</a></div>
      <div class="Code_Segment"><a name="1019371">            "Illegal antennaModelType.\n");</a></div>
      <div class="Code_Segment"><a name="1019363">    ...</a></div>
      <div class="Code_Segment"><a name="1019435">    // Set PHY802_11-ESTIMATED-DIRECTIONAL-ANTENNA-GAIN</a></div>
      <div class="Code_Segment"><a name="1019436">    //</a></div>
      <div class="Code_Segment"><a name="1019437">    IO_ReadDouble(</a></div>
      <div class="Code_Segment"><a name="1019438">        node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1019439">        node-&gt;phyData[phyIndex]-&gt;networkAddress,</a></div>
      <div class="Code_Segment"><a name="1019440">        nodeInput,</a></div>
      <div class="Code_Segment"><a name="1019441">        "PHY802.11-ESTIMATED-DIRECTIONAL-ANTENNA-GAIN",</a></div>
      <div class="Code_Segment"><a name="1019442">        &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="1019443">        &amp;(phy802_11-&gt;directionalAntennaGain_dB));</a></div>
      <div class="Code_Segment"><a name="1019444">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019445">    if (!wasFound &amp;&amp;</a></div>
      <div class="Code_Segment"><a name="1019446">        (phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019447">            != ANTENNA_OMNIDIRECTIONAL &amp;&amp;</a></div>
      <div class="Code_New"><a name="1019462">        (phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_New"><a name="1019463">            != ANTENNA_MYANTENNA &amp;&amp;</a></div>
      <div class="Code_Segment"><a name="1019448">          phy802_11-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019449">            != ANTENNA_PATTERNED))</a></div>
      <div class="Code_Segment"><a name="1019450">    {</a></div>
      <div class="Code_Segment"><a name="1019451">        ERROR_ReportError(</a></div>
      <div class="Code_Segment"><a name="1019452">            "PHY802.11-ESTIMATED-DIRECTIONAL-ANTENNA-GAIN is missing\n");</a></div>
      <div class="Code_Segment"><a name="1019433">    }</a></div>
      <div class="Code_Segment"><a name="1019460">    ...</a></div>
      <div class="Code_Segment"><a name="1019388">}</a></div>
      <div class="Figure">FIGURE 4-182.&nbsp;&nbsp;<a name="1019342">Modifications to Function Phy802_11Init</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1019615', '');" title="Physical Layer" name="1019426">Figure&nbsp;4-183</a></span> shows the modifications for function Phy802_11ITermintaeCurrentReceive, which is implemented in phy_802_11.cpp.</div>
      <div class="Code_Segment"><a name="1019479">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019558">void Phy802_11TerminateCurrentReceive(</a></div>
      <div class="Code_Segment"><a name="1019559">    Node* node, int phyIndex, const BOOL terminateOnlyOnReceiveError,</a></div>
      <div class="Code_Segment"><a name="1019560">    BOOL* frameError,</a></div>
      <div class="Code_Segment"><a name="1019561">    clocktype* endSignalTime)</a></div>
      <div class="Code_Segment"><a name="1019562">{</a></div>
      <div class="Code_Segment"><a name="1019563">    PhyData* thisPhy = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1019564">    PhyData802_11* phy802_11 = (PhyData802_11*)thisPhy-&gt;phyVar;</a></div>
      <div class="Code_Segment"><a name="1019480">    ...</a></div>
      <div class="Code_Segment"><a name="1019570">    *frameError = phy802_11-&gt;rxMsgError;</a></div>
      <div class="Code_Segment"><a name="1019571">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019572">    if ((terminateOnlyOnReceiveError) &amp;&amp; (!phy802_11-&gt;rxMsgError)) {</a></div>
      <div class="Code_Segment"><a name="1019573">        return;</a></div>
      <div class="Code_Segment"><a name="1019574">    }//if//</a></div>
      <div class="Code_Segment"><a name="1019576">    if (thisPhy-&gt;antennaData-&gt;antennaModelType == ANTENNA_OMNIDIRECTIONAL) {</a></div>
      <div class="Code_Segment"><a name="1019578">        phy802_11-&gt;interferencePower_mW += phy802_11-&gt;rxMsgPower_mW;</a></div>
      <div class="Code_Segment"><a name="1019579">    }</a></div>
      <div class="Code_Segment"><a name="1019580">    else {</a></div>
      <div class="Code_Segment"><a name="1019581">        int channelIndex;</a></div>
      <div class="Code_Segment"><a name="1019582">        PHY_GetTransmissionChannel(node, phyIndex, &amp;channelIndex);</a></div>
      <div class="Code_Segment"><a name="1019584">        ERROR_Assert(((thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019585">                    == ANTENNA_SWITCHED_BEAM) ||</a></div>
      <div class="Code_Segment"><a name="1019586">               (thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019587">                    == ANTENNA_STEERABLE) ||</a></div>
      <div class="Code_New"><a name="1019628">               (thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_New"><a name="1019629">                    == ANTENNA_MYANTENNA) ||</a></div>
      <div class="Code_Segment"><a name="1019588">               (thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019589">                    == ANTENNA_PATTERNED)) ,</a></div>
      <div class="Code_Segment"><a name="1019590">                "Illegal antennaModelType");</a></div>
      <div class="Code_Segment"><a name="1019592">        ...</a></div>
      <div class="Code_Segment"><a name="1019603">        }</a></div>
      <div class="Code_Segment"><a name="1019624">     ...</a></div>
      <div class="Code_Segment"><a name="1019620">}</a></div>
      <div class="Figure">FIGURE 4-183.&nbsp;&nbsp;<a name="1019615">Modifications to Function Phy802_11TerminateCurrentReceive</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1043739', '');" title="Physical Layer" name="1019649">Figure&nbsp;4-184</a></span> shows the modifications for function Phy802_11IGetLastAngleOfArrival, which is implemented in phy_802_11.cpp. AntennaMyantennaGetLastBoresightAzimuth is the MYANTENNA function to return the last boresight azimuth angle.</div>
      <div class="Code_Segment"><a name="1019650">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019727">double Phy802_11GetLastAngleOfArrival(Node* node, int phyIndex) {</a></div>
      <div class="Code_Segment"><a name="1019728">    PhyData* thisPhy = node-&gt;phyData[phyIndex];</a></div>
      <div class="Code_Segment"><a name="1019729">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019730">    switch (thisPhy-&gt;antennaData-&gt;antennaModelType) {</a></div>
      <div class="Code_Segment"><a name="1019731">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019732">    case ANTENNA_SWITCHED_BEAM:</a></div>
      <div class="Code_Segment"><a name="1019733">        {</a></div>
      <div class="Code_Segment"><a name="1019734">            return AntennaSwitchedBeamGetLastBoresightAzimuth(node,</a></div>
      <div class="Code_Segment"><a name="1019735">                phyIndex);</a></div>
      <div class="Code_Segment"><a name="1019736">            break;</a></div>
      <div class="Code_Segment"><a name="1019737">        }</a></div>
      <div class="Code_Segment"><a name="1019738">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019739">    case ANTENNA_STEERABLE:</a></div>
      <div class="Code_Segment"><a name="1019740">        {</a></div>
      <div class="Code_Segment"><a name="1019741">            return AntennaSteerableGetLastBoresightAzimuth(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1019742">            break;</a></div>
      <div class="Code_Segment"><a name="1019743">        }</a></div>
      <div class="Code_Segment"><a name="1019744">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019745">    case ANTENNA_PATTERNED:</a></div>
      <div class="Code_Segment"><a name="1019746">        {</a></div>
      <div class="Code_Segment"><a name="1019747">            return AntennaPatternedGetLastBoresightAzimuth(node, phyIndex);</a></div>
      <div class="Code_Segment"><a name="1019748">            break;</a></div>
      <div class="Code_Segment"><a name="1019749">        }</a></div>
      <div class="Code_Segment"><a name="1019750">&nbsp;</a></div>
      <div class="Code_New"><a name="1019767">    case ANTENNA_MYANTENNA:</a></div>
      <div class="Code_New"><a name="1019768">        {</a></div>
      <div class="Code_New"><a name="1019769">            return AntennaMyantennaGetLastBoresightAzimuth(node, phyIndex);</a></div>
      <div class="Code_New"><a name="1019770">            break;</a></div>
      <div class="Code_New"><a name="1019771">        }</a></div>
      <div class="Code_New"><a name="1019772">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019751">    default:</a></div>
      <div class="Code_Segment"><a name="1019752">        {</a></div>
      <div class="Code_Segment"><a name="1019753">            ERROR_ReportError("AOA not supported for this Antenna Model\n");</a></div>
      <div class="Code_Segment"><a name="1019754">            break;</a></div>
      <div class="Code_Segment"><a name="1019755">        }</a></div>
      <div class="Code_Segment"><a name="1019756">    }//switch//</a></div>
      <div class="Code_Segment"><a name="1019757">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019758">    abort();</a></div>
      <div class="Code_Segment"><a name="1025520">    return 0.0;</a></div>
      <div class="Code_Segment"><a name="1019686">}</a></div>
      <div class="Figure">FIGURE 4-184.&nbsp;&nbsp;<a name="1043739">Modifications to Function Phy802_11GetLastAngleOfArrival</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1019830', '');" title="Physical Layer" name="1043743">Figure&nbsp;4-185</a></span> shows the modifications for function PhyAbstractInit, which is implemented in <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/phy_abstract.cpp.</div>
      <div class="Code_Segment"><a name="1043744">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019841">void PhyAbstractInit(</a></div>
      <div class="Code_Segment"><a name="1019842">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1019843">    const int phyIndex,</a></div>
      <div class="Code_Segment"><a name="1019844">    const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1019845">{</a></div>
      <div class="Code_Segment"><a name="1019846">    double rxSensitivity_dBm;</a></div>
      <div class="Code_Segment"><a name="1019797">    double rxThreshold_dBm;</a></div>
      <div class="Code_Segment"><a name="1019837">    ...</a></div>
      <div class="Code_Segment"><a name="1019852">    //</a></div>
      <div class="Code_Segment"><a name="1019853">    // Antenna model initialization</a></div>
      <div class="Code_Segment"><a name="1019854">    //</a></div>
      <div class="Code_Segment"><a name="1019855">    ANTENNA_Init(node, phyIndex, nodeInput);</a></div>
      <div class="Code_Segment"><a name="1019856">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1019857">    ERROR_Assert(((phy_abstract-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019858">                == ANTENNA_OMNIDIRECTIONAL) ||</a></div>
      <div class="Code_New"><a name="1019884">           (phy_abstract-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_New"><a name="1019885">                == ANTENNA_MYANTENNA)) ||</a></div>
      <div class="Code_Segment"><a name="1019859">           (phy_abstract-&gt;thisPhy-&gt;antennaData-&gt;antennaModelType</a></div>
      <div class="Code_Segment"><a name="1019860">                == ANTENNA_PATTERNED)) ,</a></div>
      <div class="Code_Segment"><a name="1019861">            "Illegal antennaModelType.\n");</a></div>
      <div class="Code_Segment"><a name="1019862">   ...</a></div>
      <div class="Code_Segment"><a name="1019873">}</a></div>
      <div class="Figure">FIGURE 4-185.&nbsp;&nbsp;<a name="1019830">Modifications to Function PhyAbstractInit</a></div>
      <div class="Heading3Numbered">4.6.6.10  <a name="1006019">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1006020">This step is similar to the one for adding a PHY model (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-6.html#1024035', '');" title="Physical Layer">Section&nbsp;4.6.5.12</a></span>).</div>
      <div class="Heading3Numbered">4.6.6.11  <a name="1076403">Integrating the Model into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1076407">To make the new model available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Body"><a name="1023277">&nbsp;</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <hr align="left" />
    <table align="left">
      <tr>
        <td class="WebWorks_Company_Phone_Bottom">© 2008 - 2012 SCALABLE Network Technologies, Inc. All rights reserved.</td>
      </tr>
    </table>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>