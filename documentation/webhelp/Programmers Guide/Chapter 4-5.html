<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>MAC Layer</title>
    <link rel="StyleSheet" href="css/Chapter%204-5.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <div>
      <img src="snt-logo-text2-transparent-small.png" />
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Chapter%204-1.05.1.html#1003564">4	Developing Protocol Models in QualNet</a> &gt; 4.5  MAC Layer</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading1Numbered">4.5  <a name="1003564">MAC Layer</a></div>
      <div class="BodyAfterHead"><a name="1003565">The MAC Layer resides between the Network and Physical Layers in the </a><span class="Variable">QualNet</span> protocol stack, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-1.05.1.html#993736', '');" title="Developing Protocol Models in QualNet">Figure&nbsp;4-1</a></span>. The MAC Layer provides error-free transfer of data across a link using the services of the Physical Layer. In <span class="Variable">QualNet</span>, some MAC protocols do not use the Physical Layer. Instead, the Physical Layer functionality is incorporated in the MAC protocol.</div>
      <div class="Body"><a name="1042905">This section gives a detailed description of how to add a MAC Layer protocol to </a><span class="Variable">QualNet</span>. </div>
      <div class="Heading2Numbered">4.5.1  <a name="1042906">MAC Layer Protocols in </a><span class="Variable">QualNet</span></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="1042907">QualNet</a></span> provides a large number of MAC Layer protocols, both wired and wireless. If a node has multiple interfaces, it may run different MAC protocols at different interfaces. The MAC protocols running at different interfaces of a node can be a mix of wired and wireless protocols. </div>
      <div class="Body"><a name="1029579">Besides different MAC protocols, </a><span class="Variable">QualNet</span> also simulates faults and switches at the MAC Layer. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1029702', '');" title="MAC Layer">Table&nbsp;4-14</a></span> lists the different MAC protocol models in <span class="Variable">QualNet</span>. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1029702', '');" title="MAC Layer">Table&nbsp;4-14</a></span> lists some of the protocols for switches in <span class="Variable">QualNet</span>. See the corresponding model library for a detailed description of each protocol and its parameters.</div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-14.&nbsp;&nbsp;<a name="1029702">MAC Protocols in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 144pt">
            <div class="CellHeading"><a name="1029708">MAC Protocol</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 234pt">
            <div class="CellHeading"><a name="1029710">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1029712">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029714">ABSTRACT</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029716">Models the abstract MAC protocol for point-to-point links.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029718">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1057994">ABSTRACT-MAC</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1057996">Models the abstract MAC protocol for cellular systems.</a></div>
            <div class="CellBody"><a name="1057997">(To select this protocol, parameter </a><span style="font-family: &quot;Courier New&quot;">MAC-PROTOCOL</span> should be set to <span style="font-family: &quot;Courier New&quot;">CELLULAR-MAC</span> and  parameter <span style="font-family: &quot;Courier New&quot;">CELLULAR-MAC-PROTOCOL</span> should be set to <span style="font-family: &quot;Courier New&quot;">ABSTRACT-MAC</span>.)</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1057999">Cellular</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029732">ALOHA</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029734">Models the ALOHA MAC protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029736">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029745">CSMA</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029747">Models the Carrier Sense Multiple Access (CSMA) MAC protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029749">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029751">GENERICMAC</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029753">Models an abstract wireless MAC protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029755">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029757">GSM</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029759">Models the GSM MAC Layer.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029761">Cellular</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1058017">MAC-LTE</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1058019">Models LTE Layer 2.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1058021">LTE</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029769">MAC802.3</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029771">Models the IEEE 802.3 MAC specification.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029773">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029775">MAC802.15.4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029777">Models the IEEE 802.15.4 MAC (ZigBee MAC) specification.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029779">Sensor Networks</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029781">MAC802.16</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029783">Models the IEEE 802.16 MAC (WiMAX MAC) specification.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029785">Advanced Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029787">MACA</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029789">Models the Multiple Access with Collision Avoidance (MACA) MAC protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029791">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029793">MACDOT11</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029795">Models the IEEE 802.11 MAC specification.</a></div>
            <div class="CellBody"><a name="1058033">In addition, models the IEEE 802.11 MAC specification if 802.11 MAC is configured in infrastructure mode and the parameter </a><span style="font-family: &quot;Courier New&quot;">MAC-DOT11s-MESH-POINT</span> is set to <span style="font-family: &quot;Courier New&quot;">YES</span> for some node or interface in the subnet.</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029797">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029799">MACDOT11e</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029801">Models the IEEE 802.11e MAC specification.</a></div>
            <div class="CellBody"><a name="1029802">This is a QoS enhancement to the IEEE 802.11 MAC.</a></div>
            <div class="CellBody"><a name="1058447">In addition, models the IEEE 802.11n MAC specification if </a><span style="font-family: &quot;Courier New&quot;">PHY-MODEL</span> is set to <span style="font-family: &quot;Courier New&quot;">PHY-802.11n</span>.</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029804">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1029806">SATCOM</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029808">Models an abstract MAC protocol for satellites. </a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029810">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029819">SWITCHED-ETHERNET</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029821">Models an abstract switch connecting a subnet.</a></div>
            <div class="CellBody"><a name="1029822">This model does not have detailed models of switch ports, etc., and is limited to one subnet.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029824">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029826">TDMA</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029828">Models the Time Division Multiple Access (TDMA) MAC protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029830">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1058001">UMTS-LAYER2</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1058003">Models the abstract MAC protocol for UMTS systems.</a></div>
            <div class="CellBody"><a name="1058004">(To select this protocol, parameter </a><span style="font-family: &quot;Courier New&quot;">MAC-PROTOCOL</span> should be set to <span style="font-family: &quot;Courier New&quot;">CELLULAR-MAC</span> and  parameter <span style="font-family: &quot;Courier New&quot;">CELLULAR-MAC-PROTOCOL</span> should be set to <span style="font-family: &quot;Courier New&quot;">UMTS-LAYER2</span>.)</div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1058006">UMTS</a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="1029833">&nbsp;</a></div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-15.&nbsp;&nbsp;<a name="1029839">Protocols for Switches in </a><span class="Variable">QualNet</span></div>
        </caption>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top; width: 144pt">
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1029845">Protocol</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top; width: 234pt">
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1029847">Description</a></span></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top; width: 90pt">
            <div class="CellBody" style="color: #000000; font-family: Arial; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1029849">Network<br />Type</a></span></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029869">GARP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029871">Generic Attribute Registration Protocol</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029979">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029875">GVRP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029877">GARP VLAN Registration Protocol</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029995">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029881">STP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029883">Spanning Tree Protocol</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1030001">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029887">VLAN</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029889">Virtual Local Area Network</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1030007">Multimedia and Enterprise</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading2Numbered">4.5.2  <a name="987061">MAC Layer Organization: Files and Folders</a></div>
      <div class="BodyAfterHead"><a name="992014">In this section, we briefly examine the files and folders that are relevant to MAC Layer protocols. These files contain detailed comments on functions and other code components.</a></div>
      <div class="Body"><a name="992015">The MAC Layer API is composed of several macros, functions, and structures. These are defined in the following header files:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="992016">QUALNET_HOME</a></span>/include/api.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="992017">This file defines the events and data structures needed to communicate between different layers of the protocol stack.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="992018">QUALNET_HOME</a></span>/include/mac.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1043089">This file contains definitions common to MAC Layer protocols, the MAC data structure in the node structure, and prototypes of functions defined in </a><span class="Variable">QUALNET_HOME</span>/main/mac.cpp.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1043096">QUALNET_HOME</a></span>/libraries/developer/src/network_ip.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1043097">This file contains definitions of some general API functions for interface address information operations.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="992055">QUALNET_HOME</a></span>/include/phy.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="992056">This file contains definitions of API functions needed to communicate with the Physical Layer.</a></div>
      <div class="Body"><a name="992022">Additionally, the following header files are also relevant to the MAC Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="992023">QUALNET_HOME</a></span>/include/fileio.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="992024">This file contains prototypes of functions to read input files and create output files. </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="992025">QUALNET_HOME</a></span>/include/mapping.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="992026">This file contains prototypes of functions to map between node ids and IP addresses.</a></div>
      <div class="Body"><a name="992027">The following are the folders and source files associated with the MAC Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="987080">QUALNET_HOME</a></span>/libraries/developer/src, <span class="Variable">QUALNET_HOME</span>/libraries/developer/src</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="992088">These folders contain the source and header files for most of the MAC Layer protocols implemented in </a><span class="Variable">QualNet</span>. The file names are based on the name of the protocol that they implement, e.g., to see the implementation for IEEE 802.3, look at files mac_802_3.cpp and mac_802_3.h in the folder <span class="Variable">QUALNET_HOME</span>/libraries/developer/src. Other library folders may also contain code for other MAC protocols.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="987082">QUALNET_HOME</a></span>/main/mac.cpp</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="987083">This file contains MAC Layer functions, including the initialization, message processing, and finalization functions. </a></div>
      <div class="Heading2Numbered">4.5.3  <a name="987084">MAC Layer Data Structures</a></div>
      <div class="BodyAfterHead"><a name="992125">The MAC Layer data structures are defined in </a><span class="Variable">QUALNET_HOME</span>/include/mac.h. This section describes the main data structures. (Note that only a partial description of the data structures is provided here. Refer to file mac.h for a complete description.)</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><span style="font-family: &quot;Courier New&quot;"><a name="992152">MAC_PROTOCOL</a></span>: This is an enumeration type that lists all the MAC Layer protocols. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992169">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992170">typedef enum</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992171">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992172">    MAC_PROTOCOL_MPLS = 1,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992173">    MAC_PROTOCOL_CSMA,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992174">    MAC_PROTOCOL_FCSC_CSMA,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992175">    MAC_PROTOCOL_MACA,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992176">    MAC_PROTOCOL_FAMA,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992179">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992209">    MAC_PROTOCOL_ABSTRACT,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1023575">    MAC_PROTOCOL_CELLULAR,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1023573">    MAC_PROTOCOL_ANE,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054515">    MAC_PROTOCOL_WORMHOLE,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054516">    MAC_PROTOCOL_ANODR,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054517">    MAC_PROTOCOL_802_15_4,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1023572">    MAC_PROTOCOL_NONE // this must be the last one</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992210">} MAC_PROTOCOL;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992247">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="992160">MacData</a></span>: This is the main data structure used by the MAC Layer and stores information about the MAC protocol running at a specific interface. Some important fields of this structure are explained below.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="991709">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023588">struct MacData</a></div>
      <div class="Code_Segment"><a name="1023589">{</a></div>
      <div class="Code_Segment"><a name="1023590">    MAC_PROTOCOL macProtocol;</a></div>
      <div class="Code_Segment"><a name="1023591">    D_UInt32     macProtocolDynamic;</a></div>
      <div class="Code_Segment"><a name="1054554">    int          interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1023592">    BOOL         macStats;</a></div>
      <div class="Code_Segment"><a name="1023593">    BOOL         promiscuousMode;</a></div>
      <div class="Code_Segment"><a name="1058088">    ...</a></div>
      <div class="Code_Segment"><a name="1023594">    Int64        bandwidth;   // In bytes.</a></div>
      <div class="Code_Segment"><a name="1023595">    clocktype    propDelay;</a></div>
      <div class="Code_Segment"><a name="1023596">    BOOL         interfaceIsEnabled;</a></div>
      <div class="Code_Segment"><a name="1058095">    ...</a></div>
      <div class="Code_Segment"><a name="1023597">    int          phyNumber;</a></div>
      <div class="Code_Segment"><a name="1023598">    void         *macVar;</a></div>
      <div class="Code_Segment"><a name="1023599">    void         *mplsVar;</a></div>
      <div class="Code_Segment"><a name="1023601">    MacHasFrameToSendFn sendFrameFn;</a></div>
      <div class="Code_Segment"><a name="1023602">    MacReceiveFrameFn receiveFrameFn;</a></div>
      <div class="Code_Segment"><a name="1023604">    LinkedList  *interfaceStatusHandlerList;</a></div>
      <div class="Code_Segment"><a name="1023605">    NodeAddress virtualMacAddress;</a></div>
      <div class="Code_Segment"><a name="1023606">    MacVlan* vlan;</a></div>
      <div class="Code_Segment"><a name="1023608">    void*       bgMainStruct; //ptr of background traffic main structure</a></div>
      <div class="Code_Segment"><a name="1023609">    void*       randFault; //ptr of the random link fault data structure</a></div>
      <div class="Code_Segment"><a name="1023610">    short       faultCount; //flag for link fault.</a></div>
      <div class="Code_Segment"><a name="1023612">    MacHWAddress                macHWAddr;</a></div>
      <div class="Code_Segment"><a name="1025243">    BOOL                         isLLCEnabled;</a></div>
      <div class="Code_Segment"><a name="1023613">    BOOL                        interfaceCardFailed;</a></div>
      <div class="Code_Segment"><a name="1058102">    ...</a></div>
      <div class="Code_Segment"><a name="991733">};</a></div>
      <div class="Figure">FIGURE 4-118.&nbsp;&nbsp;<span style="font-family: &quot;Courier New&quot;"><a name="991729">MacData</a></span> Data Structure</div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987099">macProtocol</a></span>: This is the MAC protocol running at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987100">interfaceIndex</a></span>: This is the index of the interface. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="992371">macStats</a></span>: This Boolean variable indicates whether MAC statistics should be printed at end of simulation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987102">promiscuousMode</a></span>: This Boolean variable indicates whether the interface operates in promiscuous mode.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987103">bandwidth</a></span>: This variable stores the bandwidth of the attached network.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987104">propDelay</a></span>: This variable stores the propagation delay suffered by a packet.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987106">phyNumber</a></span>: This is an index to the Physical Layer protocol running at the interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987107">macVar</a></span>: This is a pointer to the data structure for the MAC protocol running at this interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987109">sendFrameFn</a></span>: This is a pointer to the function used to send packets to the network.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987110">receiveFrameFn</a></span>: This is a pointer to the function used to handle packets received from the network.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987113">macHWAddr</a></span>: This is the MAC Layer address of the interface. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading2Numbered">4.5.4  <a name="987122">MAC Layer APIs and Inter-layer Communication</a></div>
      <div class="BodyAfterHead"><a name="992389">This section describes the APIs used by the Network Layer to communicate with the MAC Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1004426', '');" title="MAC Layer">Section&nbsp;4.5.4.1</a></span>), the APIs used by the MAC Layer to communicate with the Network Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1004439', '');" title="MAC Layer">Section&nbsp;4.5.4.2</a></span>), the APIs used by the MAC Layer protocols to communicate with the Physical Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1004448', '');" title="MAC Layer">Section&nbsp;4.5.4.3</a></span>), and the APIs used by the Physical Layer to communicate with the MAC Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1004457', '');" title="MAC Layer">Section&nbsp;4.5.4.4</a></span>). This section also lists some of the MAC Layer utility APIs (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1004473', '');" title="MAC Layer">Section&nbsp;4.5.4.5</a></span>).</div>
      <div class="Body"><a name="992390">The complete list of APIs, with their parameters and description, can be found in </a><span style="font-style: italic">API Reference Guide</span>.</div>
      <div class="Heading3Numbered">4.5.4.1  <a name="1004426">Network Layer to MAC Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1004427">The API MAC_NetworkLayerHasPacketToSend is used by the Network Layer to inform the MAC Layer that a packet is available for transmission in the output queue.</a></div>
      <div class="Body"><a name="1028882">When ARP is not enabled, the Network Layer calls function to IPv4AddresstoHWAddress to convert the IP address of the next hop of a packet to the MAC address used by the MAC protocol running at the interface.</a></div>
      <div class="Body"><a name="1028889">The prototype for the functions MAC_NetworkLayerHasPacketToSend and IPv4AddresstoHWAddress are contained in the file mac.h. The functions are implemented in the file mac.cpp.</a></div>
      <div class="Heading3Numbered">4.5.4.2  <a name="1004439">MAC Layer to Network Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1004440">MAC Layer protocols use several APIs to communicate with the Network Layer. The prototypes for these functions are contained in the file mac.h. The file mac.cpp contains the implementation of these functions.</a></div>
      <div class="Body"><a name="1004423">Some of the APIs used for communication from the MAC Layer to the Network Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="987126">MAC_OutputQueueIsEmpty: This functions checks if the output queue at an interface is empty.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="987128">MAC_OutputQueueDequeuePacket: This function dequeues a packet from an output queue. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="987130">MAC_OutputQueueTopPacket: This function is used to view the top packet of a queue without dequeuing it.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="987132">MAC_OutputQueueDequeuePacketForAPriority: This function dequeues a specific priority packet from an output queue.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="987142">MAC_HandOffSuccessfullyReceivedPacket: This function is used by the MAC Layer to pass a received packet to the upper layers.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="987146">MAC_MacLayerAcknowledgement: This function notifies the Network Layer that a packet has been successfully delivered by the MAC protocol.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="987148">MAC_NotificationOfPacketDrop: This function notifies the upper layer protocols when a packet is dropped at the MAC Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.5.4.3  <a name="1004448">MAC Layer to Physical Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1004538">MAC Layer protocols use several APIs to communicate with the Physical Layer. The prototypes for these API functions are contained in the file </a><span class="Variable">QUALNET_HOME</span>/include/phy.h. </div>
      <div class="BodyAfterHead"><a name="1004539">Some of the functions used for communication from the MAC Layer to the Physical Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004540">PHY_StartTransmittingSignal: This function is used by the MAC Layer to send a packet to the Physical Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004453">PHY_StartListeningToChannel: This function is used by the MAC Layer to direct the Physical Layer to start listening to the specified channel.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004730">PHY_StopListeningToChannel: This function is used by the MAC Layer to direct the Physical Layer to stop listening to the specified channel.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1013094">PHY_SetTransmissionChannel: This function is used by the MAC Layer to set the channel for transmission.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.5.4.4  <a name="1004457">Physical Layer to MAC Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1004748">Physical Layer protocols use several APIs to communicate with the MAC Layer. The prototypes for these API functions are contained in the file mac.h. The file mac.cpp contains the implementation of these functions.</a></div>
      <div class="BodyAfterHead"><a name="1004459">Some of the functions used for communication from the Physical Layer to the MAC Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004494">MAC_ReceivePacketFromPhy: This function delivers a packet from the Physical Layer to the MAC Layer. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004495">MAC_ReceivePhyStatusChangeNotification: This function notifies the MAC Layer of a status change at the Physical Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.5.4.5  <a name="1004473">MAC Layer Utility APIs</a></div>
      <div class="BodyAfterHead"><a name="1004474">Several APIs are available at the MAC Layer that perform tasks internal to the MAC Layer. Some of these functions can be used by other layers, as well. The prototypes for these API functions are contained in the file mac.h. The file mac.cpp contains the implementation of these functions. </a></div>
      <div class="Body"><a name="1004803">Some of the MAC Layer utility APIs are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025244">MAC_IsMyHWAddress: This function checks whether a particular MAC address belongs to a specific interface of a node. The function returns TRUE if the address is a broadcast address or if the address is the unicast address of a specific interface of a node.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004790">MAC_IsMyAddress: This is an overloaded function which checks whether a particular address belongs to a specific node. One version of the function checks whether the address is the unicast address of any interface of the node. The other version checks whether the address is the unicast address of a specific interface of the node.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted" style="color: #000000; font-family: Arial; font-size: 2.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 13.00032pt; text-transform: none; vertical-align: baseline"><a name="1025276">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025277">MAC_IsBroadcastHWAddress: This function checks whether a particular address is a broadcast address.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1025267">GetMacHWAddress: This function returns the MAC address of an interface of the node.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004791">MAC_IsWiredNetwork: This function checks if the attached network is a wired network.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1004470">MAC_IsPointToPointNetwork: This function checks if the attached network is a point-to-point network.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading2Numbered">4.5.5  <a name="987174">Adding a Wired MAC Protocol </a></div>
      <div class="BodyAfterHead"><a name="992661">Although the working of each MAC protocol is different, there are certain functions that are performed by most MAC protocols. This section provides an overview of the flow of a MAC protocol for a wired network and provides an outline for developing and adding a MAC protocol, MYPROTOCOL, for a wired network to </a><span class="Variable">QualNet</span>. It describes how to develop code components common to most MAC protocols such as initializing, sending and receiving packets, and collecting statistics. </div>
      <div class="Body"><a name="992557">We illustrate the process of adding a MAC protocol for a wired network by using as an example the implementation code for the IEEE 802.3 protocol. The header file for the IEEE 802.3 implementation is mac_802_3.h and the source file is mac_802_3.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. We use code snippets from these two files throughout this section to illustrate different steps in writing a wired MAC protocol. After understanding the discussed snippets, look at the complete code for IEEE 802.3 to understand how a wired MAC protocol is implemented in <span class="Variable">QualNet</span>.</div>
      <div class="Body"><a name="992559">The following list summarizes the actions that need to be performed for adding a wired MAC protocol to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="992563">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#992730', '');" title="MAC Layer">Section&nbsp;4.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992567">Modify the file mac.cpp to include the protocol’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#992730', '');" title="MAC Layer">Section&nbsp;4.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992571">Include the protocol in the list of MAC Layer protocols and trace protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#992879', '');" title="MAC Layer">Section&nbsp;4.5.5.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992575">Define data structures for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993105', '');" title="MAC Layer">Section&nbsp;4.5.5.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992579">Decide on the format for the protocol-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993297', '');" title="MAC Layer">Section&nbsp;4.5.5.5.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992580">Read the protocol’s configuration parameters and call the protocol’s initialization function from the MAC Layer initialization function, MAC_Initialize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993627', '');" title="MAC Layer">Section&nbsp;4.5.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1028498">Call the appropriate function to assign MAC addresses to interfaces (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028344', '');" title="MAC Layer">Section&nbsp;4.5.5.5.3</a></span>). If MYPROTOCOL uses a new type of MAC address, then implement a function to assign MAC addresses of that type.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992584">Write the initialization function for the protocol. The initialization function should include the following tasks:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="992588">Declare and initialize the state variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994390', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992592">Initialize send and receive function pointers (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994121', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992596">Initialize the neighbor list (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994132', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="997842">Initialize times, if needed (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994468', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992597">Implement functions to translate between IP and MAC addresses used by MYPROTOCOL (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1026445', '');" title="MAC Layer">Section&nbsp;4.5.5.6</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1028512">Call the protocol’s event dispatcher from the MAC Layer event dispatcher, MAC_ProcessEvent (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994974', '');" title="MAC Layer">Section&nbsp;4.5.5.7.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992601">Declare any new event types used by the protocol in the header file </a><span class="Variable">QUALNET_HOME</span>/include/api.h (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995160', '');" title="MAC Layer">Section&nbsp;4.5.5.7.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992608">Write the protocol event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995160', '');" title="MAC Layer">Section&nbsp;4.5.5.7.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997897">Modify MAC Layer functions to integrate the new MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#987260', '');" title="MAC Layer">Section&nbsp;4.5.5.8</a></span>). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1002018">Modify function MAC_NetworkLayerHasPacketToSend to deliver packets received from the Network Layer to MYPROTOCOL.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1002022">Modify functions MAC_IsWiredNetwork, MAC_IsPointToPointNetwork, etc., to return the correct network type for the interface that MYPROTOCOL runs on. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997909">Write a function to handle outgoing packets (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996218', '');" title="MAC Layer">Section&nbsp;4.5.5.9.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="997917">Write a function to process incoming packets (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996350', '');" title="MAC Layer">Section&nbsp;4.5.5.9.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992613">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="992617">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996838', '');" title="MAC Layer">Section&nbsp;4.5.5.10.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992621">Initialize the statistics variables in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996861', '');" title="MAC Layer">Section&nbsp;4.5.5.10.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992625">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996912', '');" title="MAC Layer">Section&nbsp;4.5.5.10.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="992629">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997166', '');" title="MAC Layer">Section&nbsp;4.5.5.10.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1055222">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1055252', '');" title="MAC Layer">Section&nbsp;4.5.5.10.5</a></span>) .</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">17.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992630">Call the protocol finalization function from the MAC Layer finalization function, MAC_Finalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997546', '');" title="MAC Layer">Section&nbsp;4.5.5.11.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">18.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992637">Write the protocol finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997430', '');" title="MAC Layer">Section&nbsp;4.5.5.11.2</a></span>). Call the function to print statistics from the protocol finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">19.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="992645">Include the protocol header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997462', '');" title="MAC Layer">Section&nbsp;4.5.5.12</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">20.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1055198">To make the protocol available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1055289', '');" title="MAC Layer">Section&nbsp;4.5.5.13</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.5.5.1  <a name="992726">Naming Guidelines</a></div>
      <div class="BodyAfterHead"><a name="992727">In </a><span class="Variable">QualNet</span>, each component (file, data structure, function, etc.) is given a name that indicates the name of the protocol, the layer in which the protocol resides, and the functionality of the component, as appropriate. We recommend that when adding a new protocol, the programmer name the different components of the new protocol in a similar manner. It will be helpful to examine the implementation of IEEE 802.3 in <span class="Variable">QualNet</span> for hints for naming and coding different components of the new protocol.</div>
      <div class="Body"><a name="992728">In this section, we describe the steps for developing a wired MAC protocol called “MYPROTOCOL”. We will use the string “Myprotocol” in the names of the different components of this protocol, just as the string “Mac802_3” appears in the names of the components of the IEEE 802.3 implementation.</a></div>
      <div class="Heading3Numbered">4.5.5.2  <a name="992730">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1023702">The first step towards adding a MAC protocol is creating files. Most models comprise two files: the header file and the source file. These files can be placed in any library, e.g., in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. However, it is recommended that all user-developed models be made part of a library. In our example, we will place the MAC protocol in an a library called user_models. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#954568', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10</a></span> for instructions for creating and activating a library.</div>
      <div class="BodyAfterHead"><a name="1023706">If it doesn’t already exist, create a directory in </a><span class="Variable">QUALNET_HOME</span>/libraries called user_models and a subdirectory in <span class="Variable">QUALNET_HOME</span>/libraries/user_models called src. Create the files for the MAC protocol and place them in the folder <span class="Variable">QUALNET_HOME</span>/libraries/user_models/src. Name these files in a way that clearly indicates the model that they implement. Prefix the file names with <span style="font-style: italic">mac_</span> to designate the files as MAC protocol files.</div>
      <div class="Body" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: italic; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="font-style: normal"><a name="992732">Examples</a></span>:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992733">mac_802_3.h, mac_802_3.cpp: These files in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src implement the IEEE 802.3 MAC protocol.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992734">mac_tdma.h, mac_tdma.cpp: These files in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src implement the TDMA MAC protocol.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="992738">In keeping with the naming guidelines of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#992726', '');" title="MAC Layer">Section&nbsp;4.5.5.1</a></span>, the header file for the example protocol is called mac_myprotocol.h, and the source file is called mac_myprotocol.cpp.</div>
      <div class="Note_Indented"><a name="992742"><img class="Default" src="images/Chapter%204-5.09.1.1.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="992743">While adding code to the files, it is important to organize the code well between the files. Generally, the header file, mac_myprotocol.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992744">Prototypes for interface functions in the source file, mac_myprotocol.cpp</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992745">Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992746">Data structure definitions and data types: </a><span style="font-family: &quot;Courier New&quot;">struct</span> and <span style="font-family: &quot;Courier New&quot;">enum</span> declarations</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="992747">The source file, mac_myprotocol.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992748">Statement to include the protocol’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Declaration"><a name="992749">	</a></div>
      <div class="Declaration"><a name="1058138">#include “mac_myprotocol.h”</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992750">Statements to include standard library functions and other header files needed by the protocol source file. A typical protocol source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992751">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992752">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992753">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992754">#include &lt;string.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992755">#include "api.h"       // </a></span><span class="Variable" style="font-family: Arial">QUALNET_HOME</span>/include/api.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992833">#include "mac.h"       // </a></span><span class="Variable" style="font-family: Arial">QUALNET_HOME</span>/include/mac.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992834">#include "network_ip.h"        </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1023469">                  // </a></span><span class="Variable" style="font-family: Arial">QUALNET_HOME</span>/libraries/developer/src/network_ip.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992846">#include “partition.h” // </a></span><span class="Variable" style="font-family: Arial">QUALNET_HOME</span>/include/partition.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="992845">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992760">Initialization function for the protocol, MacMyprotocolInit</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992761">Event dispatcher function for the protocol, MacMyprotocolLayer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992762">Finalization function for the protocol, MacMyprotocolFinalize</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="992763">Additional protocol implementation functions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="992764">The file mac.cpp contains the layer level initialization, event dispatcher, and finalization functions. These layer level functions in turn call the protocol’s initialization, event dispatcher, and finalization functions. Therefore, to make these protocol functions available to the layer level functions, insert the following include statement in the file mac.cpp:</a></div>
      <div class="Declaration"><a name="992765">	</a></div>
      <div class="Declaration"><a name="1058153">#include “mac_myprotocol.h”</a></div>
      <div class="Heading3Numbered">4.5.5.3  <a name="992879">Including MYPROTOCOL in List of MAC Layer Protocols</a></div>
      <div class="BodyAfterHead"><a name="992880">Each node in </a><span class="Variable">QualNet</span> hosts an operating protocol stack. For each layer in the stack, a list of protocols running at that layer is maintained. When a new MAC Layer protocol is added to <span class="Variable">QualNet</span>, it needs to be included in the list of MAC Layer protocols. To do this, add the protocol name to the enumeration <span style="font-family: &quot;Courier New&quot;">MAC_PROTOCOL</span> defined in mac.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#987084', '');" title="MAC Layer">Section&nbsp;4.5.3</a></span>). </div>
      <div class="Body"><a name="992885">For our example protocol, add the entry </a><span style="font-family: &quot;Courier New&quot;">MAC_PROTOCOL_MYPROTOCOL</span><span style="font-weight: bold"> </span>to <span style="font-family: &quot;Courier New&quot;">MAC_PROTOCOL</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993045', '');" title="MAC Layer">Figure&nbsp;4-119</a></span>.</div>
      <div class="Code_Segment"><a name="992965">&nbsp;</a></div>
      <div class="Code_Segment"><a name="992966">typedef enum</a></div>
      <div class="Code_Segment"><a name="992967">{</a></div>
      <div class="Code_Segment"><a name="992968">    MAC_PROTOCOL_MPLS = 1,</a></div>
      <div class="Code_Segment"><a name="992969">    MAC_PROTOCOL_CSMA,</a></div>
      <div class="Code_Segment"><a name="992970">    MAC_PROTOCOL_FCSC_CSMA,</a></div>
      <div class="Code_Segment"><a name="992971">    MAC_PROTOCOL_MACA,</a></div>
      <div class="Code_Segment"><a name="992972">    MAC_PROTOCOL_FAMA,</a></div>
      <div class="Code_Segment"><a name="992975">    ...</a></div>
      <div class="Code_Segment"><a name="1054588">    MAC_PROTOCOL_WORMHOLE,</a></div>
      <div class="Code_Segment"><a name="1054572">    MAC_PROTOCOL_ANODR,</a></div>
      <div class="Code_Segment"><a name="1054573">    MAC_PROTOCOL_802_15_4,</a></div>
      <div class="Code_New"><a name="1023787">    MAC_PROTOCOL_MYPROTOCOL,</a></div>
      <div class="Code_Segment"><a name="1054612">    MAC_PROTOCOL_NONE // this must be the last one</a></div>
      <div class="Code_Segment"><a name="992977">} MAC_PROTOCOL;</a></div>
      <div class="Figure">FIGURE 4-119.&nbsp;&nbsp;<a name="993045">Adding MYPROTOCOL to List of MAC Layer Protocols</a></div>
      <div class="Note_Indented"><a name="993046"><img class="Default" src="images/Chapter%204-5.09.1.2.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files. </a></div>
      <div class="Body"><span class="Variable"><a name="992910">QualNet</a></span> provides for detailed traces of packets as they traverse the protocol stack at nodes in the network. A packet trace lists, among other information, the protocol that is handling the packet at the time of the trace. To facilitate tracing, <span class="Variable">QualNet</span> lists all protocols in an enumeration, <span style="font-family: &quot;Courier New&quot;">TraceProtocolType</span>, in the file <span class="Variable">QUALNET_HOME</span>/include/trace.h. For our example protocol, add an entry <span style="font-family: &quot;Courier New&quot;">TRACE_MYPROTOCOL</span> in<span style="font-family: &quot;Courier New&quot;"> TraceProtocolType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993095', '');" title="MAC Layer">Figure&nbsp;4-120</a></span>.</div>
      <div class="Code_Segment"><a name="992914">&nbsp;</a></div>
      <div class="Code_Segment"><a name="992915">typedef enum</a></div>
      <div class="Code_Segment"><a name="992916">{</a></div>
      <div class="Code_Segment"><a name="992917">    TRACE_UNDEFINED = 0,</a></div>
      <div class="Code_Segment"><a name="1023281">    TRACE_TCP,                 // 1</a></div>
      <div class="Code_Segment"><a name="992918">    TRACE_UDP,                // 2</a></div>
      <div class="Code_Segment"><a name="992919">    TRACE_IP,                 // 3</a></div>
      <div class="Code_Segment"><a name="992920">    TRACE_CBR,                // 4</a></div>
      <div class="Code_Segment"><a name="992921">    ...</a></div>
      <div class="Code_New"><a name="992926">    TRACE_MYPROTCOL,</a></div>
      <div class="Code_Segment"><a name="992927">    // Must be last one!!!</a></div>
      <div class="Code_Segment"><a name="992928">    TRACE_ANY_PROTOCOL</a></div>
      <div class="Code_Segment"><a name="992929">}TraceProtocolType;</a></div>
      <div class="Figure">FIGURE 4-120.&nbsp;&nbsp;<a name="993095">Adding MYPROTOCOL to List of Trace Protocols</a></div>
      <div class="Note_Indented"><a name="993097"><img class="Default" src="images/Chapter%204-5.09.1.3.jpg" width="48" height="37" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">TRACE_ANY_PROTOCOL</span>). </div>
      <div class="Heading3Numbered">4.5.5.4  <a name="993105">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="993106">Each MAC Layer protocol has its own data structures, which are defined in the protocol’s header file. The data structures store information such as:</a></div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="993110">Protocol parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993627', '');" title="MAC Layer">Section&nbsp;4.5.5.5.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="993114">Protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994390', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="993118">Statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996838', '');" title="MAC Layer">Section&nbsp;4.5.5.10.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="993119">Define an appropriate data structure, </a><span style="font-family: &quot;Courier New&quot;">MacDataMyprotocol</span>, for MYPROTCOL in the protocol header file, mac_myprotocol.h. As an example, the following data structure, defined in mac_802_3.h, is used by the IEEE 802.3 protocol:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993120">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993161">typedef struct struct_mac_802_3_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993162">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993163">    MacData* myMacData;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993167">    int bwInMbps;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993170">    clocktype slotTime;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993171">    clocktype interframeGap;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993172">    clocktype jamTrDelay;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993175">    Message* msgBuffer;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993178">    MAC802_3StationState stationState;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993182">    int backoffWindow;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993183">    int collisionCounter;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993185">    BOOL wasInBackoff;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054631">    int seqNum;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054632">    MAC802_3Statistics stats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054633">    LinkedList* neighborList;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054634">    BOOL isFullDuplex;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054635">    MAC802_3FullDuplexStatistics* fullDupStats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1054636">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1023813">} MacData802_3;</a></span></div>
      <div class="Body"><a name="993102">In the above declaration, </a><span style="font-family: &quot;Courier New&quot;">MAC802_3Statistics</span> is the statistics data structure and <span style="font-family: &quot;Courier New&quot;">MAC802_3StationState</span> is the enumeration of protocol states for the IEEE 802.3 protocol. See the declaration of <span style="font-family: &quot;Courier New&quot;">MacData802_3</span> in mac_802_3.h for a description of the other fields of the data structure.</div>
      <div class="Heading3Numbered">4.5.5.5  <a name="993294">Initialization</a></div>
      <div class="BodyAfterHead"><a name="993295">In this section, we describe the tasks that need to be performed as part of the initialization process of a wired MAC protocol.</a></div>
      <div class="Heading4Numbered">4.5.5.5.1  <a name="993297">Determining the Protocol Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="1013107">A MAC protocol may use protocol-specific configuration parameters. The configuration parameters are specified in the </a><span class="Variable">QualNet</span> configuration file. The format for specifying a MAC protocol’s configuration parameters is:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1013108">[&lt;Identifier&gt;] &lt;Parameter-name&gt; [&lt;Index&gt;] &lt;Parameter-value&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1013109">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="1013110">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1013111"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;	</span>: Node identifier, subnet identifier, or IP address to which this parameter declaration is applicable, enclosed in square brackets. This specification is optional, and if it is not included, the parameter declaration applies to all nodes.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="1013112">&lt;Parameter-name&gt;	</a></span>: Name of the parameter.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1013113"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;	</span>: Instance to which this parameter declaration is applicable, enclosed in square brackets. This is used when there are multiple instances of the parameter. This specification is optional, and if it is not included, the parameter declaration applies to all instances.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><span style="font-family: &quot;Courier New&quot;"><a name="1013114">&lt;Parameter-value&gt;</a></span>	: Value to be used for the parameter.</div>
      <div class="Body"><a name="993364">Generally, a wired MAC protocol requires the data rate and propagation delay to be specified. As an example, the following configuration specifies the subnet data rate and propagation delay as 10 Mbps and 1 micro-second, respectively.</a></div>
      <div class="Declaration"><a name="993332">&nbsp;</a></div>
      <div class="Declaration"><a name="1058173">SUBNET-DATA-RATE             10000000</a></div>
      <div class="Declaration"><a name="993329">SUBNET-PROPAGATION-DELAY     1US</a></div>
      <div class="Body"><a name="993315">Decide on the format for specifying the new protocol’s configuration parameters. For our example protocol, specify the configuration parameters in the </a><span class="Variable">QualNet</span> configuration file using the following format (<span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;</span> and <span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;</span> can also be used to qualify the parameter declarations, as described above):</div>
      <div class="Code_Segment_Large"><a name="993402">MAC-PROTOCOL        MYPROTOCOL</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993417">&lt;param1&gt;            &lt;value1&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993428">...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="993421">&lt;paramN&gt;            &lt;valueN&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1013052">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 18pt"><a name="1012976">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="1012977">&lt;param1&gt;</a></span>, ..., <span style="font-family: &quot;Courier New&quot;">&lt;paramN&gt;</span>	: Names of parameters for <span style="font-family: &quot;Courier New&quot;">MYPROTOCOL</span>.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 184.19976pt; margin-top: 3.0pt; text-indent: -148.19976pt"><span style="font-family: &quot;Courier New&quot;"><a name="1012978">&lt;value1&gt;</a></span>, ..., <span style="font-family: &quot;Courier New&quot;">&lt;valueN</span>	: Values of the protocol parameters.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993627', '');" title="MAC Layer" name="993291">Section&nbsp;4.5.5.5.2</a></span> explains how to read user input specified in this format to initialize the protocol.</div>
      <div class="Heading4Numbered">4.5.5.5.2  <a name="993627">Reading Configuration Parameters and Calling the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="993624">QualNet</a></span> can configure a protocol to the parameters specified by the user in the <span class="Variable">QualNet</span> configuration file that sets up the experiment. This section explains how to read these user-specified configuration parameters for the MAC protocol and provide them to the protocol's initialization function.</div>
      <div class="BodyAfterHead"><a name="993509">The protocol stack of each node is initialized in a bottom up manner. For wired networks, the MAC Layer is the bottom-most layer and is initialized first. This process is performed in the node initialization function PARTITION_InitializeNodes, implemented in </a><span class="Variable">QUALNET_HOME</span>/main/partition.cpp<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#919750', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.1</a></span>).</div>
      <div class="BodyAfterHead"><a name="993604">The node initialization function, PARTITION_InitializeNodes, calls the MAC Layer initialization function MAC_Initialize. Function MAC_Initialize reads the configuration file for lines starting with the keywords </a><span style="font-family: &quot;Courier New&quot;">SUBNET</span> or <span style="font-family: &quot;Courier New&quot;">LINK</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1025496', '');" title="MAC Layer">Figure&nbsp;4-121</a></span>). If the input line begins with the keyword <span style="font-family: &quot;Courier New&quot;">SUBNET</span>, MAC_Initialize calls the function ProcessSubnetLine. If the input line begins with the keyword <span style="font-family: &quot;Courier New&quot;">LINK</span>, MAC_Initialize calls the function ProcessLinkLine. </div>
      <div class="Code_Segment"><a name="1025423">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1025529">void</a></div>
      <div class="Code_Segment"><a name="1025424">MAC_Initialize(Node *firstNode,</a></div>
      <div class="Code_Segment"><a name="1025425">               const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1025426">{</a></div>
      <div class="Code_Segment"><a name="1025428">    ...</a></div>
      <div class="Code_Segment"><a name="1025431">    char* subnetAddressString = (char*) MEM_malloc(MAX_ADDRESS_STRING_LENGTH);</a></div>
      <div class="Code_Segment"><a name="1025433">    ...</a></div>
      <div class="Code_Segment"><a name="1025434">    for (i = 0; i &lt; nodeInput-&gt;numLines; i++)</a></div>
      <div class="Code_Segment"><a name="1025435">    {</a></div>
      <div class="Code_Segment"><a name="1025436">        char* currentLine = nodeInput-&gt;values[i];</a></div>
      <div class="Code_Segment"><a name="1025437">        char *nextSubnetString = currentLine;</a></div>
      <div class="Code_Segment"><a name="1054657">             BOOL isLink = FALSE;</a></div>
      <div class="Code_Segment"><a name="1054658">        if (strcmp(nodeInput-&gt;variableNames[i], "SUBNET") == 0)</a></div>
      <div class="Code_Segment"><a name="1054659">        {</a></div>
      <div class="Code_Segment"><a name="1054660">        }</a></div>
      <div class="Code_Segment"><a name="1054661">        else if (strcmp(nodeInput-&gt;variableNames[i], "LINK") == 0)</a></div>
      <div class="Code_Segment"><a name="1054662">        {</a></div>
      <div class="Code_Segment"><a name="1054663">            isLink = TRUE;</a></div>
      <div class="Code_Segment"><a name="1054664">        }</a></div>
      <div class="Code_Segment"><a name="1054665">        else</a></div>
      <div class="Code_Segment"><a name="1054666">        {</a></div>
      <div class="Code_Segment"><a name="1054667">            continue;</a></div>
      <div class="Code_Segment"><a name="1025438">        }</a></div>
      <div class="Code_Segment"><a name="1054683">        ...</a></div>
      <div class="Code_Segment"><a name="1054719">        if (isLink == FALSE)</a></div>
      <div class="Code_Segment"><a name="1054720">        {</a></div>
      <div class="Code_Segment"><a name="1054721">           ProcessSubnetLine(firstNode,</a></div>
      <div class="Code_Segment"><a name="1054722">                              nodeInput,</a></div>
      <div class="Code_Segment"><a name="1054723">                              ipv4subnetAddress,</a></div>
      <div class="Code_Segment"><a name="1054724">                              numHostBits,</a></div>
      <div class="Code_Segment"><a name="1054725">                              &amp;IPv6subnetAddress,</a></div>
      <div class="Code_Segment"><a name="1054726">                              IPv6subnetPrefixLen,</a></div>
      <div class="Code_Segment"><a name="1054727">                              p,</a></div>
      <div class="Code_Segment"><a name="1054728">                              &amp;subnetData-&gt;subnetList[subnetIndex],</a></div>
      <div class="Code_Segment"><a name="1054729">                              subnetIndex,</a></div>
      <div class="Code_Segment"><a name="1054730">                              siteCounter);</a></div>
      <div class="Code_Segment"><a name="1054731">        }</a></div>
      <div class="Code_Segment"><a name="1054732">        else</a></div>
      <div class="Code_Segment"><a name="1054733">        {</a></div>
      <div class="Code_Segment"><a name="1054734">            ProcessLinkLine(firstNode,</a></div>
      <div class="Code_Segment"><a name="1054735">                             nodeInput,</a></div>
      <div class="Code_Segment"><a name="1054736">                             p,</a></div>
      <div class="Code_Segment"><a name="1054737">                             siteCounter);</a></div>
      <div class="Code_Segment"><a name="1054711">         }</a></div>
      <div class="Code_Segment"><a name="1025492">    }</a></div>
      <div class="Code_Segment"><a name="1025493">    ...</a></div>
      <div class="Code_Segment"><a name="1025494">}</a></div>
      <div class="Figure">FIGURE 4-121.&nbsp;&nbsp;<a name="1025496">Processing Input File </a><span style="font-family: &quot;Courier New&quot;">SUBNET</span> and <span style="font-family: &quot;Courier New&quot;">LINK</span> Statements in MAC_Initialize</div>
      <div class="BodyAfterHead"><a name="1004397">Function ProcessSubnetLine assigns an IPv4 or IPv6 address to the subnet interface for each node in the subnet and calls function AddNodeToSubnet (AddNodeToIpv6Network) for each node. Function AddNodeToSubnet and AddNodeToIpv6Network initialize the interface information for the subnet interface and calls the initialization function for the MAC protocol specified for the subnet in the configuration file. For example, if IEEE 802.3 is specified as the MAC protocol, AddNodeToSubnet (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993726', '');" title="MAC Layer">Figure&nbsp;4-122</a></span>) and AddNodeToIpv6Network (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1026252', '');" title="MAC Layer">Figure&nbsp;4-123</a></span>) call function CreateMac802_3. Functions MAC_Initialize, ProcessSubnetLine, ProcessLinkLine, AddNodeToSubnet, AddNodeToIpv6Network, and CreateMac802_3 are implemented in the file mac.cpp.</div>
      <div class="Body"><a name="1004401">For some MAC protocols, function AddNodeToSubnet also updates the Network Layer forwarding table to include the routing information for nodes in the subnet. For IEEE 802.3, AddNodeToSubnet calls function NetworkUpdateForwardingTable to add an entry for nodes in the subnet. </a></div>
      <div class="Code_Segment"><a name="993709">&nbsp;</a></div>
      <div class="Code_Segment"><a name="993746">static void //inline//</a></div>
      <div class="Code_Segment"><a name="993747">AddNodeToSubnet(</a></div>
      <div class="Code_Segment"><a name="1026074">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1026075">    const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="1026076">    NodeAddress subnetAddress,    //base address</a></div>
      <div class="Code_Segment"><a name="1026077">    NodeAddress interfaceAddress, //my IP# on this interface</a></div>
      <div class="Code_Segment"><a name="1026078">    int numHostBits,</a></div>
      <div class="Code_Segment"><a name="1026079">    char *macProtocolName,</a></div>
      <div class="Code_Segment"><a name="1026080">    PartitionSubnetMemberData* subnetList,</a></div>
      <div class="Code_Segment"><a name="1026081">    int         nodesInSubnet,</a></div>
      <div class="Code_Segment"><a name="1026082">    int         subnetListIndex,</a></div>
      <div class="Code_Segment"><a name="1026083">    BOOL        isNewInterface,</a></div>
      <div class="Code_Segment"><a name="1026084">    short       subnetIndex)</a></div>
      <div class="Code_Segment"><a name="993757">{</a></div>
      <div class="Code_Segment"><a name="993758">    int interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="993759">    ...</a></div>
      <div class="Code_Segment"><a name="993761">    Address address;</a></div>
      <div class="Code_Segment"><a name="993762">&nbsp;</a></div>
      <div class="Code_Segment"><a name="993763">    MacAddNewInterface(node, interfaceAddress, numHostBits, &amp;interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="993767">                       nodeInput, macProtocolName, isNewInterface);</a></div>
      <div class="Code_Segment"><a name="993733">    ...</a></div>
      <div class="Code_Segment"><a name="1026121">    if(strcmp(macProtocolName, "MAC802.3") == 0 || ...)</a></div>
      <div class="Code_Segment"><a name="1026127">    {</a></div>
      <div class="Code_Segment"><a name="1026155">        /* Automatically add directly connected route to forwarding table. */</a></div>
      <div class="Code_Segment"><a name="1026156">        NetworkUpdateForwardingTable(</a></div>
      <div class="Code_Segment"><a name="1026157">                              node, subnetAddress,</a></div>
      <div class="Code_Segment"><a name="1026158">                              ConvertNumHostBitsToSubnetMask(numHostBits),</a></div>
      <div class="Code_Segment"><a name="1026159">                              0, interfaceIndex, 1, ROUTING_PROTOCOL_DEFAULT);</a></div>
      <div class="Code_Segment"><a name="1026137">    }</a></div>
      <div class="Code_Segment"><a name="1026173">    ...</a></div>
      <div class="Code_Segment"><a name="993779">    /* Select the MAC protocol and initialize. */</a></div>
      <div class="Code_Segment"><a name="993815">    if (strcmp(macProtocolName, "MAC802.3") == 0)</a></div>
      <div class="Code_Segment"><a name="993816">    {</a></div>
      <div class="Code_Segment"><a name="993817">        if (nodesInSubnet &lt; 2)</a></div>
      <div class="Code_Segment"><a name="993818">        {</a></div>
      <div class="Code_Segment"><a name="993819">            char errorStr[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="993821">            sprintf(errorStr, "There are %d nodes (fewer than two) in subnet "</a></div>
      <div class="Code_Segment"><a name="993822">                              "%d", nodesInSubnet, subnetAddress);</a></div>
      <div class="Code_Segment"><a name="993823">            ERROR_ReportError(errorStr);</a></div>
      <div class="Code_Segment"><a name="993824">        }</a></div>
      <div class="Code_Segment"><a name="993826">        CreateMac802_3(node, &amp;address, nodeInput, interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="993909">                       (SubnetMemberData *) subnetList, nodesInSubnet, </a></div>
      <div class="Code_Segment"><a name="993912">                       NETWORK_IPV4);</a></div>
      <div class="Code_Segment"><a name="993849">        return;</a></div>
      <div class="Code_Segment"><a name="993850">    }</a></div>
      <div class="Code_Segment"><a name="993851">    else if (strcmp(macProtocolName, "SATCOM") == 0)</a></div>
      <div class="Code_Segment"><a name="993734">    {</a></div>
      <div class="Code_Segment"><a name="993735">        ...</a></div>
      <div class="Code_Segment"><a name="993862">    }</a></div>
      <div class="Code_Segment"><a name="993863">    ...</a></div>
      <div class="Code_Segment"><a name="993864">}</a></div>
      <div class="Figure">FIGURE 4-122.&nbsp;&nbsp;<a name="993726">Wired MAC Initialization: Adding a Node to an IPv4 Subnet</a></div>
      <div class="Code_Segment"><a name="1026199">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026270">static void //inline//</a></div>
      <div class="Code_Segment"><a name="1054800">AddNodeToIpv6Network(</a></div>
      <div class="Code_Segment"><a name="1054801">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1054802">    const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="1054803">    in6_addr *globalAddr,</a></div>
      <div class="Code_Segment"><a name="1054804">    in6_addr *subnetAddr,</a></div>
      <div class="Code_Segment"><a name="1054805">    unsigned int subnetPrefixLen,</a></div>
      <div class="Code_Segment"><a name="1054806">    char* macProtocolName,</a></div>
      <div class="Code_Segment"><a name="1054807">    short subnetIndex,</a></div>
      <div class="Code_Segment"><a name="1054808">    SubnetMemberData* subnetList,</a></div>
      <div class="Code_Segment"><a name="1054809">    int nodesInSubnet,</a></div>
      <div class="Code_Segment"><a name="1054810">    int subnetListIndex,</a></div>
      <div class="Code_Segment"><a name="1054811">    unsigned short siteCounter,</a></div>
      <div class="Code_Segment"><a name="1026283">    BOOL isNewInterface)</a></div>
      <div class="Code_Segment"><a name="1054827">{</a></div>
      <div class="Code_Segment"><a name="1026284">    int interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1026285">    ...</a></div>
      <div class="Code_Segment"><a name="1026288">    Address address;</a></div>
      <div class="Code_Segment"><a name="1026217">    ...</a></div>
      <div class="Code_Segment"><a name="1026218">    MacAddNewInterface(node, globalAddr, subnetAddr, subnetPrefixLen,</a></div>
      <div class="Code_Segment"><a name="1026313">                       &amp;interfaceIndex, nodeInput, siteCounter,</a></div>
      <div class="Code_Segment"><a name="1026320">                       macProtocolName, isNewInterface);</a></div>
      <div class="Code_Segment"><a name="1026220">    ...</a></div>
      <div class="Code_Segment"><a name="1026321">    SetIPv6AddressInfo(&amp;address, *globalAddr);</a></div>
      <div class="Code_Segment"><a name="1026330">    ...</a></div>
      <div class="Code_Segment"><a name="1026335">       /* Select the MAC protocol and initialize. */</a></div>
      <div class="Code_Segment"><a name="1026336">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1026337">    if (strcmp(macProtocolName, "MAC802.3") == 0)</a></div>
      <div class="Code_Segment"><a name="1026338">    {</a></div>
      <div class="Code_Segment"><a name="1026339">        if (nodesInSubnet &lt; 2)</a></div>
      <div class="Code_Segment"><a name="1026340">        {</a></div>
      <div class="Code_Segment"><a name="1026341">            char errorStr[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1026343">            /*sprintf(errorStr, "There are %d nodes (fewer than two) in subnet"</a></div>
      <div class="Code_Segment"><a name="1026344">                  " TLA=%u, NLA=%u, SLA=%u", nodesInSubnet, tla, nla, sla);*/</a></div>
      <div class="Code_Segment"><a name="1026345">            ERROR_ReportError(errorStr);</a></div>
      <div class="Code_Segment"><a name="1026346">        }</a></div>
      <div class="Code_Segment"><a name="1026348">        CreateMac802_3(node, &amp;address, nodeInput,</a></div>
      <div class="Code_Segment"><a name="1026349">            interfaceIndex, subnetList, nodesInSubnet, NETWORK_IPV6);</a></div>
      <div class="Code_Segment"><a name="1026351">        return;</a></div>
      <div class="Code_Segment"><a name="1026221">    }</a></div>
      <div class="Code_Segment"><a name="1026371">    else if (strcmp(macProtocolName, "SATCOM") == 0)</a></div>
      <div class="Code_Segment"><a name="1026372">    {</a></div>
      <div class="Code_Segment"><a name="1026373">        ...</a></div>
      <div class="Code_Segment"><a name="1026374">    }</a></div>
      <div class="Code_Segment"><a name="1026331">    ...</a></div>
      <div class="Code_Segment"><a name="1026250">}</a></div>
      <div class="Figure">FIGURE 4-123.&nbsp;&nbsp;<a name="1026252">Wired MAC Initialization: Adding a Node to an IPv6 Subnet</a></div>
      <div class="Body"><a name="993620">Function CreateMac802_3, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993990', '');" title="MAC Layer">Figure&nbsp;4-124</a></span>, reads the parameters for the protocol by calling function Mac802_3GetSubnetParameters, stores the parameters in the protocol data structure for the interface, <span style="font-family: &quot;Courier New&quot;">macData[interfaceIndex]</span>, initializes the Network Layer queues for the interface by calling function NetworkIpCreateQueues, and calls the initialization function for the IEEE 802.3 protocol, Mac802_3Init. NetworkIpCreateQueues is implemented in <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.cpp and the IEEE 802.3 functions are implemented in mac_802_3.cpp.</div>
      <div class="Code_Segment"><a name="994016">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023872">static void</a></div>
      <div class="Code_Segment"><a name="1023873">CreateMac802_3(</a></div>
      <div class="Code_Segment"><a name="1023874">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1023875">    Address* address,</a></div>
      <div class="Code_Segment"><a name="1023877">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="1023878">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1023879">    SubnetMemberData* subnetList,</a></div>
      <div class="Code_Segment"><a name="1023880">    int nodesInSubnet,</a></div>
      <div class="Code_Segment"><a name="1023881">    NetworkType networkType,</a></div>
      <div class="Code_Segment"><a name="1023882">    BOOL fromLink = FALSE)</a></div>
      <div class="Code_Segment"><a name="1023883">{</a></div>
      <div class="Code_Segment"><a name="1023884">    Int64 subnetBandwidth;</a></div>
      <div class="Code_Segment"><a name="1023885">    clocktype subnetPropDelay;</a></div>
      <div class="Code_Segment"><a name="1023886">    ...</a></div>
      <div class="Code_Segment"><a name="1023887">    Mac802_3GetSubnetParameters(node,</a></div>
      <div class="Code_Segment"><a name="1026392">                                interfaceIndex</a></div>
      <div class="Code_Segment"><a name="1026391">                                nodeInput,</a></div>
      <div class="Code_Segment"><a name="1023888">                                address,</a></div>
      <div class="Code_Segment"><a name="1023889">                                &amp;subnetBandwidth,</a></div>
      <div class="Code_Segment"><a name="1023890">                                &amp;subnetPropDelay,</a></div>
      <div class="Code_Segment"><a name="1023891">                                fromLink);</a></div>
      <div class="Code_Segment"><a name="1023892">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023893">    if (fromLink)</a></div>
      <div class="Code_Segment"><a name="1023894">    {</a></div>
      <div class="Code_Segment"><a name="1023895">        SetMacConfigParameter(node,</a></div>
      <div class="Code_Segment"><a name="1023896">                              interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1023897">                              nodeInput);</a></div>
      <div class="Code_Segment"><a name="1023899">    }</a></div>
      <div class="Code_Segment"><a name="1023900">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023901">    NetworkIpCreateQueues(node, nodeInput, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1023902">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023903">    node-&gt;macData[interfaceIndex]-&gt;macProtocol = MAC_PROTOCOL_802_3;</a></div>
      <div class="Code_Segment"><a name="1023904">    node-&gt;macData[interfaceIndex]-&gt;bandwidth = subnetBandwidth;</a></div>
      <div class="Code_Segment"><a name="1023905">    node-&gt;macData[interfaceIndex]-&gt;propDelay = subnetPropDelay;</a></div>
      <div class="Code_Segment"><a name="1023906">    node-&gt;macData[interfaceIndex]-&gt;mplsVar = NULL;</a></div>
      <div class="Code_Segment"><a name="1023907">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023908">    Mac802_3Init(node,</a></div>
      <div class="Code_Segment"><a name="1023909">                 nodeInput,</a></div>
      <div class="Code_Segment"><a name="1023910">                 interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1023912">                 subnetList,</a></div>
      <div class="Code_Segment"><a name="1023913">                 nodesInSubnet);</a></div>
      <div class="Code_Segment"><a name="1023914">}</a></div>
      <div class="Figure">FIGURE 4-124.&nbsp;&nbsp;<a name="993990">MAC Protocol Initialization: Function CreateMac802_3</a></div>
      <div class="Heading4Numbered">4.5.5.5.3  <a name="1028344">Initializing MAC Address</a></div>
      <div class="BodyAfterHead"><a name="1028345">As part of the initialization of the MAC protocol at an interface, the interface is assigned a MAC address. This section describes how this is done for IPv4 networks. For IPv6 networks, the steps are very similar.</a></div>
      <div class="Body"><a name="1028346">If a node is added to a subnet by means of the </a><span style="font-family: &quot;Courier New&quot;">SUBNET</span> keyword in the configuration file, function MAC_Initialize calls function ProcessInpuFileSubnetLine, which in turn calls function AddNodeToSubnet. (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993627', '');" title="MAC Layer">Section&nbsp;4.5.5.5.2</a></span>). Function AddNodeToSubnet calls function MacAddNewInterface, which initializes the interface information for the node’s interface to the subnet. MacAddNewInterface calls function MacConfigureHWAddress to initialize the MAC address for the interface.</div>
      <div class="Body"><a name="1028350">MacConfigureHWAddress configures the hardware address at an interface of the node. MacAddNewInterface reads the MAC address configuration file if this interface address is not defined in the scenario configuration (.config) file. If the MAC address configuration file contains a MAC address for the interface being initialized, then that MAC address is assigned to the interface. Otherwise, MacConfigureHWAddress calls one of the following functions to assign a MAC address to the interface:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1028351">MacSetDefaultHWAddress: To assign an Ethernet-type (6-byte) MAC address as a combination of node identifier and interface index</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1028352">MAC_SetFourByteMacAddress: To assign a 4-byte MAC address</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1028353">MAC_SetTwoByteMacAddress: To assign a 2-byte MAC address</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1028354">Modify MacConfigureHWAddress to call the function to configure the MAC address for MYPROTOCOL, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028413', '');" title="MAC Layer">Figure&nbsp;4-125</a></span>. The example in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028413', '');" title="MAC Layer">Figure&nbsp;4-125</a></span> assumes that MYPROTOCOL uses a 4-byte MAC address which is configured by function MAC_SetFourByteMacAddress.</div>
      <div class="Body"><a name="1028361">If MYPROTOCOL supports a different type of MAC address, then you may need to implement a new MAC address generation function and call it from MacConfigureHWAddress.</a></div>
      <div class="Code_Segment"><a name="1028362">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1028363">static</a></div>
      <div class="Code_Segment"><a name="1028364">void MacConfigureHWAddress(</a></div>
      <div class="Code_Segment"><a name="1028365">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1028366">    NodeId nodeId,</a></div>
      <div class="Code_Segment"><a name="1028367">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1028368">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="1028369">    MacHWAddress* macAddr,</a></div>
      <div class="Code_Segment"><a name="1028370">    char *macProtocolName,</a></div>
      <div class="Code_Segment"><a name="1028371">    NetworkType networkType,</a></div>
      <div class="Code_Segment"><a name="1028372">    Address ipAddr)</a></div>
      <div class="Code_Segment"><a name="1028373">{</a></div>
      <div class="Code_Segment"><a name="1028374">    ...</a></div>
      <div class="Code_Segment"><a name="1028375">    macAddrConfigured = readInterfaceMacAddress(node, nodeid, interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1028376">                                                nodeInput, macAddr, </a></div>
      <div class="Code_Segment"><a name="1028377">                                                readMacAddress, ipAddr);</a></div>
      <div class="Code_Segment"><a name="1028378">     if(!macAddrConfigured)</a></div>
      <div class="Code_Segment"><a name="1028379">     {</a></div>
      <div class="Code_Segment"><a name="1028380">          IO_ReadCachedFile(node, nodeid, interfaceIndex, nodeInput,</a></div>
      <div class="Code_Segment"><a name="1028381">                            "MAC-ADDRESS-CONFIG-FILE", &amp;retVal, &amp;macAddrInput);</a></div>
      <div class="Code_Segment"><a name="1028382">            ...</a></div>
      <div class="Code_Segment"><a name="1028383">    }   </a></div>
      <div class="Code_Segment"><a name="1028384">   if (!macAddrConfigured)</a></div>
      <div class="Code_Segment"><a name="1028385">    {</a></div>
      <div class="Code_Segment"><a name="1028386">        if(strcmp(macProtocolName, "MAC802.3")==0 ||</a></div>
      <div class="Code_Segment"><a name="1028387">           ...</a></div>
      <div class="Code_Segment"><a name="1028388">           strcmp(macProtocolName, "SWITCHED-ETHERNET") == 0)</a></div>
      <div class="Code_Segment"><a name="1028389">        {</a></div>
      <div class="Code_Segment"><a name="1028390">                MacSetDefaultHWAddress(nodeId, macAddr, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1028391">        }</a></div>
      <div class="Code_Segment"><a name="1028392">        else if(strcmp(macProtocolName, "MAC-LINK-11") == 0 ||</a></div>
      <div class="Code_New"><a name="1028393">                strcmp(macProtocolName, "MYPROTOCOL") == 0  ||</a></div>
      <div class="Code_Segment"><a name="1028394">                ...</a></div>
      <div class="Code_Segment"><a name="1028395">                strcmp(macProtocolName, "MAC-SRW") == 0)</a></div>
      <div class="Code_Segment"><a name="1028396">       {</a></div>
      <div class="Code_Segment"><a name="1028397">               MAC_SetFourByteMacAddress(node, nodeId, macAddr, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1028398">        }</a></div>
      <div class="Code_Segment"><a name="1028399">        else if(strcmp(macProtocolName, "MAC802.15.4") == 0)</a></div>
      <div class="Code_Segment"><a name="1028400">        {</a></div>
      <div class="Code_Segment"><a name="1028401">              MAC_SetTwoByteMacAddress(node, macAddr, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1028402">        }</a></div>
      <div class="Code_Segment"><a name="1028403">        else</a></div>
      <div class="Code_Segment"><a name="1028404">        {</a></div>
      <div class="Code_Segment"><a name="1028405">                ERROR_Assert(FALSE,</a></div>
      <div class="Code_Segment"><a name="1028406">                        "Invalid Mac Protocol or does not "</a></div>
      <div class="Code_Segment"><a name="1028407">                        "have any supported Mac address type");</a></div>
      <div class="Code_Segment"><a name="1028408">        }</a></div>
      <div class="Code_Segment"><a name="1028409">    }</a></div>
      <div class="Code_Segment"><a name="1028410">    ...</a></div>
      <div class="Code_Segment"><a name="1028411">}</a></div>
      <div class="Figure">FIGURE 4-125.&nbsp;&nbsp;<a name="1028413">MAC Address Configuration Function</a></div>
      <div class="Heading4Numbered">4.5.5.5.4  <a name="1028341">Implementing the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="994065">The initialization of a MAC protocol takes place in the initialization function of the protocol that is indirectly called by the MAC Layer initialization function MAC_Initialize. The initialization function of a wired MAC protocol commonly performs the following tasks:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994196">Create an instance of the protocol data structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994197">Calculate and store the protocol’s operational parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994198">Initialize the state variables</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994199">Initialize the send and receive function pointers</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994376">Collect neighbor information and create the neighbor list</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994066">Schedule timers, if required</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="993623">Like all other functions belonging to the protocol, the prototype for the initialization function should be included in the protocol's header file, mac_myprotocol.h.</a></div>
      <div class="Heading5Numbered">4.5.5.5.4.1  <a name="994390">Creating an Instance and Initializing the State</a></div>
      <div class="BodyAfterHead"><a name="994391">The initialization function initializes the protocol state. Each protocol has a structure that it uses to store state information. This may include information such as the protocol state and parameters, neighbor information, etc. Each instance of the protocol maintains its own state variable. </a></div>
      <div class="Body"><a name="994577">To store the state, declare the structure to hold the protocol state in the header file, mac_myprotocol.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993105', '');" title="MAC Layer">Section&nbsp;4.5.5.4</a></span>). As an example, see the declaration of the IEEE 802.3 data structure <span style="font-family: &quot;Courier New&quot;">MacData802_3</span> in mac_802_3.h.</div>
      <div class="Body"><a name="994575">Create an instance of the protocol state by allocating memory to the state structure. IEEE 802.3 performs this task in its initialization function Mac802_3Init by calling the function MEM_malloc to allocate memory for the IEEE 802.3 data structure </a><span style="font-family: &quot;Courier New&quot;">MacData802_3</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994268', '');" title="MAC Layer">Figure&nbsp;4-126</a></span>. Mac802_3Init and the other IEEE 802.3 functions are implemented in mac_802_3.cpp. Data structure and constant definitions for IEEE 802.3 are contained in mac_802_3.h. </div>
      <div class="Body"><a name="994637">Mac802_3Init also sets up pointers between the newly created instance of the IEEE 802.3 data structure </a><span style="font-family: &quot;Courier New&quot;">MacData802_3</span> and the data structure that stores the MAC Layer information for the interface, <span style="font-family: &quot;Courier New&quot;">macData[interfaceIndex]</span>.</div>
      <div class="Body"><a name="994669">The state variables for the protocol are also initialized in the initialization function. For example, Mac802_3Init initializes the protocol status (mode), backoff window, message buffer, etc.</a></div>
      <div class="BodyAfterHead"><a name="994704">The initialization function of a wired MAC protocol also calculates and stores the values of parameters that it requires in its operation. For example, function Mac802_3Init calculates and stores the values of the slot time, inter-frame gap and jam transmission time used by IEEE 802.3 by calling functions Mac802_3GetSlotTime, Mac802_3GetInterframeDelay, and Mac802_3GetJamTrDelay, respectively.</a></div>
      <div class="Code_Segment"><a name="994234">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1023953">void Mac802_3Init(</a></div>
      <div class="Code_Segment"><a name="1023954">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1023955">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="1023956">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1023958">    SubnetMemberData* nodeList,</a></div>
      <div class="Code_Segment"><a name="1023959">    int numNodesInSubnet)</a></div>
      <div class="Code_Segment"><a name="1023960">{</a></div>
      <div class="Code_Segment"><a name="1023961">    MacData802_3* mac802_3;</a></div>
      <div class="Code_Segment"><a name="1023962">    ...</a></div>
      <div class="Code_Segment"><a name="1023968">    mac802_3 = (MacData802_3 *) MEM_malloc(sizeof(MacData802_3));</a></div>
      <div class="Code_Segment"><a name="1023969">    memset(mac802_3, 0, sizeof(MacData802_3));</a></div>
      <div class="Code_Segment"><a name="1023971">    mac802_3-&gt;myMacData = node-&gt;macData[interfaceIndex];</a></div>
      <div class="Code_Segment"><a name="1023972">    mac802_3-&gt;myMacData-&gt;macVar = (void *) mac802_3;</a></div>
      <div class="Code_Segment"><a name="1023974">    RANDOM_SetSeed(mac802_3-&gt;seed,</a></div>
      <div class="Code_Segment"><a name="1023975">                   node-&gt;globalSeed,</a></div>
      <div class="Code_Segment"><a name="1023976">                   node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1023977">                   MAC_PROTOCOL_802_3,</a></div>
      <div class="Code_Segment"><a name="1023978">                   interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1023983">    // Get channel bandwidth</a></div>
      <div class="Code_Segment"><a name="1023984">    mac802_3-&gt;bwInMbps = (int) (mac802_3-&gt;myMacData-&gt;bandwidth / 1000000);</a></div>
      <div class="Code_Segment"><a name="1023986">    // Initialize slot time, interframe gap and Jam transmission time.</a></div>
      <div class="Code_Segment"><a name="1023987">    mac802_3-&gt;slotTime = Mac802_3GetSlotTime(node, mac802_3);</a></div>
      <div class="Code_Segment"><a name="1023988">    mac802_3-&gt;interframeGap = Mac802_3GetInterframeDelay(node, mac802_3);</a></div>
      <div class="Code_Segment"><a name="1023989">    mac802_3-&gt;jamTrDelay = Mac802_3GetJamTrDelay(node, mac802_3);</a></div>
      <div class="Code_Segment"><a name="1023991">    // Initially there is no packet in own buffer</a></div>
      <div class="Code_Segment"><a name="1023992">    mac802_3-&gt;msgBuffer = NULL;</a></div>
      <div class="Code_Segment"><a name="1023994">    // Initialize state, collision counter</a></div>
      <div class="Code_Segment"><a name="1023995">    // Backoff Window &amp; Backoff Flag for this interface</a></div>
      <div class="Code_Segment"><a name="1023996">    mac802_3-&gt;stationState = IDLE_STATE;</a></div>
      <div class="Code_Segment"><a name="1023997">    mac802_3-&gt;collisionCounter = 0;</a></div>
      <div class="Code_Segment"><a name="1023998">    mac802_3-&gt;wasInBackoff = FALSE;</a></div>
      <div class="Code_Segment"><a name="1023999">    mac802_3-&gt;backoffWindow = MAC802_3_MIN_BACKOFF_WINDOW;</a></div>
      <div class="Code_Segment"><a name="1024000">    mac802_3-&gt;seqNum = 0;</a></div>
      <div class="Code_Segment"><a name="1024001">    ...</a></div>
      <div class="Code_Segment"><a name="1024008">    // Initialize neighbor list for this station</a></div>
      <div class="Code_Segment"><a name="1024009">    ListInit(node, &amp;mac802_3-&gt;neighborList);</a></div>
      <div class="Code_Segment"><a name="1024011">    mac802_3-&gt;link= (LinkData*)MEM_malloc(sizeof(LinkData));</a></div>
      <div class="Code_Segment"><a name="1024012">    memset(mac802_3-&gt;link, 0, sizeof(LinkData));</a></div>
      <div class="Code_Segment"><a name="1024014">    Mac802_3GetNeighborInfo(</a></div>
      <div class="Code_Segment"><a name="1024015">        node,</a></div>
      <div class="Code_Segment"><a name="1024016">        mac802_3-&gt;neighborList,</a></div>
      <div class="Code_Segment"><a name="1024017">        nodeList,</a></div>
      <div class="Code_Segment"><a name="1024018">        numNodesInSubnet,</a></div>
      <div class="Code_Segment"><a name="1024019">        mac802_3-&gt;link);</a></div>
      <div class="Code_Segment"><a name="1024021">    mac802_3-&gt;link-&gt;myMacData = mac802_3-&gt;myMacData;</a></div>
      <div class="Code_Segment"><a name="1024022">    ...</a></div>
      <div class="Code_Segment"><a name="994275">}</a></div>
      <div class="Figure">FIGURE 4-126.&nbsp;&nbsp;<a name="994268">IEEE 802.3 Initialization Function</a></div>
      <div class="Heading5Numbered">4.5.5.5.4.2  <a name="994121">Initializing Send and Receive Function Pointers</a></div>
      <div class="BodyAfterHead"><a name="994122">Each MAC protocol implements a function to transmit packets to the network and a function to handle packets received from the network. The pointers to these send and receive functions are stored in the </a><span style="font-family: &quot;Courier New&quot;">sendFrameFn</span> and <span style="font-family: &quot;Courier New&quot;">receiveFrameFn</span> fields, respectively, of the data structure that stores the MAC Layer information for the interface. This initialization is also done in the protocol initialization function. For example, the send and receive functions for the IEEE 802.3 protocol are Mac802_3NetworkLayerHasPacketToSend and Mac802_3HandleReceivedFrame, respectively (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994268', '');" title="MAC Layer">Figure&nbsp;4-126</a></span>).</div>
      <div class="Body"><a name="996321">For MYPROTOCOL, write the send and receive functions MacMyprotocolNetworkLayerHasPacketToSend and MacMyprotocolHandleReceivedFrame (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995822', '');" title="MAC Layer">Section&nbsp;4.5.5.9</a></span>) and set the send receive function pointers <span style="font-family: &quot;Courier New&quot;">sendFrameFn</span> and <span style="font-family: &quot;Courier New&quot;">receiveFrameFn</span> of the MAC data structure for the interface to point to these functions.</div>
      <div class="Heading5Numbered">4.5.5.5.4.3  <a name="994132">Initializing Neighbor List</a></div>
      <div class="BodyAfterHead"><a name="994732">For a wired MAC protocol, a node maintains a list of nodes to which it is connected through the subnet interface. This neighbor list is initialized in the protocol’s initialization function. For example, for the IEEE 802.3 protocol, function Mac802_3Init calls function Mac802_3GetNeighborInfo (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994268', '');" title="MAC Layer">Figure&nbsp;4-126</a></span>) to set up the neighbor list for a node. </div>
      <div class="Heading5Numbered">4.5.5.5.4.4  <a name="994468">Initializing Timers</a></div>
      <div class="BodyAfterHead"><a name="994857">A MAC protocol may need to set timers at initialization. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#920185', '');" title="Discrete-event Simulation in QualNet">Section&nbsp;3.3.2.2</a></span> for details on setting timers.</div>
      <div class="Heading3Numbered">4.5.5.6  <a name="1026445">Implementing Address Translation Functions</a></div>
      <div class="BodyAfterHead"><a name="1028433">Since the Network Layer and MAC Layer use different addresses for the same interface, the protocol implementation should provide for a way to translate from one address to another. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028437', '');" title="MAC Layer">Section&nbsp;4.5.5.6.1</a></span> describes the function to translate an IP address to a MAC address. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028443', '');" title="MAC Layer">Section&nbsp;4.5.5.6.2</a></span> describes the function to translate a MAC address to an IP address.</div>
      <div class="Heading4Numbered">4.5.5.6.1  <a name="1028437">IP to MAC Address Translation Function</a></div>
      <div class="BodyAfterHead"><a name="1028708">When the Network Layer passes a packet to the MAC Layer, it also passes the MAC address of the next hop. If ARP is not enabled, the Network Layer calls function IPv4AddressToHWAddress (for IPv4 networks) to translate the IP address of the next hop to the MAC address used by the MAC protocol running at the interface.</a></div>
      <div class="Body"><a name="1028817">This section describes the translation from IPv4 to MAC addresses.</a></div>
      <div class="Body"><a name="1028709">Function IPv4AddressToHWAddress translates an IP address to a MAC address based on the MAC protocol used by the interface. For Example, for the IEEE 802.3 protocol, function IPv4AddressToHWAddress calls function IPv4AddressToDefaultHWAddress, which translates an IPv4 address to a MAC address (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1027359', '');" title="MAC Layer">Figure&nbsp;4-127</a></span>). Modify function IPv4AddressToHWAddress&nbsp;to call the translation function for MYPROTOCOL. The example in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1027359', '');" title="MAC Layer">Figure&nbsp;4-127</a></span> assumes that MYPROTOCOL uses a 4-byte MAC address and calls MAC_FourByteMacAddressToVariableHWAddress which translates an IPv4 address to a MAC address. Functions IPv4AddressToHWAddress, IPv4AddressToDefaultHWAddress, and MAC_FourByteMacAddressToVariableHWAddress are implemented in mac.cpp.</div>
      <div class="Body"><a name="1028472">If MYPROTOCOL supports a different type of MAC address, then you may need to implement a new MAC address to IPv4 address translation function.</a></div>
      <div class="Code_Segment"><a name="1027148">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1027192">BOOL IPv4AddressToHWAddress(</a></div>
      <div class="Code_Segment"><a name="1027193">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1027194">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1027195">    Message* msg,</a></div>
      <div class="Code_Segment"><a name="1027196">    NodeAddress ipv4Address,</a></div>
      <div class="Code_Segment"><a name="1027197">    MacHWAddress* macAddr)</a></div>
      <div class="Code_Segment"><a name="1027198">{</a></div>
      <div class="Code_Segment"><a name="1027200">    BOOL isResolved = FALSE;</a></div>
      <div class="Code_Segment"><a name="1027202">    switch (node-&gt;macData[interfaceIndex]-&gt;macProtocol)</a></div>
      <div class="Code_Segment"><a name="1027203">    {</a></div>
      <div class="Code_Segment"><a name="1027204">        ...</a></div>
      <div class="Code_Segment"><a name="1027206">        case MAC_PROTOCOL_802_3:</a></div>
      <div class="Code_Segment"><a name="1027207">        case MAC_PROTOCOL_ALOHA:</a></div>
      <div class="Code_Segment"><a name="1027213">        ...</a></div>
      <div class="Code_Segment"><a name="1027214">        case MAC_PROTOCOL_LINK:</a></div>
      <div class="Code_Segment"><a name="1027215">        {</a></div>
      <div class="Code_Segment"><a name="1027216">            (*macAddr).byte = (unsigned char*) MEM_malloc(</a></div>
      <div class="Code_Segment"><a name="1027217">                      sizeof(unsigned char)*MAC_ADDRESS_DEFAULT_LENGTH);</a></div>
      <div class="Code_Segment"><a name="1027218">            IPv4AddressToDefaultHWAddress(node, interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1027219">                                          ipv4Address, macAddr);</a></div>
      <div class="Code_Segment"><a name="1027220">            isResolved = TRUE;</a></div>
      <div class="Code_Segment"><a name="1027221">            break;</a></div>
      <div class="Code_Segment"><a name="1027222">        }</a></div>
      <div class="Code_Segment"><a name="1027290">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1027292">        case MAC_PROTOCOL_DOT11:  </a></div>
      <div class="Code_Segment"><a name="1027293">        ..</a></div>
      <div class="Code_New"><a name="1027299">        case MAC_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_Segment"><a name="1027294">        ...</a></div>
      <div class="Code_Segment"><a name="1027242">        case MAC_PROTOCOL_CES_WINTGBS:</a></div>
      <div class="Code_Segment"><a name="1027244">         {</a></div>
      <div class="Code_Segment"><a name="1027245">                MAC_FourByteMacAddressToVariableHWAddress(node,</a></div>
      <div class="Code_Segment"><a name="1027246">                                                          interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1027247">                                                          macAddr,</a></div>
      <div class="Code_Segment"><a name="1027248">                                                          ipv4Address);</a></div>
      <div class="Code_Segment"><a name="1027249">                isResolved = TRUE;</a></div>
      <div class="Code_Segment"><a name="1027250">                break;</a></div>
      <div class="Code_Segment"><a name="1027251">         }</a></div>
      <div class="Code_Segment"><a name="1027260">         ...</a></div>
      <div class="Code_Segment"><a name="1027318">        default:</a></div>
      <div class="Code_Segment"><a name="1027261">            ...</a></div>
      <div class="Code_Segment"><a name="1027264">    }</a></div>
      <div class="Code_Segment"><a name="1027266">    return isResolved;</a></div>
      <div class="Code_Segment"><a name="1027187">}</a></div>
      <div class="Figure">FIGURE 4-127.&nbsp;&nbsp;<a name="1027359">Function to Translate IPv4 Addresses to MAC Addresses</a></div>
      <div class="Heading4Numbered">4.5.5.6.2  <a name="1028443">MAC to IP Address Translation Function</a></div>
      <div class="BodyAfterHead"><a name="1028818">When ARP is not enabled, some protocols may need to translate the MAC address of an interface to the IP address. This section describes the translation from MAC to IPv4 addresses.</a></div>
      <div class="Body"><a name="1028442">Function MacHWAddressToIpv4Address translates a MAC address to an IP address based on the MAC address type. For example, for an Ethernet type address, function MacHWAddressToIpv4Address calls function DefaultMac802AddressToIpv4Address to translate the MAC address to IPv4 address (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1027359', '');" title="MAC Layer">Figure&nbsp;4-127</a></span>). Functions MacHWAddressToIpv4Address and DefaultMac802AddressToIpv4Address are implemented in mac.cpp.</div>
      <div class="Body"><a name="1027381">If MYPROTOCOL supports a different type of MAC address, then you may need to implement a new IPv4 address to MAC address translation function.</a></div>
      <div class="Code_Segment"><a name="1027387">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1027451">NodeAddress MacHWAddressToIpv4Address(</a></div>
      <div class="Code_Segment"><a name="1027388">                Node *node,</a></div>
      <div class="Code_Segment"><a name="1027389">                int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1027390">                MacHWAddress* macAddr)</a></div>
      <div class="Code_Segment"><a name="1027391">{</a></div>
      <div class="Code_Segment"><a name="1027393">    if (MAC_IsBroadcastHWAddress(macAddr))</a></div>
      <div class="Code_Segment"><a name="1027394">    {</a></div>
      <div class="Code_Segment"><a name="1027395">            return ANY_DEST;</a></div>
      <div class="Code_Segment"><a name="1027396">    }</a></div>
      <div class="Code_Segment"><a name="1027397">    else if (ArpIsEnable(node,interfaceIndex))</a></div>
      <div class="Code_Segment"><a name="1027398">    {</a></div>
      <div class="Code_Segment"><a name="1027399">        return ReverseArpTableLookUp(node, interfaceIndex, macAddr);</a></div>
      <div class="Code_Segment"><a name="1027400">    }</a></div>
      <div class="Code_Segment"><a name="1027401">    else</a></div>
      <div class="Code_Segment"><a name="1027402">    {</a></div>
      <div class="Code_Segment"><a name="1027403">            switch(macAddr-&gt;hwType)</a></div>
      <div class="Code_Segment"><a name="1027404">            {</a></div>
      <div class="Code_Segment"><a name="1027405">                case HW_TYPE_ETHER:</a></div>
      <div class="Code_Segment"><a name="1027406">                {</a></div>
      <div class="Code_Segment"><a name="1027407">                      Mac802Address mac802Addr;</a></div>
      <div class="Code_Segment"><a name="1027408">                      ConvertVariableHWAddressTo802Address(node,</a></div>
      <div class="Code_Segment"><a name="1027409">                                                           macAddr,</a></div>
      <div class="Code_Segment"><a name="1027410">                                                           &amp;mac802Addr);</a></div>
      <div class="Code_Segment"><a name="1027411">                      return DefaultMac802AddressToIpv4Address(node,</a></div>
      <div class="Code_Segment"><a name="1027412">                                                               &amp;mac802Addr);</a></div>
      <div class="Code_Segment"><a name="1027413">                      break;</a></div>
      <div class="Code_Segment"><a name="1027414">                }</a></div>
      <div class="Code_Segment"><a name="1027415">                case IPV4_LINKADDRESS:</a></div>
      <div class="Code_Segment"><a name="1027416">                {</a></div>
      <div class="Code_Segment"><a name="1027417">                    return MAC_VariableHWAddressToFourByteMacAddress (</a></div>
      <div class="Code_Segment"><a name="1027418">                                                               node,macAddr);</a></div>
      <div class="Code_Segment"><a name="1027420">                    break;</a></div>
      <div class="Code_Segment"><a name="1027421">                }</a></div>
      <div class="Code_Segment"><a name="1027422">                case HW_NODE_ID:</a></div>
      <div class="Code_Segment"><a name="1027423">                {</a></div>
      <div class="Code_Segment"><a name="1027424">                    ...</a></div>
      <div class="Code_Segment"><a name="1027429">                }</a></div>
      <div class="Code_Segment"><a name="1027430">                default:</a></div>
      <div class="Code_Segment"><a name="1027431">                    ERROR_Assert(FALSE, "Unsupported hardware type");</a></div>
      <div class="Code_Segment"><a name="1027432">                    break;</a></div>
      <div class="Code_Segment"><a name="1027433">            }</a></div>
      <div class="Code_Segment"><a name="1027434">    }</a></div>
      <div class="Code_Segment"><a name="1027436">    return 0;</a></div>
      <div class="Code_Segment"><a name="1027382">}</a></div>
      <div class="Figure">FIGURE 4-128.&nbsp;&nbsp;<a name="1027459">Function to Translate MAC Addresses to IPv4 Addresses</a></div>
      <div class="Heading3Numbered">4.5.5.7  <a name="1027362">Implementing the Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="994870">In this section, we describe the steps for implementing the event dispatcher function for a wired MAC protocol. </a></div>
      <div class="Body"><a name="994874">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#933631', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.2</a></span>, when an event occurs, it is first handled by the node level dispatcher function NODE_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/node.cpp. If the event is for the MAC Layer, NODE_ProcessEvent calls the MAC Layer event dispatcher MAC_ProcessEvent, defined in mac.cpp. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994974', '');" title="MAC Layer" name="994962">Section&nbsp;4.5.5.7.1</a></span> describes how to modify the MAC Layer event dispatcher function to call the MAC protocol’s event dispatcher. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995160', '');" title="MAC Layer">Section&nbsp;4.5.5.7.2</a></span> describes how to implement the MAC protocol’s event dispatcher.</div>
      <div class="Heading4Numbered">4.5.5.7.1  <a name="994974">Modifying the MAC Layer Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="994975">Function MAC_ProcessEvent implements the MAC Layer event dispatcher that informs the appropriate MAC protocol of received events. Messages contain the index of the interface for which the event has occurred. The API function MESSAGE_GetInstanceId returns the interface index. MAC_ProcessEvent implements a switch statement on the protocol that is running at the interface read from the message and calls the appropriate protocol-specific event dispatcher. </a></div>
      <div class="Body"><a name="994979">To enable the protocol MYPROTOCOL to receive events, add code to MAC_ProcessEvent to call the protocol's event dispatcher function when messages for the protocol are received. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994966', '');" title="MAC Layer">Figure&nbsp;4-129</a></span> shows a code fragment from MAC_ProcessEvent with sample code for calling MYPROTOCOL’s event dispatcher function MacMyprotocolLayer.</div>
      <div class="Code_Segment"><a name="994983">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995045">void</a></div>
      <div class="Code_Segment"><a name="995046">MAC_ProcessEvent(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="995047">{</a></div>
      <div class="Code_Segment"><a name="995048">    int interfaceIndex = MESSAGE_GetInstanceId(msg);</a></div>
      <div class="Code_Segment"><a name="995049">    int protocol = MESSAGE_GetProtocol(msg);</a></div>
      <div class="Code_Segment"><a name="995059">    ...</a></div>
      <div class="Code_Segment"><a name="995064">   /* Select the MAC protocol model, and direct it to handle the message. */</a></div>
      <div class="Code_Segment"><a name="995065">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995066">    switch (node-&gt;macData[interfaceIndex]-&gt;macProtocol)</a></div>
      <div class="Code_Segment"><a name="995067">    {</a></div>
      <div class="Code_Segment"><a name="995068">        ...</a></div>
      <div class="Code_Segment"><a name="1054121">        case MAC_PROTOCOL_DOT11:</a></div>
      <div class="Code_Segment"><a name="1054122">        {</a></div>
      <div class="Code_Segment"><a name="1054123">            MacDot11Layer(node, interfaceIndex, msg);</a></div>
      <div class="Code_Segment"><a name="1054124">            break;</a></div>
      <div class="Code_Segment"><a name="999599">        }</a></div>
      <div class="Code_Segment"><a name="1054140">        case MAC_PROTOCOL_CSMA:</a></div>
      <div class="Code_Segment"><a name="999600">        {</a></div>
      <div class="Code_Segment"><a name="999601">            MacCsmaLayer(node, interfaceIndex, msg);</a></div>
      <div class="Code_Segment"><a name="999602">            break;</a></div>
      <div class="Code_Segment"><a name="995073">        }</a></div>
      <div class="Code_Segment"><a name="999610">        ...</a></div>
      <div class="Code_New"><a name="995095">        case MAC_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="995096">        {</a></div>
      <div class="Code_New"><a name="995097">            MacMyprotocolLayer(node, interfaceIndex, msg);</a></div>
      <div class="Code_New"><a name="995098">            break;</a></div>
      <div class="Code_New"><a name="995062">        }</a></div>
      <div class="Code_Segment"><a name="995112">        ...</a></div>
      <div class="Code_Segment"><a name="995113">     }</a></div>
      <div class="Code_Segment"><a name="995114">}</a></div>
      <div class="Figure">FIGURE 4-129.&nbsp;&nbsp;<a name="994966">MAC Layer Event Dispatcher </a></div>
      <div class="Heading4Numbered">4.5.5.7.2  <a name="995160">Implementing the Protocol Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="995161">A protocol's event dispatcher should include a switch on all message types that the protocol may receive. It can then process each message type either inside the switch or by calling a function to handle the message type received. </a></div>
      <div class="Body"><a name="995162">All event types used by </a><span class="Variable">QualNet</span> protocols are enumerated in the file <span class="Variable">QUALNET_HOME</span>/include/api.h. If the protocol being added needs additional event types, these should be included in the enumeration in file api.h, as shown in <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995189', '');" title="MAC Layer">Figure&nbsp;4-130</a>. </div>
      <div class="Code_Segment"><a name="995166">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995167">// /**</a></div>
      <div class="Code_Segment"><a name="995168">// ENUM        :: MESSAGE/EVENT</a></div>
      <div class="Code_Segment"><a name="995169">// DESCRIPTION :: Event/message types exchanged in the simulation</a></div>
      <div class="Code_Segment"><a name="995170">// **/</a></div>
      <div class="Code_Segment"><a name="995171">enum</a></div>
      <div class="Code_Segment"><a name="995172">{</a></div>
      <div class="Code_Segment"><a name="995173">    /* Special message types used for internal design. */</a></div>
      <div class="Code_Segment"><a name="995174">    MSG_SPECIAL_Timer                          = 0,</a></div>
      <div class="Code_Segment"><a name="995175">    ...</a></div>
      <div class="Code_Segment"><a name="995176">    /* Message Types for Channel layer */</a></div>
      <div class="Code_Segment"><a name="995177">    MSG_PROP_SignalArrival                     = 100,</a></div>
      <div class="Code_Segment"><a name="995178">    MSG_PROP_SignalEnd                         = 101,</a></div>
      <div class="Code_Segment"><a name="995179">    ...</a></div>
      <div class="Code_Segment"><a name="995180">    /*</a></div>
      <div class="Code_Segment"><a name="995181">     * Any other message types which have to be added should be added before</a></div>
      <div class="Code_Segment"><a name="995182">     * MSG_DEFAULT. Otherwise the program will not work correctly.</a></div>
      <div class="Code_Segment"><a name="995183">     */</a></div>
      <div class="Code_New"><a name="995184">    MSG_MAC_MYPROTOCOL_NewEvent1,</a></div>
      <div class="Code_New"><a name="995185">    MSG_MAC_MYPROTOCOL_NewEvent2,</a></div>
      <div class="Code_Segment"><a name="995186">    MSG_DEFAULT                                = 10000</a></div>
      <div class="Code_Segment"><a name="995187">};</a></div>
      <div class="Figure">FIGURE 4-130.&nbsp;&nbsp;<a name="995189">Declaring New Event Types</a></div>
      <div class="Note_Indented"><a name="995190">Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">MSG_DEFAULT</span>).<img class="Default" src="images/Chapter%204-5.09.1.4.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></div>
      <div class="Body"><a name="995252">The event dispatcher function for a MAC protocol handles both packet and timer events. As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995191', '');" title="MAC Layer">Figure&nbsp;4-131</a></span> shows the IEEE 802.3 event dispatcher function Mac802_3Layer. Note that once a message has been processed, it is freed by calling the API MESSAGE_Free, unless it is used to forward a packet to the upper layers. The event dispatcher also includes a default case in the switch statement to handle events of an unknown type.</div>
      <div class="Note_Indented"><a name="995259"><img class="Default" src="images/Chapter%204-5.09.1.5.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is important to free the memory after the message has been processed; otherwise, the simulator will leak memory.</a></div>
      <div class="Body"><a name="995261">In </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995191', '');" title="MAC Layer">Figure&nbsp;4-131</a></span>, event <span style="font-family: &quot;Courier New&quot;">MSG_MAC_StartTransmission</span> is an example of a timer event that is scheduled by one node for another node. Such timer events are used in wired MAC Protocols and Physical Layer models to model signal propagation. In IEEE 802.3, when a node starts transmitting a frame, it schedules a timer event of type <span style="font-family: &quot;Courier New&quot;">MSG_MAC_StartTransmission</span> to occur at each of its neighbor nodes after a delay that is equal to the propagation delay between the transmitting node and the receiving node. Event <span style="font-family: &quot;Courier New&quot;">MSG_MAC_TransmissionFinished</span> indicates the end of transmission of a frame. If the node is in the proper state (<span style="font-family: &quot;Courier New&quot;">RECEIVING_STATE</span>), this event also indicates that a packet has arrived at the node. Event <span style="font-family: &quot;Courier New&quot;">MSG_MAC_JamSequence</span> indicates the end of a jam sequence transmitted by a neighboring node. Event <span style="font-family: &quot;Courier New&quot;">MSG_MAC_TimerExpired</span> is a self timer, i.e., a timer that is scheduled by a node for itself. </div>
      <div class="BodyAfterHead"><a name="1002565">See files mac_802_3.h and mac_802_3.cpp for definitions of data structures and functions used for implementing IEEE 802.3.</a></div>
      <div class="Code_Segment"><a name="995273">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995362">void Mac802_3Layer(</a></div>
      <div class="Code_Segment"><a name="995363">    Node* node,</a></div>
      <div class="Code_Segment"><a name="995364">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="995365">    Message* msg)</a></div>
      <div class="Code_Segment"><a name="995366">{</a></div>
      <div class="Code_Segment"><a name="995367">    MacData802_3* mac802_3 = (MacData802_3 *)</a></div>
      <div class="Code_Segment"><a name="995368">                              node-&gt;macData[interfaceIndex]-&gt;macVar;</a></div>
      <div class="Code_Segment"><a name="1024219">    ...</a></div>
      <div class="Code_Segment"><a name="995370">    switch (msg-&gt;eventType)</a></div>
      <div class="Code_Segment"><a name="995371">    {</a></div>
      <div class="Code_Segment"><a name="995372">        case MSG_MAC_StartTransmission:</a></div>
      <div class="Code_Segment"><a name="995373">        {</a></div>
      <div class="Code_Segment"><a name="995274">            // Indicates some node has started to send a frame</a></div>
      <div class="Code_Segment"><a name="995381">           ...</a></div>
      <div class="Code_Segment"><a name="995389">        }</a></div>
      <div class="Code_Segment"><a name="995394">        case MSG_MAC_TransmissionFinished:</a></div>
      <div class="Code_Segment"><a name="995395">        {</a></div>
      <div class="Code_Segment"><a name="995387">            // Indicates a frame has come up to this node.</a></div>
      <div class="Code_Segment"><a name="995382">            ...</a></div>
      <div class="Code_Segment"><a name="995407">        }</a></div>
      <div class="Code_Segment"><a name="995401">        case MSG_MAC_JamSequence:</a></div>
      <div class="Code_Segment"><a name="995399">        {</a></div>
      <div class="Code_Segment"><a name="995405">           ...</a></div>
      <div class="Code_Segment"><a name="995406">        }</a></div>
      <div class="Code_Segment"><a name="995410">        case MSG_MAC_TimerExpired:</a></div>
      <div class="Code_Segment"><a name="995411">        {</a></div>
      <div class="Code_Segment"><a name="995412">            MAC802_3TimerType timerType;</a></div>
      <div class="Code_Segment"><a name="995413">            MAC802_3SelfTimer* info = NULL;</a></div>
      <div class="Code_Segment"><a name="995415">            // Get info from message</a></div>
      <div class="Code_Segment"><a name="995416">            info = (MAC802_3SelfTimer *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="995417">            timerType = info-&gt;timerType;</a></div>
      <div class="Code_Segment"><a name="995419">            switch (timerType)</a></div>
      <div class="Code_Segment"><a name="995420">            {</a></div>
      <div class="Code_Segment"><a name="995421">                case mac_802_3_TimerSendPacket:</a></div>
      <div class="Code_Segment"><a name="995408">                {</a></div>
      <div class="Code_Segment"><a name="995425">                   ...</a></div>
      <div class="Code_Segment"><a name="995426">                }</a></div>
      <div class="Code_Segment"><a name="995429">                case mac_802_3_ChannelIdle:</a></div>
      <div class="Code_Segment"><a name="995427">                {</a></div>
      <div class="Code_Segment"><a name="995433">                   ...</a></div>
      <div class="Code_Segment"><a name="995436">                }</a></div>
      <div class="Code_Segment"><a name="995437">                ...</a></div>
      <div class="Code_Segment"><a name="995444">            }</a></div>
      <div class="Code_Segment"><a name="995501">            ...</a></div>
      <div class="Code_Segment"><a name="995502">        }</a></div>
      <div class="Code_Segment"><a name="995503">        default:</a></div>
      <div class="Code_Segment"><a name="995451">        {</a></div>
      <div class="Code_Segment"><a name="995452">            ...</a></div>
      <div class="Code_Segment"><a name="995461">        }</a></div>
      <div class="Code_Segment"><a name="995462">    }</a></div>
      <div class="Code_Segment"><a name="995463">}</a></div>
      <div class="Figure">FIGURE 4-131.&nbsp;&nbsp;<a name="995191">IEEE 802.3 Event Dispatcher</a></div>
      <div class="Heading3Numbered">4.5.5.8  <a name="987260">Modifying MAC Layer Functions</a></div>
      <div class="BodyAfterHead"><a name="995571">The MAC Layer function MAC_NetworkLayerHasPacketToSend is used by the IP protocol, when the output queue is empty, to indicate to the MAC Layer that IP has a packet to send. MAC_NetworkLayerHasPacketToSend calls the send function for the MAC protocol running at the interface to process the packet from the Network Layer. To add a new MAC protocol, MYPROTOCOL, modify MAC_NetworkLayerHasPacketToSend so that the packet handler function for MYPROTCOL is called when MYPROTOCOL is running at the interface. MAC_NetworkLayerHasPacketToSend is implemented in mac.cpp. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995620', '');" title="MAC Layer">Figure&nbsp;4-132</a></span> shows the changes that need to be made MAC_NetworkLayerHasPacketToSend. For IEEE 802.3, the function to handle packets received from the Network Layer is Mac802_3NetworkLayerHasPacketToSend (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995822', '');" title="MAC Layer">Section&nbsp;4.5.5.9</a></span>). A pointer to this function is stored in the <span style="font-family: &quot;Courier New&quot;">sendFrameFn</span> field of the MAC data structure for that interface during initialization (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994121', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4.2</a></span>). The changes shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995620', '');" title="MAC Layer">Figure&nbsp;4-132</a></span> assume that the initialization for MYPROTOCOL is done in the same way as for IEEE 802.3, described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028341', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4</a></span>, i.e., a pointer to the send function for MYPROTOCOL, MacMyprotocolNetworkLayerHaspacketToSend, is stored in <span style="font-family: &quot;Courier New&quot;">sendFrameFn.</span></div>
      <div class="Code_Segment"><a name="995617">&nbsp;</a></div>
      <div class="Code_Segment"><a name="995691">void</a></div>
      <div class="Code_Segment"><a name="995692">MAC_NetworkLayerHasPacketToSend(Node *node, int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="995693">{</a></div>
      <div class="Code_Segment"><a name="995694">    /* Select the MAC protocol model, and direct it to send/buffer the</a></div>
      <div class="Code_Segment"><a name="995695">       packet. */</a></div>
      <div class="Code_Segment"><a name="995618">    ...</a></div>
      <div class="Code_Segment"><a name="995707">    switch (node-&gt;macData[interfaceIndex]-&gt;macProtocol)</a></div>
      <div class="Code_Segment"><a name="995708">    {</a></div>
      <div class="Code_Segment"><a name="995716">         ...</a></div>
      <div class="Code_Segment"><a name="995736">        case MAC_PROTOCOL_802_3:</a></div>
      <div class="Code_Segment"><a name="995737">        {</a></div>
      <div class="Code_Segment"><a name="995738">            (*node-&gt;macData[interfaceIndex]-&gt;sendFrameFn)</a></div>
      <div class="Code_Segment"><a name="995739">                (node, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="995740">            break;</a></div>
      <div class="Code_Segment"><a name="995741">        }</a></div>
      <div class="Code_New"><a name="995742">        case MAC_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="995743">        {</a></div>
      <div class="Code_New"><a name="995767">            (*node-&gt;macData[interfaceIndex]-&gt;sendFrameFn)</a></div>
      <div class="Code_New"><a name="995768">                (node, interfaceIndex);</a></div>
      <div class="Code_New"><a name="995816">            break;</a></div>
      <div class="Code_New"><a name="995817">        }</a></div>
      <div class="Code_Segment"><a name="995818">        ...</a></div>
      <div class="Code_Segment"><a name="995778">     }</a></div>
      <div class="Code_Segment"><a name="995779">}</a></div>
      <div class="Figure">FIGURE 4-132.&nbsp;&nbsp;<a name="995620">Delivering Packets from Network Layer to MAC Protocols</a></div>
      <div class="BodyAfterHead"><a name="987261">The MAC Layer also implements several functions that are used by upper layer protocols to determine the type of interface. These functions are:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="995827">MAC_IsWiredNetwork: This function returns TRUE if the interface is a wired network.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="995835">MAC_IsPointToPointNetwork: This function returns TRUE if the interface is a point-to-point link.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="995853">MAC_IsWiredBroadcastNetwork: This function returns TRUE if the interface is a wired broadcast network.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="995861">MAC_IsWirelessNetwork: This function returns TRUE if the interface is a wireless network.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="995870">MAC_IsOneHopBroadcastNetwork: This function returns TRUE if the interface is a one-hop broadcast network.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="995821">These functions are implemented in mac.cpp. To add MYPROTOCOL to </a><span class="Variable">QualNet</span>, modify these functions so that they correctly indicate the type of network that MYPROTCOL runs on. As an example, the modification to function MAC_IsWiredNetwork is shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995999', '');" title="MAC Layer">Figure&nbsp;4-133</a></span>.</div>
      <div class="Code_Segment"><a name="995967">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996003">BOOL</a></div>
      <div class="Code_Segment"><a name="996004">MAC_IsWiredNetwork(Node *node, int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="996005">{</a></div>
      <div class="Code_Segment"><a name="996006">    // Abstract satellite model is considered a wired network</a></div>
      <div class="Code_Segment"><a name="996007">    // for the time being.</a></div>
      <div class="Code_Segment"><a name="996008">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996009">    if (node-&gt;macData[interfaceIndex]-&gt;macProtocol == MAC_PROTOCOL_LINK ||</a></div>
      <div class="Code_Segment"><a name="996010">//      node-&gt;macData[interfaceIndex]-&gt;macProtocol == MAC_PROTOCOL_MPLS ||</a></div>
      <div class="Code_Segment"><a name="996011">        node-&gt;macData[interfaceIndex]-&gt;macProtocol == MAC_PROTOCOL_802_3 ||</a></div>
      <div class="Code_New"><a name="996023">        node-&gt;macData[interfaceIndex]-&gt;macProtocol == </a></div>
      <div class="Code_New"><a name="996028">                                              MAC_PROTOCOL_MYPROTOCOL ||</a></div>
      <div class="Code_Segment"><a name="996012">        node-&gt;macData[interfaceIndex]-&gt;macProtocol ==</a></div>
      <div class="Code_Segment"><a name="996013">                                              MAC_PROTOCOL_SWITCHED_ETHERNET)</a></div>
      <div class="Code_Segment"><a name="996014">    {</a></div>
      <div class="Code_Segment"><a name="996015">        return TRUE;</a></div>
      <div class="Code_Segment"><a name="996016">    }</a></div>
      <div class="Code_Segment"><a name="996017">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996018">    return FALSE;</a></div>
      <div class="Code_Segment"><a name="995998">}</a></div>
      <div class="Figure">FIGURE 4-133.&nbsp;&nbsp;<a name="995999">Determining MAC Protocol Type</a></div>
      <div class="Heading3Numbered">4.5.5.9  <a name="995822">Interfacing with Network Layer</a></div>
      <div class="BodyAfterHead"><a name="1004194">In this section we describe the interface between the Network Layer and a wired MAC Protocol.</a></div>
      <div class="Body"><a name="1004195">A wired MAC protocol interacts with the Network Layer in the following ways:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1004196">When IP has a packet to send and the output queue is empty, IP indicates to the MAC protocol that a packet is ready for transmission. If the MAC protocol is in the appropriate state, it dequeues the packet from the output queue, adds a MAC header, and transmits the packet. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996218', '');" title="MAC Layer">Section&nbsp;4.5.5.9.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002104">When the state of the MAC protocol changes to one where it can transmit a packet, the MAC protocol checks the output queue. If the queue is non-empty, the MAC protocol dequeues a packet from the queue, adds a MAC header, and transmits the packet. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996218', '');" title="MAC Layer">Section&nbsp;4.5.5.9.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002108">When the MAC protocol receives a packet from the network that is meant for the Network Layer, the MAC protocol delivers the packet to the Network Layer. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996350', '');" title="MAC Layer">Section&nbsp;4.5.5.9.2</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002112">When the MAC protocol receives a packet from the network that is not addressed to the node, but the node is operating in promiscuous mode, the MAC protocol delivers the packet to the Network Layer. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996350', '');" title="MAC Layer">Section&nbsp;4.5.5.9.2</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002116">Some MAC protocols pass an indication to the Network Layer when certain events occur at the MAC Layer. These events include: a packet being dropped at the MAC Layer and receiving a MAC Layer acknowledgement for a transmitted packet. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1002173', '');" title="MAC Layer">Section&nbsp;4.5.5.9.3</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading4Numbered">4.5.5.9.1  <a name="996218">Processing Outgoing Packets</a></div>
      <div class="BodyAfterHead"><a name="996224">When IP has a packet to send to the MAC Layer and the output queue is empty, IP calls function MAC_NetworkLayerHasPacketToSend. MAC_NetworkLayerHasPacketToSend calls the appropriate function for the MAC protocol running at the interface to process the packet from the Network Layer (see.</a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#987260', '');" title="MAC Layer">Section&nbsp;4.5.5.8</a></span>). If IEEE 802.3 is running at the interface, MAC_NetworkLayerHasPacketToSend calls the IEEE 802.3 function Mac802_3NetworkLayerHasPacketToSend. Mac802_3NetworkLayerHasPacketToSend, shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996181', '');" title="MAC Layer">Figure&nbsp;4-134</a></span> and implemented in mac_802_3.cpp, checks the status of the node.</div>
      <div class="Body"><a name="1002043">If the node’s status is </a><span style="font-family: &quot;Courier New&quot;">IDLE_STATE</span> and its message buffer is empty, Mac802_3NetworkLayerHasPacketToSend does the following:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002044">Mac802_3NetworkLayerHasPacketToSend calls function Mac802_3RetrievePacketFromQIntoOwnBuffer to retrieve a packet from the output queue and add a MAC header to it by calling function Mac802_3CreateFrame.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002055">Mac802_3NetworkLayerHasPacketToSend then calls function Mac802_3SenseChannel to sense the channel and transmit the packet if the node’s status is </a><span style="font-family: &quot;Courier New&quot;">IDLE_STATE</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="996149">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996185">static void Mac802_3NetworkLayerHasPacketToSend(</a></div>
      <div class="Code_Segment"><a name="996186">    Node* node,</a></div>
      <div class="Code_Segment"><a name="996187">    int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="996188">{</a></div>
      <div class="Code_Segment"><a name="996189">    MacData802_3* mac802_3 = (MacData802_3 *)</a></div>
      <div class="Code_Segment"><a name="996190">                              node-&gt;macData[interfaceIndex]-&gt;macVar;</a></div>
      <div class="Code_Segment"><a name="996191">    ...</a></div>
      <div class="Code_Segment"><a name="996192">    if (mac802_3-&gt;stationState == IDLE_STATE)</a></div>
      <div class="Code_Segment"><a name="996193">    {</a></div>
      <div class="Code_Segment"><a name="996194">        // Check if there is any frame into own buffer</a></div>
      <div class="Code_Segment"><a name="996195">        if (mac802_3-&gt;msgBuffer != NULL)</a></div>
      <div class="Code_Segment"><a name="996196">        {</a></div>
      <div class="Code_Segment"><a name="996197">            // Frame present.</a></div>
      <div class="Code_Segment"><a name="996198">            // So no need to retrieve another.</a></div>
      <div class="Code_Segment"><a name="996199">            return;</a></div>
      <div class="Code_Segment"><a name="996200">        }</a></div>
      <div class="Code_Segment"><a name="996201">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996202">        // Retrieve the packet from queue into own buffer</a></div>
      <div class="Code_Segment"><a name="996203">        Mac802_3RetrievePacketFromQIntoOwnBuffer(node, mac802_3);</a></div>
      <div class="Code_Segment"><a name="996204">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996205">        // Sense the channel to transmit frame</a></div>
      <div class="Code_Segment"><a name="996206">        Mac802_3SenseChannel(node, mac802_3);</a></div>
      <div class="Code_Segment"><a name="996207">    }</a></div>
      <div class="Code_Segment"><a name="996208">}</a></div>
      <div class="Figure">FIGURE 4-134.&nbsp;&nbsp;<a name="996181">Processing Outgoing Packets</a></div>
      <div class="Body"><a name="998590">For MYPROTOCOL, write a function, MacMyprotocolNetworkLayerHasPacketToSend, that performs appropriate actions to process an outgoing packet.</a></div>
      <div class="Heading4Numbered">4.5.5.9.2  <a name="996350">Processing Incoming Packets</a></div>
      <div class="BodyAfterHead"><a name="996348">The arrival of an incoming packet at a node is indicated by an event that is scheduled by the transmitting node. In IEEE 802.3, when a node completes transmission of a packet, it schedules event </a><span style="font-family: &quot;Courier New&quot;">MSG_MAC_TransmissionFinished</span> at all other nodes in the subnet to occur after the propagation delay. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996802', '');" title="MAC Layer" name="996573">Figure&nbsp;4-135</a></span> shows the code segment from the IEEE 802.3 event handler function Mac802_3Layer that handles incoming packets. If the node’s status is <span style="font-family: &quot;Courier New&quot;">RECEIVING_STATE</span>, then the event <span style="font-family: &quot;Courier New&quot;">MSG_MAC_TransmissionFinished</span> indicates that a packet has arrived at the node. Function Mac802_3Layer calls the receive function for IEEE 802.3, Mac802_3HandleReceivedFrame, to process the received frame. Note that a pointer to this function is stored in the <span style="font-family: &quot;Courier New&quot;">receiveFrameFn</span> field of the MAC data structure for that interface during initialization (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994121', '');" title="MAC Layer">Section&nbsp;4.5.5.5.4.2</a></span>).</div>
      <div class="Code_Segment"><a name="996390">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996577">void Mac802_3Layer(</a></div>
      <div class="Code_Segment"><a name="996391">    Node* node,</a></div>
      <div class="Code_Segment"><a name="996392">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="996393">    Message* msg)</a></div>
      <div class="Code_Segment"><a name="996394">{</a></div>
      <div class="Code_Segment"><a name="1024232">    MacData802_3* mac802_3 = (MacData802_3 *)</a></div>
      <div class="Code_Segment"><a name="1024233">                              node-&gt;macData[interfaceIndex]-&gt;macVar;</a></div>
      <div class="Code_Segment"><a name="1024237">    ...</a></div>
      <div class="Code_Segment"><a name="1024234">    switch (msg-&gt;eventType)</a></div>
      <div class="Code_Segment"><a name="996398">    {</a></div>
      <div class="Code_Segment"><a name="996399">        ...</a></div>
      <div class="Code_Segment"><a name="996404">        case MSG_MAC_TransmissionFinished:</a></div>
      <div class="Code_Segment"><a name="996405">        {</a></div>
      <div class="Code_Segment"><a name="996406">            // Indicates a frame has come up to this node.</a></div>
      <div class="Code_Segment"><a name="996466">            if (mac802_3-&gt;stationState == RECEIVING_STATE)</a></div>
      <div class="Code_Segment"><a name="996467">            {</a></div>
      <div class="Code_Segment"><a name="996468">                // Frame received successfully.</a></div>
      <div class="Code_Segment"><a name="996469">                // Check the frame. If it is intended for this station</a></div>
      <div class="Code_Segment"><a name="996470">                // forward it to upper layer.</a></div>
      <div class="Code_Segment"><a name="996471">                (*mac802_3-&gt;myMacData-&gt;receiveFrameFn)(node,</a></div>
      <div class="Code_Segment"><a name="996472">                                                       interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="996473">                                                       msg);</a></div>
      <div class="Code_Segment"><a name="996475">                if (mac802_3-&gt;wasInBackoff)</a></div>
      <div class="Code_Segment"><a name="996476">                {</a></div>
      <div class="Code_Segment"><a name="996477">                    // Previously, station was in Backoff state.</a></div>
      <div class="Code_Segment"><a name="996478">                    // So change station state as Backoff.</a></div>
      <div class="Code_Segment"><a name="996480">                    mac802_3-&gt;stationState = BACKOFF_STATE;</a></div>
      <div class="Code_Segment"><a name="996481">                }</a></div>
      <div class="Code_Segment"><a name="996482">                else</a></div>
      <div class="Code_Segment"><a name="996483">                {</a></div>
      <div class="Code_Segment"><a name="996484">                    // Station was Idle previously.</a></div>
      <div class="Code_Segment"><a name="996485">                    // Make station Idle and try to send next frame</a></div>
      <div class="Code_Segment"><a name="996486">                    // if available.</a></div>
      <div class="Code_Segment"><a name="996488">                    mac802_3-&gt;stationState = IDLE_STATE;</a></div>
      <div class="Code_Segment"><a name="996489">                    Mac802_3TryToSendNextFrame(node, mac802_3);</a></div>
      <div class="Code_Segment"><a name="996490">                }</a></div>
      <div class="Code_Segment"><a name="996492">                // Msg, containing the frame, will be freed properly later.</a></div>
      <div class="Code_Segment"><a name="996493">            }</a></div>
      <div class="Code_Segment"><a name="996494">            else</a></div>
      <div class="Code_Segment"><a name="996495">            {</a></div>
      <div class="Code_Segment"><a name="996496">                // Received a corrupted frame due to collision.</a></div>
      <div class="Code_Segment"><a name="996497">                // Discard this runt frame.</a></div>
      <div class="Code_Segment"><a name="996498">                MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="996499">            }</a></div>
      <div class="Code_Segment"><a name="996500">            break;</a></div>
      <div class="Code_Segment"><a name="996407">        }   ...</a></div>
      <div class="Code_Segment"><a name="996408">        ...</a></div>
      <div class="Code_Segment"><a name="996412">     }</a></div>
      <div class="Code_Segment"><a name="996439">}</a></div>
      <div class="Figure">FIGURE 4-135.&nbsp;&nbsp;<a name="996802">Processing Incoming Packets</a></div>
      <div class="Body"><a name="996807">Function Mac802_3HandleReceivedFrame, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996630', '');" title="MAC Layer">Figure&nbsp;4-136</a></span>, performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996751">Mac802_3HandleReceivedFrame checks if the packet is addressed to the node. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996755">If the packet is addressed to the node, Mac802_3HandleReceivedFrame calls function Mac802_3ConvertFrameIntoPacket to remove the MAC header from the packet and delivers the packet to the upper layers by calling function MAC_HandoffSuccessfullyReceivedPacket.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996767">If the packet is not addressed to the node but the node is operating in promiscuous mode, Mac802_3HandleReceivedFrame calls function Mac802_3ConvertFrameIntoPacket to remove the MAC header from the packet and then calls function MAC_SneakPeakAtMacPacket to enable the Network Layer to examine the received packet.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1058217">If the packet is not addressed to the node and the node is not operating in promiscuous mode, Mac802_3HandleReceivedFrame ignores the received packet.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1058218">static void Mac802_3HandleReceivedFrame(</a></div>
      <div class="Code_Segment"><a name="1058219">    Node* node,</a></div>
      <div class="Code_Segment"><a name="996640">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="996641">    Message* msg)</a></div>
      <div class="Code_Segment"><a name="996642">{</a></div>
      <div class="Code_Segment"><a name="996645">    MacHeaderVlanTag tagInfo;</a></div>
      <div class="Code_Segment"><a name="996646">    unsigned short lengthOfPacket = 0;</a></div>
      <div class="Code_Segment"><a name="1027487">    MacHWAddress srcHWAddr;</a></div>
      <div class="Code_Segment"><a name="1027488">    MacHWAddress destHWAddr;</a></div>
      <div class="Code_Segment"><a name="996647">&nbsp;</a></div>
      <div class="Code_Segment"><a name="996648">    MacData802_3* mac802_3 = (MacData802_3 *)</a></div>
      <div class="Code_Segment"><a name="996649">                              node-&gt;macData[interfaceIndex]-&gt;macVar;</a></div>
      <div class="Code_Segment"><a name="996651">    ...</a></div>
      <div class="Code_Segment"><a name="1027500">    // Get destination and source address from the frame.</a></div>
      <div class="Code_Segment"><a name="1027501">    Mac802_3GetSrcAndDestAddrFromFrame(node, msg, &amp;destHWAddr, &amp;srcHWAddr);</a></div>
      <div class="Code_Segment"><a name="996661">    ...</a></div>
      <div class="Code_Segment"><a name="1054854">    BOOL isMyAddr = FALSE;</a></div>
      <div class="Code_Segment"><a name="1054856">    if (NetworkIpIsUnnumberedInterface(node, interfaceIndex))</a></div>
      <div class="Code_Segment"><a name="1054857">    {</a></div>
      <div class="Code_Segment"><a name="1054858">        isMyAddr = (MAC_IsBroadcastHWAddress(&amp;destHWAddr) ||</a></div>
      <div class="Code_Segment"><a name="1054859">                        MAC_IsMyAddress(node, &amp;destHWAddr));</a></div>
      <div class="Code_Segment"><a name="1054860">    }</a></div>
      <div class="Code_Segment"><a name="1054861">    else</a></div>
      <div class="Code_Segment"><a name="1054862">    {</a></div>
      <div class="Code_Segment"><a name="1054863">       isMyAddr = MAC_IsMyHWAddress(node, interfaceIndex, &amp;destHWAddr);</a></div>
      <div class="Code_Segment"><a name="996662">    }</a></div>
      <div class="Code_Segment"><a name="1054875">    // Checking whether the message is intended for this station</a></div>
      <div class="Code_Segment"><a name="996664">   if (isMyAddr)</a></div>
      <div class="Code_Segment"><a name="1054894">    {</a></div>
      <div class="Code_Segment"><a name="996665">        // Frame intended for me. Increase numFrameReceived statistic</a></div>
      <div class="Code_Segment"><a name="996666">        mac802_3-&gt;stats.numFrameReceived++;</a></div>
      <div class="Code_Segment"><a name="996667">        Mac802_3Trace(node, mac802_3, msg, "R");</a></div>
      <div class="Code_Segment"><a name="996669">        Mac802_3ConvertFrameIntoPacket(node, msg, &amp;tagInfo);</a></div>
      <div class="Code_Segment"><a name="996671">        ...</a></div>
      <div class="Code_Segment"><a name="996678">        MAC_HandOffSuccessfullyReceivedPacket(</a></div>
      <div class="Code_Segment"><a name="996679">            node, interfaceIndex, msg, &amp;srcHWAddr);</a></div>
      <div class="Code_Segment"><a name="996680">    }</a></div>
      <div class="Code_Segment"><a name="996682">    // If node is operating in promiscuous mode then let</a></div>
      <div class="Code_Segment"><a name="996683">    // Network layer sneak a peak at the packet</a></div>
      <div class="Code_Segment"><a name="996684">    else if (node-&gt;macData[interfaceIndex]-&gt;promiscuousMode)</a></div>
      <div class="Code_Segment"><a name="996685">    {</a></div>
      <div class="Code_Segment"><a name="996686">        // Frame intended for me. So increase the numFrameReceived statistic.</a></div>
      <div class="Code_Segment"><a name="996688">        mac802_3-&gt;stats.numFrameReceived++;</a></div>
      <div class="Code_Segment"><a name="996689">        Mac802_3Trace(node, mac802_3, msg, "R");</a></div>
      <div class="Code_Segment"><a name="996691">        Mac802_3ConvertFrameIntoPacket(node, msg, &amp;tagInfo);</a></div>
      <div class="Code_Segment"><a name="996693">        ...</a></div>
      <div class="Code_Segment"><a name="996700">        MAC_SneakPeekAtMacPacket(</a></div>
      <div class="Code_Segment"><a name="996701">            node, interfaceIndex, msg, srcAddr, destHWAddr);</a></div>
      <div class="Code_Segment"><a name="996703">        MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="996704">    }</a></div>
      <div class="Code_Segment"><a name="996705">    else</a></div>
      <div class="Code_Segment"><a name="996706">    {</a></div>
      <div class="Code_Segment"><a name="996707">        // Message for unknown destination. So ignore it.</a></div>
      <div class="Code_Segment"><a name="996708">        MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="996709">    }</a></div>
      <div class="Code_Segment"><a name="996710">}</a></div>
      <div class="Figure">FIGURE 4-136.&nbsp;&nbsp;<a name="996630">Handling Received Packets</a></div>
      <div class="Body"><a name="996814">For MYPROTOCOL, write a function, MacMyprotocolHandleReceivedFrame, that performs appropriate actions to process a received packet.</a></div>
      <div class="Heading4Numbered">4.5.5.9.3  <a name="1002173">Sending Indications to Network Layer</a></div>
      <div class="BodyAfterHead"><a name="1002184">A MAC protocol may provide an indication to the Network Layer when the following events occur:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1002185">MAC protocol drops a packet: A MAC protocol may retransmit a packet up to a maximum number of times. When the maximum number of retransmissions is reached, the MAC protocol drops the packet and may inform the Network Layer of the dropped packet by calling function MAC_NotificationOfPacketDrop. See the implementation of IEEE 802.11 MAC in </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/mac_dot11-sta.h to see how this function is used.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002195">MAC protocol receives an acknowledgement for a transmitted packet: When a MAC protocol receives an acknowledgement for a successfully transmitted packet, it may notify the Network Layer of the received acknowledgement by calling function MAC_MacLayerAcknowledgement. See the implementation of IEEE 802.11 MAC in mac_dot11-sta.h to see how this function is used.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.5.5.10  <a name="996835">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="996836">In this section, we describe how to collect and report statistics for a MAC protocol.</a></div>
      <div class="Heading4Numbered">4.5.5.10.1  <a name="996838">Declaring Statistics Variables</a></div>
      <div class="BodyAfterHead"><a name="996839">A MAC Layer protocol can be configured to record statistics specified by the programmer, such as:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996840">	Number of packets transmitted </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996841">	Number of packets received</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="996842">Number of packets discarded due to collision</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="996843">To enable statistics collection for the protocol, include the statistic collection variables in the structure used to hold the protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993105', '');" title="MAC Layer">Section&nbsp;4.5.5.4</a></span>). The statistics related variables can also be defined in a structure and then that structure is included in the state variable. For example, the data structure for IEEE 802.3, <span style="font-family: &quot;Courier New&quot;">MacData802_3</span>, contains the IEEE 802.3 statistics variable, <span style="font-family: &quot;Courier New&quot;">MAC802_3Statistics</span>, shown below:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><a name="996847">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025219">typedef struct struct_mac_802_3_stat</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025220">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025221">    Int64 numFrameTransmitted;      // No of frame send by this station</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025222">    Int64 numFrameReceived;         // No of frame received by this station</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025223">    Int32 numBackoffFaced;          // No of times backoff faced</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025224">    Int64 numFrameLossForCollision; </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1025232">                                  // No of frame discarded due to collision</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; margin-left: 18pt; text-indent: 0pt; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996858">} MAC802_3Statistics;</a></span></div>
      <div class="Body"><span style="font-family: &quot;Courier New&quot;"><a name="996859">MacData802_3</a></span> and <span style="font-family: &quot;Courier New&quot;">MAC802_3Statistics</span> are defined in mac_802_3.h.</div>
      <div class="Heading4Numbered">4.5.5.10.2  <a name="996861">Initializing Statistics</a></div>
      <div class="BodyAfterHead"><a name="996862">Initialize statistics variables in the protocol’s initialization function. For example, the IEEE 802.3 initialization function Mac802_3Init, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996910', '');" title="MAC Layer">Figure&nbsp;4-137</a></span>, initializes all fields of the statistics variable <span style="font-family: &quot;Courier New&quot;">MAC802_3Statistics</span> to 0. </div>
      <div class="Code_Segment"><a name="996866">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997039">void Mac802_3Init(</a></div>
      <div class="Code_Segment"><a name="997040">    Node* node,</a></div>
      <div class="Code_Segment"><a name="997041">    const NodeInput* nodeInput,</a></div>
      <div class="Code_Segment"><a name="997042">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="997044">    SubnetMemberData* nodeList,</a></div>
      <div class="Code_Segment"><a name="997045">    int numNodesInSubnet)</a></div>
      <div class="Code_Segment"><a name="996867">{</a></div>
      <div class="Code_Segment"><a name="997053">    ...</a></div>
      <div class="Code_Segment"><a name="997057">    // Initialize Stat Variables</a></div>
      <div class="Code_Segment"><a name="997058">    mac802_3-&gt;stats.numFrameTransmitted = 0;</a></div>
      <div class="Code_Segment"><a name="997059">    mac802_3-&gt;stats.numFrameReceived = 0;</a></div>
      <div class="Code_Segment"><a name="997060">    mac802_3-&gt;stats.numBackoffFaced = 0;</a></div>
      <div class="Code_Segment"><a name="997055">    mac802_3-&gt;stats.numFrameLossForCollision = 0;</a></div>
      <div class="Code_Segment"><a name="997064">    ...</a></div>
      <div class="Code_Segment"><a name="997065">}</a></div>
      <div class="Figure">FIGURE 4-137.&nbsp;&nbsp;<a name="996910">Initializing Statistics Variables for IEEE 802.3 </a></div>
      <div class="Heading4Numbered">4.5.5.10.3  <a name="996912">Updating Statistics</a></div>
      <div class="BodyAfterHead"><a name="996913">After declaring and initializing the statistics variables, update their value during the protocol life cycle, as required. For example, IEEE 802.3 increments the value of </a><span style="font-family: &quot;Courier New&quot;">numFrameTransmitted</span> in function Mac802_3CompleteFrameTransmission, implemented in mac_802_3.cpp, every time IEEE 802.3 transmits a packet, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1024246', '');" title="MAC Layer">Figure&nbsp;4-138</a></span>.</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996914">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997109">static void Mac802_3CompleteFrameTransmission(</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997110">    Node* node,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997111">    MacData802_3* mac802_3)</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997112">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997113">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997120">    // Send the message in the LAN, ie, to each neighbor</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997121">    Mac802_3BroadcastMessage(node,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997122">                             mac802_3-&gt;msgBuffer,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997123">                             mac802_3,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997124">                             MSG_MAC_TransmissionFinished);</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997125">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997127">    // Station has sent the frame successfully.</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997128">    // Reset collision counter &amp; Empty self buffer.</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997129">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997130">    // Increase numFrameTransmitted statistics</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997131">    mac802_3-&gt;stats.numFrameTransmitted++;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997132">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997161">}   </a></span></div>
      <div class="Figure">FIGURE 4-138.&nbsp;&nbsp;<a name="1024246">Updating IEEE 802.3 Statistics</a></div>
      <div class="Heading4Numbered">4.5.5.10.4  <a name="997166"> Printing Statistics</a></div>
      <div class="BodyAfterHead"><a name="997226">As a final step towards statistics collection, create a function to print statistics. Call this function from the finalization function of the protocol, which is discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997430', '');" title="MAC Layer">Section&nbsp;4.5.5.11.2</a></span>. </div>
      <div class="Body"><a name="997244">Function Mac802_3PrintStats, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997233', '');" title="MAC Layer">Figure&nbsp;4-139</a></span>, calls the C function sprintf to create a single string containing the statistic name and statistic value, and then calls function IO_PrintStat to print that string to a file. Function IO_PrintStat function, defined in <span class="Variable">QUALNET_HOME</span>/include/fileio.h, requires the following parameters:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997246">Node pointer: Pointer to the node reporting the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997247">Layer: String indicating the layer. Set this to </a><span style="font-family: &quot;Courier New&quot;">"MAC"</span> for the MAC Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997248">Protocol: String indicating the protocol name.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997249">Interface address: Interface address. Set this to </a><span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> for MAC Layer protocols.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997250">Instance identifier: Interface index.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="997251">Buffer: String containing the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="997252">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997286">static void Mac802_3PrintStats(</a></div>
      <div class="Code_Segment"><a name="997287">    Node* node,</a></div>
      <div class="Code_Segment"><a name="997288">    MacData802_3* mac802_3,</a></div>
      <div class="Code_Segment"><a name="997289">    int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="997290">{</a></div>
      <div class="Code_Segment"><a name="1024259">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1024260">    char buf1[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1024262">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024263">    ctoa(mac802_3-&gt;stats.numFrameTransmitted, buf1);</a></div>
      <div class="Code_Segment"><a name="1024264">    sprintf(buf, "Number of Frames Transmitted = %s", buf1);</a></div>
      <div class="Code_Segment"><a name="1024265">    IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="1024266">        node,</a></div>
      <div class="Code_Segment"><a name="1024267">        "MAC",</a></div>
      <div class="Code_Segment"><a name="1024268">        "802.3",</a></div>
      <div class="Code_Segment"><a name="1024269">        ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="1024270">        interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1024271">        buf);</a></div>
      <div class="Code_Segment"><a name="1024272">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024273">    ctoa(mac802_3-&gt;stats.numFrameReceived, buf1);</a></div>
      <div class="Code_Segment"><a name="1024274">    sprintf(buf, "Number of Frames Received = %s", buf1);</a></div>
      <div class="Code_Segment"><a name="1024275">    IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="1024276">        node,</a></div>
      <div class="Code_Segment"><a name="1024277">        "MAC",</a></div>
      <div class="Code_Segment"><a name="1024278">        "802.3",</a></div>
      <div class="Code_Segment"><a name="1024279">        ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="1024280">        interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="997276">        buf);</a></div>
      <div class="Code_Segment"><a name="1024295">   ...</a></div>
      <div class="Code_Segment"><a name="997277">}</a></div>
      <div class="Figure">FIGURE 4-139.&nbsp;&nbsp;<a name="997233">Function to Print Statistics</a></div>
      <div class="Heading4Numbered">4.5.5.10.5  <a name="1055252">Adding Dynamic Statistics</a></div>
      <div class="BodyAfterHead"><a name="1055256">Dynamic statistics are statistic variables whose values can be observed in the </a><span class="Variable">QualNet</span> GUI during the simulation. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.3.html#955932', '');" title="Customizing Visualize Mode of QualNet Architect">Section&nbsp;5.2.3</a></span> for adding dynamic statistics to a protocol. Refer to <span class="Variable" style="font-style: italic">QualNet User’s Guide</span> for details of viewing dynamic statistics during the simulation.</div>
      <div class="Heading3Numbered">4.5.5.11  <a name="997341">Finalization</a></div>
      <div class="BodyAfterHead"><a name="997342">The finalization function of the protocol is called by the simulator at the end of simulation. It is the last code that executes during the simulation. This function is responsible for printing statistics to the statistics file.</a></div>
      <div class="BodyAfterHead"><a name="997541">At the end of simulation, the finalization function for each protocol is called to print the protocol statistics. As discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#934306', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.3</a></span>, the finalization function is called hierarchically. The node finalization function, PARTITION_Finalize, which is defined in <span class="Variable">QUALNET_HOME</span>/main/partition.cpp, calls the finalization function for MAC Layer, MAC_Finalize, defined in mac.cpp. MAC_Finalize calls the finalization function of the MAC protocol running at each interface. </div>
      <div class="Heading4Numbered">4.5.5.11.1  <a name="997546">Modifying the MAC Layer Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="997547">Call the finalization function of the MAC protocol from the MAC Layer finalization function, MAC_Finalize, defined in mac.cpp. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997567', '');" title="MAC Layer">Figure&nbsp;4-140</a></span> shows the outline of code that needs to be added to MAC_Finalize. Function MacMyprotocolFinalize is the finalization function of the protocol MYPROTOCOL (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997430', '');" title="MAC Layer">Section&nbsp;4.5.5.11.2</a></span>).</div>
      <div class="Code_Segment"><a name="997555">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997575">void</a></div>
      <div class="Code_Segment"><a name="997576">MAC_Finalize(Node *node)</a></div>
      <div class="Code_Segment"><a name="997577">{</a></div>
      <div class="Code_Segment"><a name="997578">    int interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="997579">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997580">    for (interfaceIndex = 0;</a></div>
      <div class="Code_Segment"><a name="997581">         interfaceIndex &lt; node-&gt;numberInterfaces;</a></div>
      <div class="Code_Segment"><a name="997582">         interfaceIndex++)</a></div>
      <div class="Code_Segment"><a name="997583">    {</a></div>
      <div class="Code_Segment"><a name="997585">        ...</a></div>
      <div class="Code_Segment"><a name="997590">        /* Select the MAC protocol model and finalize it. */</a></div>
      <div class="Code_Segment"><a name="997592">        if (node-&gt;macData[interfaceIndex])</a></div>
      <div class="Code_Segment"><a name="997593">        {</a></div>
      <div class="Code_Segment"><a name="997594">            switch (node-&gt;macData[interfaceIndex]-&gt;macProtocol)</a></div>
      <div class="Code_Segment"><a name="997595">            {</a></div>
      <div class="Code_Segment"><a name="997603">                ...</a></div>
      <div class="Code_Segment"><a name="997606">                case MAC_PROTOCOL_802_3:</a></div>
      <div class="Code_Segment"><a name="997607">                {</a></div>
      <div class="Code_Segment"><a name="997608">                    Mac802_3Finalize(node, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="997609">                    break;</a></div>
      <div class="Code_Segment"><a name="997610">                }</a></div>
      <div class="Code_New"><a name="997611">                case MAC_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="997612">                {</a></div>
      <div class="Code_New"><a name="997613">                    MacMyprotocolFinalize(node, interfaceIndex);</a></div>
      <div class="Code_New"><a name="997614">                    break;</a></div>
      <div class="Code_New"><a name="997604">                }</a></div>
      <div class="Code_Segment"><a name="997625">                ...</a></div>
      <div class="Code_Segment"><a name="997626">             }</a></div>
      <div class="Code_Segment"><a name="997627">         }</a></div>
      <div class="Code_Segment"><a name="997628">         ...</a></div>
      <div class="Code_Segment"><a name="997629">}</a></div>
      <div class="Figure">FIGURE 4-140.&nbsp;&nbsp;<a name="997567">MAC Layer Finalization Function</a></div>
      <div class="Heading4Numbered">4.5.5.11.2  <a name="997430">Implementing the Protocol Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="997431">Write the finalization function for the protocol MYPROTOCOL, MacMyprotocolFinalize. If statistics collection is enabled for the MAC Layer, call the function to print the protocol’s statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997166', '');" title="MAC Layer">Section&nbsp;4.5.5.10.4</a></span>) from the finalization function, or add code directly to MacMyprotocolFinalize to print statistics.</div>
      <div class="Body"><a name="997437">Use the IEEE 802.3 finalization function, Mac802_3Finalize, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997451', '');" title="MAC Layer">Figure&nbsp;4-141</a></span>, as a template. Mac802_3Finalize is implemented in mac_802_3.cpp.</div>
      <div class="Code_Segment"><a name="997681">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024312">void Mac802_3Finalize(</a></div>
      <div class="Code_Segment"><a name="1024313">    Node* node,</a></div>
      <div class="Code_Segment"><a name="1024314">    int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="1024315">{</a></div>
      <div class="Code_Segment"><a name="1024316">    MacData802_3* mac802_3 = (MacData802_3 *)</a></div>
      <div class="Code_Segment"><a name="1024317">                              node-&gt;macData[interfaceIndex]-&gt;macVar;</a></div>
      <div class="Code_Segment"><a name="1024318">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024319">    if (node-&gt;macData[interfaceIndex]-&gt;macStats == TRUE)</a></div>
      <div class="Code_Segment"><a name="1024320">    {</a></div>
      <div class="Code_Segment"><a name="1024321">        // The mac can be either in full or half duplex mode</a></div>
      <div class="Code_Segment"><a name="1024322">        // If its a full duplex, some extra statistics may be added</a></div>
      <div class="Code_Segment"><a name="1024323">        if (mac802_3-&gt;isFullDuplex)</a></div>
      <div class="Code_Segment"><a name="1024324">        {</a></div>
      <div class="Code_Segment"><a name="1024325">            Mac802_3FullDuplexFinalize(node, mac802_3, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1024326">            // The existing 802.3 parameters may also be needed.</a></div>
      <div class="Code_Segment"><a name="1024327">            //  If not needed then we may return from here.</a></div>
      <div class="Code_Segment"><a name="1024328">        }</a></div>
      <div class="Code_Segment"><a name="1024329">        else</a></div>
      <div class="Code_Segment"><a name="1024330">        {</a></div>
      <div class="Code_Segment"><a name="1024331">            Mac802_3PrintStats(node, mac802_3, interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1024332">        }</a></div>
      <div class="Code_Segment"><a name="997449">    }</a></div>
      <div class="Figure">FIGURE 4-141.&nbsp;&nbsp;<a name="997451">Finalization Function for IEEE 802.3</a></div>
      <div class="Body"><a name="997427">As for all other functions, specify the prototype of the finalization function in the protocol's header file, mac_myprotocol.h.</a></div>
      <div class="Heading3Numbered">4.5.5.12  <a name="997462">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1024848">The final step in integrating your MAC protocol into </a><span class="Variable">QualNet</span> is to add the source file to the <span class="Variable">QualNet</span> source tree and compile.</div>
      <div class="BodyAfterHead"><a name="1024806">If you have created the files for the MAC protocol in an existing library or addon, then add the source file to the Makefile-common for that library or addon. For example, if you have created your model files in the Developer library, then modify </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/Makefile-common as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1024827', '');" title="MAC Layer">Figure&nbsp;4-142</a></span>. Recompile <span class="Variable">QualNet</span> after making the changes.</div>
      <div class="Code_Segment"><a name="1024810">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024811">...</a></div>
      <div class="Code_Segment"><a name="1024812"># common sources</a></div>
      <div class="Code_Segment"><a name="1024813">#</a></div>
      <div class="Code_Segment"><a name="1024814">DEVELOPER_SRCS = \</a></div>
      <div class="Code_Segment"><a name="1024815">$(DEVELOPER_SRCDIR)/adaptation_aal5.cpp \</a></div>
      <div class="Code_Segment"><a name="1024816">$(DEVELOPER_SRCDIR)/adaptation.cpp \</a></div>
      <div class="Code_Segment"><a name="1024817">...</a></div>
      <div class="Code_Segment"><a name="1024856">$(DEVELOPER_SRCDIR)/mac_arp.cpp \</a></div>
      <div class="Code_Segment"><a name="1024857">$(DEVELOPER_SRCDIR)/mac_llc.cpp \</a></div>
      <div class="Code_Segment"><a name="1054953">$(DEVELOPER_SRCDIR)/mac_background_traffic.cpp \</a></div>
      <div class="Code_Segment"><a name="1024820">$(DEVELOPER_SRCDIR)/mac_link.cpp \</a></div>
      <div class="Code_New"><a name="1024821">$(DEVELOPER_SRCDIR)/mac_myprotocol.cpp \</a></div>
      <div class="Code_Segment"><a name="1024864">$(DEVELOPER_SRCDIR)/mac_satcom.cpp \</a></div>
      <div class="Code_Segment"><a name="1024865">$(DEVELOPER_SRCDIR)/mobility_placement.cpp \</a></div>
      <div class="Code_Segment"><a name="1024824">$(DEVELOPER_SRCDIR)/multicast_igmp.cpp \</a></div>
      <div class="Code_Segment"><a name="1024825">...</a></div>
      <div class="Figure">FIGURE 4-142.&nbsp;&nbsp;<a name="1024827">Adding Model to Makefile-common</a></div>
      <div class="Body"><a name="1055284">If you have created a new library called user_models, then follow the instructions given in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#929473', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10.5</a></span> to integrate the user_models library into <span class="Variable">QualNet</span>.</div>
      <div class="Heading3Numbered">4.5.5.13  <a name="1055289">Integrating the Protocol into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1055293">To make the new protocol available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Heading2Numbered">4.5.6  <a name="998264">Adding a Wireless MAC Protocol</a></div>
      <div class="BodyAfterHead"><a name="998265">This section provides an overview of the flow of a MAC protocol for a wireless network and provides an outline for developing and adding a MAC protocol, MYPROTOCOL, for a wireless network to </a><span class="Variable">QualNet</span>. It describes how to develop code components common to most MAC protocols such as initializing, sending and receiving packets, and collecting statistics.</div>
      <div class="Body"><a name="998462">We illustrate the process of adding a MAC protocol for a wireless network by using as an example the implementation code for the CSMA protocol. The header file for the CSMA implementation is mac_csma.h and the source file is mac_csma.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/wireless/src. We use code snippets from these two files throughout this section to illustrate different steps in writing a wireless MAC protocol. After understanding the discussed snippets, look at the complete code for the CSMA protocol to understand how a wireless MAC protocol is implemented in <span class="Variable">QualNet</span>.</div>
      <div class="Body"><a name="998262">The following list summarizes the actions that need to be performed for adding a wireless MAC protocol, MYPROTOCOL, to </a><span class="Variable">QualNet</span>. For those steps that are similar to the steps for writing a wired MAC protocol, we refer the reader to the appropriate subsection of <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#987174', '');" title="MAC Layer">Section&nbsp;4.5.5</a></span>. The steps that are different for wired MAC protocols are described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="998298">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#992730', '');" title="MAC Layer">Section&nbsp;4.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998302">Modify the file mac.cpp to include the protocol’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#992730', '');" title="MAC Layer">Section&nbsp;4.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998306">Include the protocol in the list of MAC Layer protocols and trace protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#992879', '');" title="MAC Layer">Section&nbsp;4.5.5.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998310">Define data structures for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998397', '');" title="MAC Layer">Section&nbsp;4.5.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998314">Decide on the format for the protocol-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998535', '');" title="MAC Layer">Section&nbsp;4.5.6.2.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998315">Call the protocol’s initialization function from the MAC Layer initialization function, MAC_Initialize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998629', '');" title="MAC Layer">Section&nbsp;4.5.6.2.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1028573">Call the appropriate function to assign MAC addresses to interfaces (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028620', '');" title="MAC Layer">Section&nbsp;4.5.6.2.3</a></span>). If MYPROTOCOL uses a new type of MAC address, then implement a function to assign MAC addresses of that type.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1028574">Write the initialization function for the protocol. The initialization function should include the following tasks:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1028578">Declare and initialize the state variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998971', '');" title="MAC Layer">Section&nbsp;4.5.6.2.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1028582">Read and store the configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998971', '');" title="MAC Layer">Section&nbsp;4.5.6.2.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1028590">Initialize times, if needed (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999191', '');" title="MAC Layer">Section&nbsp;4.5.6.2.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1028591">Implement functions to translate between IP and MAC addresses used by MYPROTOCOL (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028641', '');" title="MAC Layer">Section&nbsp;4.5.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998336">Call the protocol’s event dispatcher from the MAC Layer event dispatcher, MAC_ProcessEvent (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999211', '');" title="MAC Layer">Section&nbsp;4.5.6.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998340">Declare any new event types used by the protocol in the header file </a><span class="Variable">QUALNET_HOME</span>/include/api.h (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999257', '');" title="MAC Layer">Section&nbsp;4.5.6.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998347">Write the protocol event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999257', '');" title="MAC Layer">Section&nbsp;4.5.6.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002242">Modify MAC Layer functions to integrate the new MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000321', '');" title="MAC Layer">Section&nbsp;4.5.6.5</a></span>). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1002243">Modify function MAC_NetworkLayerHasPacketToSend to deliver packets received from the Network Layer to MYPROTOCOL.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1002244">Modify functions MAC_IsWirelessNetwork, MAC_IsOneHopBroadcastNetwork, etc., to return the correct network type for the interface that MYPROTOCOL runs on. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1002257">Modify function MAC_ReceivePacketFromPhy to deliver packets received from the Physical Layer to MYPROTOCOL.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1002262">Modify function MAC_ReceivePhyStatusChangeNotification to deliver Physical Layer status change notifications to MYPROTOCOL.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998355">Write a function to handle outgoing packets (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000118', '');" title="MAC Layer">Section&nbsp;4.5.6.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998359">Write a function to process incoming packets (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000027', '');" title="MAC Layer">Section&nbsp;4.5.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002274">Write a function to process Physical Layer status changes (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1001177', '');" title="MAC Layer">Section&nbsp;4.5.6.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">17.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998360">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="998364">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996838', '');" title="MAC Layer">Section&nbsp;4.5.5.10.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="998368">Initialize the statistics variables in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996861', '');" title="MAC Layer">Section&nbsp;4.5.5.10.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="998372">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996912', '');" title="MAC Layer">Section&nbsp;4.5.5.10.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="998376">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997166', '');" title="MAC Layer">Section&nbsp;4.5.5.10.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1055350">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1055252', '');" title="MAC Layer">Section&nbsp;4.5.5.10.5</a></span>) .</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">18.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998377">Call the protocol finalization function from the MAC Layer finalization function, MAC_Finalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997546', '');" title="MAC Layer">Section&nbsp;4.5.5.11.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">19.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998384">Write the protocol finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997430', '');" title="MAC Layer">Section&nbsp;4.5.5.11.2</a></span>). Call the function to print statistics from the protocol finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">20.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998388">Include the protocol header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997462', '');" title="MAC Layer">Section&nbsp;4.5.5.12</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">21.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1055365">To make the protocol available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1055430', '');" title="MAC Layer">Section&nbsp;4.5.6.10</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.5.6.1  <a name="998397">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="998292">This step is similar to the one for adding a wired MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993105', '');" title="MAC Layer">Section&nbsp;4.5.5.4</a></span>).</div>
      <div class="BodyAfterHead"><a name="998417">Each MAC Layer protocol has its own data structures, which are defined in the protocol’s header file. The data structures store information such as:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="998421">Protocol parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998954', '');" title="MAC Layer">Section&nbsp;4.5.6.2.4</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998425">Protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998954', '');" title="MAC Layer">Section&nbsp;4.5.6.2.4</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="998429">Statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996838', '');" title="MAC Layer">Section&nbsp;4.5.5.10.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="998430">Define an appropriate data structure, </a><span style="font-family: &quot;Courier New&quot;">MacDataMyprotocol</span>, for MYPROTCOL in the protocol header file, mac_myprotocol.h. As an example, the following data structure, defined in mac_csma.h, is used by the CSMA protocol:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998431">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024470">typedef struct struct_mac_csma_str</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024471">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024472">    MacData* myMacData;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024474">    Int32 status;           /* status of layer CSMA_STATUS_* */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024475">    Int32 BOmin;            /* minimum backoff */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024476">    Int32 BOmax;            /* maximum backoff */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024477">    Int32 BOtimes;          /* how many times has it backoff ? */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024479">    Int32 pktsToSend;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024480">    Int32 pktsLostOverflow;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024482">    Int32 pktsSentUnicast;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024483">    Int32 pktsSentBroadcast;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024485">    Int32 pktsGotUnicast;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024486">    Int32 pktsGotBroadcast;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024488">    CsmaTimer timer;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1024490">    RandomSeed seed;        /* for setting backoff timer */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1012808">} MacDataCsma;</a></span></div>
      <div class="Heading3Numbered">4.5.6.2  <a name="998532">Initialization</a></div>
      <div class="BodyAfterHead"><a name="998533">In this section, we describe the tasks that need to be performed as part of the initialization process of a wireless MAC protocol.</a></div>
      <div class="Heading4Numbered">4.5.6.2.1  <a name="998535">Determining the Protocol Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="998536">This step is similar to the one for adding a wired MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993297', '');" title="MAC Layer">Section&nbsp;4.5.5.5.1</a></span>). </div>
      <div class="Heading4Numbered">4.5.6.2.2  <a name="998629">Calling the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="998631">The protocol stack of each node is initialized in a bottom up manner. For wireless networks, the MAC Layer at an interface is initialized after the Physical Layer model for the interface is initialized. This process is performed in the node initialization function PARTITION_InitializeNodes, implemented in </a><span class="Variable">QUALNET_HOME</span>/main/partition.cpp<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#919750', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.1</a></span>).</div>
      <div class="BodyAfterHead"><a name="998635">The node initialization function, PARTITION_InitializeNodes, calls the MAC Layer initialization function MAC_Initialize. Function MAC_Initialize reads the configuration file for lines starting with the keywords </a><span style="font-family: &quot;Courier New&quot;">SUBNET</span> or <span style="font-family: &quot;Courier New&quot;">LINK</span>. If the input line begins with the keyword <span style="font-family: &quot;Courier New&quot;">SUBNET</span>, MAC_Initialize calls function ProcessSubnetLine. If the input line begins with the keyword <span style="font-family: &quot;Courier New&quot;">LINK</span>, MAC_Initialize calls function ProcessLinkLine. Function ProcessSubnetLine assigns an IPv4 and/or IPv6 address to the subnet interface for each node in the subnet and calls function AddNodeToSubnet or AddNodeToIpv6Network for each node. Functions AddNodeToSubnet and AddNodeToIpv6Network initialize the interface information for the subnet interface. Functions MAC_Initialize, ProcessSubnetLine, ProcessLinkLine, AddNodeToSubnet, and AddNodeToIpv6Network are implemented in the file mac.cpp.</div>
      <div class="Body"><a name="998895">For a wireless MAC protocol, function AddNodeToSubnet (AddNodeToIpv6Network) initializes the Physical Layer model specified for the interface. AddNodeToSubnet (AddNodeToIpv6Network) then determines the data rate for the index by calling function PHY_GetTxDataRate and initializes the Network Layer queues for the interface by calling function NetworkIpCreateQueues. AddNodeToSubnet (AddNodeToIpv6Network) then calls the initialization function for the MAC protocol running at the interface. For example, if CSMA is specified as the MAC protocol, AddNodeToSubnet (AddNodeToIpv6Network) calls the CSMA initialization function, function MacCsmaInit (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998691', '');" title="MAC Layer">Figure&nbsp;4-143</a></span>). PHY_GetTxDataRate is implemented in <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src/phy.cpp and NetworkIpCreateQueues is implemented in <span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.cpp. MacCsmaInit and the other CSMA functions are implemented in mac_csma.cpp. Modify AddNodeToSubnet (AddNodeToIpv6Network) to call the MYPROTOCOL initialization function, MacMyprotocolInit, if MYPROTOCOL is specified as the MAC protocol for the interface, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#998691', '');" title="MAC Layer">Figure&nbsp;4-143</a></span> (<span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1027756', '');" title="MAC Layer">Figure&nbsp;4-144</a></span>).</div>
      <div class="Code_Segment"><a name="998639">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998640">static void //inline//</a></div>
      <div class="Code_Segment"><a name="998641">AddNodeToSubnet(</a></div>
      <div class="Code_Segment"><a name="998642">    Node *node,</a></div>
      <div class="Code_Segment"><a name="998851">    const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="998852">    NodeAddress subnetAddress,    //base address</a></div>
      <div class="Code_Segment"><a name="998853">    NodeAddress interfaceAddress, //my IP# on this interface</a></div>
      <div class="Code_Segment"><a name="998646">    int numHostBits,</a></div>
      <div class="Code_Segment"><a name="998647">    char *macProtocolName,</a></div>
      <div class="Code_Segment"><a name="1027624">    PartitionSubnetMemberData* subnetList,</a></div>
      <div class="Code_Segment"><a name="1027625">    int         nodesInSubnet,</a></div>
      <div class="Code_Segment"><a name="1027626">    int         subnetListIndex,</a></div>
      <div class="Code_Segment"><a name="1027627">    BOOL        isNewInterface,</a></div>
      <div class="Code_Segment"><a name="998651">    short       subnetIndex)</a></div>
      <div class="Code_Segment"><a name="1027635">{</a></div>
      <div class="Code_Segment"><a name="998652">    int interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="998653">    ...</a></div>
      <div class="Code_Segment"><a name="998654">    Address address;</a></div>
      <div class="Code_Segment"><a name="998655">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998656">    MacAddNewInterface(node, interfaceAddress, numHostBits, &amp;interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1027637">                       nodeInput, macProtocolName, isNewInterface);</a></div>
      <div class="Code_Segment"><a name="998658">    ...</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998791">        // bandwidth is set to the base data rate</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998818">        // (in case it's variable)</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998819">        //</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998820">        node-&gt;macData[interfaceIndex]-&gt;bandwidth =</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998821">            (PHY_GetTxDataRate(</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998822">                node,</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998823">                node-&gt;macData[interfaceIndex]-&gt;phyNumber) / 8);</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998824">&nbsp;</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998825">        NetworkIpCreateQueues(node, nodeInput,</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998826">                              interfaceIndex);</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998827">&nbsp;</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998836">       if (strcmp(macProtocolName, "CSMA") == 0) {</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998837">            node-&gt;macData[interfaceIndex]-&gt;macProtocol = MAC_PROTOCOL_CSMA;</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998838">            MacCsmaInit(node, interfaceIndex, nodeInput);</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998839">        }</a></div>
      <div class="Code_New"><a name="1003630">        else if (strcmp(macProtocolName, "MYPROTOCOL") == 0) {</a></div>
      <div class="Code_New"><a name="1003631">           node-&gt;macData[interfaceIndex]-&gt;macProtocol =</a></div>
      <div class="Code_New"><a name="1003655">                                                   MAC_PROTOCOL_MYPROTOCOL;</a></div>
      <div class="Code_New"><a name="1003632">            MacMyprotocolInit(node, interfaceIndex, nodeInput);</a></div>
      <div class="Code_New"><a name="1003633">        }</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998846">        ...</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="998847">}</a></div>
      <div class="Figure">FIGURE 4-143.&nbsp;&nbsp;<a name="998691">Wireless MAC Initialization: Adding a Node to an IPv4 Subnet</a></div>
      <div class="Code_Segment"><a name="1027703">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1027772">static void //inline//</a></div>
      <div class="Code_Segment"><a name="1027773">AddNodeToIpv6Network(</a></div>
      <div class="Code_Segment"><a name="1027774">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1027775">    const NodeInput *nodeInput,</a></div>
      <div class="Code_Segment"><a name="1027776">    in6_addr *globalAddr,</a></div>
      <div class="Code_Segment"><a name="1027777">    in6_addr *subnetAddr,</a></div>
      <div class="Code_Segment"><a name="1027778">    unsigned int subnetPrefixLen,</a></div>
      <div class="Code_Segment"><a name="1027779">    char* macProtocolName,</a></div>
      <div class="Code_Segment"><a name="1027780">    short subnetIndex,</a></div>
      <div class="Code_Segment"><a name="1055028">    SubnetMemberData* subnetList,</a></div>
      <div class="Code_Segment"><a name="1027781">    int nodesInSubnet,</a></div>
      <div class="Code_Segment"><a name="1027782">    int subnetListIndex,</a></div>
      <div class="Code_Segment"><a name="1027783">    unsigned short siteCounter,</a></div>
      <div class="Code_Segment"><a name="1027784">    BOOL isNewInterface)</a></div>
      <div class="Code_Segment"><a name="1027785">{</a></div>
      <div class="Code_Segment"><a name="1027786">    int interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1027787">    ...</a></div>
      <div class="Code_Segment"><a name="1027704">    Address address ;</a></div>
      <div class="Code_Segment"><a name="1027826">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1027827">    MacAddNewInterface(node, globalAddr, subnetAddr, subnetPrefixLen,</a></div>
      <div class="Code_Segment"><a name="1027828">                       &amp;interfaceIndex, nodeInput, siteCounter, macProtocolName,</a></div>
      <div class="Code_Segment"><a name="1027721">                       isNewInterface);</a></div>
      <div class="Code_Segment"><a name="1027724">    ...</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027725">        // bandwidth is set to the base data rate</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027726">        // (in case it's variable)</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027727">        //</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027834">        node-&gt;macData[interfaceIndex]-&gt;bandwidth =</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027835">            (PHY_GetTxDataRate(</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027836">                node,</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027837">                node-&gt;macData[interfaceIndex]-&gt;phyNumber) / 8);</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027839">        NetworkIpCreateQueues(node, nodeInput,</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027735">                              interfaceIndex);</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027894">        if (strcmp(macProtocolName, "CSMA") == 0) {</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027895">            node-&gt;macData[interfaceIndex]-&gt;macProtocol = MAC_PROTOCOL_CSMA;</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027896">            MacCsmaInit(node, interfaceIndex, nodeInput);</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027879">        }</a></div>
      <div class="Code_New"><a name="1027880">    else if (strcmp(macProtocolName, "MYPROTOCOL") == 0) {</a></div>
      <div class="Code_New"><a name="1027749">          node-&gt;macData[interfaceIndex]-&gt;macProtocol =</a></div>
      <div class="Code_New"><a name="1027750">                                                   MAC_PROTOCOL_MYPROTOCOL;</a></div>
      <div class="Code_New"><a name="1027751">          MacMyprotocolInit(node, interfaceIndex, nodeInput);</a></div>
      <div class="Code_New"><a name="1027752">    }</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027753">        ...</a></div>
      <div class="Code_Segment" style="margin-left: 16.80048pt; text-indent: 0pt"><a name="1027754">}</a></div>
      <div class="Figure">FIGURE 4-144.&nbsp;&nbsp;<a name="1027756">Wireless MAC Initialization: Adding a Node to an IPv6 Subnet</a></div>
      <div class="Heading4Numbered">4.5.6.2.3  <a name="1028620">Initializing MAC Address</a></div>
      <div class="BodyAfterHead"><a name="1028624">This step is similar to the one for adding a wired MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028344', '');" title="MAC Layer">Section&nbsp;4.5.5.5.3</a></span>).</div>
      <div class="Heading4Numbered">4.5.6.2.4  <a name="998954">Implementing the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="998955">The initialization of a wireless MAC protocol takes place in the initialization function of the protocol that is indirectly called by the MAC Layer initialization function MAC_Initialize. The initialization function of a wireless MAC protocol commonly performs the following tasks:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="998956">Create an instance of the protocol data structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="998957">Calculate and store the protocol’s operational parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="998958">Initialize the state variables</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="998961">Schedule timers, if required</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="998962">Like all other functions belonging to the protocol, the prototype for the initialization function should be included in the protocol's header file, mac_myprotocol.h.</a></div>
      <div class="Heading5Numbered">4.5.6.2.4.1  <a name="998971">Creating an Instance and Reading Configuration Parameters</a></div>
      <div class="BodyAfterHead"><a name="998972">The initialization function initializes the protocol state. Each protocol has a structure that it uses to store state information. This may include information such as the protocol state and parameters, statistics variables, etc. Each instance of the protocol maintains its own state variable. </a></div>
      <div class="Body"><a name="998973">To store the state, declare the structure to hold the protocol state in the header file, mac_myprotocol.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993105', '');" title="MAC Layer">Section&nbsp;4.5.5.4</a></span>). As an example, see the declaration of the CSMA data structure <span style="font-family: &quot;Courier New&quot;">MacDataCsma</span> in mac_csma.h.</div>
      <div class="Body"><a name="998977">Create an instance of the protocol state by allocating memory to the state structure. CSMA performs this task in its initialization function MacCsmaInit by calling the function MEM_malloc to allocate memory for the CSMA data structure </a><span style="font-family: &quot;Courier New&quot;">MacDataCsma</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999146', '');" title="MAC Layer">Figure&nbsp;4-145</a></span>. MacCsmaInit and the other CSMA functions are implemented in mac_csma.cpp. Data structure and constant definitions for CSMA are contained in mac_csma.h. </div>
      <div class="Body"><a name="998981">MacCsmaInit also sets up pointers between the newly created instance of the CSMA data structure </a><span style="font-family: &quot;Courier New&quot;">MacDataCsma</span> and the data structure that stores the MAC Layer information for the interface, <span style="font-family: &quot;Courier New&quot;">macData[interfaceIndex]</span>.</div>
      <div class="Body"><a name="998982">The state variables for the protocol are also initialized in the initialization function. For example, MacCsmaInit initializes the protocol status (mode), backoff parameters, etc.</a></div>
      <div class="BodyAfterHead"><a name="998983">The initialization function of a wireless MAC protocol may also calculate and store the values of parameters that it requires in its operation. If the protocol has any user-specified configuration parameters, these are read in the protocol initialization function. CSMA does not have any user-specified configuration parameters. To understand how configuration parameters are read from an input file, refer to the IEEE 802.3 function Mac802_3GetSubnetParameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#993627', '');" title="MAC Layer">Section&nbsp;4.5.5.5.2</a></span>) or the IEEE 802.11 MAC initialization function MacDot11Init in <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src//mac_dot11.cpp.</div>
      <div class="Code_Segment"><a name="999094">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024549">void MacCsmaInit(</a></div>
      <div class="Code_Segment"><a name="1024550">   Node *node, int interfaceIndex, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1024551">{</a></div>
      <div class="Code_Segment"><a name="1024552">    MacDataCsma *csma = (MacDataCsma *) MEM_malloc(sizeof(MacDataCsma));</a></div>
      <div class="Code_Segment"><a name="1024554">    assert(csma != NULL);</a></div>
      <div class="Code_Segment"><a name="1024555">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024556">    memset(csma, 0, sizeof(MacDataCsma));</a></div>
      <div class="Code_Segment"><a name="1024557">    csma-&gt;myMacData = node-&gt;macData[interfaceIndex];</a></div>
      <div class="Code_Segment"><a name="1024558">    csma-&gt;myMacData-&gt;macVar = (void *)csma;</a></div>
      <div class="Code_Segment"><a name="1024560">    csma-&gt;timer.flag = CSMA_TIMER_OFF | CSMA_TIMER_UNDEFINED;</a></div>
      <div class="Code_Segment"><a name="1024561">    csma-&gt;timer.seq = 0;</a></div>
      <div class="Code_Segment"><a name="1024563">    csma-&gt;status = CSMA_STATUS_PASSIVE;</a></div>
      <div class="Code_Segment"><a name="1024564">    csma-&gt;BOmin = CSMA_BO_MIN;</a></div>
      <div class="Code_Segment"><a name="1024565">    csma-&gt;BOmax = CSMA_BO_MAX;</a></div>
      <div class="Code_Segment"><a name="1024566">    csma-&gt;BOtimes = 0;</a></div>
      <div class="Code_Segment"><a name="1024568">    csma-&gt;pktsToSend = 0;</a></div>
      <div class="Code_Segment"><a name="1024569">    csma-&gt;pktsLostOverflow = 0;</a></div>
      <div class="Code_Segment"><a name="1024571">    csma-&gt;pktsSentUnicast = 0;</a></div>
      <div class="Code_Segment"><a name="1024572">    csma-&gt;pktsSentBroadcast = 0;</a></div>
      <div class="Code_Segment"><a name="1024574">    csma-&gt;pktsGotUnicast = 0;</a></div>
      <div class="Code_Segment"><a name="1024575">    csma-&gt;pktsGotBroadcast = 0;</a></div>
      <div class="Code_Segment"><a name="1024577">    RANDOM_SetSeed(csma-&gt;seed,</a></div>
      <div class="Code_Segment"><a name="1024578">                   node-&gt;globalSeed,</a></div>
      <div class="Code_Segment"><a name="1024579">                   node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1024580">                   MAC_PROTOCOL_CSMA,</a></div>
      <div class="Code_Segment"><a name="1024581">                   interfaceIndex);</a></div>
      <div class="Code_Segment"><a name="1024582">   ...</a></div>
      <div class="Code_Segment"><a name="1024587">}</a></div>
      <div class="Figure">FIGURE 4-145.&nbsp;&nbsp;<a name="999146">CSMA Initialization Function</a></div>
      <div class="Heading5Numbered">4.5.6.2.4.2  <a name="999191">Initializing Timers</a></div>
      <div class="BodyAfterHead"><a name="999195">A MAC protocol may need to set timers at initialization. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#920185', '');" title="Discrete-event Simulation in QualNet">Section&nbsp;3.3.2.2</a></span> for details on setting timers.</div>
      <div class="Heading3Numbered">4.5.6.3  <a name="1028641">Implementing Address Translation Functions</a></div>
      <div class="BodyAfterHead"><a name="1028645">This step is similar to the one for adding a wired MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1026445', '');" title="MAC Layer">Section&nbsp;4.5.5.6</a></span>).</div>
      <div class="Heading3Numbered">4.5.6.4  <a name="999197">Implementing the Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="999198">In this section, we describe the steps for implementing the event dispatcher function for a wireless MAC protocol. </a></div>
      <div class="Body"><a name="999202">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#933631', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.2</a></span>, when an event occurs, it is first handled by the node level dispatcher function NODE_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/node.cpp. If the event is for the MAC Layer, NODE_ProcessEvent calls the MAC Layer event dispatcher MAC_ProcessEvent, defined in mac.cpp. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999211', '');" title="MAC Layer" name="999206">Section&nbsp;4.5.6.4.1</a></span> describes how to modify the MAC Layer event dispatcher function to call the MAC protocol’s event dispatcher. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999257', '');" title="MAC Layer">Section&nbsp;4.5.6.4.2</a></span> describes how to implement the MAC protocol’s event dispatcher.</div>
      <div class="Heading4Numbered">4.5.6.4.1  <a name="999211">Modifying the MAC Layer Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="999212">This step is similar to the one for adding a wired MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#994974', '');" title="MAC Layer">Section&nbsp;4.5.5.7.1</a></span>).</div>
      <div class="Heading4Numbered">4.5.6.4.2  <a name="999257">Implementing the Protocol Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="999258">A protocol's event dispatcher should include a switch on all message types that the protocol may receive. It can then process each message type either inside the switch or by calling a function to handle the message type received. </a></div>
      <div class="Body"><a name="999259">All event types used by </a><span class="Variable">QualNet</span> protocols are enumerated in the file <span class="Variable">QUALNET_HOME</span>/include/api.h. If the protocol being added needs additional event types, these should be included in the enumeration in file api.h, as shown in <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#995189', '');" title="MAC Layer">Figure&nbsp;4-130</a>. </div>
      <div class="Body"><a name="999291">The event dispatcher function for a MAC protocol may handle both packet and timer events. As an example, </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000319', '');" title="MAC Layer">Figure&nbsp;4-146</a></span> shows the CSMA event dispatcher function MacCsmaLayer. Note that once a message has been processed, it is freed by calling the API MESSAGE_Free. The event dispatcher also includes a default case in the switch statement to handle events of an unknown type.</div>
      <div class="Note_Indented"><a name="999298"><img class="Default" src="images/Chapter%204-5.09.1.6.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is important to free the memory after the message has been processed; otherwise, the simulator will leak memory.</a></div>
      <div class="BodyAfterHead"><a name="999299">See files mac_csma.h and mac_csma.cpp for definitions of data structures and functions used for implementing CSMA.</a></div>
      <div class="Body"><a name="999303">For the CSMA protocol, there is only one type of event: a timer event of type </a><span style="font-family: &quot;Courier New&quot;">MSG_MAC_TimerExpred</span>. When the event occurs, MacCsmaLayer checks if the timeout event corresponds to the latest timer set by the protocol by checking the timer sequence number. If the sequence number does not correspond to the latest timer set by the protocol, MacCsmaLayer ignores the event. If the timer event indicates that the backoff timer has expired, MacCsmaLayer calls function CheckPhyStatusAndSendOrBackoff. If the timer event indicates that the yield timer has expired, MacCsmaLayer calls function MacCsmaPassive.</div>
      <div class="Code_Segment"><a name="999304">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999410">void MacCsmaLayer(Node *node, int interfaceIndex, Message *msg)</a></div>
      <div class="Code_Segment"><a name="999411">{</a></div>
      <div class="Code_Segment"><a name="999412">    /*</a></div>
      <div class="Code_Segment"><a name="999413">     * Retrieve the pointer to the data portion which relates</a></div>
      <div class="Code_Segment"><a name="999414">     * to the CSMA protocol.</a></div>
      <div class="Code_Segment"><a name="999415">     */</a></div>
      <div class="Code_Segment"><a name="999416">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999417">    MacDataCsma *csma = (MacDataCsma *)node-&gt;macData[interfaceIndex]-&gt;macVar;</a></div>
      <div class="Code_Segment"><a name="999418">    int seq_num;</a></div>
      <div class="Code_Segment"><a name="999419">    ...</a></div>
      <div class="Code_Segment"><a name="1054296">    assert(msg-&gt;eventType == MSG_MAC_TimerExpired);</a></div>
      <div class="Code_Segment"><a name="1054297">    seq_num = *((int *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="1054298">    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="999426">    if ((seq_num &lt; csma-&gt;timer.seq) ||</a></div>
      <div class="Code_Segment"><a name="999427">        ((csma-&gt;timer.flag &amp; CSMA_TIMER_SWITCH) == CSMA_TIMER_OFF)) {</a></div>
      <div class="Code_Segment"><a name="999428">        return;</a></div>
      <div class="Code_Segment"><a name="999429">    }</a></div>
      <div class="Code_Segment"><a name="999431">    if (seq_num &gt; csma-&gt;timer.seq) {</a></div>
      <div class="Code_Segment"><a name="999432">        assert(FALSE);</a></div>
      <div class="Code_Segment"><a name="999433">    }</a></div>
      <div class="Code_Segment"><a name="999435">    assert(((csma-&gt;timer.flag &amp; CSMA_TIMER_TYPE) ==</a></div>
      <div class="Code_Segment"><a name="999436">            CSMA_TIMER_BACKOFF) ||</a></div>
      <div class="Code_Segment"><a name="999437">           ((csma-&gt;timer.flag &amp; CSMA_TIMER_TYPE) == CSMA_TIMER_YIELD));</a></div>
      <div class="Code_Segment"><a name="999439">    switch(csma-&gt;timer.flag &amp; CSMA_TIMER_TYPE) {</a></div>
      <div class="Code_Segment"><a name="999440">    case CSMA_TIMER_BACKOFF:</a></div>
      <div class="Code_Segment"><a name="999441">    {</a></div>
      <div class="Code_Segment"><a name="999442">        csma-&gt;timer.flag = CSMA_TIMER_OFF | CSMA_TIMER_UNDEFINED;</a></div>
      <div class="Code_Segment"><a name="999444">        CheckPhyStatusAndSendOrBackoff(node, csma);</a></div>
      <div class="Code_Segment"><a name="999446">        break;</a></div>
      <div class="Code_Segment"><a name="999447">    }</a></div>
      <div class="Code_Segment"><a name="999449">    case CSMA_TIMER_YIELD:</a></div>
      <div class="Code_Segment"><a name="999450">        csma-&gt;timer.flag = CSMA_TIMER_OFF | CSMA_TIMER_UNDEFINED;</a></div>
      <div class="Code_Segment"><a name="999451">        csma-&gt;status = CSMA_STATUS_PASSIVE;</a></div>
      <div class="Code_Segment"><a name="999452">        MacCsmaPassive(node, csma);</a></div>
      <div class="Code_Segment"><a name="999453">        break;</a></div>
      <div class="Code_Segment"><a name="999455">    default:</a></div>
      <div class="Code_Segment"><a name="999456">        assert(FALSE); abort();</a></div>
      <div class="Code_Segment"><a name="999457">        break;</a></div>
      <div class="Code_Segment"><a name="999458">    }/*switch*/</a></div>
      <div class="Code_Segment"><a name="1000318">}</a></div>
      <div class="Figure">FIGURE 4-146.&nbsp;&nbsp;<a name="1000319">CSMA Event Dispatcher</a></div>
      <div class="Heading3Numbered">4.5.6.5  <a name="1000321">Modifying MAC Layer Functions</a></div>
      <div class="BodyAfterHead"><a name="999813">This step is similar to the one for adding a wired MAC protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#987260', '');" title="MAC Layer">Section&nbsp;4.5.5.8</a></span>).</div>
      <div class="BodyAfterHead"><a name="999869">Add code to function MAC_NetworkLayerHasPacketToSend to call MYPROTOCOL’s send function when the MAC Layer receives a packet from the Network Layer and MYPROTOCOL is running at the interface (see </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999754', '');" title="MAC Layer">Figure&nbsp;4-147</a>). Function MacMyprotocolNetworkLayerHasPacketToSend is the MYPROTOCOL function that handles packets received from the Network Layer. <span style="font-family: &quot;Courier New&quot;">MacDataMyprotocol</span> is the data structure for MYPROTOCOL.</div>
      <div class="Code_Segment"><a name="999721">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999722">void</a></div>
      <div class="Code_Segment"><a name="999723">MAC_NetworkLayerHasPacketToSend(Node *node, int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="999724">{</a></div>
      <div class="Code_Segment"><a name="999725">    /* Select the MAC protocol model, and direct it to send/buffer the</a></div>
      <div class="Code_Segment"><a name="999726">       packet. */</a></div>
      <div class="Code_Segment"><a name="999727">    ...</a></div>
      <div class="Code_Segment"><a name="999728">    switch (node-&gt;macData[interfaceIndex]-&gt;macProtocol)</a></div>
      <div class="Code_Segment"><a name="999729">    {</a></div>
      <div class="Code_Segment"><a name="999730">        ...</a></div>
      <div class="Code_Segment"><a name="1054188">        case MAC_PROTOCOL_DOT11:</a></div>
      <div class="Code_Segment"><a name="1054189">        {</a></div>
      <div class="Code_Segment"><a name="1054190">            MacDot11NetworkLayerHasPacketToSend(</a></div>
      <div class="Code_Segment"><a name="1054191">                node, (MacDataDot11 *) node-&gt;macData[interfaceIndex]-&gt;macVar);</a></div>
      <div class="Code_Segment"><a name="1054192">            break;</a></div>
      <div class="Code_Segment"><a name="999817">        }</a></div>
      <div class="Code_Segment"><a name="1054208">        case MAC_PROTOCOL_CSMA:</a></div>
      <div class="Code_Segment"><a name="999818">        {</a></div>
      <div class="Code_Segment"><a name="999819">            MacCsmaNetworkLayerHasPacketToSend(</a></div>
      <div class="Code_Segment"><a name="999820">                node, (MacDataCsma *) node-&gt;macData[interfaceIndex]-&gt;macVar);</a></div>
      <div class="Code_Segment"><a name="999821">            break;</a></div>
      <div class="Code_Segment"><a name="999737">        }</a></div>
      <div class="Code_New"><a name="999744">        case MAC_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="999745">        {</a></div>
      <div class="Code_New"><a name="999829">            MacMyprotocolNetworkLayerHasPacketToSend(</a></div>
      <div class="Code_New"><a name="999830">                node, </a></div>
      <div class="Code_New"><a name="999837">               (MacDataMyprotocol *) node-&gt;macData[interfaceIndex]-&gt;macVar);</a></div>
      <div class="Code_New"><a name="999748">            break;</a></div>
      <div class="Code_New"><a name="999749">        }</a></div>
      <div class="Code_Segment"><a name="999750">        ...</a></div>
      <div class="Code_Segment"><a name="999751">     }</a></div>
      <div class="Code_Segment"><a name="999752">}</a></div>
      <div class="Figure">FIGURE 4-147.&nbsp;&nbsp;<a name="999754">Delivering Packets from Network Layer to MAC Protocols</a></div>
      <div class="BodyAfterHead"><a name="999755">The MAC Layer also implements several functions that are used by upper layer protocols to determine the type of interface. These functions are listed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#987260', '');" title="MAC Layer">Section&nbsp;4.5.5.8</a></span>. To add MYPROTOCOL to <span class="Variable">QualNet</span>, modify functions MAC_IsWirelessNetwork and MAC_IsOneHopBroadcastNetwork so that they correctly indicate the type of network that MYPROTCOL runs on. As an example, the modification to function MAC_IsWirelessNetwork is shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999786', '');" title="MAC Layer">Figure&nbsp;4-148</a></span>.</div>
      <div class="Code_Segment"><a name="999765">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999922">BOOL</a></div>
      <div class="Code_Segment"><a name="999923">MAC_IsWirelessNetwork(Node *node, int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="999924">{</a></div>
      <div class="Code_Segment"><a name="999925">    if (node-&gt;macData[interfaceIndex]-&gt;macProtocol == MAC_PROTOCOL_802_11 ||</a></div>
      <div class="Code_Segment"><a name="999926">        node-&gt;macData[interfaceIndex]-&gt;macProtocol == MAC_PROTOCOL_CSMA ||</a></div>
      <div class="Code_New"><a name="999927">        node-&gt;macData[interfaceIndex]-&gt;macProtocol == </a></div>
      <div class="Code_New"><a name="999955">                                                   MAC_PROTOCOL_MYPROTOCOL ||</a></div>
      <div class="Code_Segment"><a name="999959">        ...</a></div>
      <div class="Code_Segment"><a name="999943">        node-&gt;macData[interfaceIndex]-&gt;macProtocol ==</a></div>
      <div class="Code_Segment"><a name="999962">                                              MAC_PROTOCOL_SATELLITE_BENTPIPE)</a></div>
      <div class="Code_Segment"><a name="999944">    {</a></div>
      <div class="Code_Segment"><a name="999945">        return TRUE;</a></div>
      <div class="Code_Segment"><a name="999946">    }</a></div>
      <div class="Code_Segment"><a name="999948">    return FALSE;</a></div>
      <div class="Code_Segment"><a name="999784">}</a></div>
      <div class="Figure">FIGURE 4-148.&nbsp;&nbsp;<a name="999786">Determining MAC Protocol Type</a></div>
      <div class="Body"><a name="1000576">A wireless MAC protocol also interacts with the Physical Layer. The Physical Layer calls function MAC_ReceivePacketFromPhy to deliver a packet to the MAC Layer. MAC_ReceivePacketFromPhy calls the receive function for the MAC protocol running at the interface to process the packet received from the Physical Layer. For example, MAC_ReceivePacketFromPhy calls the CSMA receive function MacCsmaReceivePacketFromPhy when CSMA is running at the interface. MAC_ReceivePacketFromPhy is implemented in mac.cpp.</a></div>
      <div class="Body"><a name="1000600">To add a new MAC protocol, MYPROTOCOL, modify MAC_ReceivePacketFromPhy so that the receive function for MYPROTCOL is called when MYPROTOCOL is running at the interface, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000620', '');" title="MAC Layer">Figure&nbsp;4-149</a></span>. Function MacMyprotocolReceivePacketFromPhy is the MYPROTCOL function to handle packets received from the Physical Layer.</div>
      <div class="Code_Segment"><a name="1000628">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1055036">void</a></div>
      <div class="Code_Segment"><a name="1000629">MAC_ReceivePacketFromPhy(</a></div>
      <div class="Code_Segment"><a name="1000630">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1000631">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1000632">    Message *packet)</a></div>
      <div class="Code_Segment"><a name="1000633">{</a></div>
      <div class="Code_Segment"><a name="1000634">    ...</a></div>
      <div class="Code_Segment"><a name="1055055">    if (!MAC_InterfaceIsEnabled(node, interfaceIndex))</a></div>
      <div class="Code_Segment"><a name="1055056">    {</a></div>
      <div class="Code_Segment"><a name="1055057">        if (node-&gt;macData[interfaceIndex]-&gt;macProtocol == </a></div>
      <div class="Code_Segment"><a name="1055058">            MAC_PROTOCOL_CELLULAR)</a></div>
      <div class="Code_Segment"><a name="1055059">        {</a></div>
      <div class="Code_Segment"><a name="1055060">            MESSAGE_FreeList(node, packet);           </a></div>
      <div class="Code_Segment"><a name="1055061">        }</a></div>
      <div class="Code_Segment"><a name="1055062">        else</a></div>
      <div class="Code_Segment"><a name="1055063">        {</a></div>
      <div class="Code_Segment"><a name="1055064">            MESSAGE_Free(node, packet);</a></div>
      <div class="Code_Segment"><a name="1055065">        }</a></div>
      <div class="Code_Segment"><a name="1055066">        return;</a></div>
      <div class="Code_Segment"><a name="1000639">    }</a></div>
      <div class="Code_Segment"><a name="1000640">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1055078">    switch (node-&gt;macData[interfaceIndex]-&gt;macProtocol)</a></div>
      <div class="Code_Segment"><a name="1000641">    {</a></div>
      <div class="Code_Segment"><a name="1054216">        case MAC_PROTOCOL_DOT11: {</a></div>
      <div class="Code_Segment"><a name="1054217">            MacDot11ReceivePacketFromPhy(</a></div>
      <div class="Code_Segment"><a name="1054218">                node, (MacDataDot11*)node-&gt;macData[interfaceIndex]-&gt;macVar,</a></div>
      <div class="Code_Segment"><a name="1054219">                packet);</a></div>
      <div class="Code_Segment"><a name="1054220">            break;</a></div>
      <div class="Code_Segment"><a name="1000650">        }</a></div>
      <div class="Code_Segment"><a name="1054236">        case MAC_PROTOCOL_CSMA:</a></div>
      <div class="Code_Segment"><a name="1000651">        {</a></div>
      <div class="Code_Segment"><a name="1000652">            MacCsmaReceivePacketFromPhy(</a></div>
      <div class="Code_Segment"><a name="1000653">                     node, </a></div>
      <div class="Code_Segment"><a name="1000677">                    (MacDataCsma*)node-&gt;macData[interfaceIndex]-&gt;macVar,</a></div>
      <div class="Code_Segment"><a name="1000678">                    packet);</a></div>
      <div class="Code_Segment"><a name="1000654">            break;</a></div>
      <div class="Code_Segment"><a name="1000655">        }</a></div>
      <div class="Code_New"><a name="1000680">        case MAC_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1000681">        {</a></div>
      <div class="Code_New"><a name="1000682">            MacMyprotocolReceivePacketFromPhy(</a></div>
      <div class="Code_New"><a name="1000683">                     node, </a></div>
      <div class="Code_New"><a name="1000684">                    (MacDataMyprotocol*)node-&gt;macData[interfaceIndex]-&gt;macVar,</a></div>
      <div class="Code_New"><a name="1000685">                    packet);</a></div>
      <div class="Code_New"><a name="1000686">            break;</a></div>
      <div class="Code_New"><a name="1000687">        }</a></div>
      <div class="Code_Segment"><a name="1000672">        ...</a></div>
      <div class="Code_Segment"><a name="1000673">      }</a></div>
      <div class="Code_Segment"><a name="1000674">}</a></div>
      <div class="Figure">FIGURE 4-149.&nbsp;&nbsp;<a name="1000620">Delivering Packets from Physical Layer to MAC Protocols</a></div>
      <div class="Body"><a name="1001315">A wireless MAC protocol also receives and processes notifications of Physical Layer status change. When the status of the Physical Layer changes, the Physical Layer sends a notification to the MAC Layer by using the API MAC_ReceivePhyStatusChangeNotification. MAC_ReceivePhyStatusChangeNotification calls the Physical Layer status change handler function for the MAC protocol running at the interface. For example, if CSMA is running at the interface, MAC_ReceiveStatusChangeNotification calls function MacCsmaReceivePhyStatusChangeNotification. MAC_ReceivePhyStatusChangeNotification is implemented in mac.cpp.</a></div>
      <div class="Body"><a name="1001316">To add a new MAC protocol, MYPROTOCOL, modify MAC_ReceivePhyStatusChangeNotification so that the Physical Layer status change handler function for MYPROTCOL is called when MYPROTOCOL is running at the interface, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1001429', '');" title="MAC Layer">Figure&nbsp;4-150</a></span>. Function MacMyprotocolReceivePhyStatusChangeNotification is the MYPROTCOL function to handle Physical Layer status changes.</div>
      <div class="Code_Segment"><a name="1001453">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001499">void</a></div>
      <div class="Code_Segment"><a name="1001454">MAC_ReceivePhyStatusChangeNotification(</a></div>
      <div class="Code_Segment"><a name="1001455">    Node *node,</a></div>
      <div class="Code_Segment"><a name="1001456">    int interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1001457">    PhyStatusType oldPhyStatus,</a></div>
      <div class="Code_Segment"><a name="1001458">    PhyStatusType newPhyStatus,</a></div>
      <div class="Code_Segment"><a name="1001459">    clocktype receiveDuration,</a></div>
      <div class="Code_Segment"><a name="1001460">    const Message *potentialIncomingPacket)</a></div>
      <div class="Code_Segment"><a name="1001461">{</a></div>
      <div class="Code_Segment"><a name="1001462">    switch (node-&gt;macData[interfaceIndex]-&gt;macProtocol)</a></div>
      <div class="Code_Segment"><a name="1001463">    {</a></div>
      <div class="Code_Segment"><a name="1054244">        case MAC_PROTOCOL_DOT11:{</a></div>
      <div class="Code_Segment"><a name="1054245">            MacDot11ReceivePhyStatusChangeNotification(</a></div>
      <div class="Code_Segment"><a name="1054246">                node,</a></div>
      <div class="Code_Segment"><a name="1054247">                (MacDataDot11*)node-&gt;macData[interfaceIndex]-&gt;macVar,</a></div>
      <div class="Code_Segment"><a name="1054248">                oldPhyStatus,</a></div>
      <div class="Code_Segment"><a name="1054249">                newPhyStatus,</a></div>
      <div class="Code_Segment"><a name="1054250">                receiveDuration,</a></div>
      <div class="Code_Segment"><a name="1054251">                potentialIncomingPacket);</a></div>
      <div class="Code_Segment"><a name="1054252">            break;</a></div>
      <div class="Code_Segment"><a name="1001474">        }</a></div>
      <div class="Code_Segment"><a name="1001475">        case MAC_PROTOCOL_CSMA:</a></div>
      <div class="Code_Segment"><a name="1001476">        {</a></div>
      <div class="Code_Segment"><a name="1001477">            MacCsmaReceivePhyStatusChangeNotification(</a></div>
      <div class="Code_Segment"><a name="1001478">                node,</a></div>
      <div class="Code_Segment"><a name="1001479">                (MacDataCsma*)node-&gt;macData[interfaceIndex]-&gt;macVar,</a></div>
      <div class="Code_Segment"><a name="1001480">                oldPhyStatus,</a></div>
      <div class="Code_Segment"><a name="1001481">                newPhyStatus);</a></div>
      <div class="Code_Segment"><a name="1001482">            break;</a></div>
      <div class="Code_Segment"><a name="1001483">        }</a></div>
      <div class="Code_New"><a name="1001484">        case MAC_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1001485">        {</a></div>
      <div class="Code_New"><a name="1001486">            MacMyprotocolReceivePhyStatusChangeNotification(</a></div>
      <div class="Code_New"><a name="1001487">                node,</a></div>
      <div class="Code_New"><a name="1001488">                (MacDataMyprotocol*)node-&gt;macData[interfaceIndex]-&gt;macVar,</a></div>
      <div class="Code_New"><a name="1001489">                oldPhyStatus,</a></div>
      <div class="Code_New"><a name="1001490">                newPhyStatus);</a></div>
      <div class="Code_New"><a name="1001491">            break;</a></div>
      <div class="Code_New"><a name="1001427">        }</a></div>
      <div class="Code_Segment"><a name="1001506">        ...</a></div>
      <div class="Code_Segment"><a name="1001507">      }</a></div>
      <div class="Code_Segment"><a name="1001508">}</a></div>
      <div class="Figure">FIGURE 4-150.&nbsp;&nbsp;<a name="1001429">Notifying MAC Protocols of Physical Layer Status Changes</a></div>
      <div class="Heading3Numbered">4.5.6.6  <a name="999975">Interfacing with Network and Physical Layers</a></div>
      <div class="BodyAfterHead"><a name="1000117">In this section we describe the interface between the Network Layer and a wireless MAC Protocol, and the interface between a wireless MAC protocol and the Physical Layer.</a></div>
      <div class="Body"><a name="1000225">A wireless MAC protocol interacts with the Network Layer in the following ways:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1000226">When IP has a packet to send and the output queue is empty, IP indicates to the MAC protocol that a packet is ready for transmission. If the MAC protocol is in the appropriate state, it dequeues the packet from the output queue. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000118', '');" title="MAC Layer">Section&nbsp;4.5.6.6.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1000230">When the state of the MAC protocol changes to one where it can transmit a packet, the MAC protocol checks the output queue. If the queue is non-empty, the MAC protocol dequeues a packet from the queue. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000118', '');" title="MAC Layer">Section&nbsp;4.5.6.6.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1000237">When the MAC protocol receives a packet from the Physical Layer that is meant for the Network Layer, the MAC protocol delivers the packet to the Network Layer. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000027', '');" title="MAC Layer">Section&nbsp;4.5.6.6.2</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1000254">When the MAC protocol receives a packet from the Physical Layer that is not addressed to the node, but the node is operating in promiscuous mode, the MAC protocol delivers the packet to the Network Layer. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000027', '');" title="MAC Layer">Section&nbsp;4.5.6.6.2</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002687">Some MAC protocols pass an indication to the Network Layer when certain events occur at the MAC Layer. These events include: a packet being dropped at the MAC Layer and receiving a MAC Layer acknowledgement for a transmitted packet. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1002173', '');" title="MAC Layer">Section&nbsp;4.5.5.9.3</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1001103">A wireless MAC protocol interacts with the Physical Layer in the following ways:</a></div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="1001104">When the MAC protocol has a packet to send, it checks the status of the Physical Layer to determine if packet transmission can start. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000118', '');" title="MAC Layer">Section&nbsp;4.5.6.6.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001126">When the MAC protocol is ready to transmit a packet, it adds a MAC header to the packet and sends the packet to the Physical Layer. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000118', '');" title="MAC Layer">Section&nbsp;4.5.6.6.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001108">When the Physical Layer receives a packet from another node, it sends it to the MAC Layer. The MAC Layer removes the MAC header from the received packet and processes the packet. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000027', '');" title="MAC Layer">Section&nbsp;4.5.6.6.2</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001112">When the status of the Physical Layer changes, the Physical Layer notifies the MAC Layer of the status change. The MAC protocol takes appropriate action depending upon the type of status change. See </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1001177', '');" title="MAC Layer">Section&nbsp;4.5.6.6.3</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading4Numbered">4.5.6.6.1  <a name="1000118"> Processing Outgoing Packets</a></div>
      <div class="BodyAfterHead"><a name="999979">When IP has a packet to send to the MAC Layer and the output queue is empty, IP calls function MAC_NetworkLayerHasPacketToSend. MAC_NetworkLayerHasPacketToSend calls the appropriate function for the MAC protocol running at the interface to process the packet from the Network Layer (see.</a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000321', '');" title="MAC Layer">Section&nbsp;4.5.6.5</a></span>). If CSMA is running at the interface, MAC_NetworkLayerHasPacketToSend calls the CSMA function MacCsmaNetworkLayerHasPacketToSend. </div>
      <div class="Body"><a name="1000150">MacCsmaNetworkLayerHasPacketToSend checks the status of the node. If the node’s status is </a><span style="font-family: &quot;Courier New&quot;">CSMA_STATUS_PASSIVE</span>, MacCsmaNetworkLayerHasPacketToSend calls function CheckPhyStatusAndSendOrBackoff. Function CheckPhyStatusAndSendOrBackoff checks the status of the Physical Layer and of the output queue, and either calls function MacCsmaXmit to transmit a packet or function MacCsmaBackoff to enter backoff state. Functions MacCsmaNetworkLayerHasPacketToSend and CheckPhyStatusAndSendOrBackoff are shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000021', '');" title="MAC Layer">Figure&nbsp;4-151</a></span> and are implemented in mac_csma.cpp.</div>
      <div class="Code_Segment"><a name="999995">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000152">void MacCsmaNetworkLayerHasPacketToSend(Node *node, MacDataCsma *csma)</a></div>
      <div class="Code_Segment"><a name="1000153">{</a></div>
      <div class="Code_Segment"><a name="1000154">    if (csma-&gt;status == CSMA_STATUS_PASSIVE) {</a></div>
      <div class="Code_Segment"><a name="1000155">        CheckPhyStatusAndSendOrBackoff(node, csma);</a></div>
      <div class="Code_Segment"><a name="1000156">    }//if//</a></div>
      <div class="Code_Segment"><a name="1000157">}</a></div>
      <div class="Code_Segment"><a name="1000172">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1004122">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000175">static //inline//</a></div>
      <div class="Code_Segment"><a name="1000176">void CheckPhyStatusAndSendOrBackoff(Node* node, MacDataCsma* csma) {</a></div>
      <div class="Code_Segment"><a name="1000177">    /* Carrier sense response from phy. */</a></div>
      <div class="Code_Segment"><a name="1000178">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000179">    if ((PhyStatus(node, csma) == PHY_IDLE) &amp;&amp;</a></div>
      <div class="Code_Segment"><a name="1000180">        (csma-&gt;status != CSMA_STATUS_IN_XMITING))</a></div>
      <div class="Code_Segment"><a name="1000181">    {</a></div>
      <div class="Code_Segment"><a name="1000182">        csma-&gt;status = CSMA_STATUS_XMIT;</a></div>
      <div class="Code_Segment"><a name="1000183">        MacCsmaXmit(node, csma);</a></div>
      <div class="Code_Segment"><a name="1000184">    }</a></div>
      <div class="Code_Segment"><a name="1000185">    else {</a></div>
      <div class="Code_Segment"><a name="1000186">        if (!MAC_OutputQueueIsEmpty(</a></div>
      <div class="Code_Segment"><a name="1000187">                node, csma-&gt;myMacData-&gt;interfaceIndex))</a></div>
      <div class="Code_Segment"><a name="1000188">        {</a></div>
      <div class="Code_Segment"><a name="1000189">            csma-&gt;status = CSMA_STATUS_BACKOFF;</a></div>
      <div class="Code_Segment"><a name="1000190">            MacCsmaBackoff(node, csma);</a></div>
      <div class="Code_Segment"><a name="1000191">        }</a></div>
      <div class="Code_Segment"><a name="1000192">    }</a></div>
      <div class="Code_Segment"><a name="1000173">}</a></div>
      <div class="Figure">FIGURE 4-151.&nbsp;&nbsp;<a name="1000021">Processing Outgoing Packets</a></div>
      <div class="Body"><a name="1000022">As discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#999257', '');" title="MAC Layer">Section&nbsp;4.5.6.4.2</a></span>, CSMA enters the <span style="font-family: &quot;Courier New&quot;">CSMA_STATUS_PASSIVE</span> state when the yield timer expires. This indicates that CSMA can transmit a new packet. In this case, MacCsmaLayer calls function MacCsmaPassive. MacCsmaPassive calls function MacCsmaNetworkLayerHasPacketToSend if the output queue is non-empty. As explained before, MacCsmaNetworkLayerHasPacketToSend calls function CheckPhyStatusAndSendOrbackoff, which calls either MacCsmaXmit or MacCsmaBackoff.</div>
      <div class="Body"><a name="1000452">Function MacCsmaXmit, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1028044', '');" title="MAC Layer">Figure&nbsp;4-152</a></span>, dequeues a packet from the output queue, adds a header to the packet, and calls function PHY_StartTransmittingSignal to send the packet to the Physical Layer for transmission. Function ConvertVariableHWAddressTo802Address converts the MAC address in the structure MacHWAddress to an Ethernet type address.</div>
      <div class="Code_Segment"><a name="1000484">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024632">static</a></div>
      <div class="Code_Segment"><a name="1024633">void MacCsmaXmit(Node *node, MacDataCsma *csma)</a></div>
      <div class="Code_Segment"><a name="1024634">{</a></div>
      <div class="Code_Segment"><a name="1027972">    Message *msg;</a></div>
      <div class="Code_Segment"><a name="1027973">    MacHWAddress destHWAddr;</a></div>
      <div class="Code_Segment"><a name="1027974">    int networkType;</a></div>
      <div class="Code_Segment"><a name="1024640">    TosType priority;</a></div>
      <div class="Code_Segment"><a name="1027982">    CsmaHeader         *hdr;</a></div>
      <div class="Code_Segment"><a name="1024641">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1024642">    assert(csma-&gt;status == CSMA_STATUS_XMIT);</a></div>
      <div class="Code_Segment"><a name="1024644">    /*</a></div>
      <div class="Code_Segment"><a name="1024645">     * Dequeue packet which was received from the</a></div>
      <div class="Code_Segment"><a name="1024646">     * network layer.</a></div>
      <div class="Code_Segment"><a name="1024647">     */</a></div>
      <div class="Code_Segment"><a name="1024649">    MAC_OutputQueueDequeuePacket(</a></div>
      <div class="Code_Segment"><a name="1024650">        node, csma-&gt;myMacData-&gt;interfaceIndex,</a></div>
      <div class="Code_Segment"><a name="1024651">        &amp;msg, &amp;destHWAddr, &amp;networkType, &amp;priority);</a></div>
      <div class="Code_Segment"><a name="1024653">    if (msg == NULL)</a></div>
      <div class="Code_Segment"><a name="1024654">    {</a></div>
      <div class="Code_Segment"><a name="1024655">        ...</a></div>
      <div class="Code_Segment"><a name="1024664">        if(csma-&gt;BOtimes &gt;0)</a></div>
      <div class="Code_Segment"><a name="1024666">        {</a></div>
      <div class="Code_Segment"><a name="1024667">            csma-&gt;status = CSMA_STATUS_BACKOFF;</a></div>
      <div class="Code_Segment"><a name="1024669">        }</a></div>
      <div class="Code_Segment"><a name="1024670">        else</a></div>
      <div class="Code_Segment"><a name="1024671">        {</a></div>
      <div class="Code_Segment"><a name="1024672">            csma-&gt;status = CSMA_STATUS_PASSIVE;</a></div>
      <div class="Code_Segment"><a name="1024674">        }</a></div>
      <div class="Code_Segment"><a name="1024676">        return;</a></div>
      <div class="Code_Segment"><a name="1024677">    }</a></div>
      <div class="Code_Segment"><a name="1024679">    csma-&gt;status = CSMA_STATUS_IN_XMITING;</a></div>
      <div class="Code_Segment"><a name="1024680">    csma-&gt;timer.flag = CSMA_TIMER_OFF | CSMA_TIMER_UNDEFINED;</a></div>
      <div class="Code_Segment"><a name="1024682">  </a></div>
      <div class="Code_Segment"><a name="1028026">  /* Assign other fields to packet to be sent to phy layer. */</a></div>
      <div class="Code_Segment"><a name="1028048">   MESSAGE_AddHeader(node, msg, sizeof(CsmaHeader), TRACE_CSMA);</a></div>
      <div class="Code_Segment"><a name="1028050">   hdr = (CsmaHeader *) msg-&gt;packet;</a></div>
      <div class="Code_Segment"><a name="1028052">   ConvertVariableHWAddressTo802Address(node, &amp;destHWAddr, &amp;hdr-&gt;destAddr);</a></div>
      <div class="Code_Segment"><a name="1028054">   ConvertVariableHWAddressTo802Address(</a></div>
      <div class="Code_Segment"><a name="1028055">                  node,</a></div>
      <div class="Code_Segment"><a name="1028056">                  &amp;node-&gt;macData[csma-&gt;myMacData-&gt;interfaceIndex]-&gt;macHWAddr,</a></div>
      <div class="Code_Segment"><a name="1028057">                  &amp;hdr-&gt;sourceAddr);</a></div>
      <div class="Code_Segment"><a name="1028095">   hdr-&gt;priority = priority;</a></div>
      <div class="Code_Segment"><a name="1028096">   PHY_StartTransmittingSignal(node, csma-&gt;myMacData-&gt;phyNumber,</a></div>
      <div class="Code_Segment"><a name="1028063">                                msg, FALSE, 0);</a></div>
      <div class="Code_Segment"><a name="1028066">   if (MAC_IsBroadcastMac802Address(&amp;hdr-&gt;destAddr)) {</a></div>
      <div class="Code_Segment"><a name="1028067">        csma-&gt;pktsSentBroadcast++;</a></div>
      <div class="Code_Segment"><a name="1028068">   }</a></div>
      <div class="Code_Segment"><a name="1028069">   else {</a></div>
      <div class="Code_Segment"><a name="1028070">        csma-&gt;pktsSentUnicast++;</a></div>
      <div class="Code_Segment"><a name="1028071">   }</a></div>
      <div class="Code_Segment"><a name="1028042">}</a></div>
      <div class="Figure">FIGURE 4-152.&nbsp;&nbsp;<a name="1028044">Sending Outgoing Packet to Physical Layer</a></div>
      <div class="Heading4Numbered">4.5.6.6.2  <a name="1000027">Processing Incoming Packets</a></div>
      <div class="BodyAfterHead"><a name="1000741">When the Physical Layer has a packet to send to the MAC Layer, the Physical Layer calls function MAC_ReceivePacketFromPhy. MAC_ReceivePacketFromPhy calls the appropriate function for the MAC protocol running at the interface to process the packet from the Physical Layer (see.</a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000321', '');" title="MAC Layer">Section&nbsp;4.5.6.5</a></span>). If CSMA is running at the interface, MAC_ReceivePacketFromPhy calls the CSMA function MacCsmaReceivePacketFromPhy. </div>
      <div class="Body"><a name="1000745">MacCsmaReceivePacketFromPhy, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000777', '');" title="MAC Layer">Figure&nbsp;4-153</a></span>, checks the status of the node. If the node is not in the transmitting state, MacCsmaReceivePacketFromPhy does one of the following:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000846">If the packet is addressed to the node or is a broadcast packet, MacCsmaReceivePacketFromPhy removes the MAC header and delivers the packet to the Network Layer by calling function MAC_HandoffSucessfullyReceivedPacket.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000859">If the packet is not addressed to the node and is not a broadcast packet, but the node is operating in promiscuous mode, MacCsmaReceivePacketFromPhy calls function MacCsmaHandlePromiscousMode. MacCsmaHandlePromiscousMode removes the MAC header and sends the packet to the Network Layer by using the function MAC_SneakPeekAtMacPacket.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="1000749">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000883">void MacCsmaReceivePacketFromPhy(</a></div>
      <div class="Code_Segment"><a name="1000884">    Node* node, MacDataCsma* csma, Message* msg)</a></div>
      <div class="Code_Segment"><a name="1000885">{</a></div>
      <div class="Code_Segment"><a name="1000886">    if (csma-&gt;status == CSMA_STATUS_IN_XMITING) {</a></div>
      <div class="Code_Segment"><a name="1000887">        MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1000888">        return;</a></div>
      <div class="Code_Segment"><a name="1000889">    }//if//</a></div>
      <div class="Code_Segment"><a name="1000890">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000891">    switch (csma-&gt;status) {</a></div>
      <div class="Code_Segment"><a name="1000892">    case CSMA_STATUS_PASSIVE:</a></div>
      <div class="Code_Segment"><a name="1000893">    case CSMA_STATUS_CARRIER_SENSE:</a></div>
      <div class="Code_Segment"><a name="1000894">    case CSMA_STATUS_BACKOFF:</a></div>
      <div class="Code_Segment"><a name="1000895">    case CSMA_STATUS_YIELD: {</a></div>
      <div class="Code_Segment"><a name="1000896">       int interfaceIndex = csma-&gt;myMacData-&gt;interfaceIndex;</a></div>
      <div class="Code_Segment"><a name="1000897">       CsmaHeader *hdr = (CsmaHeader *) msg-&gt;packet;</a></div>
      <div class="Code_Segment"><a name="1028105">       MacHWAddress  destHWAddress;</a></div>
      <div class="Code_Segment"><a name="1028107">       Convert802AddressToVariableHWAddress(node, &amp;destHWAddress,</a></div>
      <div class="Code_Segment"><a name="1028108">                                                             &amp;hdr-&gt;destAddr);</a></div>
      <div class="Code_Segment"><a name="1028111">       if (MAC_IsMyAddress(node, &amp;destHWAddress)) {</a></div>
      <div class="Code_Segment"><a name="1028112">            csma-&gt;pktsGotUnicast++;</a></div>
      <div class="Code_Segment"><a name="1028113">        }</a></div>
      <div class="Code_Segment"><a name="1028114">        else if (MAC_IsBroadcastMac802Address(&amp;hdr-&gt;destAddr))</a></div>
      <div class="Code_Segment"><a name="1028115">        {</a></div>
      <div class="Code_Segment"><a name="1028116">            csma-&gt;pktsGotBroadcast++;</a></div>
      <div class="Code_Segment"><a name="1028117">        }</a></div>
      <div class="Code_Segment"><a name="1028119">       if (MAC_IsMyAddress(node, &amp;destHWAddress) ||</a></div>
      <div class="Code_Segment"><a name="1028120">                            MAC_IsBroadcastHWAddress(&amp;destHWAddress))</a></div>
      <div class="Code_Segment"><a name="1028121">        {</a></div>
      <div class="Code_Segment"><a name="1028123">             MacHWAddress srcHWAddress;</a></div>
      <div class="Code_Segment"><a name="1028124">             Convert802AddressToVariableHWAddress(node, &amp;srcHWAddress,</a></div>
      <div class="Code_Segment"><a name="1028125">                                                           &amp;hdr-&gt;sourceAddr);</a></div>
      <div class="Code_Segment"><a name="1028127">            MESSAGE_RemoveHeader(node, msg, sizeof(CsmaHeader), TRACE_CSMA);</a></div>
      <div class="Code_Segment"><a name="1028129">            MAC_HandOffSuccessfullyReceivedPacket(node,</a></div>
      <div class="Code_Segment"><a name="1028130">               csma-&gt;myMacData-&gt;interfaceIndex, msg, &amp;srcHWAddress);</a></div>
      <div class="Code_Segment"><a name="1028131">        }</a></div>
      <div class="Code_Segment"><a name="1028132">        else {</a></div>
      <div class="Code_Segment"><a name="1028133">            if (node-&gt;macData[interfaceIndex]-&gt;promiscuousMode) {</a></div>
      <div class="Code_Segment"><a name="1028134">                MacCsmaHandlePromiscuousMode(node, csma, msg,</a></div>
      <div class="Code_Segment"><a name="1028137">                                             hdr-&gt;sourceAddr,  hdr-&gt;destAddr);</a></div>
      <div class="Code_Segment"><a name="1028139">            }</a></div>
      <div class="Code_Segment"><a name="1028140">            MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1028141">        }</a></div>
      <div class="Code_Segment"><a name="1028142">        break;</a></div>
      <div class="Code_Segment"><a name="1000929">    }</a></div>
      <div class="Code_Segment"><a name="1000930">    default:</a></div>
      <div class="Code_Segment"><a name="1000931">        MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1000932">        printf("MAC_CSMA: Error with node %u, status %ld.\n",</a></div>
      <div class="Code_Segment"><a name="1000933">               node-&gt;nodeId, csma-&gt;status);</a></div>
      <div class="Code_Segment"><a name="1000934">        assert(FALSE); abort();</a></div>
      <div class="Code_Segment"><a name="1000935">    }//switch//</a></div>
      <div class="Code_Segment"><a name="1000936">}</a></div>
      <div class="Figure">FIGURE 4-153.&nbsp;&nbsp;<a name="1000777">Processing Incoming Packets</a></div>
      <div class="Body"><a name="1000989">Note that besides transporting upper layer packets, some MAC protocols may also generate and receive </a><span style="font-style: italic">control</span> packets. For example, IEEE 802.11 MAC uses CTS and RTS control packets. These control packets originate at the MAC Layer at the sending node. At the receiving node, the control packets are processed at the MAC Layer and are not delivered to the upper layers. If MYPROTOCOL uses control packets, the receive function for MYPROTOCOL, MacMyprotocolReceivepacketFromPhy, should check the destination layer of a received packet and should not deliver control packets to the Network Layer. </div>
      <div class="Heading4Numbered">4.5.6.6.3  <a name="1001177">Processing Physical Layer Status Change Notification</a></div>
      <div class="BodyAfterHead"><a name="1001188">The operation of a wireless MAC protocol depends upon the state of the Physical Layer. When the status of the Physical Layer changes, the Physical Layer sends a notification to the MAC Layer by using the API MAC_ReceiveStatusChangeNotification. MAC_ReceiveStatusChangeNotification calls the physical status change handler function for the MAC protocol running at the interface (see.</a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1000321', '');" title="MAC Layer">Section&nbsp;4.5.6.5</a></span>). For example, if CSMA is running at the interface, MAC_ReceiveStatusChangeNotification calls function MacCsmaReceivePhyStatusChangeNotification.</div>
      <div class="Body"><a name="1001207">For CSMA, the status change of interest occurs when the Physical Layer status changes from a transmitting state to a non-transmitting state. This status change indicates the end of transmission of a packet by the Physical Layer. When this status change occurs, function MacCsmaReceivePhyStatusChangeNotification, shown in </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1001274', '');" title="MAC Layer">Figure&nbsp;4-154</a>, resets the backoff parameters. set the CSMA status to <span style="font-family: &quot;Courier New&quot;">CSMA_STATUS_YIELD</span>, and calls function MacCsmaYield. </div>
      <div class="Code_Segment"><a name="1001225">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001289">void MacCsmaReceivePhyStatusChangeNotification(</a></div>
      <div class="Code_Segment"><a name="1001290">   Node* node,</a></div>
      <div class="Code_Segment"><a name="1001291">   MacDataCsma* csma,</a></div>
      <div class="Code_Segment"><a name="1001292">   PhyStatusType oldPhyStatus,</a></div>
      <div class="Code_Segment"><a name="1001293">   PhyStatusType newPhyStatus)</a></div>
      <div class="Code_Segment"><a name="1001294">{</a></div>
      <div class="Code_Segment"><a name="1001295">   if (oldPhyStatus == PHY_TRANSMITTING) {</a></div>
      <div class="Code_Segment"><a name="1001296">      assert(newPhyStatus != PHY_TRANSMITTING);</a></div>
      <div class="Code_Segment"><a name="1001297">      assert(csma-&gt;status == CSMA_STATUS_IN_XMITING);</a></div>
      <div class="Code_Segment"><a name="1001298">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001299">      csma-&gt;BOmin = CSMA_BO_MIN;</a></div>
      <div class="Code_Segment"><a name="1001300">      csma-&gt;BOmax = CSMA_BO_MAX;</a></div>
      <div class="Code_Segment"><a name="1001301">      csma-&gt;BOtimes = 0;</a></div>
      <div class="Code_Segment"><a name="1001302">      csma-&gt;status = CSMA_STATUS_YIELD;</a></div>
      <div class="Code_Segment"><a name="1001303">      MacCsmaYield(node, csma, (clocktype)CSMA_TX_DATA_YIELD_TIME);</a></div>
      <div class="Code_Segment"><a name="1001304">   }//if//</a></div>
      <div class="Code_Segment"><a name="1001272">}</a></div>
      <div class="Figure">FIGURE 4-154.&nbsp;&nbsp;<a name="1001274">Processing Physical Layer Status Changes</a></div>
      <div class="Heading3Numbered">4.5.6.7  <a name="1001560">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="1001174">This step is similar to the one for adding a wired MAC Protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#996835', '');" title="MAC Layer">Section&nbsp;4.5.5.10</a></span>).</div>
      <div class="Heading3Numbered">4.5.6.8  <a name="1001575">Finalization</a></div>
      <div class="BodyAfterHead"><a name="1001579">This step is similar to the one for adding a wired MAC Protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#1055252', '');" title="MAC Layer">Section&nbsp;4.5.5.10.5</a></span>).</div>
      <div class="Heading3Numbered">4.5.6.9  <a name="1001584">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1001588">This step is similar to the one for adding a wired MAC Protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-5.html#997462', '');" title="MAC Layer">Section&nbsp;4.5.5.12</a></span>).</div>
      <div class="Heading3Numbered">4.5.6.10  <a name="1055430">Integrating the Protocol into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1055434">To make the new protocol available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Body"><a name="1023021">&nbsp;</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <hr align="left" />
    <table align="left">
      <tr>
        <td class="WebWorks_Company_Phone_Bottom">© 2008 - 2012 SCALABLE Network Technologies, Inc. All rights reserved.</td>
      </tr>
    </table>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>