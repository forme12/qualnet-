<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Application Layer</title>
    <link rel="StyleSheet" href="css/Chapter%204-2.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <div>
      <img src="snt-logo-text2-transparent-small.png" />
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Chapter%204-1.05.1.html#964883">4	Developing Protocol Models in QualNet</a> &gt; 4.2  Application Layer</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading1Numbered">4.2  <a name="964883">Application Layer</a></div>
      <div class="BodyAfterHead"><a name="1003564">The Application Layer is the topmost layer in the protocol stack, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-1.05.1.html#993736', '');" title="Developing Protocol Models in QualNet">Figure&nbsp;4-1</a></span>. User applications and some routing protocols reside at this layer. </div>
      <div class="Body"><a name="1003573">This section gives a detailed description of how to add an Application Layer protocol to </a><span class="Variable">QualNet</span>. </div>
      <div class="Heading2Numbered">4.2.1  <a name="1068913">Application Layer Protocols in </a><span class="Variable">QualNet</span></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="1068914">QualNet</a></span> provides a large number of Application Layer protocols. Multiple applications, and multiple instances of the same application, can run at a node simultaneously, much like a real network. </div>
      <div class="BodyAfterHead"><a name="994071">Application Layer protocols in </a><span class="Variable">QualNet</span> can be grouped into the following two categories: </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="965329">Traffic-generating Protocols</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="994078">Routing Protocols</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.2.1.1  <a name="1068887">Traffic-generating Protocols</a></div>
      <div class="BodyAfterHead"><a name="1068888">Traffic-generating protocols simulate the traffic generated by a real network application. </a><span class="Variable">QualNet</span> provides a large number of traffic-generating protocols. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1094244', '');" title="Application Layer">Table&nbsp;4-2</a></span> lists some of the traffic-generating Application Layer protocols in <span class="Variable">QualNet</span>.</div>
      <div class="BodyAfterHead"><a name="1068875">While some protocols are used directly as applications, such as FTP and Telnet, others are used to simulate real network applications. Applications such as CBR (Constant Bit Rate) can be configured to simulate a large number of real network applications by mimicking their traffic pattern. For example, audio traffic and old video codecs infuse traffic at a constant rate into the network and can be accurately simulated by appropriately configuring the CBR application in </a><span class="Variable">QualNet</span>. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1094244', '');" title="Application Layer" name="1068744">Table&nbsp;4-2</a></span> lists the different traffic generators modeled in <span class="Variable">QualNet</span>. See the corresponding model library for a detailed description of each protocol and its parameters.</div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-2.&nbsp;&nbsp;<a name="1094244">Traffic Generators in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 144pt">
            <div class="CellHeading"><a name="1094250">Traffic Generator </a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 234pt">
            <div class="CellHeading"><a name="1094252">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1094254">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094256">CBR</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094258">Constant Bit Rate (CBR) traffic generator.</a></div>
            <div class="CellBody"><a name="1094259">This UDP-based client-server application sends data from a client to a server at a constant bit rate.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094261">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094263">CELLULAR-ABSTRACT-APP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094265">Abstract cellular application.</a></div>
            <div class="CellBody"><a name="1094266">This is an application to generate traffic for networks running abstract cellular models.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094268">Cellular</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094270">FTP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094272">File Transfer Protocol (FTP).</a></div>
            <div class="CellBody"><a name="1094273">This tcplib application generates TCP traffic based on historical trace data.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094275">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094277">FTP/GENERIC</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094279">Generic FTP.</a></div>
            <div class="CellBody"><a name="1094280">This model is similar to the FTP model but allows the user to have more control over the traffic properties. It uses FTP to transfer a user-specified amount of data.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094282">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094284">GSM</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094286">Global System for Mobile communications (GSM).</a></div>
            <div class="CellBody"><a name="1094287">This is an application for generating traffic for GSM networks.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094289">Cellular</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094291">HTTP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094293">HyperText Transfer Protocol (HTTP).</a></div>
            <div class="CellBody"><a name="1094294">The HTTP application generates realistic web traffic between a client and one or more servers. The traffic is randomly generated based on historical data.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094296">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094298">LOOKUP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094300">Look-up traffic generator.</a></div>
            <div class="CellBody"><a name="1094301">This is an abstract model of unreliable query/response traffic, such as DNS look-up, or pinging.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094303">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094354">MCBR</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094356">Multicast Constant Bit rate (MCBR).</a></div>
            <div class="CellBody"><a name="1094357">This model is similar to CBR and generates multicast constant bit rate traffic.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094359">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094305">PHONE-CALL</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094308">Phone call traffic generator.</a></div>
            <div class="CellBody"><a name="1094366">This model simulates phone calls between two end users in a UMTS network.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094310">UMTS</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094312">SUPER-APPLICATION</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094314">Super application.</a></div>
            <div class="CellBody"><a name="1094315">This model can simulate both TCP and UDP flows as well as two-way (request-response type) UDP sessions.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094317">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094319">TELNET</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094321">Telnet application.</a></div>
            <div class="CellBody"><a name="1094322">This model generates realistic Tenet-style TCP traffic between a client and a server based on historical data. It is part of the tcplib suit of applications.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094324">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094326">TRAFFIC-GEN</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094328">Random distribution-based traffic generator.</a></div>
            <div class="CellBody"><a name="1094329">This is a flexible UDP traffic generator that supports a variety of data size and interval distributions and QoS parameters.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094331">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094333">TRAFFIC-TRACE</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094335">Trace file-based traffic generator.</a></div>
            <div class="CellBody"><a name="1094336">This model generates traffic according to a user-specified file, and like Traffic-Gen, it supports QoS parameters.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094338">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094340">VBR</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094342">Variable Bit Rate (VBR) traffic generator.</a></div>
            <div class="CellBody"><a name="1094343">This model generates fixed-size data packets transmitted using UDP at exponentially distributed time intervals.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094345">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094347">VOIP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094349">Voice over IP traffic generator.</a></div>
            <div class="CellBody"><a name="1094350">This model simulates IP telephony sessions.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094352">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094850">ZIGBEEAPP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094861">ZigBee Application.</a></div>
            <div class="CellBody"><a name="1094862">This is similar to the CBR application but is used only in sensor networks.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094855">Sensor Networks</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading3Numbered">4.2.1.2  <a name="916849">Routing Protocols</a></div>
      <div class="BodyAfterHead"><a name="994688">In addition to traffic generators, certain service-providing protocols may also reside at the Application Layer. Routing protocols is a common category of service-providing Application Layer protocols. These routing protocols use UDP or TCP services.</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1043002', '');" title="Application Layer" name="1042738">Table&nbsp;4-3</a></span> lists the Application Layer routing protocols in <span class="Variable">QualNet</span>. See the corresponding model library for a detailed description of each protocol and its parameters.</div>
      <div class="Anchor"><a name="1043231">&nbsp;</a></div>
      <div class="Note_Indented"><a name="1043227"><img class="Default" src="images/Chapter%204-2.06.1.1.jpg" width="45" height="33" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Some routing protocols are implemented at the Network Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1048755', '');" title="Network Layer">Table&nbsp;4-8</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#1049217', '');" title="Network Layer">Table&nbsp;4-9</a></span>). </div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-3.&nbsp;&nbsp;<a name="1043002">Application Layer Routing Protocols in </a><span class="Variable">QualNet</span>&nbsp;</div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 144pt">
            <div class="CellHeading"><a name="1043008">Routing Protocol</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 234pt">
            <div class="CellHeading"><a name="1043010">Description</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 90pt">
            <div class="CellHeading"><a name="1043012">Model Library</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043027">BELLMANFORD</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043029">Bellman-Ford routing protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043031">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1094412">BGPv4</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094433">Border Gateway Protocol version 4 (BGPv4).</a></div>
            <div class="CellBody"><a name="1094473">This protocol can be used for IPv4 and IPv6 networks.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1094417">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043045">EIGRP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043047">Enhanced Interior Gateway Routing Protocol (EIGRP).</a></div>
            <div class="CellBody"><a name="1043048">This is a distance vector routing protocol designed for fast convergence.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043050">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043052">FISHEYE</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043054">Fisheye Routing Protocol.</a></div>
            <div class="CellBody"><a name="1043055">This is a link state-based routing protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043057">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043080">IGRP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043082">Interior Gateway Routing Protocol (IGRP).</a></div>
            <div class="CellBody"><a name="1043083">This is a distance vector Interior Gateway protocol (IGP).</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043085">Multimedia and Enterprise</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043094">OLSR-INRIA</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043096">Optimized Link State Routing (OLSR) protocol.</a></div>
            <div class="CellBody"><a name="1043097">This is a link state-based routing protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043099">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043101">OLSRv2-NIIGATA</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043103">Optimized Link State Routing, version 2 (OLSRv2) protocol.</a></div>
            <div class="CellBody"><a name="1043104">This is a successor of the OLSR protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043106">Wireless</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043122">RIP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043124">Routing Information Protocol (RIP) routing protocol.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043126">Developer</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody" style="margin-bottom: 3.0pt"><a name="1043128">RIPng</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043130">Routing Information Protocol, next generation (RIPng) routing protocol.</a></div>
            <div class="CellBody"><a name="1043131">This protocol can be used for IPv6 networks.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043133">Developer</a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="916891">Other routing protocols may send messages directly from the Network Layer. These protocols do not use UDP or TCP services. Examples of such Network Layer routing protocols include the Ad-hoc Distance Vector (AODV) and Dynamic Source Routing (DSR) protocols. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1043171', '');" title="Application Layer">Table&nbsp;4-4</a></span> lists some differences between Application Layer and Network Layer routing protocols</div>
      <table class="Format_A" style="text-align: left; width: 468pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-4.&nbsp;&nbsp;<a name="1043171">Application Layer versus Network Layer Routing Protocols</a></div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.25pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 234pt">
            <div class="CellHeading"><a name="1043175">Application Layer Routing Protocols</a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.25pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 234pt">
            <div class="CellHeading"><a name="1043177">Network Layer Routing Protocols</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043179">Use UDP or TCP to transmit their route discovery and control packets.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043181">Use IP directly to transmit their route discovery and control packets.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043183">Use an IP kernel function to update the IP forwarding table.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.25pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043185">Use IP kernel functions to register itself as the packet routing function.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043187">Do not receive data packets to forward, IP handles those itself.</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.25pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1043189">Receive data packets and decide outgoing interface to forward packets.</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading2Numbered">4.2.2  <a name="965594">Application Layer Organization: Files and Folders</a></div>
      <div class="BodyAfterHead"><a name="996818">In this section, we briefly examine the files and folders that are relevant to Application Layer protocols. These files contain detailed comments on functions and other code components.</a></div>
      <div class="Body"><a name="965520">The Application Layer API is composed of several macros, functions, and structures. These are defined in the following header files:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="965521">QUALNET_HOME</a></span>/include/api.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="965532">This file defines the events and data structures needed to communicate between different layers of the protocol stack.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="965533">QUALNET_HOME</a></span>/include/application.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1068259">This file contains definitions common to Application Layer protocols and Application Layer data structure in the node structure.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1068260">QUALNET_HOME</a></span>/include /app_util.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1068261">This file contains prototypes of the functions defined in the file </a><span class="Variable">QUALNET_HOME</span>/main/app_util.cpp.</div>
      <div class="Body"><a name="972789">Additionally, the following header files are also relevant to the Application Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="916930">QUALNET_HOME</a></span>/include/fileio.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="994123">This file contains prototypes of functions to read input files and create output files. </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="916931">QUALNET_HOME</a></span>/include/mapping.h</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="994129">This file contains prototypes of functions to map between node ids and IP addresses.</a></div>
      <div class="Body"><a name="916974">The following are the folders and source files associated with the Application Layer:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="1068680">QUALNET_HOME</a></span>/libraries/developer/src </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="1068681">This folder contains the source and header files for most of the applications implemented in </a><span class="Variable">QualNet</span>. The file names are based on the name of the application that they implement, e.g., to see the implementation for CBR (Constant Bit Rate), look at files app_cbr.cpp and app_cbr.h in this folder. Other libraries may contain code for application models as well.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="916981">QUALNET_HOME</a></span>/main/application.cpp</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="916982">This file contains Application Layer functions, including the initialization, message processing, and finalization functions.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span class="Variable"><a name="916984">QUALNET_HOME</a></span>/main/app_util.cpp </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="986250">This file contains utilities used by Application Layer protocols. This includes functions to set timers, register an application, send packets, and manage connections to Transport Layer protocols (UDP and TCP).</a></div>
      <div class="Heading2Numbered">4.2.3  <a name="986251">Application Layer Data Structures</a></div>
      <div class="BodyAfterHead"><a name="986262">The Application Layer data structures are defined in </a><span class="Variable">QUALNET_HOME</span>/include/application.h. This section describes the main data structures. (Note that only a partial description of the data structures is provided here. Refer to file application.h for a complete description.)</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><span style="font-family: &quot;Courier New&quot;"><a name="988346">AppType</a></span>: This is an enumeration type that lists all the Application Layer protocols. Note that for each traffic-generating protocols, there are two entries in the list: one for the client and one for the server. There is a single entry in the list for each Application Layer routing protocol.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988388">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988416">typedef enum</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988348">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988349">    APP_FTP_SERVER_DATA = 20,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1079240">    APP_FTP_SERVER = 21,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988350">    APP_FTP_CLIENT,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988351">    APP_TELNET_SERVER = 23,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988352">    APP_TELNET_CLIENT,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988353">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988354">    /* Application-layer routing protocols */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988357">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988358">    APP_ROUTING_FISHEYE = 160,      // IP protocol number</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988359">    APP_ROUTING_STATIC,</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996951">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988435">    APP_PLACEHOLDER</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988372">} AppType;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986327">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="988679">AppInfo</a></span>: This data structure contains information about an instance of an application. The information stored is the application type and a pointer to the structure that stores the application state and statistics. Each node maintains this information for each instance of each application running at that node.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988680">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988681">typedef struct app_info</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988442">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988443">    AppType appType;          /* type of application */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988444">    void *appDetail;          /* statistics of the application */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998045">    struct app_info *appNext; /* link to the next app of</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998046">                                 the node */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988667">} AppInfo;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988668">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="988669">AppData</a></span>: This is the main data structure used by the Application Layer and stores information about all applications running at a node. Some important fields of this structure are explained below.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="994058">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996993">struct AppData</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986263">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986264">    AppInfo  *appPtr;       /* pointer to the list of app info */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986265">    PortInfo *portTable;    /* pointer to the port table */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986266">    short    nextPortNum;   /* next available port number */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986267">    BOOL     appStats;      /* flag indicating whether application</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999486">                               statistics collection is enabled */</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986268">    AppType exteriorGatewayProtocol;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986269">    BOOL routingStats;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986270">    void *routingVar;          </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986271">    void *bellmanford;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986272">    void *olsr;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="986273">    ...  </a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="996992">};</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997003">&nbsp;</a></div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="988655">appPtr</a></span>: This is a pointer to the list of traffic-generating protocols running at the node. Each instance of an application has its own entry in this list.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="988619">appStats</a></span>: This flag indicates whether or not statistics collection is enabled for the Application Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="988620">portTable</a></span>, <span style="font-family: &quot;Courier New&quot;">nextPortNum</span>: These fields are used to manage port numbers and are explained in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1030592', '');" title="Application Layer">Section&nbsp;4.2.7.1</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_Indented_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_Indented_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_Indented_inner"><span style="font-family: &quot;Courier New&quot;"><a name="988621">routingVar</a></span>, <span style="font-family: &quot;Courier New&quot;">bellmanford</span>, <span style="font-family: &quot;Courier New&quot;">olsr</span>: These are pointers to the Application Layer routing protocols running at the node.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="998049">AppTimer</a></span>: This data structure is used to implement Application Layer timers. It stores the timer type and information to identify the application for which the timer is set.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment_Large"><a name="998067">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="998088">typedef struct app_timer</a></div>
      <div class="Code_Segment_Large"><a name="998075">{</a></div>
      <div class="Code_Segment_Large"><a name="998076">  int type;               /* timer type */</a></div>
      <div class="Code_Segment_Large"><a name="998077">  int connectionId;       /*  the connection this timer is meant for */</a></div>
      <div class="Code_Segment_Large"><a name="998078">  unsigned short sourcePort;     /*  the port of the session this */ </a></div>
      <div class="Code_Segment_Large"><a name="1041901">                                 /*  timer is meant for */</a></div>
      <div class="Code_Segment_Large"><a name="998079">   NodeAddress address;  /* address and port combination identify */</a></div>
      <div class="Code_Segment_Large"><a name="998084">                         /* session */</a></div>
      <div class="Code_Segment_Large"><a name="998071">} AppTimer;</a></div>
      <div class="Heading2Numbered">4.2.4  <a name="1005645">Application Layer APIs and Inter-layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1068456">This section describes the APIs that are available for the Application Layer to communicate with the Transport Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1005871', '');" title="Application Layer">Section&nbsp;4.2.4.1</a></span>), message types that are used by the Transport Layer to communicate with the Application Layer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1005920', '');" title="Application Layer">Section&nbsp;4.2.4.2</a></span>), and some of the Application Layer utility APIs (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1005954', '');" title="Application Layer">Section&nbsp;4.2.4.3</a></span>). </div>
      <div class="Body"><a name="1068466">The complete list of APIs, with their parameters and description, can be found in </a><span style="font-style: italic">API Reference Guide</span>.</div>
      <div class="Heading3Numbered">4.2.4.1  <a name="1005871">Application Layer to Transport Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1005872">A number of APIs are available at the Application Layer to communicate with the Transport Layer. The prototypes for the API functions are contained in the file app_util.h. The file app_util.cpp contains the implementation of these functions. </a></div>
      <div class="Body"><a name="1005470">Some of the APIs used for communication from the Application Layer to the Transport Layer are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986684">APP_UdpSendNewDataWithPriority: This function allocates and sends data to the UDP protocol at the Transport Layer with the specified priority.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986720">APP_TcpOpenConnection: This function opens a TCP connection.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005905">APP_TcpServerListen: This function enables the Application Layer to listen on the specified server port.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005906">APP_TcpSendData: This function sends data to the TCP protocol at the Transport Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005907">APP_TcpCloseConnection: This function closes a TCP connection.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.2.4.2  <a name="1005920">Transport Layer to Application Layer Communication</a></div>
      <div class="BodyAfterHead"><a name="1005908">Transport Layer protocols communicate with the Application Layer by means of messages. The message types used for this communication are enumerated in the file </a><span class="Variable">QUALNET_HOME</span>/include/api.h. Some of the message types used by Transport Layer protocols to communicate with the Application Layer are listed below.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1005909">MSG_APP_FromTransport</a></span>: This message type is used by UDP to pass an incoming packet to the Application Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="986768">MSG_APP_FromTransOpenResult</a></span>: This message type is used by TCP to notify an application client that a TCP connection request was accepted or rejected.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1005947">MSG_APP_FromTransDataSent</a></span>: This message type is used by TCP to indicate to the Application Layer that an outgoing packet has been transmitted.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1005950">MSG_APP_FromTransDataReceived</a></span>: This message type is used by TCP to pass an incoming packet to the Application Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1005951">MSG_APP_FromTransListenResult</a></span>: This message type is used by TCP to notify an application server that a request to open a TCP connection has been received.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="1005952">MSG_APP_FromTransCloseResult</a></span>: This message type is used by TCP to notify an application client or server that a TCP connection has been closed.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.2.4.3  <a name="1005954">Application Layer Utility APIs</a></div>
      <div class="BodyAfterHead"><a name="1005967">Several APIs are available at the Application Layer that perform tasks internal to the Application Layer. The prototypes for the API functions are contained in the file app_util.h. The file app_util.cpp contains the implementation of these functions.</a></div>
      <div class="Body"><a name="1005968">Some of the Application Layer utility APIs are listed below.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005949">APP_IsFreePort: This functions checks whether the specified port number is free or in use.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="986786">APP_GetProtocolType: This function returns the protocol type for which the specified message is destined.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005882">APP_RegisterNewApp: This function inserts a new application instance in the list of application instances running at a node’s Application Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1005883">APP_SetTimer: This function sets an Application Layer timer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading2Numbered">4.2.5  <a name="986903">Adding a Traffic-generating Application Protocol </a></div>
      <div class="BodyAfterHead"><a name="1068684">Although the working of each Application Layer protocol is different, there are certain functions that are performed by most Application Layer protocols. This section provides an overview of the flow of a traffic-generating Application Layer protocol and provides an outline for developing and adding a traffic-generating Application Layer protocol to </a><span class="Variable">QualNet</span>. It describes how to develop code components common to most application protocols such as initializing, sending and receiving packets, and collecting statistics. </div>
      <div class="Body"><a name="991887">We illustrate the process of adding a traffic-generating protocol by using as an example the implementation code for the CBR (Constant Bit Rate) application, which is one of the most frequently used protocols. The header file for the CBR implementation is app_cbr.h and the source file is app_cbr.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. We use code snippets from these two files throughout this section to illustrate different steps in writing a traffic-generating protocol. After understanding the discussed snippets, look at the complete code for CBR to understand how a traffic-generating protocol is implemented in <span class="Variable">QualNet</span>.</div>
      <div class="Body"><a name="999768">CBR, which is used as an example in this section, is a UDP-based application. TCP-based applications, such as FTP, require some additional tasks that are not covered in this section. Use FTP as an example to develop a TCP-based application. The header file for the FTP implementation is app_ftp.h and the source file is app_ftp.cpp in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src.</div>
      <div class="Body"><a name="987005">The following list summarizes the actions that need to be performed for adding a traffic-generating Application Layer protocol to </a><span class="Variable">QualNet</span>. Each of these steps is described in detail in subsequent sections.</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="987007">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#988764', '');" title="Application Layer">Section&nbsp;4.2.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991631">Modify the file application.cpp to include the protocol’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#988764', '');" title="Application Layer">Section&nbsp;4.2.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="986923">Include the protocol in the list of Application Layer protocols and trace protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987028', '');" title="Application Layer">Section&nbsp;4.2.5.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="988032">Define data structures for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987769', '');" title="Application Layer">Section&nbsp;4.2.5.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="986926">Decide on the format for the protocol-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987077', '');" title="Application Layer">Section&nbsp;4.2.5.5.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991485">Read the protocol’s configuration parameters and call the protocol’s initialization function from the Application Layer initialization function, APP_InitializeApplications (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#931704', '');" title="Application Layer">Section&nbsp;4.2.5.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="986958">Write the initialization function for the protocol. The initialization function should include the following tasks:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="986960">Declare and initialize the state variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#991916', '');" title="Application Layer">Section&nbsp;4.2.5.5.3.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="986956">Register the application instance (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#991397', '');" title="Application Layer">Section&nbsp;4.2.5.5.3.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="986963">Initialize timers (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932267', '');" title="Application Layer">Section&nbsp;4.2.5.5.3.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991529">Call the client and server event dispatchers from the Application Layer event dispatcher, APP_ProcessEvent (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987097', '');" title="Application Layer">Section&nbsp;4.2.5.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1003311">Declare any new event types used by the protocol in the header file api.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987147', '');" title="Application Layer">Section&nbsp;4.2.5.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="986969">Write the client event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987147', '');" title="Application Layer">Section&nbsp;4.2.5.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991542">Write the server event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932495', '');" title="Application Layer">Section&nbsp;4.2.5.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="986971">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="986978">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932633', '');" title="Application Layer">Section&nbsp;4.2.5.7.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="986985">Initialize the statistics variables in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932666', '');" title="Application Layer">Section&nbsp;4.2.5.7.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="986991">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932672', '');" title="Application Layer">Section&nbsp;4.2.5.7.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="986946">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932677', '');" title="Application Layer">Section&nbsp;4.2.5.7.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1079574">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1079888', '');" title="Application Layer">Section&nbsp;4.2.5.7.5</a></span>) .</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991590">Call the client and server finalization function from the Application Layer finalization function, APP_Finalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932770', '');" title="Application Layer">Section&nbsp;4.2.5.8.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="986930">Write the client finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932772', '');" title="Application Layer">Section&nbsp;4.2.5.8.2</a></span>). Call the function to print statistics from the client finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1079545">Write the server finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#991182', '');" title="Application Layer">Section&nbsp;4.2.5.8.3</a></span>). Call the function to print statistics from the server finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1079552">Include the protocol header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987370', '');" title="Application Layer">Section&nbsp;4.2.5.9</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">17.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1079616">To make the protocol available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1080810', '');" title="Application Layer">Section&nbsp;4.2.5.10</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.2.5.1  <a name="1079554">Naming Guidelines</a></div>
      <div class="BodyAfterHead"><a name="988765">In </a><span class="Variable">QualNet</span>, each component (file, data structure, function, etc.) is given a name that indicates the name of the protocol, the layer in which the protocol resides, and the functionality of the component, as appropriate. We recommend that when adding a new protocol, the programmer name the different components of the new protocol in a similar manner. It will be helpful to examine the implementation of CBR in <span class="Variable">QualNet</span> for hints for naming and coding different components of the new protocol.</div>
      <div class="Body"><a name="988775">In this section, we describe the steps for developing a traffic-generating Application Layer protocol called “MYPROTOCOL”. We will use the string “Myprotocol” in the names of the different components of this protocol, just as the string “Cbr” appears in the names of the components of the CBR implementation.</a></div>
      <div class="Heading3Numbered">4.2.5.2  <a name="988764">Creating Files</a></div>
      <div class="BodyAfterHead"><a name="1040799">The first step towards adding an application model is creating files. Most models comprise two files: the header file and the source file. These files can be placed in any library, e.g., in the folder </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src. However, it is recommended that all user-developed models be made part of a separate library. In our example, we will place the application model in a library called user_models. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#954568', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10</a></span> for instructions for creating and activating a library.</div>
      <div class="BodyAfterHead"><a name="1040803">If it doesn’t already exist, create a directory in </a><span class="Variable">QUALNET_HOME</span>/libraries called user_models and a subdirectory in <span class="Variable">QUALNET_HOME</span>/libraries/user_models called src. Create the files for the application model and place them in the folder <span class="Variable">QUALNET_HOME</span>/libraries/user_models/src. Name these files in a way that clearly indicates the model that they implement. Prefix the file names with <span style="font-style: italic">app_</span> to designate the files as application model files.</div>
      <div class="Body" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: italic; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="font-style: normal"><a name="972798">Examples</a></span>:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917061">app_ftp.h, app_ftp.cpp: Implement FTP (File Transfer Protocol)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917062">app_cbr.h, app_cbr.cpp: Implement CBR (Constant Bit Rate)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1005613">In keeping with the naming guidelines of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1079554', '');" title="Application Layer">Section&nbsp;4.2.5.1</a></span>, the header file for the example protocol is called app_myprotocol.h, and the source file is called app_myprotocol.cpp.</div>
      <div class="Note_Indented"><a name="1005617"><img class="Default" src="images/Chapter%204-2.06.1.2.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is strongly recommended to have separate header and source files. Not having a header file may lead to unexpected problems even if the compilation process does not indicate any error. </a></div>
      <div class="Body"><a name="917073">While adding code to the files, it is important to organize the code well between the files. Generally, the header file, app_myprotocol.h, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917075">Prototypes for interface functions in the source file, app_myprotocol.cpp</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917076">Constant definitions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917077">Data structure definitions and data types: </a><span style="font-family: &quot;Courier New&quot;">struct</span> and <span style="font-family: &quot;Courier New&quot;">enum</span> declarations</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="997075">The source file, app_myprotocol.cpp, should contain the following:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917080">Statement to include the protocol’s header file:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="987754">	</a><span style="font-family: &quot;Courier New&quot;">#include “app_myprotocol.h”</span></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917216">Statements to include standard library functions and other header files needed by the protocol source file. A typical protocol source file includes the following statements:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="917222">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997095">#include &lt;stdio.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988803">#include &lt;stdlib.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="988804">#include &lt;string.h&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="917223">#include "api.h"       // </a></span><span class="Variable">QUALNET_HOME</span>/include/api.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="917229">#include "app_util.h"  // </a></span><span class="Variable">QUALNET_HOME</span>/include/app_util.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1040867">#include "partition.h" // </a></span><span class="Variable">QUALNET_HOME</span>/include/partition.h</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="997096">&nbsp;</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="917237">Initialization functions for the client and server, AppMyprotocolClientInit and AppMyprotocolServerInit, respectively</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="990349">Event dispatcher function for the client and server, AppLayerMyprotocolClient and AppLayerMyprotocolServer, respectively</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1002839">Finalization function for the client and server, AppMyprotocolClientFinalize and AppMyprotocolServerFinalize, respectively</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="990350">Additional protocol implementation functions</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="990351">The file </a><span class="Variable">QUALNET_HOME</span>/main/application.cpp contains the layer level initialization, event dispatcher, and finalization functions. These layer level functions in turn call the protocol’s initialization, event dispatcher, and finalization functions. Therefore, to make these protocol functions available to the layer level functions, insert the following include statement in the file application.cpp:</div>
      <div class="Body"><a name="990361">	</a><span style="font-family: &quot;Courier New&quot;">#include “app_myprotocol.h”</span></div>
      <div class="Heading3Numbered">4.2.5.3  <a name="987028">Including MYPROTOCOL in List of Application Layer Protocols</a></div>
      <div class="BodyAfterHead"><a name="987053">Each node in </a><span class="Variable">QualNet</span> hosts an operating protocol stack. For each layer in the stack, a list of protocols running at that layer is maintained. When a new Application Layer protocol is added to <span class="Variable">QualNet</span>, it needs to be included in the list of Application Layer protocols. To do this, add the protocol name to the enumeration <span style="font-family: &quot;Courier New&quot;">AppType</span> defined in <span class="Variable">QUALNET_HOME</span>/include/application.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986251', '');" title="Application Layer">Section&nbsp;4.2.3</a></span>). </div>
      <div class="Body"><a name="988947">Traffic-generating applications have two parts: a client which generates the traffic and a server that receives the traffic. Both the client and server of an application protocol should be added to </a><span style="font-family: &quot;Courier New&quot;">AppType</span>. </div>
      <div class="Body"><a name="988849">For our example protocol, add the two entries </a><span style="font-family: &quot;Courier New&quot;">APP_MYPROTOCOL_CLIENT</span><span style="font-size: 9.0pt; font-weight: bold"> </span><span style="font-size: 9.0pt">(for the application client) and</span><span style="font-size: 9.0pt; font-weight: bold"> </span><span style="font-family: &quot;Courier New&quot;">APP_MYPROTOCOL_SEVER</span><span style="font-size: 9.0pt; font-weight: bold"> </span><span style="font-size: 9.0pt">(for the application server)</span><span style="font-weight: bold"> </span>to <span style="font-family: &quot;Courier New&quot;">AppType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#988979', '');" title="Application Layer">Figure&nbsp;4-15</a></span>.</div>
      <div class="Code_Segment"><a name="988949">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997124">typedef enum</a></div>
      <div class="Code_Segment"><a name="988950">{</a></div>
      <div class="Code_Segment"><a name="988951">    APP_FTP_SERVER_DATA = 20,</a></div>
      <div class="Code_Segment"><a name="1079269">    APP_FTP_SERVER = 21,</a></div>
      <div class="Code_Segment"><a name="988952">    APP_FTP_CLIENT,</a></div>
      <div class="Code_Segment"><a name="988953">    APP_TELNET_SERVER = 23,</a></div>
      <div class="Code_Segment"><a name="988954">    APP_TELNET_CLIENT,</a></div>
      <div class="Code_Segment"><a name="988955">    ...</a></div>
      <div class="Code_Segment"><a name="988956">    /* Application-layer routing protocols */</a></div>
      <div class="Code_Segment"><a name="997138">    ...</a></div>
      <div class="Code_Segment"><a name="997139">    APP_ROUTING_FISHEYE = 160,      // IP protocol number</a></div>
      <div class="Code_Segment"><a name="997140">    APP_ROUTING_STATIC,</a></div>
      <div class="Code_Segment"><a name="1041060">    ...</a></div>
      <div class="Code_New"><a name="1041062">     APP_MYPROTOCOL_CLIENT,</a></div>
      <div class="Code_New"><a name="988970">     APP_MYPROTOCOL_SERVER,</a></div>
      <div class="Code_Segment"><a name="988966">    APP_PLACEHOLDER</a></div>
      <div class="Code_Segment"><a name="988962">} AppType;</a></div>
      <div class="Figure">FIGURE 4-15.&nbsp;&nbsp;<a name="988979">Adding MYPROTOCOL to List of Application Layer Protocols</a></div>
      <div class="Note_Indented"><a name="1041258"><img class="Default" src="images/Chapter%204-2.06.1.3.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">APP_PLACEHOLDER</span>).</div>
      <div class="Body"><span class="Variable"><a name="1068357">QualNet</a></span> provides for detailed traces of packets as they traverse the protocol stack at nodes in the network. A packet trace lists, among other information, the protocol that is handling the packet at the time of the trace. To facilitate tracing, <span class="Variable">QualNet</span> lists all protocols in an enumeration, <span style="font-family: &quot;Courier New&quot;">TraceProtocolType</span>, in the file <span class="Variable">QUALNET_HOME</span>/include/trace.h. For our example protocol, add an entry <span style="font-family: &quot;Courier New&quot;">TRACE_MYPROTOCOL</span> in<span style="font-family: &quot;Courier New&quot;"> TraceProtocolType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1005127', '');" title="Application Layer">Figure&nbsp;4-16</a></span>.</div>
      <div class="Code_Segment"><a name="1005166">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1005176">typedef enum</a></div>
      <div class="Code_Segment"><a name="1005177">{</a></div>
      <div class="Code_Segment"><a name="1030009">    TRACE_UNDEFINED = 0,</a></div>
      <div class="Code_Segment"><a name="1030010">    TRACE_TCP,                // 1</a></div>
      <div class="Code_Segment"><a name="1030011">    TRACE_UDP,                // 2</a></div>
      <div class="Code_Segment"><a name="1030012">    TRACE_IP,                 // 3</a></div>
      <div class="Code_Segment"><a name="1030013">    TRACE_CBR,                // 4</a></div>
      <div class="Code_Segment"><a name="1005178">    TRACE_FTP,                // 5</a></div>
      <div class="Code_Segment"><a name="1005184">    ...</a></div>
      <div class="Code_New"><a name="1005195">    TRACE_MYPROTCOL,</a></div>
      <div class="Code_Segment"><a name="1005191">    // Must be last one!!!</a></div>
      <div class="Code_Segment"><a name="1005185">    TRACE_ANY_PROTOCOL</a></div>
      <div class="Code_Segment"><a name="1005196">}TraceProtocolType;</a></div>
      <div class="Figure">FIGURE 4-16.&nbsp;&nbsp;<a name="1005127">Adding MYPROTOCOL to List of Trace Protocols</a></div>
      <div class="Note_Indented"><a name="1005233">&nbsp;</a></div>
      <div class="Note_Indented"><a name="1040959">Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">TRACE_ANY_PROTOCOL</span>). <img class="Default" src="images/Chapter%204-2.06.1.4.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></div>
      <div class="Heading3Numbered">4.2.5.4  <a name="987769">Defining Data Structures</a></div>
      <div class="BodyAfterHead"><a name="988018">Each application has its own data structures, which are defined in the protocol’s header file. The data structures store information such as:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="989024">Application parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#931704', '');" title="Application Layer">Section&nbsp;4.2.5.5.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="989025">Application instance identification, such as port number (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1030592', '');" title="Application Layer">Section&nbsp;4.2.7.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="996604">Application state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987745', '');" title="Application Layer">Section&nbsp;4.2.5.5.3</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="989029">Statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932633', '');" title="Application Layer">Section&nbsp;4.2.5.7.1</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="989005">Define appropriate data structures for your application’s client and server in the protocol header file, app_myprotocol.h. As an example, the following data structures (defined in app_cbr.h) are used by the CBR protocol:</a></div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987775">CbrData</a></span>: This is the main data structure used by the CBR protocol.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987875">&nbsp;</a></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987863">typedef struct struct_app_cbr_data</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987777">{</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987778">    short sourcePort;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987779">    char type;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987780">    Int32 seqNo;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987781">    clocktype txTime;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1028496">    ...</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987783">} CbrData;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="987786">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987886">AppDataCbrClient</a></span>: This data structure contains the CBR client information.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment_Large"><a name="987788">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="987890">typedef struct struct_app_cbr_client_str</a></div>
      <div class="Code_Segment_Large"><a name="987790">{</a></div>
      <div class="Code_Segment_Large"><a name="1028434">    Address localAddr;</a></div>
      <div class="Code_Segment_Large"><a name="1028435">    Address remoteAddr;</a></div>
      <div class="Code_Segment_Large"><a name="1028436">    D_Clocktype interval;</a></div>
      <div class="Code_Segment_Large"><a name="1028437">    clocktype sessionStart;</a></div>
      <div class="Code_Segment_Large"><a name="1028438">    clocktype sessionFinish;</a></div>
      <div class="Code_Segment_Large"><a name="1028439">    clocktype sessionLastSent;</a></div>
      <div class="Code_Segment_Large"><a name="1028440">    clocktype endTime;</a></div>
      <div class="Code_Segment_Large"><a name="1028441">    BOOL sessionIsClosed;</a></div>
      <div class="Code_Segment_Large"><a name="1028442">    D_Int64 numBytesSent;</a></div>
      <div class="Code_Segment_Large"><a name="1028443">    UInt32 numPktsSent;</a></div>
      <div class="Code_Segment_Large"><a name="1028444">    UInt32 itemsToSend;</a></div>
      <div class="Code_Segment_Large"><a name="1028445">    UInt32 itemSize;</a></div>
      <div class="Code_Segment_Large"><a name="1028446">    short sourcePort;</a></div>
      <div class="Code_Segment_Large"><a name="1028447">    Int32 seqNo;</a></div>
      <div class="Code_Segment_Large"><a name="987807">    D_UInt32 tos;</a></div>
      <div class="Code_Segment_Large"><a name="1028455">}AppDataCbrClient;</a></div>
      <div class="Code_Segment_Large"><a name="1028462">&nbsp;</a></div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><span style="font-family: &quot;Courier New&quot;"><a name="987894">AppDataCbrServer</a></span>: This data structure contains the CBR server information.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment_Large"><a name="987810">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="987811">typedef struct struct_app_cbr_server_str</a></div>
      <div class="Code_Segment_Large"><a name="987813">{</a></div>
      <div class="Code_Segment_Large"><a name="1028472">    Address localAddr;</a></div>
      <div class="Code_Segment_Large"><a name="1028473">    Address remoteAddr;</a></div>
      <div class="Code_Segment_Large"><a name="1028474">    short sourcePort;</a></div>
      <div class="Code_Segment_Large"><a name="1028475">    clocktype sessionStart;</a></div>
      <div class="Code_Segment_Large"><a name="1028476">    clocktype sessionFinish;</a></div>
      <div class="Code_Segment_Large"><a name="1028477">    clocktype sessionLastReceived;</a></div>
      <div class="Code_Segment_Large"><a name="1028478">    BOOL sessionIsClosed;</a></div>
      <div class="Code_Segment_Large"><a name="1028479">    D_Int64 numBytesRecvd;</a></div>
      <div class="Code_Segment_Large"><a name="1028480">    UInt32 numPktsRecvd;</a></div>
      <div class="Code_Segment_Large"><a name="1028481">    clocktype totalEndToEndDelay;</a></div>
      <div class="Code_Segment_Large"><a name="1028482">    clocktype maxEndToEndDelay;</a></div>
      <div class="Code_Segment_Large"><a name="1028483">    clocktype minEndToEndDelay;</a></div>
      <div class="Code_Segment_Large"><a name="1028484">    Int32 seqNo;</a></div>
      <div class="Code_Segment_Large"><a name="1028488">    clocktype totalJitter;</a></div>
      <div class="Code_Segment_Large"><a name="987828">    ...</a></div>
      <div class="Code_Segment_Large"><a name="987770">} AppDataCbrServer;</a></div>
      <div class="Heading3Numbered">4.2.5.5  <a name="917217">Initialization</a></div>
      <div class="BodyAfterHead"><a name="989898">In this section, we describe the tasks that need to be performed as part of the initialization process of a traffic-generating Application Layer protocol.</a></div>
      <div class="Heading4Numbered">4.2.5.5.1  <a name="987077">Determining the Protocol Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="917268">Each application has an input format for specifying user-specified configuration parameters. The application configuration is specified in the </a><span class="Variable">QualNet</span> application configuration file using this input format. The format for specifying an application’s configuration parameters is:</div>
      <div class="Code_Segment_Large"><a name="917270">&lt;Protocol-name&gt; &lt;param1&gt; &lt;param2&gt; ... &lt;paramN&gt;</a></div>
      <div class="Code_Segment_Large"><a name="1028868">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="917272">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="917274">&lt;Protocol-name&gt;	</a></span>:<span style="font-weight: bold"> </span>Unique identifier for the protocol.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 169.2pt; margin-top: 3.0pt; text-indent: -133.2pt"><span style="font-family: &quot;Courier New&quot;"><a name="917345">&lt;param1&gt;</a></span>, ..., <span style="font-family: &quot;Courier New&quot;">&lt;paramN&gt;	</span>: User-specified configuration parameter values. An application protocol may have any number of required and/or optional parameters.</div>
      <div class="Body"><a name="917278">For example, to specify CBR traffic parameters in the configuration file </a><span class="Variable">QUALNET_HOME</span>/scenarios/default/default.app, use the following format:</div>
      <div class="Code_Segment_Large" style="margin-left: 60.75pt"><a name="917280">CBR &lt;src&gt; &lt;dest&gt; &lt;items_to_send&gt; &lt;item_size&gt; &lt;interval&gt; &lt;start time&gt;   &lt;end time&gt; </a></div>
      <div class="BodyAfterHead" style="margin-left: 9pt; text-indent: 0pt"><a name="917282">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 138.6pt; margin-top: 3.0pt; text-indent: -102.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="917283">&lt;src&gt;	</a></span>: Client node's node identifier or IP address. </div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 138.6pt; margin-top: 3.0pt; text-indent: -102.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="917284">&lt;dest&gt;	</a></span>: Server node's node identifier or IP address.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 138.6pt; margin-top: 3.0pt; text-indent: -102.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="917285">&lt;items_to_send&gt;	</a></span>: Number of items to send.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 138.6pt; margin-top: 3.0pt; text-indent: -102.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="917286">&lt;item_size&gt;	</a></span>: Size of each item.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 138.6pt; margin-top: 3.0pt; text-indent: -102.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="917287">&lt;interval&gt;	</a></span>: Pause time between transmission of successive items.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-top: 3.0pt; text-indent: 36pt"><span style="font-family: &quot;Courier New&quot;"><a name="917288">&lt;start_time&gt;	</a></span>: Transmission start time.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 138.6pt; margin-top: 3.0pt; text-indent: -102.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="917289">&lt;end_time&gt;	</a></span>: Transmission end time.</div>
      <div class="Body"><a name="917293">The following example specifies that the node 1 will send 500 2-kilobyte items to node 2, sending one per minute, starting at 50 simulation seconds, and ending at 100 simulation seconds:</a></div>
      <div class="Code_Segment_Large"><a name="917296">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1094529">CBR 1 2 500 2048 1M 50S 100S</a></div>
      <div class="Body"><a name="917298">Decide on the format for specifying the new application’s configuration parameters. For our example protocol, specify the configuration parameters in the </a><span class="Variable">QualNet</span> configuration file using the following format:</div>
      <div class="Code_Segment_Large"><a name="989921">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1094545">MYPROTOCOL &lt;param1&gt; &lt;param2&gt; ... &lt;paramN&gt;</a></div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#931704', '');" title="Application Layer" name="989930">Section&nbsp;4.2.5.5.2</a></span> explains how to read user input specified in this format to initialize the application.</div>
      <div class="Heading4Numbered">4.2.5.5.2  <a name="931704">Reading Configuration Parameters and Calling the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><span class="Variable"><a name="931717">QualNet</a></span> can configure a protocol to the parameters specified by the user in the <span class="Variable">QualNet</span> configuration file that sets up the experiment. This section explains how to read these user-specified configuration parameters for the application protocol and provide them to the protocol's initialization function.</div>
      <div class="Body"><a name="997347">The protocol stack of each node is initialized in a bottom up manner. The initialization of the Application Layer thus occurs after the other layers have been initialized. This process is performed in the node initialization function PARTITION_InitializeNodes, implemented in </a><span class="Variable">QUALNET_HOME</span>/main/partition.cpp<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#919750', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.1</a></span>).</div>
      <div class="Body"><a name="997351">The node initialization function, PARTITION_InitializeNodes, calls the Application Layer initialization functions APP_InitializeApplications and APP_Initialize, which are implemented in the file application.cpp. APP_Initialize initializes Application Layer routing protocols while APP_InitializeApplications is used for initializing traffic-generating protocols. </a></div>
      <div class="Body"><a name="931723">Function APP_InitializeApplications reads the user's configuration parameters and passes them to the initialization functions of application protocols. To initialize a traffic-generating application protocol in </a><span class="Variable">QualNet</span>, add code to the function APP_InitializeApplications for reading the protocol's configuration parameters and for calling its initialization function. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#997813', '');" title="Application Layer" name="931727">Figure&nbsp;4-17</a></span> shows how APP_InitializeApplications reads the configuration parameters for CBR and calls the initialization function for the CBR client and server. APP_InitializeApplications has access to the configuration input for the Application Layer specified by the user in the experiment configuration file. This input is stored in a variable called <span style="font-family: &quot;Courier New&quot;">appInput</span>. The first word of the currently examined input line is stored in a variable called <span style="font-family: &quot;Courier New&quot;">appStr</span>. The <span style="font-family: &quot;Courier New&quot;">appStr</span> variable is compared with the keyword used to uniquely identify an application, such as CBR, FTP, etc. If a match occurs, then the parameters of the application are read from the input string. The C library function <span style="font-family: &quot;Courier New&quot;">sscanf</span> is used to split the input string into multiple words that constitute the parameters of the protocol. </div>
      <div class="Body"><a name="1029930">The source and destination node identifiers are parameters commonly specified by users for most traffic-generating applications. The strings containing the source and destination information (obtained by splitting the input string) are passed to the </a><span class="Variable">QualNet</span> library function IO_AppParseSourceAndDestStrings, defined in ð/include/fileio.h. This function performs the following tasks:</div>
      <div class="Numbered1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered1_inner" style="width: 13.7448pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered1_inner"><a name="931733">Gets the source and destination node identifier and node address from the input strings </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="931735">Displays an error message if the source or destination does not exist</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="997415">After obtaining the node identifier, the </a><span class="Variable">QualNet</span> library function MAPPING_GetNodePtrFromHash, defined in <span class="Variable">QUALNET_HOME</span>/include/mapping.h, is called to get a handle to the node pointer which stores the state of the source node. </div>
      <div class="Body"><a name="1002959">The parameters containing time related information are converted from string to </a><span class="Variable">QualNet</span>'s clocktype variables by calling <span class="Variable">QualNet</span> library function TIME_ConvertToClock defined in <span class="Variable">QUALNET_HOME</span>/include/clock.h.</div>
      <div class="Body"><a name="1002954">This is followed by a call to the CBR client initialization function AppCbrClientInit, which is passed the source node pointer and user configuration values that were read from input string </a><span style="font-family: &quot;Courier New&quot;">appInput</span>. Then, APP_InitializeApplications calls function APP_SuccessfullyHandledLoopback to check if the application is specified as a loopback application. If it is not a loopback application, function MAPPING_GetNodePtrFromHash is called to get the destination node pointer. Lastly, the CBR server initialization function, AppCbrServerInit, is called with destination node pointer as the parameter. The initialization functions AppCbrClientInit and AppCbrServerInit are implemented in the file app_cbr.cpp. Function APP_SuccessfullyHandledLoopback is implemented in application.cpp.</div>
      <div class="Code_Segment"><a name="994002">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997453">void APP_InitializeApplications(Node *firstNode, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="997457">{</a></div>
      <div class="Code_Segment"><a name="997458">   NodeInput appInput;</a></div>
      <div class="Code_Segment"><a name="997459">   char appStr[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="997460">   ...</a></div>
      <div class="Code_Segment"><a name="997476">   for (i = 0; i &lt; appInput.numLines; i++)</a></div>
      <div class="Code_Segment"><a name="997477">    {</a></div>
      <div class="Code_Segment"><a name="997478">        sscanf(appInput.inputStrings[i], "%s", appStr);</a></div>
      <div class="Code_Segment"><a name="997474">        ...</a></div>
      <div class="Code_Segment"><a name="997496">        else</a></div>
      <div class="Code_Segment"><a name="997497">        if (strcmp(appStr, "CBR") == 0)</a></div>
      <div class="Code_Segment"><a name="997498">        {</a></div>
      <div class="Code_Segment"><a name="997499">            char sourceString[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="997482">            ...</a></div>
      <div class="Code_Segment"><a name="997513">            NodeAddress sourceNodeId;</a></div>
      <div class="Code_Segment"><a name="997514">            Address sourceAddr;</a></div>
      <div class="Code_Segment"><a name="997523">            ...</a></div>
      <div class="Code_Segment"><a name="997526">            numValues = sscanf(appInput.inputStrings[i],</a></div>
      <div class="Code_Segment"><a name="997618">                               "%*s %s %s %d %d %s %s %s %s %s %s",</a></div>
      <div class="Code_Segment"><a name="997619">                               sourceString, destString, &amp;itemsToSend,</a></div>
      <div class="Code_Segment"><a name="997620">                               &amp;itemSize, intervalStr, startTimeStr, </a></div>
      <div class="Code_Segment"><a name="997533">                               endTimeStr, optionToken1, optionToken2,</a></div>
      <div class="Code_Segment"><a name="1079297">                               optionToken3);</a></div>
      <div class="Code_Segment"><a name="997673">            ...</a></div>
      <div class="Code_Segment"><a name="997543">            IO_AppParseSourceAndDestStrings(</a></div>
      <div class="Code_Segment"><a name="997683">                firstNode, appInput.inputStrings[i], sourceString,</a></div>
      <div class="Code_Segment"><a name="1029204">                &amp;sourceNodeId, &amp;sourceAddr, destString, &amp;destNodeId, &amp;destAddr);</a></div>
      <div class="Code_Segment"><a name="1029206">            node = MAPPING_GetNodePtrFromHash(nodeHash, sourceNodeId);</a></div>
      <div class="Code_Segment"><a name="997558">            if (node != NULL)</a></div>
      <div class="Code_Segment"><a name="997559">            {</a></div>
      <div class="Code_Segment"><a name="997560">                clocktype startTime = TIME_ConvertToClock(startTimeStr);</a></div>
      <div class="Code_Segment"><a name="997561">                clocktype endTime = TIME_ConvertToClock(endTimeStr);</a></div>
      <div class="Code_Segment"><a name="997554">                ...</a></div>
      <div class="Code_Segment"><a name="997764">                AppCbrClientInit(node, sourceAddr, destAddr, itemsToSend</a></div>
      <div class="Code_Segment"><a name="997786">                                 itemSize, interval, startTime, endTime,</a></div>
      <div class="Code_Segment"><a name="997782">                                 tos, isRsvpTeEnabled);</a></div>
      <div class="Code_Segment"><a name="997578">            }</a></div>
      <div class="Code_Segment"><a name="1029167">            ...</a></div>
      <div class="Code_Segment"><a name="1079304">            // Handle Loopback Address</a></div>
      <div class="Code_Segment"><a name="1029168">            if (node == NULL || </a></div>
      <div class="Code_Segment"><a name="1029212">                !APP_SuccessfullyHandledLoopback(</a></div>
      <div class="Code_Segment"><a name="1029169">                                    node, appInput.inputStrings[i], destAddr,</a></div>
      <div class="Code_Segment"><a name="1029170">                                    destNodeId, sourceAddr, sourceNodeId))</a></div>
      <div class="Code_Segment"><a name="1029173">            {</a></div>
      <div class="Code_Segment"><a name="1029176">                node = MAPPING_GetNodePtrFromHash(nodeHash, destNodeId);</a></div>
      <div class="Code_Segment"><a name="997580">            }            </a></div>
      <div class="Code_Segment"><a name="1029271">            if (node != NULL) </a></div>
      <div class="Code_Segment"><a name="1030039">            {</a></div>
      <div class="Code_Segment"><a name="997582">                AppCbrServerInit(node);</a></div>
      <div class="Code_Segment"><a name="997583">            }</a></div>
      <div class="Code_Segment"><a name="997800">        }</a></div>
      <div class="Code_Segment"><a name="1003627">        ...</a></div>
      <div class="Code_Segment"><a name="1003629">}</a></div>
      <div class="Figure">FIGURE 4-17.&nbsp;&nbsp;<a name="997813">Calling CBR Initialization Functions</a></div>
      <div class="Body"><a name="1028403">Add code to the function APP_InitializeApplications to read the configuration parameters for the application MYPROTOCOL from the input file, and to call the initialization functions for the client and server, AppMyprotocolClientInit and AppMyprotocolServerInit, respectively. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#994466', '');" title="Application Layer">Figure&nbsp;4-18</a></span> shows an outline of the code that should be added.</div>
      <div class="Code_Segment"><a name="994432">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997442">	void APP_InitializeApplications(Node *firstnode, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1029333">{</a></div>
      <div class="Code_Segment"><a name="1029334">   NodeInput appInput;</a></div>
      <div class="Code_Segment"><a name="1029335">   char appStr[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1029336">   ...</a></div>
      <div class="Code_Segment"><a name="1029337">   for (i = 0; i &lt; appInput.numLines; i++)</a></div>
      <div class="Code_Segment"><a name="1029338">    {</a></div>
      <div class="Code_Segment"><a name="1029339">        sscanf(appInput.inputStrings[i], "%s", appStr);</a></div>
      <div class="Code_Segment"><a name="1029340">        ...</a></div>
      <div class="Code_Segment"><a name="1029341">        else</a></div>
      <div class="Code_Segment"><a name="1029342">        if (strcmp(appStr, "CBR") == 0)</a></div>
      <div class="Code_Segment"><a name="1029343">        {</a></div>
      <div class="Code_Segment"><a name="1029350">          ...</a></div>
      <div class="Code_Segment"><a name="1029351">        }</a></div>
      <div class="Code_New"><span style="font-weight: normal"><a name="994436">		</a></span>	 	 else</div>
      <div class="Code_New"><a name="994437">					if (strmcp(appStr, “MYPROTOCOL”) == 0)</a></div>
      <div class="Code_New"><a name="994438">					{</a></div>
      <div class="Code_New"><a name="994439">						/* Initialize variables for reading user input */</a></div>
      <div class="Code_New"><a name="994440">						...</a></div>
      <div class="Code_New"><a name="994441">						/*Read user input into appropriate variables */</a></div>
      <div class="Code_New"><a name="994442">						retVal == sccanf(appInput.inputStrings[i], ...);</a></div>
      <div class="Code_New"><a name="994443">						...</a></div>
      <div class="Code_New"><a name="994444">						/* Get source and destination nodeId and address */</a></div>
      <div class="Code_New"><a name="994445">						IO_AppParseSourceAndDestStrings(...)</a></div>
      <div class="Code_New"><a name="994446">						...</a></div>
      <div class="Code_New"><a name="994447">						/* Get the pointer to the source node */</a></div>
      <div class="Code_New"><a name="994448">						node = MAPPING_GetNodePtrFromHash (...);</a></div>
      <div class="Code_New"><a name="994449">						if (node != NULL)</a></div>
      <div class="Code_New"><a name="994450">						{</a></div>
      <div class="Code_New"><a name="994451">							...</a></div>
      <div class="Code_New"><a name="994452">							/* Call MYPROTOCOL client initialization function */</a></div>
      <div class="Code_New"><a name="994453">							AppMyprotocolClientInit (node, ...);</a></div>
      <div class="Code_New"><a name="994454">						}</a></div>
      <div class="Code_New"><a name="994455">						/* Get the pointer to the destination node */</a></div>
      <div class="Code_New"><a name="994456">						node = MAPPING_GetNodePtrFromHash (...);</a></div>
      <div class="Code_New"><a name="994457">						if (node != NULL)</a></div>
      <div class="Code_New"><a name="994458">						{</a></div>
      <div class="Code_New"><a name="994459">							...</a></div>
      <div class="Code_New"><a name="994460">							/* Call MYPROTOCOL server initialization function */</a></div>
      <div class="Code_New"><a name="994461">							AppMyprotocolServerInit (node, ...);</a></div>
      <div class="Code_New"><a name="994462">						}</a></div>
      <div class="Code_New"><a name="994463">					}</a></div>
      <div class="Code_Segment_Large"><a name="1029354">       ...</a></div>
      <div class="Code_Segment_Large"><a name="1029355">   }</a></div>
      <div class="Code_Segment"><a name="994464">	}</a></div>
      <div class="Figure">FIGURE 4-18.&nbsp;&nbsp;<a name="994466">Calling MYPROTOCOL Initialization Functions</a></div>
      <div class="Heading4Numbered">4.2.5.5.3  <a name="987745">Implementing the Client Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="968180">The initialization of an application takes place in the initialization function of the protocol that is called by the Application Layer initialization function APP_InitializeApplications. The initialization function of an application commonly performs the following tasks:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932046">Initialize the state and store the user specified configuration parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="990201">Initialize data structures and variables as required, e.g., allocate memory to tables, set default values, etc.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932048">Create an instance of the application </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932050">Schedule a timer to itself for starting the application, if the application uses UDP at the Transport Layer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="999763">Open a TCP connection, if the application uses TCP at the Transport Layer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="991912">This section describes how to initialize the client for a UDP-based application. For an example of initializing the client for a TCP-based application, refer to the FTP function AppFtpClientInit in </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/app_ftp.cpp.</div>
      <div class="Body"><a name="999799">Like all other functions belonging to the application, the prototype for the initialization functions should be included in the application's header file, app_myprotocol.h.</a></div>
      <div class="Heading5Numbered">4.2.5.5.3.1  <a name="991916">Creating an Instance and Initializing the State</a></div>
      <div class="BodyAfterHead"><a name="932110">The initialization function initializes the protocol state. Each protocol has a structure that it uses to store state information. This may include information such as timer state (next periodic update, etc.), flags, connection information, sequence number, pointers to tables used by the protocol, etc. Each instance of the application maintains its own state variable. </a></div>
      <div class="Body"><a name="932112">To store the state, declare the structure to hold the protocol state in the header file, app_myprotocol.h (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987769', '');" title="Application Layer">Section&nbsp;4.2.5.4</a></span>). </div>
      <div class="Body"><a name="991416">Create an instance of the application by allocating memory to the state structure. CBR performs this task by calling the function AppCbrClientNewCbrClient in its initialization function AppCbrClientInit, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#990264', '');" title="Application Layer">Figure&nbsp;4-19</a></span>. <span style="font-family: &quot;Courier New&quot;">AppDataCbrClient</span> is the data structure for the CBR client (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987769', '');" title="Application Layer">Section&nbsp;4.2.5.4</a></span>).</div>
      <div class="Code_Segment"><a name="932114">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997846">void AppCbrClientInit(Node *node, Address clientAddr, Address serverAddr,</a></div>
      <div class="Code_Segment"><a name="997919">								  Int32 itemsToSend, Int32 itemSize, clocktype interval,</a></div>
      <div class="Code_Segment"><a name="997932">								  clocktype startTime, clocktype endTime, unsigned tos, </a></div>
      <div class="Code_Segment"><a name="1029547">								  BOOL isRsvpTeEnabled)</a></div>
      <div class="Code_Segment"><a name="997847">{<br />			...</a></div>
      <div class="Code_Segment"><a name="997894">			AppDataCbrClient *clientPtr; //pointer to the state structure</a></div>
      <div class="Code_Segment"><a name="997875">			...</a></div>
      <div class="Code_Segment"><a name="997876">			clientPtr = AppCbrClientNewCbrClient(</a></div>
      <div class="Code_Segment"><a name="997881">										node,</a></div>
      <div class="Code_Segment"><a name="997882">										clientAddr, serverAddr,</a></div>
      <div class="Code_Segment"><a name="997885">										itemsToSend, itemSize,</a></div>
      <div class="Code_Segment"><a name="997886">										interval, startTime,</a></div>
      <div class="Code_Segment"><a name="997887">										endTime, (TosType) tos);</a></div>
      <div class="Code_Segment"><a name="997888">			...</a></div>
      <div class="Code_Segment"><a name="997889">}</a></div>
      <div class="Figure">FIGURE 4-19.&nbsp;&nbsp;<a name="990264">Creating an Application Instance in Initialization Function</a></div>
      <div class="Body"><a name="932121">Function AppCbrClientNewCbrClient calls the function MEM_malloc to allocate memory to the state structure. It then stores the user specified configuration parameters that were passed to the initialization function AppCbrClientInit as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#997997', '');" title="Application Layer">Figure&nbsp;4-20</a></span>.</div>
      <div class="Code_Segment"><a name="991394">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997961">AppDataCbrClient *AppCbrClientNewCbrClient(</a></div>
      <div class="Code_Segment"><a name="997970">								 Node *node, Address localAddr, Address remoteAddr,</a></div>
      <div class="Code_Segment"><a name="997962">								 Int32 itemsToSend, Int32 itemSize, clocktype interval,</a></div>
      <div class="Code_Segment"><a name="997963">								 clocktype startTime, clocktype endTime, TosType tos)</a></div>
      <div class="Code_Segment"><a name="997948">&nbsp;</a></div>
      <div class="Code_Segment"><a name="997959">{</a></div>
      <div class="Code_Segment"><a name="997978">			AppDataCbrClient *cbrClient;</a></div>
      <div class="Code_Segment"><a name="998000">			</a></div>
      <div class="Code_Segment"><a name="998001">			cbrClient = (AppDataCbrClient*)</a></div>
      <div class="Code_Segment"><a name="997983">						  MEM_malloc(sizeof(AppDataCbrClient));</a></div>
      <div class="Code_Segment"><a name="1030050">   memset(cbrClient, 0, sizeof(AppDataCbrClient));</a></div>
      <div class="Code_Segment"><a name="1030060">			/*</a></div>
      <div class="Code_Segment"><a name="1030061">     * fill in cbr info.</a></div>
      <div class="Code_Segment"><a name="997984">     */</a></div>
      <div class="Code_Segment"><a name="1030069">			...</a></div>
      <div class="Code_Segment"><a name="997985">			cbrClient-&gt;interval = interval;</a></div>
      <div class="Code_Segment"><a name="997986">			cbrClient-&gt;sessionStart = getSimTime(node) + startTime;</a></div>
      <div class="Code_Segment"><a name="997989">			...</a></div>
      <div class="Code_Segment"><a name="997987">			cbrClient-&gt;sourcePort = node-&gt;appData.nextPortNum++;</a></div>
      <div class="Code_Segment"><a name="997988">			...</a></div>
      <div class="Code_Segment"><a name="997990">			APP_RegisterNewApp(node, APP_CBR_CLIENT, cbrClient);</a></div>
      <div class="Code_Segment"><a name="997994">			return cbrClient;</a></div>
      <div class="Code_Segment"><a name="997995">}</a></div>
      <div class="Figure">FIGURE 4-20.&nbsp;&nbsp;<a name="997997">Function to Create and Initialize an Application Instance</a></div>
      <div class="Body"><a name="991402">Multiple instances of the same application may run at a node. Therefore, the protocol state structure must have an identifying field. For the CBR client application, this is the field </a><span style="font-family: &quot;Courier New&quot;">sourcePort</span> of the <span style="font-family: &quot;Courier New&quot;">AppDataCbrClient</span> data structure. When a new instance of the CBR client is created, this field is assigned the next available port number, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#997997', '');" title="Application Layer">Figure&nbsp;4-20</a></span>. This ensures that a unique port number is associated with each instance. </div>
      <div class="Heading5Numbered">4.2.5.5.3.2  <a name="991397">Registering the Application</a></div>
      <div class="BodyAfterHead"><a name="988061">The next step after creating the application instance is to register the instance as one of the protocols running at the node. This is done by making a call to APP_RegisterNewApp, as shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#997997', '');" title="Application Layer">Figure&nbsp;4-20</a></span>. Function APP_RegisterNewApp is a <span class="Variable">QualNet</span> library function (defined in app_util.cpp) to add an application to the list of applications running at the node. When the application needs to access its state variable, it retrieves the state variable from this list. Each element of this list is of the type <span style="font-family: &quot;Courier New&quot;">AppInfo</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986251', '');" title="Application Layer">Section&nbsp;4.2.3</a></span>). </div>
      <div class="Body"><a name="990287">APP_RegisterNewApp accepts the following parameters:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932208">the node pointer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932212">the application type</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932213">the pointer to the state structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading5Numbered">4.2.5.5.3.3  <a name="932267">Initializing Timers</a></div>
      <div class="BodyAfterHead"><a name="932280">Besides initializing data structures, the initialization function also initializes timers for the application. Timers serve a variety of purposes at the Application Layer, e.g., to notify when the application is supposed to begin sending data, to simulate traffic sending rate, etc. </a></div>
      <div class="Body"><a name="932282">This section discusses in detail how to use timers. Since each node can have multiple applications of the same type, Application Layer timers frequently use the message </a><span style="font-family: &quot;Courier New&quot;">info</span> field to identify which application instance the timer is for.</div>
      <div class="Body"><span class="Variable"><a name="932284">QualNet</a></span> provides a general structure used to hold information on application timers called <span style="font-family: &quot;Courier New&quot;">AppTimer</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986251', '');" title="Application Layer">Section&nbsp;4.2.3</a></span>). <span style="font-family: &quot;Courier New&quot;">AppTimer</span> can be used to store the following information:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932286">Timer Type: Category or purpose of timer</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="965864">Connection Id: Connection this timer is meant for </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="965865">SourcePort: The session that this timer belongs to.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="965866">The timer type can be one of the following three pre-defined types:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932292">Name: </a><span style="font-family: &quot;Courier New&quot;">APP_TIMER_SEND_PKT</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="932293">Purpose: Timer to send a packet. Used to simulate data sending rate. </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932295">Name: </a><span style="font-family: &quot;Courier New&quot;">APP_TIMER_UPDATE_TABLE</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="932296">Purpose: Timer to update a local table, e.g., update entries, remove timed-out entries from a table, etc.</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932298">Name: </a><span style="font-family: &quot;Courier New&quot;">APP_TIMER_CLOSE_SESS</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BulletedCont"><a name="932299">Purpose: Timer to close a session. </a></div>
      <div class="Body"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#998131', '');" title="Application Layer" name="932301">Figure&nbsp;4-21</a> shows the code from the initialization function, AppCbrClientInit, that sets a timer to inform the CBR client of when to start sending data. It demonstrates how a timer can store the source port of the application instance in the message <span style="font-family: &quot;Courier New&quot;">info</span> field. This source port is used to identify the instance of the CBR application, in case there are multiple CBR applications running at the node. The timer type used is <span style="font-family: &quot;Courier New&quot;">APP_TIMER_SEND_PKT</span> because the purpose of the timer is to tell the CBR client to send a packet.</div>
      <div class="Code_Segment"><a name="998115">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998116">void AppCbrClientInit(Node *node, Address clientAddr, Address serverAddr,</a></div>
      <div class="Code_Segment"><a name="998117">							 	  Int32 itemsToSend, Int32 itemSize, clocktype interval,</a></div>
      <div class="Code_Segment"><a name="998118">								  clocktype startTime, clocktype endTime, unsigned tos, </a></div>
      <div class="Code_Segment"><a name="1029294">                      BOOL isRsvpTeEnabled)</a></div>
      <div class="Code_Segment"><a name="998119">{<br />			 ...</a></div>
      <div class="Code_Segment"><a name="998120">			 AppTimer *timer;</a></div>
      <div class="Code_Segment"><a name="998121">			 ...</a></div>
      <div class="Code_Segment"><a name="998122">			 Message *timerMsg;</a></div>
      <div class="Code_Segment"><a name="998149">			 ...</a></div>
      <div class="Code_Segment"><a name="998152">    timerMsg = MESSAGE_Alloc(node,</a></div>
      <div class="Code_Segment"><a name="998153">                             APP_LAYER,</a></div>
      <div class="Code_Segment"><a name="998154">                             APP_CBR_CLIENT,</a></div>
      <div class="Code_Segment"><a name="998155">                             MSG_APP_TimerExpired);</a></div>
      <div class="Code_Segment"><a name="998157">    MESSAGE_InfoAlloc(node, timerMsg, sizeof(AppTimer));</a></div>
      <div class="Code_Segment"><a name="998159">    timer = (AppTimer *)MESSAGE_ReturnInfo(timerMsg);</a></div>
      <div class="Code_Segment"><a name="998161">    timer-&gt;sourcePort = clientPtr-&gt;sourcePort;</a></div>
      <div class="Code_Segment"><a name="998150">    timer-&gt;type = APP_TIMER_SEND_PKT;</a></div>
      <div class="Code_Segment"><a name="998171">    MESSAGE_Send(node, timerMsg, startTime);</a></div>
      <div class="Code_Segment"><a name="998129">}</a></div>
      <div class="Figure">FIGURE 4-21.&nbsp;&nbsp;<a name="998131">Initializing Timers</a></div>
      <div class="Body"><a name="932313">The message type used here is </a><span style="font-family: &quot;Courier New&quot;">MSG_APP_TimerExpired</span>. Commonly needed message types for the Application Layer are defined in api.h. </div>
      <div class="Body"><a name="932315">The API function APP_SetTimer can also be used instead of the code in </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#998131', '');" title="Application Layer">Figure&nbsp;4-21</a> to set a new Application Layer timer and send to self after a specified delay. APP_SetTimer is implemented in app_util.cpp.</div>
      <div class="Heading4Numbered">4.2.5.5.4  <a name="999790">Implementing the Server Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="999805">For a UDP-based application, such as CBR, the server is initialized when it receives the first packet from the client. This is discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932495', '');" title="Application Layer">Section&nbsp;4.2.5.6.3</a></span>.</div>
      <div class="Body"><a name="999812">For an example of initializing the server for a TCP-based application, refer to the FTP function AppFtpServerInit in app_ftp.cpp.</a></div>
      <div class="Heading3Numbered">4.2.5.6  <a name="932275">Implementing the Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="990440">In this section, we describe the steps for implementing the event dispatcher function for a traffic-generating protocol. </a></div>
      <div class="Body"><a name="996631">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#933631', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.2</a></span>, when an event occurs, it is first handled by the node level dispatcher function NODE_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/node.cpp. If the event is for the Application Layer, NODE_ProcessEvent calls the Application Layer event dispatcher APP_ProcessEvent, defined in application.cpp. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987097', '');" title="Application Layer" name="996626">Section&nbsp;4.2.5.6.1</a></span> describes how to modify the Application Layer event dispatcher function to call the traffic-generating protocol’s event dispatchers. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987147', '');" title="Application Layer">Section&nbsp;4.2.5.6.2</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932495', '');" title="Application Layer">Section&nbsp;4.2.5.6.3</a></span> describe how to implement the event dispatcher for the protocol client and the protocol server, respectively.</div>
      <div class="Heading4Numbered">4.2.5.6.1  <a name="987097">Modifying the Application Layer Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="987103">Function APP_ProcessEvent</a><span style="font-weight: bold"> </span>implements the Application Layer event dispatcher that informs the appropriate application protocol of received events. Messages contain the name of the protocol they are destined for. (This is the application protocol name specified in the enumerated data type <span style="font-family: &quot;Courier New&quot;">AppType</span>, described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986251', '');" title="Application Layer">Section&nbsp;4.2.3</a></span>.) The API function APP_GetProtocolType returns the protocol for which the message is destined. APP_ProcessEvent implements a switch statement on the protocol name read from the message and calls the appropriate protocol-specific event dispatcher. </div>
      <div class="Body"><a name="990409">To enable the protocol MYPROTOCOL to receive events, add code to APP_ProcessEvent to call the protocol's event dispatcher function when messages for the protocol are received. For a traffic-generating application protocol, do this separately for both the server and the client. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#998265', '');" title="Application Layer">Figure&nbsp;4-22</a></span> shows a code fragment from APP_ProcessEvent with sample code for calling the client event dispatcher function, AppLayerMyprotocolClient, and the server event dispatcher function, AppLayerMyprotocolServer.</div>
      <div class="Code_Segment"><a name="987125">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998275">void APP_ProcessEvent(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="998276">{</a></div>
      <div class="Code_Segment"><a name="998277">    short protocolType;</a></div>
      <div class="Code_Segment"><a name="998278">    protocolType = APP_GetProtocolType(node,msg);</a></div>
      <div class="Code_Segment"><a name="998280">    switch(protocolType)</a></div>
      <div class="Code_Segment"><a name="998281">    {</a></div>
      <div class="Code_Segment"><a name="998282">        case APP_ROUTING_BELLMANFORD:</a></div>
      <div class="Code_Segment"><a name="998283">        {</a></div>
      <div class="Code_Segment"><a name="998284">            RoutingBellmanfordLayer(node, msg);</a></div>
      <div class="Code_Segment"><a name="998285">            break;</a></div>
      <div class="Code_Segment"><a name="998258">        }</a></div>
      <div class="Code_Segment"><a name="998262">        ...</a></div>
      <div class="Code_Segment"><a name="998299">        case APP_CBR_CLIENT:</a></div>
      <div class="Code_Segment"><a name="998300">        {</a></div>
      <div class="Code_Segment"><a name="998301">            AppLayerCbrClient(node, msg);</a></div>
      <div class="Code_Segment"><a name="998302">            break;</a></div>
      <div class="Code_Segment"><a name="998303">        }</a></div>
      <div class="Code_Segment"><a name="998304">        case APP_CBR_SERVER:</a></div>
      <div class="Code_Segment"><a name="998305">        {</a></div>
      <div class="Code_Segment"><a name="998306">            AppLayerCbrServer(node, msg);</a></div>
      <div class="Code_Segment"><a name="998307">            break;</a></div>
      <div class="Code_Segment"><a name="998312">        }        </a></div>
      <div class="Code_New"><a name="998341">        case APP_MYPROTOCOL_CLIENT:</a></div>
      <div class="Code_New"><a name="998313">        {</a></div>
      <div class="Code_New"><a name="998314">            AppLayerMyprotocolClient(node, msg);</a></div>
      <div class="Code_New"><a name="998315">            break;</a></div>
      <div class="Code_New"><a name="998316">        }</a></div>
      <div class="Code_New"><a name="998317">        case APP_MYPROTOCOL_SERVER:</a></div>
      <div class="Code_New"><a name="998318">        {</a></div>
      <div class="Code_New"><a name="998319">            AppLayerMyprotocolServer(node, msg);</a></div>
      <div class="Code_New"><a name="998320">            break;</a></div>
      <div class="Code_New"><a name="998297">        }</a></div>
      <div class="Code_Segment"><a name="998263">        ...</a></div>
      <div class="Code_Segment"><a name="998325"> }//switch//</a></div>
      <div class="Code_Segment"><a name="998264">}</a></div>
      <div class="Figure">FIGURE 4-22.&nbsp;&nbsp;<a name="998265">Calling MYPROTOCOL Event Dispatcher Functions</a></div>
      <div class="Heading4Numbered">4.2.5.6.2  <a name="987147">Implementing the Client Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="987148">A protocol's event dispatcher should include a switch on all message types that the protocol may receive. It can then process each message type either inside the switch or by calling a function to handle the message type received.</a></div>
      <div class="Body"><a name="1002688">All event types used by </a><span class="Variable">QualNet</span> protocols are enumerated in the file api.h. If the protocol being added needs additional event types, these should be included in the enumeration in file api.h, as shown in <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1041285', '');" title="Application Layer">Figure&nbsp;4-23</a>. </div>
      <div class="Code_Segment"><a name="1002692">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1002693">// /**</a></div>
      <div class="Code_Segment"><a name="1002694">// ENUM        :: MESSAGE/EVENT</a></div>
      <div class="Code_Segment"><a name="1002695">// DESCRIPTION :: Event/message types exchanged in the simulation</a></div>
      <div class="Code_Segment"><a name="1002696">// **/</a></div>
      <div class="Code_Segment"><a name="1002697">enum</a></div>
      <div class="Code_Segment"><a name="1002698">{</a></div>
      <div class="Code_Segment"><a name="1002699">    /* Special message types used for internal design. */</a></div>
      <div class="Code_Segment"><a name="1002700">    MSG_SPECIAL_Timer                          = 0,</a></div>
      <div class="Code_Segment"><a name="1002701">    ...</a></div>
      <div class="Code_Segment"><a name="1002702">    /* Message Types for Channel layer */</a></div>
      <div class="Code_Segment"><a name="1002703">    MSG_PROP_SignalArrival                     = 100,</a></div>
      <div class="Code_Segment"><a name="1002704">    MSG_PROP_SignalEnd                         = 101,</a></div>
      <div class="Code_Segment"><a name="1002705">    ...</a></div>
      <div class="Code_Segment"><a name="1002706">    /*</a></div>
      <div class="Code_Segment"><a name="1002707">     * Any other message types which have to be added should be added before</a></div>
      <div class="Code_Segment"><a name="1002708">     * MSG_DEFAULT. Otherwise the program will not work correctly.</a></div>
      <div class="Code_Segment"><a name="1002709">     */</a></div>
      <div class="Code_New"><a name="1002710">    MSG_APP_MYPROTOCOL_NewEvent1,</a></div>
      <div class="Code_New"><a name="1002711">    MSG_APP_MYPROTOCOL_NewEvent2,</a></div>
      <div class="Code_Segment"><a name="1002712">    MSG_DEFAULT                                = 10000</a></div>
      <div class="Code_Segment"><a name="1002713">};</a></div>
      <div class="Figure">FIGURE 4-23.&nbsp;&nbsp;<a name="1041285">Declaring New Event Types</a></div>
      <div class="Note_Indented"><a name="1041286"><img class="Default" src="images/Chapter%204-2.06.1.5.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">MSG_DEFAULT</span>).</div>
      <div class="Body"><a name="1041290">To understand how a protocol event dispatcher works, we examine the code for the function AppLayerCbrClient, which is the event dispatcher for the CBR client. Function AppLayerCbrClient and the other functions used by the CBR application are implemented in the file app_cbr.cpp. </a></div>
      <div class="Body"><a name="990530">When an event occurs, the first thing to do is to determine which instance of the application protocol this event is for. This can be done by looking up additional information stored in the message </a><span style="font-family: &quot;Courier New&quot;">info</span> field, such as source or destination port. For example, the CBR function AppCbrClientGetCbrClient searches the list of application instances running at the node, based on the source port number, and returns the data structure for the appropriate application instance, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#990535', '');" title="Application Layer">Figure&nbsp;4-24</a></span>. </div>
      <div class="Code_Segment"><a name="998414">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998442">AppDataCbrClient *</a></div>
      <div class="Code_Segment"><a name="998415">AppCbrClientGetCbrClient(Node *node, short sourcePort)</a></div>
      <div class="Code_Segment"><a name="998416">{</a></div>
      <div class="Code_Segment"><a name="998417">    AppInfo *appList = node-&gt;appData.appPtr;</a></div>
      <div class="Code_Segment"><a name="998418">    AppDataCbrClient *cbrClient;</a></div>
      <div class="Code_Segment"><a name="998419">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998420">    for (; appList != NULL; appList = appList-&gt;appNext)</a></div>
      <div class="Code_Segment"><a name="998421">    {</a></div>
      <div class="Code_Segment"><a name="998422">        if (appList-&gt;appType == APP_CBR_CLIENT)</a></div>
      <div class="Code_Segment"><a name="998423">        {</a></div>
      <div class="Code_Segment"><a name="998424">            cbrClient = (AppDataCbrClient *) appList-&gt;appDetail;</a></div>
      <div class="Code_Segment"><a name="998426">            if (cbrClient-&gt;sourcePort == sourcePort)</a></div>
      <div class="Code_Segment"><a name="998427">            {</a></div>
      <div class="Code_Segment"><a name="998428">                return cbrClient;</a></div>
      <div class="Code_Segment"><a name="998429">            }</a></div>
      <div class="Code_Segment"><a name="998430">        }</a></div>
      <div class="Code_Segment"><a name="998431">    }</a></div>
      <div class="Code_Segment"><a name="998432">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998433">    return NULL;</a></div>
      <div class="Code_Segment"><a name="998401">}</a></div>
      <div class="Figure">FIGURE 4-24.&nbsp;&nbsp;<a name="990535">Searching the List of Application Instances</a></div>
      <div class="Body"><a name="998368">CBR operates by setting a periodic timer to itself. Each time the timer goes off, the client sends a data packet to the destination. It then sets a new timer to occur after the periodic interval. In this way the desired data rate is achieved. The timer is initialized in the initialization function for the CBR Client, AppCbrClientInit, where a timer of type </a><span style="font-family: &quot;Courier New&quot;">APP_TIMER_SEND_PKT</span> is set for the start time of the CBR application (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932267', '');" title="Application Layer">Section&nbsp;4.2.5.5.3.3</a></span>). <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#998712', '');" title="Application Layer">Figure&nbsp;4-25</a></span> shows the code to handle this timer event in the CBR client event dispatcher function AppLayerCbrClient. </div>
      <div class="Body"><a name="991440">The API function APP_UdpSendNewHeaderVirtualDataWithPriority sends a packet to UDP at the Transport Layer. (See the </a><span style="font-style: italic">API Reference Guide</span> for the complete list of Application Layer APIs and the file app_util.cpp for their implementation.) UDP delivers the packet to the application protocol (CBR server, in this case) at the destination node.</div>
      <div class="Body"><a name="990691">Instead of the layer-specific APIs, such as APP_UdpSendNewHeaderVirtualDataWithPriority, message APIs can be used to communicate between layers, as discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.4.html#919706', '');" title="Discrete-event Simulation in QualNet">Section&nbsp;3.3.1.2</a></span>.</div>
      <div class="Body"><a name="990544">After sending a packet, the CBR client determines if any more packets need to be sent. If this is the case, it calls the function AppCbrClientScheduleNextPkt. Function AppCbrClientScheduleNextPkt sets a timer of type </a><span style="font-family: &quot;Courier New&quot;">APP_TIMER_SEND_PKT</span> to occur after the inter-packet interval of the CBR application.</div>
      <div class="Body"><a name="990593">After the message is handled by the event dispatcher, it frees the memory associated with the message by calling the function MESSAGE_Free. </a></div>
      <div class="Note_Indented"><a name="998469"><img class="Default" src="images/Chapter%204-2.06.1.6.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is important to free the memory after the message has been processed; otherwise, the simulator will leak memory.</a></div>
      <div class="Body"><a name="998504">The event dispatcher also includes a default case in the switch statement to handle messages which contain an undefined event type.</a></div>
      <div class="Code_Segment"><a name="998546">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998741">void AppLayerCbrClient(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="998558">{</a></div>
      <div class="Code_Segment"><a name="998559">    ...</a></div>
      <div class="Code_Segment"><a name="998561">    AppDataCbrClient *clientPtr;</a></div>
      <div class="Code_Segment"><a name="998547">    ...</a></div>
      <div class="Code_Segment"><a name="998571">    switch(msg-&gt;eventType)</a></div>
      <div class="Code_Segment"><a name="998572">    {</a></div>
      <div class="Code_Segment"><a name="998573">        case MSG_APP_TimerExpired:</a></div>
      <div class="Code_Segment"><a name="998574">        {</a></div>
      <div class="Code_Segment"><a name="998575">            AppTimer *timer;</a></div>
      <div class="Code_Segment"><a name="998577">            timer = (AppTimer *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="998569">            ...</a></div>
      <div class="Code_Segment"><a name="998583">            clientPtr = AppCbrClientGetCbrClient(node, timer-&gt;sourcePort);</a></div>
      <div class="Code_Segment"><a name="998589">            ...</a></div>
      <div class="Code_Segment"><a name="998594">            switch (timer-&gt;type)</a></div>
      <div class="Code_Segment"><a name="998595">            {</a></div>
      <div class="Code_Segment"><a name="998596">                case APP_TIMER_SEND_PKT:</a></div>
      <div class="Code_Segment"><a name="998597">                {</a></div>
      <div class="Code_Segment"><a name="998598">                    CbrData data;</a></div>
      <div class="Code_Segment"><a name="998592">                    ...</a></div>
      <div class="Code_Segment"><a name="998607">                    data.sourcePort = clientPtr-&gt;sourcePort;</a></div>
      <div class="Code_Segment"><a name="998608">                    data.txTime = getSimTime(node);</a></div>
      <div class="Code_Segment"><a name="998609">                    data.seqNo = clientPtr-&gt;seqNo++;</a></div>
      <div class="Code_Segment"><a name="998566">                    ...</a></div>
      <div class="Code_Segment"><a name="998619">                    APP_UdpSendNewHeaderVirtualDataWithPriority(</a></div>
      <div class="Code_Segment"><a name="998620">                        node,</a></div>
      <div class="Code_Segment"><a name="998621">                        APP_CBR_SERVER,</a></div>
      <div class="Code_Segment"><a name="998622">                        clientPtr-&gt;localAddr,</a></div>
      <div class="Code_Segment"><a name="998623">                        (short) clientPtr-&gt;sourcePort,</a></div>
      <div class="Code_Segment"><a name="998624">                        clientPtr-&gt;remoteAddr,</a></div>
      <div class="Code_Segment"><a name="998625">                        (char *) &amp;data,</a></div>
      <div class="Code_Segment"><a name="998626">                        sizeof(data),</a></div>
      <div class="Code_Segment"><a name="998627">                        clientPtr-&gt;itemSize - sizeof(data),</a></div>
      <div class="Code_Segment"><a name="998628">                        clientPtr-&gt;tos,</a></div>
      <div class="Code_Segment"><a name="998629">                        0,</a></div>
      <div class="Code_Segment"><a name="998630">                        TRACE_CBR);</a></div>
      <div class="Code_Segment"><a name="998617">                    ...</a></div>
      <div class="Code_Segment"><a name="998701">                  }</a></div>
      <div class="Code_Segment"><a name="998654">               default:</a></div>
      <div class="Code_Segment"><a name="998658">                    assert(FALSE);</a></div>
      <div class="Code_Segment"><a name="998659">            }</a></div>
      <div class="Code_Segment"><a name="998661">            break;</a></div>
      <div class="Code_Segment"><a name="998662">        }</a></div>
      <div class="Code_Segment"><a name="998663">        default:</a></div>
      <div class="Code_Segment"><a name="998664">           // Print error message</a></div>
      <div class="Code_Segment"><a name="998688">           ...</a></div>
      <div class="Code_Segment"><a name="998668">           ERROR_ReportError(error);</a></div>
      <div class="Code_Segment"><a name="998669">    }</a></div>
      <div class="Code_Segment"><a name="998671">    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="998672">}</a></div>
      <div class="Figure">FIGURE 4-25.&nbsp;&nbsp;<a name="998712">	Event Dispatcher for CBR Client</a></div>
      <div class="Body" style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: Arial; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><a name="1003672">Use of </a></span><span style="font-family: &quot;Courier New&quot;">virtualPayLoadSize</span> Field</div>
      <div class="BodyAfterHead"><a name="1003696">For some applications, the contents of part or all of the user data are not important in the simulation of the application and need not be explicitly stored in the </a><span style="font-family: &quot;Courier New&quot;">packet</span> field of a message. However, the size of the user data is important because it affects the calculation of transmission time and required buffer space at lower layers. The <span style="font-family: &quot;Courier New&quot;">virtualPayLoadSize</span> field of the <span style="font-family: &quot;Courier New&quot;">message</span> data structure is used to store the size of the part of user data whose contents are not important. Therefore, using the <span style="font-family: &quot;Courier New&quot;">virtualPayLoadSize</span> field saves memory.</div>
      <div class="Body"><a name="1003720">In CBR simulation, the contents of the user data are not important. However, an application header is used in the simulation to store the source port number, the sequence number of data item being transmitted, and the time when the data item is transmitted. This header information does not correspond to actual CBR data and is meant for simulator use only. The header is stored in the </a><span style="font-family: &quot;Courier New&quot;">packet</span> field of a message. The difference between the CBR item size being simulated and the size of the application header is stored in the <span style="font-family: &quot;Courier New&quot;">virtualPayLoadSize</span> field of the message. This is done in function APP_UdpSendNewHeaderVirtualDataWithPriority by calling the function MESSAGE_AddVirtualPayload.</div>
      <div class="Heading4Numbered">4.2.5.6.3  <a name="932495">Implementing the Server Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="990733">We use the CBR application as an example to understand the server event dispatcher, as we did for the client dispatcher. Function AppLayerCbrServer is the event dispatcher for the CBR server. This function is implemented in the file app_cbr.cpp, and snippets from it are shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#998806', '');" title="Application Layer">Figure&nbsp;4-26</a></span>.</div>
      <div class="Body"><a name="990686">The CBR server receives packets from the client and processes them. When a packet arrives at the destination node, it travels up the protocol stack one layer at a time. The UDP protocol at the Transport Layer sends the packet to the CBR server at the Application Layer by scheduling an event of the type </a><span style="font-family: &quot;Courier New&quot;">MSG_APP_FromTransport</span> at the Application Layer. </div>
      <div class="Body"><a name="990719">The CBR server event dispatcher performs actions corresponding to the event type of the received message. Event </a><span style="font-family: &quot;Courier New&quot;">MSG_APP_FromTransport</span> indicates the arrival of a packet from the Transport Layer. The CBR server handles this event by processing the received packet.</div>
      <div class="Body"><a name="990755">When a packet arrives at the CBR server, function AppLayerCbrServer first determines the protocol instance for which the packet is destined. AppLayerCbrServer calls function AppCbrServerGetCbrServer to search the list of application instances running at the node, based on the source address and source port number. If AppCbrServerGetCbrServer finds a match, it returns a pointer to the data structure for the appropriate instance; otherwise, it returns </a><span style="font-family: &quot;Courier New&quot;">NULL</span>. If AppCbrServerGetCbrServer returns <span style="font-family: &quot;Courier New&quot;">NULL</span>, it indicates that the received packet is for a new connection and AppLayerCbrServer initiates a new instance for the CBR server by calling function AppCbrServerNewCbrServer. Functions AppCbrServerGetCbrServer and AppCbrServerNewCbrServer are similar to the corresponding functions for the CBR client, AppCbrClientGetCbrClient (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987147', '');" title="Application Layer">Section&nbsp;4.2.5.6.2</a></span>) and AppCbrClientNewCbrClient (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#991916', '');" title="Application Layer">Section&nbsp;4.2.5.5.3.1</a></span>) and are implemented in app_cbr.cpp.</div>
      <div class="Body"><a name="999829">Function MESSAGE_ReturnPacket returns the </a><span style="font-family: &quot;Courier New&quot;">packet</span> field of a message and function MESSAGE_ReturnPacketSize returns the size of the <span style="font-family: &quot;Courier New&quot;">packet</span> field.</div>
      <div class="Body"><a name="990775">As in the case of the client event dispatcher, after the message is handled by the server event dispatcher, the server dispatcher frees the memory associated with the message by calling the function MESSAGE_Free. </a></div>
      <div class="Body"><a name="990798">The event dispatcher also includes a default case in the switch statement to handle messages which contain an undefined event type.</a></div>
      <div class="Code_Segment"><a name="998755">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998814">void AppLayerCbrServer(Node *node, Message *msg</a></div>
      <div class="Code_Segment"><a name="998816">{</a></div>
      <div class="Code_Segment"><a name="998817">    char error[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="998818">    AppDataCbrServer *serverPtr;</a></div>
      <div class="Code_Segment"><a name="998819">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998820">    switch(msg-&gt;eventType)</a></div>
      <div class="Code_Segment"><a name="998821">    {</a></div>
      <div class="Code_Segment"><a name="998822">        case MSG_APP_FromTransport:</a></div>
      <div class="Code_Segment"><a name="998823">        {</a></div>
      <div class="Code_Segment"><a name="998824">            UdpToAppRecv *info;</a></div>
      <div class="Code_Segment"><a name="998825">            CbrData data;</a></div>
      <div class="Code_Segment"><a name="998826">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998827">            info = (UdpToAppRecv *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="998756">            memcpy(&amp;data, MESSAGE_ReturnPacket(msg), sizeof(data));</a></div>
      <div class="Code_Segment"><a name="998831">            ...</a></div>
      <div class="Code_Segment"><a name="998839">            serverPtr = AppCbrServerGetCbrServer(node,</a></div>
      <div class="Code_Segment"><a name="998840">                                                 info-&gt;sourceAddr,</a></div>
      <div class="Code_Segment"><a name="998841">                                                 data.sourcePort);</a></div>
      <div class="Code_Segment"><a name="998842">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998843">            /* New connection, so create new CBR server to handle client. */</a></div>
      <div class="Code_Segment"><a name="998844">            if (serverPtr == NULL)</a></div>
      <div class="Code_Segment"><a name="998845">            {</a></div>
      <div class="Code_Segment"><a name="998846">                serverPtr = AppCbrServerNewCbrServer(node,</a></div>
      <div class="Code_Segment"><a name="998847">                                                     info-&gt;destAddr,</a></div>
      <div class="Code_Segment"><a name="998848">                                                     info-&gt;sourceAddr,</a></div>
      <div class="Code_Segment"><a name="998849">                                                     data.sourcePort);</a></div>
      <div class="Code_Segment"><a name="998850">            }</a></div>
      <div class="Code_Segment"><a name="998837">            ...</a></div>
      <div class="Code_Segment"><a name="998871">            if (data.seqNo &gt;= serverPtr-&gt;seqNo)</a></div>
      <div class="Code_Segment"><a name="998872">            {</a></div>
      <div class="Code_Segment"><a name="998873">                serverPtr-&gt;numBytesRecvd += MESSAGE_ReturnPacketSize(msg);</a></div>
      <div class="Code_Segment"><a name="998874">                serverPtr-&gt;sessionLastReceived = getSimTime(node);</a></div>
      <div class="Code_Segment"><a name="998876">                ...</a></div>
      <div class="Code_Segment"><a name="1030086">                serverPtr-&gt;seqNo = data.seqNo + 1;</a></div>
      <div class="Code_Segment"><a name="998832">                ...</a></div>
      <div class="Code_Segment"><a name="998881">             }</a></div>
      <div class="Code_Segment"><a name="998833">             ...</a></div>
      <div class="Code_Segment"><a name="998886">            break;</a></div>
      <div class="Code_Segment"><a name="998887">        }</a></div>
      <div class="Code_Segment"><a name="998889">        default:</a></div>
      <div class="Code_Segment"><a name="998890">        {</a></div>
      <div class="Code_Segment"><a name="998891">            ...</a></div>
      <div class="Code_Segment"><a name="998897">            ERROR_ReportError(error);</a></div>
      <div class="Code_Segment"><a name="998898">        }</a></div>
      <div class="Code_Segment"><a name="998899">    }</a></div>
      <div class="Code_Segment"><a name="1005637">&nbsp;</a></div>
      <div class="Code_Segment"><a name="998901">    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="998882">}</a></div>
      <div class="Figure">FIGURE 4-26.&nbsp;&nbsp;<a name="998806">	Event Dispatcher for CBR Server</a></div>
      <div class="Body"><a name="1002631">All event types used by </a><span class="Variable">QualNet</span> protocols are enumerated in the file api.h. If the protocol being added needs additional event types, these should be included in the enumeration in file api.h, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987147', '');" title="Application Layer">Section&nbsp;4.2.5.6.2</a></span>. </div>
      <div class="Heading3Numbered">4.2.5.7  <a name="932624">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="990813">In this section, we describe how to collect and report statistics for a traffic-generating Application Layer protocol.</a></div>
      <div class="Heading4Numbered">4.2.5.7.1  <a name="932633">Declaring Statistics Variables</a></div>
      <div class="BodyAfterHead"><a name="987169">An application protocol can be configured to record statistics specified by the programmer, such as:</a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932634">Number of bytes sent </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932635">Number of bytes received </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932636">Number of packets sent </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="932638">To enable statistics collection for the protocol, include the statistic collection variables in the structure used to hold the protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987769', '');" title="Application Layer">Section&nbsp;4.2.5.4</a></span>). For example, the data structure for the CBR server, <span style="font-family: &quot;Courier New&quot;">AppDataCbrServer</span>, defined in app_cbr.h, includes statistics variables such as:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="932654">numBytesRecvd</a></span>: Variable to record number of received bytes</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="932655">numPktsRecvd</a></span>: Variable to record number of received packets</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><span style="font-family: &quot;Courier New&quot;"><a name="932656">totalEndToEndDelay</a></span>: Variable used to calculate throughput</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="932664">The statistics related variables can also be defined in a structure and then that structure is included in the state variable. </a></div>
      <div class="Heading4Numbered">4.2.5.7.2  <a name="932666">Initializing Statistics</a></div>
      <div class="BodyAfterHead"><a name="987177">Initialize statistics variables in the function that initializes an instance of the protocol. For example, function AppCbrServerNewCbrServer in file app_cbr.cpp is the function that creates and initializes an instance of the CBR server. It also initializes the statistics variables that are declared as part of the CBR server data structure, </a><span style="font-family: &quot;Courier New&quot;">AppDataCbrServer</span>. A code snippet from function AppCbrServerNewCbrServer is in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1030800', '');" title="Application Layer">Figure&nbsp;4-27</a></span>.</div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="990979">&nbsp;</a></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998955">AppDataCbrServer *</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999048">AppCbrServerNewCbrServer(Node *node, Address localAddr,</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="999047">                         Address remoteAddr, short sourcePort)</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998956">{</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="990985">   AppDataCbrServer *cbrServer;</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="990986">   cbrServer = (AppDataCbrServer *)</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998957">                Mem_alloc(sizeof(AppDataCbrServer));</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="990987">   ...</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="932668">   cbrServer-&gt;numBytesRecvd = 0;</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998958">   cbrServer-&gt;numPktsRecvd = 0;</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="998959">   cbrServer-&gt;totalEndToEndDelay = 0;</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="990991">   ...</a></span></div>
      <div class="Code_Segment_Large" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 9.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="990992">}</a></span></div>
      <div class="Figure">FIGURE 4-27.&nbsp;&nbsp;<a name="1030800">Initializing Statistics Variables</a></div>
      <div class="Heading4Numbered">4.2.5.7.3  <a name="932672">Updating Statistics</a></div>
      <div class="BodyAfterHead"><a name="987168">After declaring and initializing the statistics variables, update their value during the protocol life cycle, as required. For example, increment the value of </a><span style="font-family: &quot;Courier New&quot;">numBytetsRecvd</span> every time the receiver gets a packet. The CBR server function AppLayerCbrServer (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#998806', '');" title="Application Layer">Figure&nbsp;4-26</a></span>) performs this task by executing the following code when the server receives a packet:</div>
      <div class="Code_Segment_Large"><a name="998972">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1030105">serverPtr-&gt;numBytesRecvd += MESSAGE_ReturnPacketSize(msg);</a></div>
      <div class="Code_Segment"><a name="1030106">serverPtr-&gt;sessionLastReceived = getSimTime(node);</a></div>
      <div class="Body"><a name="991020">The API function MESSAGE_ReturnPacketSize returns the size of the packet associated with a message.</a></div>
      <div class="Heading4Numbered">4.2.5.7.4  <a name="932677">Printing Statistics</a></div>
      <div class="BodyAfterHead"><a name="987167">As a final step towards statistics collection, create a function to print the client statistics and a function to print the server statistics. These print functions are called in the finalization functions of the protocol, which are discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1079888', '');" title="Application Layer">Section&nbsp;4.2.5.7.5</a></span>.</div>
      <div class="Body"><a name="932679">Function AppCbrServerPrintStats, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#999240', '');" title="Application Layer">Figure&nbsp;4-28</a></span>, calls the C function sprintf to create a single string containing the statistic name and statistic value, and then calls function IO_PrintStat to print that string to a file. Function IO_PrintStat function, defined in <span class="Variable">QUALNET_HOME</span>/include/fileio.h, requires the following parameters:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932685">Node pointer: Pointer to the node reporting the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932686">Layer: String indicating the layer. Set this to </a><span style="font-family: &quot;Courier New&quot;">"Application"</span> for the Application Layer.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932687">Protocol: String indicating the protocol name.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932688">Interface address: Interface address. Set this to </a><span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> for Application Layer protocols.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932689">Instance identifier: Instance identifier or port number.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="932690">Buffer: String containing the statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Code_Segment"><a name="999181">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999196">void AppCbrServerPrintStats(Node *node, AppDataCbrServer *serverPtr)</a></div>
      <div class="Code_Segment"><a name="999208">{</a></div>
      <div class="Code_Segment"><a name="999205">    clocktype throughput;</a></div>
      <div class="Code_Segment"><a name="999209">    ...</a></div>
      <div class="Code_Segment"><a name="999210">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="999215">    ...</a></div>
      <div class="Code_Segment"><a name="999227">    sprintf(buf, "Total Packets Received = %u", serverPtr-&gt;numPktsRecvd);</a></div>
      <div class="Code_Segment"><a name="999228">    IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="999229">        node,</a></div>
      <div class="Code_Segment"><a name="999230">        "Application",</a></div>
      <div class="Code_Segment"><a name="999231">        "CBR Server",</a></div>
      <div class="Code_Segment"><a name="999232">        ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="999233">        serverPtr-&gt;sourcePort,</a></div>
      <div class="Code_Segment"><a name="999216">        buf);</a></div>
      <div class="Code_Segment"><a name="1030121">  </a></div>
      <div class="Code_Segment"><a name="1030135">    sprintf(buf, "Throughput (bits/s) = %s", throughputStr);</a></div>
      <div class="Code_Segment"><a name="1030122">    IO_PrintStat(</a></div>
      <div class="Code_Segment"><a name="1030123">        node,</a></div>
      <div class="Code_Segment"><a name="1030124">        "Application",</a></div>
      <div class="Code_Segment"><a name="1030125">        "CBR Server",</a></div>
      <div class="Code_Segment"><a name="1030126">        ANY_DEST,</a></div>
      <div class="Code_Segment"><a name="1030127">        serverPtr-&gt;sourcePort,</a></div>
      <div class="Code_Segment"><a name="1030119">        buf);</a></div>
      <div class="Code_Segment"><a name="999239">   ...</a></div>
      <div class="Code_Segment"><a name="999260">}</a></div>
      <div class="Figure">FIGURE 4-28.&nbsp;&nbsp;<a name="999240">Function to Print Statistics</a></div>
      <div class="Heading4Numbered">4.2.5.7.5  <a name="1079888">Adding Dynamic Statistics</a></div>
      <div class="BodyAfterHead"><a name="1079892">Dynamic statistics are statistic variables whose values can be observed in the </a><span class="Variable">QualNet</span> GUI during the simulation. See <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.3.html#955932', '');" title="Customizing Visualize Mode of QualNet Architect">Section&nbsp;5.2.3</a></span> for adding dynamic statistics to a protocol. Refer to <span class="Variable" style="font-style: italic">QualNet User’s Guide</span> for details of viewing dynamic statistics during the simulation.</div>
      <div class="Heading3Numbered">4.2.5.8  <a name="999253">Finalization</a></div>
      <div class="BodyAfterHead"><a name="966080">The finalization function of the protocol is called by the simulator at the end of simulation. It is the last code that executes during the simulation. This function is responsible for printing statistics to the statistics file.</a></div>
      <div class="BodyAfterHead"><a name="996687">At the end of simulation, the finalization function for each protocol is called to print the protocol statistics. As discussed in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#934306', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.3</a></span>, the finalization function is called hierarchically. The node finalization function, PARTITION_Finalize, which is defined in <span class="Variable">QUALNET_HOME</span>/main/partition.cpp, calls the finalization function for Application Layer, APP_Finalize, defined in application.cpp. APP_Finalize calls the finalization function(s) of each application protocol running at the node. </div>
      <div class="Heading4Numbered">4.2.5.8.1  <a name="932770">Modifying the Application Layer Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="987205">Call the finalization function(s) of the application protocol from the Application Layer finalization function, APP_Finalize, defined in application.cpp. To add the protocol's finalization function, add a case statement on the protocol name and make a call to the finalization function within the case, as done for other protocols in the function. In APP_Finalize, the finalization functions of Application Layer routing models are specified in the first switch statement and the second switch statement is used to specify finalization functions of Application Layer traffic generators. </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#994522', '');" title="Application Layer">Figure&nbsp;4-29</a></span> shows the outline of code that needs to be added to APP_Finalize. Function AppMyprotocolClientFinalize is the finalization function for MYPROTOCOL client (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932772', '');" title="Application Layer">Section&nbsp;4.2.5.8.2</a></span>) and function AppMyprotocolServerFinalize is the finalization function for MYPROTOCOL server (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#991182', '');" title="Application Layer">Section&nbsp;4.2.5.8.3</a></span>).</div>
      <div class="Code_Segment"><a name="994521">&nbsp;</a></div>
      <div class="Code_Segment"><a name="991040">void APP_Finalize (Node *node)</a></div>
      <div class="Code_Segment"><a name="991041">{</a></div>
      <div class="Code_Segment"><a name="991042">  ...</a></div>
      <div class="Code_Segment"><a name="991043">  AppInfo *applist = NULL;</a></div>
      <div class="Code_Segment"><a name="991044">  AppInfo *nextApp = NULL;</a></div>
      <div class="Code_Segment"><a name="991045">  ...</a></div>
      <div class="Code_Segment"><a name="991048">  for (appList = node-&gt;appData.appPtr; appList != NULL;<br />       appList = nextApp)</a></div>
      <div class="Code_Segment"><a name="991049">    {</a></div>
      <div class="Code_Segment"><a name="991050">        switch (appList-&gt;appType)</a></div>
      <div class="Code_Segment"><a name="991051">        {</a></div>
      <div class="Code_Segment"><a name="991061">         ...</a></div>
      <div class="Code_Segment"><a name="991052">         case APP_CBR_CLIENT:</a></div>
      <div class="Code_Segment"><a name="991053">            {</a></div>
      <div class="Code_Segment"><a name="991054">                AppCbrClientFinalize(node, appList);</a></div>
      <div class="Code_Segment"><a name="991055">                break;</a></div>
      <div class="Code_Segment"><a name="991046">            }</a></div>
      <div class="Code_Segment"><a name="991073">          case APP_CBR_SERVER:</a></div>
      <div class="Code_Segment"><a name="991074">            {</a></div>
      <div class="Code_Segment"><a name="991075">                AppCbrServerFinalize(node, appList);</a></div>
      <div class="Code_Segment"><a name="991076">                break;</a></div>
      <div class="Code_Segment"><a name="991071">            }</a></div>
      <div class="Code_New"><a name="991080">          case APP_MYPROTOCOL_CLIENT</a></div>
      <div class="Code_New"><a name="991083">            {</a></div>
      <div class="Code_New"><a name="991084">                AppMyprotocolClientFinalize(node, appList);</a></div>
      <div class="Code_New"><a name="991085">                break;</a></div>
      <div class="Code_New"><a name="991086">            }</a></div>
      <div class="Code_New"><a name="991087">          case APP_MYPROTOCOL_SERVER:</a></div>
      <div class="Code_New"><a name="991088">            {</a></div>
      <div class="Code_New"><a name="991089">                AppMyprotocolServerFinalize(node, appList);</a></div>
      <div class="Code_New"><a name="991090">                break;</a></div>
      <div class="Code_New"><a name="991091">            }</a></div>
      <div class="Code_Segment"><a name="991117">         ...</a></div>
      <div class="Code_Segment"><a name="991118">         nextApp = appList-&gt;appNext;</a></div>
      <div class="Code_Segment"><a name="991119">    }</a></div>
      <div class="Code_Segment"><a name="991120">  ...</a></div>
      <div class="Code_Segment"><a name="991121">}</a></div>
      <div class="Figure">FIGURE 4-29.&nbsp;&nbsp;<a name="994522">Calling MYPROTOCOL Finalization Functions</a></div>
      <div class="Heading4Numbered">4.2.5.8.2  <a name="932772">Implementing the Client Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="991122">Write the finalization function for protocol client, AppMyprotocolClientFinalize. If statistics collection is enabled for the Application Layer, call the function to print the client’s statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932677', '');" title="Application Layer">Section&nbsp;4.2.5.7.4</a></span>) from the finalization function, or add code directly to AppMyprotocolClientFinalize to print statistics.</div>
      <div class="Body"><a name="991131">Use the CBR client finalization function, AppCbrClientFinalize, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#991180', '');" title="Application Layer">Figure&nbsp;4-30</a></span>, as a template. This function is implemented in app_cbr.cpp.</div>
      <div class="Code_Segment"><a name="1029778">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1029779">void AppCbrClientFinalize(Node *node, AppInfo* appInfo)</a></div>
      <div class="Code_Segment"><a name="1029780">{</a></div>
      <div class="Code_Segment"><a name="991145">    AppDataCbrClient *clientPtr =</a></div>
      <div class="Code_Segment"><a name="999078">                     (AppDataCbrClient*)appInfo-&gt;appDetail;</a></div>
      <div class="Code_Segment"><a name="991146">&nbsp;</a></div>
      <div class="Code_Segment"><a name="991147">    if (node-&gt;appData.appStats == TRUE)</a></div>
      <div class="Code_Segment"><a name="991148">    {</a></div>
      <div class="Code_Segment"><a name="991149">        AppCbrClientPrintStats(node, clientPtr);</a></div>
      <div class="Code_Segment"><a name="991150">    }</a></div>
      <div class="Code_Segment"><a name="991140">}</a></div>
      <div class="Figure">FIGURE 4-30.&nbsp;&nbsp;<a name="991180">Finalization Function for CBR Client</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-top: 0.0pt"><a name="991181">As for all other functions, specify the prototype of the finalization function in the protocol's header file, app_myprotocol.h.</a></div>
      <div class="Heading4Numbered">4.2.5.8.3  <a name="991182">Implementing the Server Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="999348">Write the finalization function for protocol client, AppMyprotocolServerFinalize. If statistics collection is enabled for the Application Layer, call the function to print the client’s statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932677', '');" title="Application Layer">Section&nbsp;4.2.5.7.4</a></span>) from the finalization function, or add code directly to AppMyprotocolServerFinalize to print statistics.</div>
      <div class="Body"><a name="999355">Use the CBR client finalization function, AppCbrServerFinalize, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#995918', '');" title="Application Layer">Figure&nbsp;4-31</a></span>, as a template. This function is implemented in app_cbr.cpp.</div>
      <div class="Code_Segment"><a name="994559">&nbsp;</a></div>
      <div class="Code_Segment"><a name="932792">void AppCbrServerFinalize(Node *node, AppInfo* appInfo)</a></div>
      <div class="Code_Segment"><a name="999091">{<br />  AppDataCbrServer *serverPtr = (AppDataCbrServer*)appInfo-&gt;appDetail;</a></div>
      <div class="Code_Segment"><a name="999093">  if (node-&gt;appData.appStats == TRUE)</a></div>
      <div class="Code_Segment"><a name="999094">  {<br />     AppCbrServerPrintStats(node, serverPtr);</a></div>
      <div class="Code_Segment"><a name="999095">  }</a></div>
      <div class="Code_Segment"><a name="999096">}</a></div>
      <div class="Figure">FIGURE 4-31.&nbsp;&nbsp;<a name="995918">Finalization Function for CBR Server</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-top: 0.0pt"><a name="991202">As for all other functions, specify the prototype of the finalization function in the protocol's header file, app_myprotocol.h.</a></div>
      <div class="Heading3Numbered">4.2.5.9  <a name="987370">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1041012">The final step in integrating your application model into </a><span class="Variable">QualNet</span> is to add the source file to the <span class="Variable">QualNet</span> source tree and compile.</div>
      <div class="Body"><a name="1041375">If you have created the files for the application model in an existing library or addon, then add the source file to the Makefile-common for that library or addon. For example, if you have created your model files in the Developer library, then modify </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/Makefile-common as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1080801', '');" title="Application Layer">Figure&nbsp;4-32</a></span>. Recompile <span class="Variable">QualNet</span> after making the changes.</div>
      <div class="Code_Segment"><a name="1041387">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1041389">...</a></div>
      <div class="Code_Segment"><a name="1041435"># common sources</a></div>
      <div class="Code_Segment"><a name="1041390">#</a></div>
      <div class="Code_Segment"><a name="1041391">DEVELOPER_SRCS = \</a></div>
      <div class="Code_Segment"><a name="1041392">$(DEVELOPER_SRCDIR)/adaptation_aal5.cpp \</a></div>
      <div class="Code_Segment"><a name="1041393">$(DEVELOPER_SRCDIR)/adaptation.cpp \</a></div>
      <div class="Code_Segment"><a name="1041394">...</a></div>
      <div class="Code_Segment"><a name="1041401">$(DEVELOPER_SRCDIR)/app_mcbr.cpp \</a></div>
      <div class="Code_Segment"><a name="1041402">$(DEVELOPER_SRCDIR)/app_messenger.cpp \</a></div>
      <div class="Code_New"><a name="1041425">$(DEVELOPER_SRCDIR)/app_myprotocol.cpp \</a></div>
      <div class="Code_Segment"><a name="1041403">$(DEVELOPER_SRCDIR)/app_superapplication.cpp \</a></div>
      <div class="Code_Segment"><a name="1041404">$(DEVELOPER_SRCDIR)/app_telnet.cpp \</a></div>
      <div class="Code_Segment"><a name="1041377">$(DEVELOPER_SRCDIR)/app_traffic_gen.cpp \</a></div>
      <div class="Code_Segment"><a name="1041419">...</a></div>
      <div class="Figure">FIGURE 4-32.&nbsp;&nbsp;<a name="1080801">Adding Model to Makefile-common</a></div>
      <div class="Body"><a name="1080802">If you have created a new library called user_models, then follow the instructions given in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-10.html#929473', '');" title="Creating an Addon, Interface or Model Library">Section&nbsp;4.10.5</a></span> to integrate the  user_models library into <span class="Variable">QualNet</span>.</div>
      <div class="Heading3Numbered">4.2.5.10  <a name="1080810">Integrating the Protocol into the GUI</a></div>
      <div class="BodyAfterHead"><a name="1080831">To make the new protocol available in </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%205.16.2.html#986045', '');" title="Customizing Design Mode of QualNet Architect">Section&nbsp;5.1.4</a></span>.</div>
      <div class="Heading2Numbered">4.2.6  <a name="1080835">Adding an Application Layer Routing Protocol</a></div>
      <div class="BodyAfterHead"><a name="932828">Application Layer routing protocols function mostly as other Application Layer protocols. They operate at the Application Layer and send/receive packets using Application Layer APIs. However, there are certain differences in their implementation. This section requires knowledge of the contents of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986903', '');" title="Application Layer">Section&nbsp;4.2.5</a></span> and provides additional implementation details needed for implementing a routing protocol at the Application Layer. </div>
      <div class="Body"><a name="991926">To understand how an Application Layer routing protocol is implemented in </a><span class="Variable">QualNet</span>, look at the implementation code for the routing protocol Bellman-Ford. The header file for the Bellman-Ford implementation is routing_bellmanford.h and the source file is routing_bellmanford.cpp in the folder <span class="Variable">QUALNET_HOME</span>/libraries/developer/src.</div>
      <div class="Body"><a name="991813">The following list summarizes the actions that need to be performed for adding an Application Layer routing protocol, MYPROTCOL, to </a><span class="Variable">QualNet</span>. For those steps that are similar to the steps for writing a traffic-generating protocol, we refer the reader to the appropriate subsection of <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986903', '');" title="Application Layer">Section&nbsp;4.2.5</a></span>. The steps that are different for routing protocols are described in detail in subsequent sections. (Note that unlike a traffic-generating Application Layer protocol, which has a client and a server, a routing protocol has a single module.)</div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="991696">Create header and source files (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#988764', '');" title="Application Layer">Section&nbsp;4.2.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991697">Modify the file application.cpp to include the protocol’s header file (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#988764', '');" title="Application Layer">Section&nbsp;4.2.5.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991701">Include the protocol in the list of Application Layer protocols and trace protocols (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1080927', '');" title="Application Layer">Section&nbsp;4.2.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001853">Modify Application Layer data structure to include routing protocol state (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992274', '');" title="Application Layer">Section&nbsp;4.2.6.2</a></span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002040">Include the protocol in Network Layer declarations (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1000420', '');" title="Application Layer">Section&nbsp;4.2.6.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991708">Define data structures for the protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987769', '');" title="Application Layer">Section&nbsp;4.2.5.4</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991709">Decide on the format for the protocol-specific configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992277', '');" title="Application Layer">Section&nbsp;4.2.6.4.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">8.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991713">Call the protocol’s initialization function from the Application Layer initialization function, APP_Initialize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992299', '');" title="Application Layer">Section&nbsp;4.2.6.4.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">9.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001884">Write the initialization function for the protocol. The initialization function should include the following tasks:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1001885">Read and store the configuration parameters (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932883', '');" title="Application Layer">Section&nbsp;4.2.6.4.3.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1001889">Initialize the state variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932883', '');" title="Application Layer">Section&nbsp;4.2.6.4.3.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="991729">Initialize timers (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992911', '');" title="Application Layer">Section&nbsp;4.2.6.4.3.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="991854">Initialize routing tables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992895', '');" title="Application Layer">Section&nbsp;4.2.6.4.3.3</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">10.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1041927">Integrate the protocol with the Network Layer (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1002343', '');" title="Application Layer">Section&nbsp;4.2.6.5</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="1041928">Modify the IP function NetworkRoutingGetAdmindistance to return the protocol’s administrative distance.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1002440">Modify the routing protocol parsing function NetworkIpParseAndSetRoutingProtocolType to include the protocol in the list of routing protocols that are initialized at the Application Layer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">11.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1001902">Call the protocol event dispatcher from the Application Layer event dispatcher, APP_ProcessEvent (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1001485', '');" title="Application Layer">Section&nbsp;4.2.6.6.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">12.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1003344">Declare any new event types used by the protocol in the header file </a><span class="Variable">QUALNET_HOME</span>/include/api.h (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987147', '');" title="Application Layer">Section&nbsp;4.2.5.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">13.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991737">Write the protocol event dispatcher (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1001617', '');" title="Application Layer">Section&nbsp;4.2.6.6.2</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">14.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991742">Include code in various functions to collect statistics.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1__0028first_0029_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1__0028first_0029_inner"><a name="991746">Declare statistics variables (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932633', '');" title="Application Layer">Section&nbsp;4.2.5.7.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="991747">Initialize the statistics variables in the protocol’s initialization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932666', '');" title="Application Layer">Section&nbsp;4.2.5.7.2</a></span>.)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="991754">Update the statistics as appropriate (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932672', '');" title="Application Layer">Section&nbsp;4.2.5.7.3</a></span>.)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="991758">Write a function to print the statistics (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932677', '');" title="Application Layer">Section&nbsp;4.2.5.7.4</a></span>.)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_Sub1_outer" style="margin-left: 14.4pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_Sub1_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_Sub1_inner"><a name="1080888">Add dynamic statistics to the protocol, if desired (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1079888', '');" title="Application Layer">Section&nbsp;4.2.5.7.5</a></span>) .</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">15.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991759">Call the protocol finalization function from the Application Layer finalization function, APP_Finalize (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#993085', '');" title="Application Layer">Section&nbsp;4.2.6.8.1</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">16.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="991766">Write the protocol finalization function (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#993068', '');" title="Application Layer">Section&nbsp;4.2.6.8.2</a></span>). Call the function to print statistics from the protocol finalization function.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">17.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1080925">Include the protocol header and source files in the </a><span class="Variable">QualNet</span> tree and compile (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987370', '');" title="Application Layer">Section&nbsp;4.2.5.9</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">18.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1080936">To make the protocol available in the </a><span class="Variable">QualNet</span> GUI, modify the GUI settings files (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1080810', '');" title="Application Layer">Section&nbsp;4.2.5.10</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.2.6.1  <a name="1080927">Including MYPROTOCOL in List of Application Layer Protocols</a></div>
      <div class="BodyAfterHead"><a name="1080931">This step is similar to the corresponding step for adding a traffic-generating protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987028', '');" title="Application Layer">Section&nbsp;4.2.5.3</a></span>), except that only one entry needs to be made to the list of protocols. </div>
      <div class="Body"><a name="992034">For our example protocol MYPROTOCOL, add </a><span style="font-family: &quot;Courier New&quot;">APP_MYPROTOCOL</span><span style="font-weight: bold"> </span>to <span style="font-family: &quot;Courier New&quot;">AppType</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992255', '');" title="Application Layer">Figure&nbsp;4-33</a></span>. Enumeration <span style="font-family: &quot;Courier New&quot;">AppType</span> is defined in application.h.</div>
      <div class="Code_Segment"><a name="991947">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999392">typedef enum</a></div>
      <div class="Code_Segment"><a name="991948">{</a></div>
      <div class="Code_Segment"><a name="1030933">    APP_FTP_SERVER_DATA = 20,</a></div>
      <div class="Code_Segment"><a name="1079338">    APP_FTP_SERVER = 21,</a></div>
      <div class="Code_Segment"><a name="1030934">    APP_FTP_CLIENT,</a></div>
      <div class="Code_Segment"><a name="1030935">    APP_TELNET_SERVER = 23,</a></div>
      <div class="Code_Segment"><a name="1041047">    ...</a></div>
      <div class="Code_New"><a name="1041049">    APP_MYPROTOCOL,</a></div>
      <div class="Code_Segment"><a name="991962">    APP_PLACEHOLDER</a></div>
      <div class="Code_Segment"><a name="991963">} AppType;</a></div>
      <div class="Figure">FIGURE 4-33.&nbsp;&nbsp;<a name="992255">Adding MYPROTOCOL to List of Application Layer Routing Protocols</a></div>
      <div class="Note_Indented"><a name="1030172"><img class="Default" src="images/Chapter%204-2.06.1.7.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />Always add to the end of lists in header files (just before the entry </a><span style="font-family: &quot;Courier New&quot;">APP_PLACEHOLDER</span>).</div>
      <div class="Body"><a name="1030170">As in the case of a traffic-generating protocol, add an entry </a><span style="font-family: &quot;Courier New&quot;">TRACE_MYPROTOCOL</span> in the enumeration <span style="font-family: &quot;Courier New&quot;">TraceProtocolType</span> in <span class="Variable">QUALNET_HOME</span>/include/trace.h, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1005127', '');" title="Application Layer">Figure&nbsp;4-16</a></span>.</div>
      <div class="Heading3Numbered">4.2.6.2  <a name="992274">Modify AppData to include MYPROTOCOL State Information</a></div>
      <div class="BodyAfterHead"><a name="1000329">The routing protocol state is stored in the Application Layer data structure </a><span style="font-family: &quot;Courier New&quot;">AppData</span>. To add a custom Application Layer routing protocol to <span class="Variable">QualNet</span>, modify <span style="font-family: &quot;Courier New&quot;">AppData</span> (<span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986251', '');" title="Application Layer">Section&nbsp;4.2.3</a></span>) to include the protocol’s state, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1000375', '');" title="Application Layer">Figure&nbsp;4-34</a></span>.</div>
      <div class="Code_Segment"><a name="1000333">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000334">struct struct_app_str</a></div>
      <div class="Code_Segment"><a name="1000335">{</a></div>
      <div class="Code_Segment"><a name="1000336">    AppInfo *appPtr;      /* pointer to the list of app info */</a></div>
      <div class="Code_Segment"><a name="1000337">    PortInfo *portTable;  /* pointer to the port table */</a></div>
      <div class="Code_Segment"><a name="1000338">    short  nextPortNum;   /* next available port number */</a></div>
      <div class="Code_Segment"><a name="1000339">    BOOL   appStats;      /* whether application statistics</a></div>
      <div class="Code_Segment"><a name="1000340">                             collection is enabled */</a></div>
      <div class="Code_Segment"><a name="1000341">    AppType exteriorGatewayProtocol;</a></div>
      <div class="Code_Segment"><a name="1000342">    BOOL routingStats;</a></div>
      <div class="Code_Segment"><a name="1000343">    void *routingVar;          </a></div>
      <div class="Code_Segment"><a name="1000344">    void *bellmanford;</a></div>
      <div class="Code_Segment"><a name="1000345">    void *olsr;</a></div>
      <div class="Code_Segment"><a name="1041068">    void *olsr2;</a></div>
      <div class="Code_New"><a name="1000346">    void *myprotocol; </a></div>
      <div class="Code_Segment"><a name="1000347">   ...</a></div>
      <div class="Code_Segment"><a name="1000348">  };</a></div>
      <div class="Figure">FIGURE 4-34.&nbsp;&nbsp;<a name="1000375">Modifying AppData to include Routing Protocol State</a></div>
      <div class="Heading3Numbered">4.2.6.3  <a name="1000420">Including MYPROTOCOL in Network Layer Declarations</a></div>
      <div class="BodyAfterHead"><a name="1000429">Each node in </a><span class="Variable">QualNet</span> maintains a list of routing protocols running at the node. When a new Application Layer routing protocol is added to <span class="Variable">QualNet</span>, it needs to be included in the list of routing protocols. To do this, add the protocol name to the enumeration <span style="font-family: &quot;Courier New&quot;">NetworkRoutingProtocolType</span> defined in <span class="Variable">QUALNET_HOME</span>/include/network.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>). </div>
      <div class="Body"><a name="1000433">For our example protocol, add the entry </a><span style="font-family: &quot;Courier New&quot;">ROUTING_PROTOCOL_MYPROTOCOL</span> to <span style="font-family: &quot;Courier New&quot;">NetworkRoutingProtocolType</span><span style="font-size: 9.0pt"> </span>as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1000474', '');" title="Application Layer">Figure&nbsp;4-35</a></span>.</div>
      <div class="Code_Segment"><a name="1000600">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000601">typedef enum</a></div>
      <div class="Code_Segment"><a name="1000439">{</a></div>
      <div class="Code_Segment"><a name="1000440">			NETWORK_PROTOCOL_IP = 0,</a></div>
      <div class="Code_Segment"><a name="1000441">			NETWORK_PROTOCOL_IPV6,</a></div>
      <div class="Code_Segment"><a name="1000442">			NETWORK_PROTOCOL_MOBILE_IP,</a></div>
      <div class="Code_Segment"><a name="1079344">			...</a></div>
      <div class="Code_Segment"><a name="1079345">   ROUTING_PROTOCOL_AODV6,</a></div>
      <div class="Code_Segment"><a name="1079346">   ROUTING_PROTOCOL_DYMO,</a></div>
      <div class="Code_Segment"><a name="1041080">   ROUTING_PROTOCOL_DYMO6,</a></div>
      <div class="Code_New"><a name="1041083">			ROUTING_PROTOCOL_MYPROTOCOL</a></div>
      <div class="Code_Segment"><a name="1000449">} NetworkRoutingProtocolType;</a></div>
      <div class="Figure">FIGURE 4-35.&nbsp;&nbsp;<a name="1000474">Adding MYPROTOCOL to List of Network Layer Protocols</a></div>
      <div class="Note_Indented"><a name="1000529">Always add to the end of lists in header files.<img class="Default" src="images/Chapter%204-2.06.1.8.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></a></div>
      <div class="Body"><a name="1041339">A routing administrative distance is assigned to each routing protocol, which determines its priority relative to other routing protocols. A protocol with a lower administrative distance has a higher priority. The administrative distances of all routing protocols are defined in the enumeration </a><span style="font-family: &quot;Courier New&quot;">NetworkRoutingAdminDistanceType</span> defined in network.h<span style="font-weight: bold"> </span>(see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-4.html#986416', '');" title="Network Layer">Section&nbsp;4.4.3</a></span>).</div>
      <div class="Body"><a name="1000977">For our example protocol, add the entry </a><span style="font-family: &quot;Courier New&quot;">ROUTING_ADMIN_DISTANCE_MYPROTOCOL</span> to <span style="font-family: &quot;Courier New&quot;">NetworkRoutingAdminDistanceType</span><span style="font-size: 9.0pt"> </span>as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1000678', '');" title="Application Layer">Figure&nbsp;4-36</a></span>. Add this entry in the proper place in the list to reflect the desired priority of MYPROTOCOL relative to the other routing protocols.</div>
      <div class="Code_Segment"><a name="1000642">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000994">typedef enum</a></div>
      <div class="Code_Segment"><a name="1000643">{</a></div>
      <div class="Code_Segment"><a name="1000644">    ROUTING_ADMIN_DISTANCE_STATIC = 1,</a></div>
      <div class="Code_Segment"><a name="1000645">    ROUTING_ADMIN_DISTANCE_EBGPv4 = 20,</a></div>
      <div class="Code_Segment"><a name="1000646">    ...</a></div>
      <div class="Code_Segment"><a name="1030217">    ROUTING_ADMIN_DISTANCE_OLSR,</a></div>
      <div class="Code_Segment"><a name="1030219">    ROUTING_ADMIN_DISTANCE_EIGRP,</a></div>
      <div class="Code_New"><a name="1001001">    ROUTING_ADMIN_DISTANCE_MYPROTOCOL,</a></div>
      <div class="Code_Segment"><a name="1000656">    //StartRIP</a></div>
      <div class="Code_Segment"><a name="1000657">    ROUTING_ADMIN_DISTANCE_RIP,</a></div>
      <div class="Code_Segment"><a name="1000658">    //EndRIP</a></div>
      <div class="Code_Segment"><a name="1000659">   ...</a></div>
      <div class="Code_Segment"><a name="1000661">   // Should always have the highest adminstrative distance</a></div>
      <div class="Code_Segment"><a name="1000662">   // (ie, least important).</a></div>
      <div class="Code_Segment"><a name="1000663">    ROUTING_ADMIN_DISTANCE_DEFAULT = 255</a></div>
      <div class="Code_Segment"><a name="1000664">} NetworkRoutingAdminDistanceType;</a></div>
      <div class="Figure">FIGURE 4-36.&nbsp;&nbsp;<a name="1000678">Declaring Administrative Distance for MYPROTOCOL</a></div>
      <div class="Heading3Numbered">4.2.6.4  <a name="1000476">Initialization</a></div>
      <div class="BodyAfterHead"><a name="1000377">In this section, we describe the tasks that need to be performed as part of the initialization process of an Application Layer routing protocol.</a></div>
      <div class="Heading4Numbered">4.2.6.4.1  <a name="992277">Determining the Protocol Configuration Format</a></div>
      <div class="BodyAfterHead"><a name="999955">A routing protocol may use protocol-specific configuration parameters. The configuration parameters are specified in the </a><span class="Variable">QualNet</span> configuration file. The format for specifying a routing protocol’s configuration parameters is:</div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1030529">[&lt;Identifier&gt;] &lt;Parameter-name&gt; [&lt;Index&gt;] &lt;Parameter-value&gt;</a></span></div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 10.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1030530">&nbsp;</a></div>
      <div class="BodyAfterHead" style="text-indent: 9pt"><a name="1030531">where</a></div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1030532"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Identifier&gt;	</span>: Node identifier, subnet identifier, or IP address to which this parameter declaration is applicable, enclosed in square brackets. This specification is optional, and if it is not included, the parameter declaration applies to all nodes.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 147.6pt; margin-top: 3.0pt; text-indent: -111.6pt"><span style="font-family: &quot;Courier New&quot;"><a name="1030533">&lt;Parameter-name&gt;	</a></span>: Name of the parameter.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><a name="1030534"> </a><span style="font-family: &quot;Courier New&quot;">&lt;Index&gt;	</span>: Instance to which this parameter declaration is applicable, enclosed in square brackets. This is used when there are multiple instances of the parameter. This specification is optional, and if it is not included, the parameter declaration applies to all instances.</div>
      <div class="Body" style="margin-bottom: 0.0pt; margin-left: 145.8pt; margin-top: 3.0pt; text-indent: -109.80000000000001pt"><span style="font-family: &quot;Courier New&quot;"><a name="999956">&lt;Parameter-value&gt;</a></span>	: Value to be used for the parameter.</div>
      <div class="Body"><a name="999960">As an example, the following are some of the configuration parameters for the Fisheye protocol. Refer to file </a><span class="Variable">QUALNET_HOME</span>/scenarios/default/default.config for an explanation of these parameters.</div>
      <div class="Code_Segment_Large"><a name="999961">&nbsp;</a></div>
      <div class="Code_Segment_Large"><a name="1094595">FISHEYE-INTRA-UPDATE-INTERVAL   5S</a></div>
      <div class="Code_Segment_Large"><a name="999979">FISHEYE-INTER-UPDATE-INTERVAL   15S</a></div>
      <div class="Code_Segment_Large"><a name="999962">FISHEYE-NEIGHBOR-TIMEOUT-INTERVAL 15S</a></div>
      <div class="Body"><a name="992278">A configuration variable is not always mandatory. If an optional configuration variable is not assigned a value, the default value is used. For example, if a user does not specify a value for </a><span style="font-family: &quot;Courier New&quot;">FISHEYE-INTRA-UPDATE-INTERVAL</span>, the default value of 5 seconds is used by the protocol. </div>
      <div class="Heading4Numbered">4.2.6.4.2  <a name="992299">Calling the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="992257">The initialization function of an Application Layer routing protocol is called from the Application Layer initialization function APP_Initialize, unlike the initialization function of a traffic-generating protocol which is called from function APP_InitializeApplications. </a></div>
      <div class="Body"><a name="1000132">IP initialization function NetworkIpInit calls function NetworkIpParseAndSetRoutingProtocolType to read the name of the routing protocol for each interface from the configuration file and update the routing protocol type for that interface. Function APP_Initialize reads the name of the routing protocol from the configuration file, checks the routing protocol type for each interface, and updates the routing protocol information for that interface. The code snippet from NetworkIpParseAndSetRoutingProtocolType and APP_Initialize corresponding to the Bellman-Ford routing protocol are shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1042027', '');" title="Application Layer">Figure&nbsp;4-37</a></span> and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992712', '');" title="Application Layer">Figure&nbsp;4-38</a></span>, respectively. The functions used in these code snippets are explained below.</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000107">Function IO_ReadString reads the name of the routing protocol from the configuration file. The prototype for IO_ReadString is defined in </a><span class="Variable">QUALNET_HOME</span>/include/fileio.h.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000108">Function NetworkIpGetInterfaceAddress, defined in </a><span class="Variable">QUALNET_HOME</span>/libraries/developer/src/network_ip.cpp, returns the IP address associated with an interface. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000105">Function NetworkIpAddUnicastRoutingProtocolType, defined in network_ip.cpp, initializes the routing protocol information for an interface. In the example of </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1042027', '');" title="Application Layer">Figure&nbsp;4-37</a></span>, NetworkIpAddUnicastRoutingProtocolType updates the interface information to indicate that Bellman-Ford is the routing protocol running at that interface.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000176">Function RoutingBellmanfordInit, defined in routing_bellmanford.cpp, is the initialization function for Bellman-Ford. RoutingBellmanfordInit is called if the </a><span style="font-family: &quot;Courier New&quot;">bellmanford</span> field of <span style="font-family: &quot;Courier New&quot;">appdata</span> is <span style="font-family: &quot;Courier New&quot;">NULL</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986251', '');" title="Application Layer">Section&nbsp;4.2.3</a></span>). RoutingBellmanfordInit creates an instance of the Bellman-Ford data structure and updates <span style="font-family: &quot;Courier New&quot;">bellmanford</span> to point to that data structure. Thus, RoutingBellmanfordInit is called at most once for each node, even if Bellman-Ford is running on multiple interfaces.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1042027', '');" title="Application Layer" name="1068525">Figure&nbsp;4-37</a></span> shows the modifications to be made to NetworkIpParseAndSetRoutingProtocolType and <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992712', '');" title="Application Layer">Figure&nbsp;4-38</a></span> shows the modifications to be made to APP_Initialize to incorporate MYPROTOCOL in <span class="Variable">QualNet</span>. RoutingMyprotocolInit is the initialization function for MYPROTOCOL (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992816', '');" title="Application Layer">Section&nbsp;4.2.6.4.3</a></span>). </div>
      <div class="Code_Segment" style="color: #000000; font-family: &quot;Courier New&quot;; font-size: 2.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><a name="1068532">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1041956">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1042033">void</a></div>
      <div class="Code_Segment"><a name="1041957">NetworkIpParseAndSetRoutingProtocolType (Node *node,</a></div>
      <div class="Code_Segment"><a name="1041958">                                                   const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="1041959">{</a></div>
      <div class="Code_Segment"><a name="1041960">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="1041961">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="1041962">    ...</a></div>
      <div class="Code_Segment"><a name="1041963">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="1041964">    {</a></div>
      <div class="Code_Segment"><a name="1041965">         ...</a></div>
      <div class="Code_Segment"><a name="1041966">         IO_ReadString(</a></div>
      <div class="Code_Segment"><a name="1041967">                node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1041968">                NetworkIpGetInterfaceAddress(node, i),</a></div>
      <div class="Code_Segment"><a name="1041969">                nodeInput,</a></div>
      <div class="Code_Segment"><a name="1041970">                "ROUTING-PROTOCOL",</a></div>
      <div class="Code_Segment"><a name="1041971">                &amp;retVal,</a></div>
      <div class="Code_Segment"><a name="1041972">                protocolString);</a></div>
      <div class="Code_Segment"><a name="1041974">        if (retVal)</a></div>
      <div class="Code_Segment"><a name="1041975">        {</a></div>
      <div class="Code_Segment"><a name="1041976">            ...</a></div>
      <div class="Code_Segment"><a name="1041977">            else if (strcmp(protocolString, "BELLMANFORD ") == 0)</a></div>
      <div class="Code_Segment"><a name="1041978">            {</a></div>
      <div class="Code_Segment"><a name="1041979">                    routingProtocolType = ROUTING_PROTOCOL_BELLMANFORD;</a></div>
      <div class="Code_Segment"><a name="1041980">            }</a></div>
      <div class="Code_New"><a name="1041981">            else if (strcmp(protocolString, "MYPROTOCOL ") == 0)</a></div>
      <div class="Code_New"><a name="1041982">            {</a></div>
      <div class="Code_New"><a name="1041983">                    routingProtocolType = ROUTING_PROTOCOL_MYPROTOCOL</a></div>
      <div class="Code_New"><a name="1041984">            }</a></div>
      <div class="Code_Segment"><a name="1041986">            ...  </a></div>
      <div class="Code_Segment"><a name="1041987">        }</a></div>
      <div class="Code_Segment"><a name="1041989">        NetworkIpAddUnicastRoutingProtocolType(</a></div>
      <div class="Code_Segment"><a name="1041990">                        node,</a></div>
      <div class="Code_Segment"><a name="1041991">                        routingProtocolType,</a></div>
      <div class="Code_Segment"><a name="1041992">                        i,</a></div>
      <div class="Code_Segment"><a name="1041993">                  NETWORK_IPV4);</a></div>
      <div class="Code_Segment"><a name="1041995">     }</a></div>
      <div class="Code_Segment"><a name="1041996">     ...</a></div>
      <div class="Code_Segment"><a name="1041950">}</a></div>
      <div class="Figure">FIGURE 4-37.&nbsp;&nbsp;<a name="1042027">Initializing Routing Protocol Information for an Interface</a></div>
      <div class="Code_Segment"><a name="992630">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999516">void</a></div>
      <div class="Code_Segment"><a name="992631">APP_Initialize(Node *node, const NodeInput *nodeInput)</a></div>
      <div class="Code_Segment"><a name="992632">{</a></div>
      <div class="Code_Segment"><a name="992633">    BOOL retVal;</a></div>
      <div class="Code_Segment"><a name="992634">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="992635">    int i;</a></div>
      <div class="Code_Segment"><a name="992637">    ...</a></div>
      <div class="Code_Segment"><a name="992640">    node-&gt;appData.nextPortNum = 1024;</a></div>
      <div class="Code_Segment"><a name="992622">    ...</a></div>
      <div class="Code_Segment"><a name="992647">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="992645">     {</a></div>
      <div class="Code_Segment" style="margin-left: 81pt; text-indent: 0pt"><a name="1042291">NetworkType InterfaceType = NetworkIpGetInterfaceType(node,i);</a></div>
      <div class="Code_Segment"><a name="1042292">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1042293">         if (InterfaceType == NETWORK_IPV4 ||</a></div>
      <div class="Code_Segment" style="margin-left: 99pt; text-indent: 0pt"><a name="1042294">InterfaceType == NETWORK_DUAL)</a></div>
      <div class="Code_Segment"><a name="1042295">         {</a></div>
      <div class="Code_Segment"><a name="1042296">           switch (ip-&gt;interfaceInfo[i]-&gt;routingProtocolType)</a></div>
      <div class="Code_Segment" style="text-indent: 58.5pt"><a name="1042297">{</a></div>
      <div class="Code_Segment" style="text-indent: 76.5pt"><a name="1042298">case ROUTING_PROTOCOL_BELLMANFORD:</a></div>
      <div class="Code_Segment" style="text-indent: 76.5pt"><a name="1042299">{</a></div>
      <div class="Code_Segment" style="text-indent: 90pt"><a name="1042300">if (node-&gt;appData.bellmanford == NULL)</a></div>
      <div class="Code_Segment" style="text-indent: 90pt"><a name="1042301">{</a></div>
      <div class="Code_Segment" style="text-indent: 103.5pt"><a name="1042302">RoutingBellmanfordInit(node);</a></div>
      <div class="Code_Segment" style="text-indent: 103.5pt"><a name="1042303">RoutingBellmanfordInitTrace(node, nodeInput);</a></div>
      <div class="Code_Segment" style="text-indent: 90pt"><a name="1042304">}</a></div>
      <div class="Code_Segment" style="text-indent: 90pt"><a name="1042305">break;</a></div>
      <div class="Code_Segment" style="text-indent: 76.5pt"><a name="1042306">}</a></div>
      <div class="Code_New"><a name="1042307">               case ROUTING_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1042308">               {</a></div>
      <div class="Code_New"><a name="1042309">                 if (node-&gt;appData.myprotocol == NULL)</a></div>
      <div class="Code_New"><a name="1042310">                 {</a></div>
      <div class="Code_New"><a name="1042311">                    RoutingMyProtocolInit(node);</a></div>
      <div class="Code_New"><a name="1042312">                    RoutingMyProtocolInitTrace(node, nodeInput);</a></div>
      <div class="Code_New"><a name="1042313">                 }</a></div>
      <div class="Code_New"><a name="1042314">                 break;</a></div>
      <div class="Code_New"><a name="1042315">              }</a></div>
      <div class="Code_Segment" style="text-indent: 76.5pt"><a name="1042316">...</a></div>
      <div class="Code_Segment" style="text-indent: 58.5pt"><a name="1042317">}</a></div>
      <div class="Code_Segment" style="text-indent: 58.5pt"><a name="1042318">...</a></div>
      <div class="Code_Segment" style="text-indent: 45pt"><a name="1042319">}</a></div>
      <div class="Code_Segment" style="text-indent: 45pt"><a name="1042320">...</a></div>
      <div class="Code_Segment" style="text-indent: 27pt"><a name="1042321">}</a></div>
      <div class="Code_Segment" style="text-indent: 27pt"><a name="1042322">...</a></div>
      <div class="Code_Segment"><a name="1042288">}</a></div>
      <div class="Figure">FIGURE 4-38.&nbsp;&nbsp;<a name="992712">Calling Routing Protocol Initialization Function from APP_Initialize</a></div>
      <div class="Heading4Numbered">4.2.6.4.3  <a name="992816">Implementing the Protocol Initialization Function</a></div>
      <div class="BodyAfterHead"><a name="1000697">The initialization of an Application Layer routing protocol takes place in the initialization function of the protocol that is called by the Application Layer initialization function APP_Initialize (see </a><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992712', '');" title="Application Layer">Figure&nbsp;4-38</a>). The initialization function of a routing protocol commonly performs the following tasks:</div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000701">Create an instance of the protocol data structure</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000702">Read and store the user-specified configuration parameters</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000703">Initialize the state variables and routing table</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="BulletSymbol">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="1000705">Schedule a timer to itself for starting the protocol</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="1000695">Like all other functions belonging to the protocol, the prototype for the initialization function, RoutingMyprotocolInit, should be included in the protocol's header file, routing_myprotocol.h.</a></div>
      <div class="Heading5Numbered">4.2.6.4.3.1  <a name="932883">Creating an Instance and Reading Configuration Parameters</a></div>
      <div class="BodyAfterHead"><a name="1000718">The initialization function initializes the protocol state. Each protocol has a structure that it uses to store state information. This may include information such as flags, connection information, routing table used by the protocol, etc. </a></div>
      <div class="Body"><a name="1000719">To store the state, declare the structure to hold the protocol state in the header file, routing_myprotocol.h. </a></div>
      <div class="Body"><a name="1000735">Create an instance of the protocol state by allocating memory to the state structure. Bellman-Ford performs this task in its initialization function RoutingBellmanfordInit by calling the function MEM_malloc to allocate memory for the Bellman-Ford data structure </a><span style="font-family: &quot;Courier New&quot;">bellmanford</span>, as shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1001061', '');" title="Application Layer">Figure&nbsp;4-39</a></span>. Refer to files routing_bellmanford.h and routing_bellmanford.cpp in <span class="Variable">QUALNET_HOME</span>/libraries/developer/src<span style="font-weight: bold"> </span>for details.</div>
      <div class="Code_Segment"><a name="1000736">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000737">void RoutingBellmanfordInit(Node *node)</a></div>
      <div class="Code_Segment"><a name="1000738">{</a></div>
      <div class="Code_Segment"><a name="1000739">    Bellmanford *bellmanford;</a></div>
      <div class="Code_Segment"><a name="1000740">    ...</a></div>
      <div class="Code_Segment"><a name="1000741">   </a></div>
      <div class="Code_Segment"><a name="1000742">    bellmanford = (Bellmanford *)</a></div>
      <div class="Code_Segment"><a name="1000743">                    MEM_malloc(sizeof(Bellmanford));</a></div>
      <div class="Code_Segment"><a name="1000744">    node-&gt;appData.bellmanford = (void *) bellmanford;</a></div>
      <div class="Code_Segment"><a name="1000745">    ...</a></div>
      <div class="Code_Segment"><a name="1000746">}</a></div>
      <div class="Figure">FIGURE 4-39.&nbsp;&nbsp;<a name="1001061">Creating Routing Protocol Instance in Initialization Function</a></div>
      <div class="Body"><a name="932913">The next step is to read the user-defined configuration parameters from the input file and store them in the protocol data structure. Since the </a><span class="Variable">QualNet</span> implementation of Bellman-Ford does not have any configurable parameters, we use Fisheye as an example. The Fisheye initialization function RoutingFisheyeInit, shown in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#999444', '');" title="Application Layer">Figure&nbsp;4-40</a></span>, uses the IO functions such as IO_ReadString to read parameter values from the input file and store them in the appropriate fields of the Fisheye protocol data structure <span style="font-family: &quot;Courier New&quot;">FisheyeData</span>. If a value is not specified for a parameter in the input file, RoutingFisheyeInit stores the default value for that parameter. Function Time_ConvertToClock, defined in <span class="Variable">QUALNET_HOME</span>/include/clock.h, converts a string to a <span class="Variable">QualNet</span> clocktype value. Refer to files routing_fisheye.h and routing_fisheye.cpp in <span class="Variable">QUALNET_HOME</span>/libraries/wireless/src<span style="font-weight: bold"> </span>for details. IO_ReadTime and IO_ReadString and other IO functions are defined in <span class="Variable">QUALNET_HOME</span>/include/fileio.h.</div>
      <div class="Code_Segment_Large"><a name="992928">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000761">void</a></div>
      <div class="Code_Segment"><a name="1000762">RoutingFisheyeInit(Node* node, const NodeInput* nodeInput)</a></div>
      <div class="Code_Segment"><a name="1000763">{</a></div>
      <div class="Code_Segment"><a name="1000764">    FisheyeData* fisheye;</a></div>
      <div class="Code_Segment"><a name="1000765">    clocktype randomDelay;</a></div>
      <div class="Code_Segment"><a name="1000766">    char buf[MAX_STRING_LENGTH];</a></div>
      <div class="Code_Segment"><a name="1000767">    BOOL wasFound;</a></div>
      <div class="Code_Segment"><a name="1000768">    int scope;</a></div>
      <div class="Code_Segment"><a name="999438">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000776">    ...</a></div>
      <div class="Code_Segment"><a name="1042356">    IO_ReadString(node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1042357">                  NetworkIpGetInterfaceAddress(node, 0)</a></div>
      <div class="Code_Segment"><a name="1042358">                  nodeInput,</a></div>
      <div class="Code_Segment"><a name="1000784">                  "FISHEYE-INTRA-UPDATE-INTERVAL",</a></div>
      <div class="Code_Segment"><a name="1000785">                  &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="1000786">                  buf);</a></div>
      <div class="Code_Segment"><a name="1000787">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000788">    if (!wasFound) {</a></div>
      <div class="Code_Segment"><a name="1000789">        fisheye-&gt;parameter.intraUpdateInterval =</a></div>
      <div class="Code_Segment"><a name="1000790">            FISHEYE_INTRA_UPDATE_INTERVAL;</a></div>
      <div class="Code_Segment"><a name="1000791">    }</a></div>
      <div class="Code_Segment"><a name="1000792">    else {</a></div>
      <div class="Code_Segment"><a name="1000793">        fisheye-&gt;parameter.intraUpdateInterval =</a></div>
      <div class="Code_Segment"><a name="1000794">            TIME_ConvertToClock(buf);</a></div>
      <div class="Code_Segment"><a name="1000795">    }</a></div>
      <div class="Code_Segment"><a name="1000796">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000797">    IO_ReadString(node-&gt;nodeId,</a></div>
      <div class="Code_Segment"><a name="1042369">                  NetworkIpGetInterfaceAddress(node, 0)</a></div>
      <div class="Code_Segment"><a name="1000799">                  nodeInput,</a></div>
      <div class="Code_Segment"><a name="1000800">                  "FISHEYE-INTER-UPDATE-INTERVAL",</a></div>
      <div class="Code_Segment"><a name="1000801">                  &amp;wasFound,</a></div>
      <div class="Code_Segment"><a name="1000802">                  buf);</a></div>
      <div class="Code_Segment"><a name="1000803">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1000804">    if (!wasFound) {</a></div>
      <div class="Code_Segment"><a name="1000805">        fisheye-&gt;parameter.interUpdateInterval =</a></div>
      <div class="Code_Segment"><a name="1000806">            FISHEYE_INTER_UPDATE_INTERVAL;</a></div>
      <div class="Code_Segment"><a name="1000807">    }</a></div>
      <div class="Code_Segment"><a name="1000808">    else {</a></div>
      <div class="Code_Segment"><a name="1000809">        fisheye-&gt;parameter.interUpdateInterval =</a></div>
      <div class="Code_Segment"><a name="1000810">            TIME_ConvertToClock(buf);</a></div>
      <div class="Code_Segment"><a name="1000779">    }</a></div>
      <div class="Code_Segment"><a name="1000777">    ...</a></div>
      <div class="Code_Segment"><a name="1000830">}</a></div>
      <div class="Figure">FIGURE 4-40.&nbsp;&nbsp;<a name="999444">Reading Configurable Parameters</a></div>
      <div class="Heading5Numbered">4.2.6.4.3.2  <a name="992911">Initializing Timers</a></div>
      <div class="BodyAfterHead"><a name="993010">This is done in the same manner as for a traffic-generating protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932267', '');" title="Application Layer">Section&nbsp;4.2.5.5.3.3</a></span>).</div>
      <div class="Heading5Numbered">4.2.6.4.3.3  <a name="992895">Initializing Tables</a></div>
      <div class="BodyAfterHead"><a name="932976">Most routing protocols initialize their routing tables in the initialization function. This may include allocating memory to the data structure and setting initial values as required. There is not one standard way of implementing a routing table and protocol designers are free to use any data structure well suited to their protocol.</a></div>
      <div class="Body"><a name="932978">Another commonly performed task in the initialization function is to add directly connected networks as permanent routes to the routing table. This can be performed by looping through all the interfaces of the node and writing its network address, interface address, and subnet mask to the routing table. </a></div>
      <div class="Body"><a name="993235">The code snippet from function RoutingBellmanfordInit, shown in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#916629', '');" title="Application Layer">Figure&nbsp;4-41</a></span>, demonstrates how to add directly connected networks to the routing table.</div>
      <div class="Code_Segment"><a name="993244">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999529">void RoutingBellmanfordInit(Node *node)</a></div>
      <div class="Code_Segment"><a name="993246">{</a></div>
      <div class="Code_Segment"><a name="993247">    Bellmanford *bellmanford;</a></div>
      <div class="Code_Segment"><a name="993248">    int i;</a></div>
      <div class="Code_Segment"><a name="993236">    ...</a></div>
      <div class="Code_Segment"><a name="993255">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="993256">    {</a></div>
      <div class="Code_Segment"><a name="993257">        NodeAddress destAddress;</a></div>
      <div class="Code_Segment"><a name="993258">        NodeAddress subnetMask;</a></div>
      <div class="Code_Segment"><a name="993259">        Route *rowPtr;</a></div>
      <div class="Code_Segment"><a name="1042383">        if (NetworkIpGetInterfaceType(node, i) != NETWORK_IPV4</a></div>
      <div class="Code_Segment"><a name="1042384">            &amp;&amp; NetworkIpGetInterfaceType(node, i) != NETWORK_DUAL)</a></div>
      <div class="Code_Segment"><a name="1041140">        {</a></div>
      <div class="Code_Segment"><a name="1041141">            continue;</a></div>
      <div class="Code_Segment"><a name="994309">        }</a></div>
      <div class="Code_Segment"><a name="1041137">        if (NetworkIpIsWiredNetwork(node, i))</a></div>
      <div class="Code_Segment"><a name="993262">        {</a></div>
      <div class="Code_Segment"><a name="993263">            // This is a wiredlink interface.</a></div>
      <div class="Code_Segment"><a name="993264">           destAddress =</a></div>
      <div class="Code_Segment"><a name="999541">               NetworkIpGetInterfaceNetworkAddress(node, i);</a></div>
      <div class="Code_Segment"><a name="993269">           subnetMask =</a></div>
      <div class="Code_Segment"><a name="999542">               NetworkIpGetInterfaceSubnetMask(node, i);</a></div>
      <div class="Code_Segment"><a name="993270">         }</a></div>
      <div class="Code_Segment"><a name="993271">         else</a></div>
      <div class="Code_Segment"><a name="993272">         {</a></div>
      <div class="Code_Segment"><a name="993273">            // This is a wireless interface.</a></div>
      <div class="Code_Segment"><a name="993274">            destAddress =</a></div>
      <div class="Code_Segment"><a name="999545">                NetworkIpGetInterfaceAddress(node, i);</a></div>
      <div class="Code_Segment"><a name="993283">            subnetMask = ANY_DEST;</a></div>
      <div class="Code_Segment"><a name="993284">        }</a></div>
      <div class="Code_Segment"><a name="994314">        if (!FindRoute(bellmanford, destAddress))</a></div>
      <div class="Code_Segment"><a name="993287">         {</a></div>
      <div class="Code_Segment"><a name="993288">            rowPtr = AddRoute(bellmanford,</a></div>
      <div class="Code_Segment"><a name="993289">                       destAddress,</a></div>
      <div class="Code_Segment"><a name="993290">                       subnetMask,</a></div>
      <div class="Code_Segment"><a name="993291">                       NetworkIpGetInterfaceAddress(node, i),</a></div>
      <div class="Code_Segment"><a name="993292">                       i,</a></div>
      <div class="Code_Segment"><a name="993293">                       0);</a></div>
      <div class="Code_Segment"><a name="993295">            rowPtr-&gt;localRoute = TRUE;</a></div>
      <div class="Code_Segment"><a name="994209">         }</a></div>
      <div class="Code_Segment"><a name="994210">         ...</a></div>
      <div class="Code_Segment"><a name="994211">    }</a></div>
      <div class="Code_Segment"><a name="993329">    ...</a></div>
      <div class="Code_Segment"><a name="993330">}</a></div>
      <div class="Figure">FIGURE 4-41.&nbsp;&nbsp;<a name="916629">Adding Directly Connected Networks to the Routing Table</a></div>
      <div class="Heading3Numbered">4.2.6.5  <a name="1002343">Integrating with the Network Layer</a></div>
      <div class="BodyAfterHead"><a name="1041152">All routing protocols, including those running at the Application Layer, interact with the IP protocol at the Network Layer. When a routing protocol is added at the Application Layer, the IP function NetworkRoutingGetAdminDistance needs to be modified. </a></div>
      <div class="Body"><a name="1041153">The IP function NetworkRoutingGetAdminDistance, implemented in network_ip.cpp, returns the administrative distance of a routing protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1000420', '');" title="Application Layer">Section&nbsp;4.2.6.3</a></span>). <a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1002377', '');" title="Application Layer">Figure&nbsp;4-42</a> shows the modifications that need to be made to NetworkRoutingGetAdminDistance to add MYPROTOCOL.</div>
      <div class="Code_Segment"><a name="1002352">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1002353">NetworkRoutingAdminDistanceType NetworkRoutingGetAdminDistance(</a></div>
      <div class="Code_Segment"><a name="1002355">                                      Node *node,</a></div>
      <div class="Code_Segment"><a name="1002356">                                      NetworkRoutingProtocolType type)</a></div>
      <div class="Code_Segment"><a name="1002357">{</a></div>
      <div class="Code_Segment"><a name="1002358">    switch (type)</a></div>
      <div class="Code_Segment"><a name="1002359">    {</a></div>
      <div class="Code_Segment"><a name="1002360">        case ROUTING_PROTOCOL_STATIC:</a></div>
      <div class="Code_Segment"><a name="1002361">        {</a></div>
      <div class="Code_Segment"><a name="1002362">            return ROUTING_ADMIN_DISTANCE_STATIC;</a></div>
      <div class="Code_Segment"><a name="1002363">        }</a></div>
      <div class="Code_Segment"><a name="1002364">        ...</a></div>
      <div class="Code_Segment"><a name="1002365">        case ROUTING_PROTOCOL_BELLMANFORD:</a></div>
      <div class="Code_Segment"><a name="1002366">        {</a></div>
      <div class="Code_Segment"><a name="1002367">            return ROUTING_ADMIN_DISTANCE_BELLMANFORD;</a></div>
      <div class="Code_Segment"><a name="1002368">        }</a></div>
      <div class="Code_New"><a name="1002369">        case ROUTING_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1002370">        {</a></div>
      <div class="Code_New"><a name="1002371">            return ROUTING_ADMIN_DISTANCE_MYPROTOCOL;</a></div>
      <div class="Code_New"><a name="1002372">        }</a></div>
      <div class="Code_Segment"><a name="1002373">        ...</a></div>
      <div class="Code_Segment"><a name="1002374">    }</a></div>
      <div class="Code_Segment"><a name="1002375">}</a></div>
      <div class="Figure">FIGURE 4-42.&nbsp;&nbsp;<a name="1002377">Modifications to Function NetworkRoutingGetAdminDistance</a></div>
      <div class="Heading3Numbered">4.2.6.6  <a name="1001468">Implementing the Event Dispatcher </a></div>
      <div class="BodyAfterHead"><a name="1001469">In this section, we describe the steps for implementing the event dispatcher function for an Application layer routing protocol. </a></div>
      <div class="Body"><a name="1001473">As explained in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%203.04.5.html#933631', '');" title="QualNet Simulator Architecture">Section&nbsp;3.4.2</a></span>, when an event occurs, it is first handled by the node level dispatcher function NODE_ProcessEvent, defined in <span class="Variable">QUALNET_HOME</span>/main/node.cpp. If the event is for the Application Layer, NODE_ProcessEvent calls the Application Layer event dispatcher APP_ProcessEvent, defined in application.cpp. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1001485', '');" title="Application Layer" name="1001477">Section&nbsp;4.2.6.6.1</a></span> describes how to modify the Application Layer dispatcher function to call the routing protocol’s event dispatcher. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1001617', '');" title="Application Layer">Section&nbsp;4.2.6.6.2</a></span> describes how to implement the event dispatcher for the routing protocol.</div>
      <div class="Heading4Numbered">4.2.6.6.1  <a name="1001485">Modifying the Application Layer Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="1001486">Function APP_ProcessEvent</a><span style="font-weight: bold"> </span>implements the Application Layer event dispatcher that informs the appropriate Application Layer protocol of received events. Modify APP_ProcessEvent to call the routing protocol’s event dispatcher when messages for the protocol are received. This modification is the similar to the modification made for a traffic-generating protocol (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987097', '');" title="Application Layer">Section&nbsp;4.2.5.6.1</a></span>), except that there is only one module for a routing protocol. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1001531', '');" title="Application Layer">Figure&nbsp;4-43</a></span> shows the modifications that need to be made to APP_ProcessEvent to call MYPROTOCOL’s event dispatcher function, RoutingMyprotocolLayer</div>
      <div class="Code_Segment"><a name="1001494">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001495">void APP_ProcessEvent(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="1001496">{</a></div>
      <div class="Code_Segment"><a name="1001497">    short protocolType;</a></div>
      <div class="Code_Segment"><a name="1001498">    protocolType = APP_GetProtocolType(node,msg);</a></div>
      <div class="Code_Segment"><a name="1001499">    switch(protocolType)</a></div>
      <div class="Code_Segment"><a name="1001500">    {</a></div>
      <div class="Code_Segment"><a name="1001501">        case APP_ROUTING_BELLMANFORD:</a></div>
      <div class="Code_Segment"><a name="1001502">        {</a></div>
      <div class="Code_Segment"><a name="1001503">            RoutingBellmanfordLayer(node, msg);</a></div>
      <div class="Code_Segment"><a name="1001504">            break;</a></div>
      <div class="Code_Segment"><a name="1001505">        }</a></div>
      <div class="Code_Segment"><a name="1001506">        ...</a></div>
      <div class="Code_New"><a name="1001507">        case APP_ROUTING_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1001518">        {</a></div>
      <div class="Code_New"><a name="1001519">            RoutingMyprotocolLayer(node, msg);</a></div>
      <div class="Code_New"><a name="1001520">            break;</a></div>
      <div class="Code_New"><a name="1001521">        }</a></div>
      <div class="Code_Segment"><a name="1001527">        ...</a></div>
      <div class="Code_Segment"><a name="1001528"> }//switch//</a></div>
      <div class="Code_Segment"><a name="1001529">}</a></div>
      <div class="Figure">FIGURE 4-43.&nbsp;&nbsp;<a name="1001531">Application Layer Event Dispatcher Function</a></div>
      <div class="Heading4Numbered">4.2.6.6.2  <a name="1001617">Implementing the Routing Protocol Event Dispatcher</a></div>
      <div class="BodyAfterHead"><a name="1001618">A protocol's event dispatcher should include a switch on all message types that the protocol may receive. It can then process each message type either inside the switch or by calling a function to handle the message type received. A routing protocol typically handles two types of events: timers and packet events indicating reception of a </a><span style="font-style: italic">routing packet</span> from the Transport Layer. (Routing packets are control packets that carry information for the routing protocol. These routing packets are different from <span style="font-style: italic">data packets</span>, which carry user data.)</div>
      <div class="Body"><a name="1002801">All event types used by </a><span class="Variable">QualNet</span> protocols are enumerated in the file api.h. If the protocol being added needs additional event types, these should be included in the enumeration in file api.h, as described in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987147', '');" title="Application Layer">Section&nbsp;4.2.5.6.2</a></span>. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1001688', '');" title="Application Layer" name="1001619">Figure&nbsp;4-44</a></span> shows the event dispatcher function for Bellman-Ford, RoutingBellmanfordLayer, which is implemented in routing_bellmanford.cpp. <span style="font-family: &quot;Courier New&quot;">MSG_APP_PeriodicUpdateAlarm</span>, <span style="font-family: &quot;Courier New&quot;">MSG_APP_CheckRouteTimeoutAlarm</span>, and <span style="font-family: &quot;Courier New&quot;">MSG_APP_TriggeredUpdateAlarm</span> are timer events, and event <span style="font-family: &quot;Courier New&quot;">MSG_APP_FromTransport</span> indicates arrival of a routing packet from the Transport Layer. Actions taken in response to these events include: updating the IP forwarding table, broadcasting routing information, resetting timers, etc. Look at the implementation for Bellman-Ford or other Application Layer routing protocols to understand how such a protocol works.</div>
      <div class="Body"><a name="1002269">After the message is handled by the event dispatcher, it frees the memory associated with the message by calling the function MESSAGE_Free. </a></div>
      <div class="Note_Indented"><a name="1002273"><img class="Default" src="images/Chapter%204-2.06.1.9.jpg" width="48" height="49" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />It is important to free the memory after the message has been processed; otherwise, the simulator will leak memory.</a></div>
      <div class="Body"><a name="1002274">The event dispatcher also includes a default case in the switch statement to handle messages which contain an undefined event type.</a></div>
      <div class="Code_Segment"><a name="1001629">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001648">void</a></div>
      <div class="Code_Segment"><a name="1001649">RoutingBellmanfordLayer(Node *node, Message *msg)</a></div>
      <div class="Code_Segment"><a name="1001650">{</a></div>
      <div class="Code_Segment"><a name="1001651">    ...</a></div>
      <div class="Code_Segment"><a name="1030287">    switch(msg-&gt;eventType)</a></div>
      <div class="Code_Segment"><a name="1001652">    {</a></div>
      <div class="Code_Segment"><a name="1001653">        // Messages sent within Bellman-Ford.</a></div>
      <div class="Code_Segment"><a name="1001654">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001655">        case MSG_APP_PeriodicUpdateAlarm:</a></div>
      <div class="Code_Segment"><a name="1001656">        {</a></div>
      <div class="Code_Segment"><a name="1001657">            HandlePeriodicUpdateAlarm(node);</a></div>
      <div class="Code_Segment"><a name="1001658">            break;</a></div>
      <div class="Code_Segment"><a name="1001659">        }</a></div>
      <div class="Code_Segment"><a name="1001660">        case MSG_APP_CheckRouteTimeoutAlarm:</a></div>
      <div class="Code_Segment"><a name="1001661">        {</a></div>
      <div class="Code_Segment"><a name="1001662">            HandleCheckRouteTimeoutAlarm(node);</a></div>
      <div class="Code_Segment"><a name="1001663">            break;</a></div>
      <div class="Code_Segment"><a name="1001664">        }</a></div>
      <div class="Code_Segment"><a name="1001665">        case MSG_APP_TriggeredUpdateAlarm:</a></div>
      <div class="Code_Segment"><a name="1001666">        {</a></div>
      <div class="Code_Segment"><a name="1001667">            HandleTriggeredUpdateAlarm(node);</a></div>
      <div class="Code_Segment"><a name="1001668">            break;</a></div>
      <div class="Code_Segment"><a name="1001669">        }</a></div>
      <div class="Code_Segment"><a name="1001670">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001671">        // Messages sent by UDP to Bellman-Ford.</a></div>
      <div class="Code_Segment"><a name="1001672">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001673">        case MSG_APP_FromTransport:</a></div>
      <div class="Code_Segment"><a name="1001674">        {</a></div>
      <div class="Code_Segment"><a name="1001675">            HandleFromTransport(node, msg);</a></div>
      <div class="Code_Segment"><a name="1001676">            break;</a></div>
      <div class="Code_Segment"><a name="1001677">        }</a></div>
      <div class="Code_Segment"><a name="1001678">        default:</a></div>
      <div class="Code_Segment"><a name="1001679">            ERROR_ReportError("Invalid switch value");</a></div>
      <div class="Code_Segment"><a name="1001680">    }</a></div>
      <div class="Code_Segment"><a name="1001681">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001682">    // Done with the message, so free it.</a></div>
      <div class="Code_Segment"><a name="1001683">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1001684">    MESSAGE_Free(node, msg);</a></div>
      <div class="Code_Segment"><a name="1001630">}</a></div>
      <div class="Figure">FIGURE 4-44.&nbsp;&nbsp;<a name="1001688">Event Dispatcher for Bellman-Ford</a></div>
      <div class="Body"><a name="1002331">An Application Layer routing protocol cooperates with IP to perform the routing function. The routing protocol computes the routing information using its routing algorithm, and passes this routing information to IP. This routing information is stored in the IP forwarding table and is used by IP to route packets. Details of computing routing information are protocol-specific, but all Application Layer routing protocols use the following two functions, which are implemented in network_ip.cpp, to maintain the IP forwarding table:</a></div>
      <div class="Numbered__0028first_0029_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered__0028first_0029_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered__0028first_0029_inner"><a name="1002314">NetworkEmptyFowardingTable: This function removes all entries in the forwarding table corresponding to a given routing protocol.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Numbered_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Numbered_inner" style="width: 14.4pt; white-space: nowrap;">
                <span class="StepNumber">2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Numbered_inner"><a name="1002326">NetworkUpdateForwardingTable: This function updates an existing entry or adds a new entry to the forwarding table.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Heading3Numbered">4.2.6.7  <a name="1030667">Collecting and Reporting Statistics</a></div>
      <div class="BodyAfterHead"><a name="1030681">This step is similar to the one for adding a traffic-generating Application Layer protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932624', '');" title="Application Layer">Section&nbsp;4.2.5.7</a></span>).</div>
      <div class="Heading3Numbered">4.2.6.8  <a name="1000895">Finalization</a></div>
      <div class="BodyAfterHead"><a name="993027">The finalization function of the protocol is called by the simulator at the end of simulation. It is the last code that executes during the simulation. This function is responsible for printing statistics to the statistics file.</a></div>
      <div class="Heading4Numbered">4.2.6.8.1  <a name="993085">Modifying the Application Layer Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="993089">This step is similar to the one in </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932770', '');" title="Application Layer">Section&nbsp;4.2.5.8.1</a></span>, except that in the Application Layer finalization function, APP_Finalize, the finalization functions of Application Layer routing protocols are called in the first switch statement and the second switch statement is used to call finalization functions of Application Layer traffic generators. </div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#993150', '');" title="Application Layer" name="993134">Figure&nbsp;4-45</a></span> shows the modifications that need to be made to APP_finalize to call MYPROTOCOL’s finalization function, RoutingMyprotocolFinalize. </div>
      <div class="Code_Segment"><a name="993101">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999564">void APP_Finalize(Node *node)</a></div>
      <div class="Code_Segment"><a name="993103">{</a></div>
      <div class="Code_Segment"><a name="993104">    NetworkDataIp *ip = (NetworkDataIp *) node-&gt;networkData.networkVar;</a></div>
      <div class="Code_Segment"><a name="993105">    ...</a></div>
      <div class="Code_Segment"><a name="993148">    int i;</a></div>
      <div class="Code_Segment"><a name="1079354">    NetworkRoutingProtocolType routingProtocolType;</a></div>
      <div class="Code_Segment"><a name="1079370">    ...</a></div>
      <div class="Code_Segment"><a name="993109">    for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="993110">    {</a></div>
      <div class="Code_Segment"><a name="1030292">        if (ip-&gt;interfaceInfo[i]-&gt;interfaceType == NETWORK_IPV4</a></div>
      <div class="Code_Segment"><a name="1079377">            || ip-&gt;interfaceInfo[i]-&gt;interfaceType == NETWORK_DUAL)</a></div>
      <div class="Code_Segment"><a name="1030293">        {</a></div>
      <div class="Code_Segment"><a name="1030294">            routingProtocolType = ip-&gt;interfaceInfo[i]-&gt;routingProtocolType;</a></div>
      <div class="Code_Segment"><a name="1030290">        }</a></div>
      <div class="Code_Segment"><a name="1030302">        ...</a></div>
      <div class="Code_Segment"><a name="993111">        // Select application-layer routing protocol model and finalize.</a></div>
      <div class="Code_Segment"><a name="993112">        switch (routingProtocolType)</a></div>
      <div class="Code_Segment"><a name="993113">        {</a></div>
      <div class="Code_Segment"><a name="993114">            case ROUTING_PROTOCOL_BELLMANFORD:</a></div>
      <div class="Code_Segment"><a name="993115">            {</a></div>
      <div class="Code_Segment"><a name="993116">                RoutingBellmanfordFinalize(node, i);</a></div>
      <div class="Code_Segment"><a name="993117">                break;</a></div>
      <div class="Code_Segment"><a name="993099">            }</a></div>
      <div class="Code_New"><a name="1001126">            case ROUTING_PROTOCOL_MYPROTOCOL:</a></div>
      <div class="Code_New"><a name="1001127">            {</a></div>
      <div class="Code_New"><a name="1001128">                RoutingMyprotocolFinalize(node, i);</a></div>
      <div class="Code_New"><a name="1001129">                break;</a></div>
      <div class="Code_New"><a name="1001130">            }</a></div>
      <div class="Code_Segment"><a name="993140">            ...</a></div>
      <div class="Code_Segment"><a name="993141">        }</a></div>
      <div class="Code_Segment"><a name="993142">       ...</a></div>
      <div class="Code_Segment"><a name="993143">   }</a></div>
      <div class="Code_Segment"><a name="993144">   ...</a></div>
      <div class="Code_Segment"><a name="993145">}</a></div>
      <div class="Figure">FIGURE 4-45.&nbsp;&nbsp;<a name="993150">Calling Finalization Function of a Routing Protocol</a></div>
      <div class="Heading4Numbered">4.2.6.8.2  <a name="993068"> Implementing the Routing Protocol Finalization Function</a></div>
      <div class="BodyAfterHead"><a name="993069">The finalization function of a routing protocol is similar to that of a traffic-generating protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#932772', '');" title="Application Layer">Section&nbsp;4.2.5.8.2</a></span>). In the finalization function for the routing protocol, RoutingMyprotocolFinalize, call the function to print statistics if routing statistics collection is enabled (<span style="font-family: &quot;Courier New&quot;">appData.routingStats</span> is true). <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1030589', '');" title="Application Layer">Figure&nbsp;4-46</a></span> shows the finalization function for Bellman-Ford, where function PrintStats is called to print statistics for Bellman-Ford.</div>
      <div class="Code_Segment"><a name="993186">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999584">void</a></div>
      <div class="Code_Segment"><a name="993187">RoutingBellmanfordFinalize(Node *node, int interfaceIndex)</a></div>
      <div class="Code_Segment"><a name="993188">{</a></div>
      <div class="Code_Segment"><a name="1030304">    Bellmanford *bellmanford = (Bellmanford *)node-&gt;appData.bellmanford;</a></div>
      <div class="Code_Segment"><a name="1030305">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1030306">    ...</a></div>
      <div class="Code_Segment"><a name="1030313">    if (node-&gt;appData.routingStats == TRUE</a></div>
      <div class="Code_Segment"><a name="1030314">        &amp;&amp; bellmanford-&gt;statsPrinted == FALSE)</a></div>
      <div class="Code_Segment"><a name="1030315">    {</a></div>
      <div class="Code_Segment"><a name="1030316">        PrintStats(node);</a></div>
      <div class="Code_Segment"><a name="1030317">        bellmanford-&gt;statsPrinted = TRUE;</a></div>
      <div class="Code_Segment"><a name="933024">    }</a></div>
      <div class="Code_Segment"><a name="1030325">}</a></div>
      <div class="Figure">FIGURE 4-46.&nbsp;&nbsp;<a name="1030589">Finalization Function of a Routing Protocol</a></div>
      <div class="Heading3Numbered">4.2.6.9  <a name="1030598">Including and Compiling Files</a></div>
      <div class="BodyAfterHead"><a name="1030595">This step is similar to the one for adding a traffic-generating Application Layer protocol (see </a><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#987370', '');" title="Application Layer">Section&nbsp;4.2.5.9</a></span>).</div>
      <div class="Heading2Numbered">4.2.7  <a name="1030590">Special Issues for Application Layer Protocols</a></div>
      <div class="Heading3Numbered">4.2.7.1  <a name="1030592">Port Numbers In </a><span class="Variable">QualNet</span></div>
      <div class="BodyAfterHead"><a name="961065">Just as every IP packet has a source and destination IP address, we must also specify a source and destination port number in every packet. Port numbers have to be in the range of 0-65535. However, known ports are almost always in the range 0-1023. </a></div>
      <div class="Body"><a name="948447">There are two types of port numbers to consider: client port numbers and server port numbers.</a></div>
      <div class="Body"><a name="948448">The client port number can be any port number at or above 1024. A client application may use a different port number each time it connects to a server. The field </a><span style="font-family: &quot;Courier New&quot;">nextPortNum</span> of the data structure <span style="font-family: &quot;Courier New&quot;">AppData</span> stores the next port number available at the node. This field is initialized to 1024 in the initialization function APP_Initialize (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#992712', '');" title="Application Layer">Figure&nbsp;4-38</a></span>). </div>
      <div class="Body"><a name="993459">Most applications in </a><span class="Variable">QualNet</span> choose <span style="font-family: &quot;Courier New&quot;">nextPortNum</span> as the client port number. Each time a client instance is created, it is assigned <span style="font-family: &quot;Courier New&quot;">nextPortNum</span> as its port number and <span style="font-family: &quot;Courier New&quot;">nextPortNum</span> is incremented. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#997997', '');" title="Application Layer">Figure&nbsp;4-20</a></span> shows how this is done for the CBR application. Assigning client port numbers in this manner ensures that each client instance gets a unique port number. </div>
      <div class="Body"><a name="993474">The client needs to know the server’s port number in order to connect to the server. To enable the client to know it's port number the server uses a known port number which may have been agreed upon as a standard. All </a><span class="Variable">QualNet</span> application servers use as their known port number the value that is assigned to their application name in the enumerated data type <span style="font-family: &quot;Courier New&quot;">AppType</span> (see <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#986251', '');" title="Application Layer">Section&nbsp;4.2.3</a></span>). For example, FTP_SERVER uses port number 21 as the destination port at the server.</div>
      <div class="Body"><a name="994587">The API functions for sending data using UDP at the Transport Layer accept the </a><span style="font-family: &quot;Courier New&quot;">AppType</span> of the server as an input parameter and set the destination port to this value. <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#968392', '');" title="Application Layer">Figure&nbsp;4-47</a></span> shows how this is done in the function APP_UdpSendNewdataWithPriority. (This function is implemented in <span class="Variable">QUALNET_HOME</span>/main/app_util.cpp.)</div>
      <div class="Code_Segment"><a name="994591">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999628">APP_UdpSendNewDataWithPriority(</a></div>
      <div class="Code_Segment"><a name="999637">    Node *node,</a></div>
      <div class="Code_Segment"><a name="999638">    AppType appType,</a></div>
      <div class="Code_Segment"><a name="999639">    NodeAddress sourceAddr,</a></div>
      <div class="Code_Segment"><a name="999640">    short sourcePort,</a></div>
      <div class="Code_Segment"><a name="999641">    NodeAddress destAddr,<br />    int outgoingInterface,<br />    char *payload,</a></div>
      <div class="Code_Segment"><a name="999657">    int payloadSize,</a></div>
      <div class="Code_Segment"><a name="999656">    TosType priority,</a></div>
      <div class="Code_Segment"><a name="999655">    clocktype delay,</a></div>
      <div class="Code_Segment"><a name="999650">    TraceProtocolType traceProtocol)</a></div>
      <div class="Code_Segment"><a name="999642">{</a></div>
      <div class="Code_Segment"><a name="999652">    Message *msg;</a></div>
      <div class="Code_Segment"><a name="999651">    AppToUdpSend *info;</a></div>
      <div class="Code_Segment"><a name="1028504">    ActionData acnData;</a></div>
      <div class="Code_Segment"><a name="1028505">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1028506">    msg = MESSAGE_Alloc(</a></div>
      <div class="Code_Segment"><a name="1028507">              node,</a></div>
      <div class="Code_Segment"><a name="1028508">              TRANSPORT_LAYER,</a></div>
      <div class="Code_Segment"><a name="1028509">              TransportProtocol_UDP,</a></div>
      <div class="Code_Segment"><a name="1028510">              MSG_TRANSPORT_FromAppSend);</a></div>
      <div class="Code_Segment"><a name="1028512">    MESSAGE_PacketAlloc(node, msg, payloadSize, traceProtocol);</a></div>
      <div class="Code_Segment"><a name="1028514">    memcpy(MESSAGE_ReturnPacket(msg), payload, payloadSize);</a></div>
      <div class="Code_Segment"><a name="1028516">    MESSAGE_InfoAlloc(node, msg, sizeof(AppToUdpSend));</a></div>
      <div class="Code_Segment"><a name="1028517">    info = (AppToUdpSend *) MESSAGE_ReturnInfo(msg);</a></div>
      <div class="Code_Segment"><a name="1028519">    SetIPv4AddressInfo(&amp;info-&gt;sourceAddr, sourceAddr);</a></div>
      <div class="Code_Segment"><a name="1029315">    info-&gt;sourcePort = sourcePort;</a></div>
      <div class="Code_Segment"><a name="1028522">    SetIPv4AddressInfo(&amp;info-&gt;destAddr, destAddr);</a></div>
      <div class="Code_Segment"><a name="1028523">    info-&gt;destPort = (short) appType;</a></div>
      <div class="Code_Segment"><a name="1028525">    info-&gt;priority = priority;</a></div>
      <div class="Code_Segment"><a name="1028526">    info-&gt;outgoingInterface = outgoingInterface;</a></div>
      <div class="Code_Segment"><a name="1028527">&nbsp;</a></div>
      <div class="Code_Segment"><a name="1028528">    //Trace Information</a></div>
      <div class="Code_Segment"><a name="1028529">    acnData.actionType = SEND;</a></div>
      <div class="Code_Segment"><a name="1028530">    acnData.actionComment = NO_COMMENT;</a></div>
      <div class="Code_Segment"><a name="1028531">    TRACE_PrintTrace(node, msg, TRACE_APPLICATION_LAYER,</a></div>
      <div class="Code_Segment"><a name="1028532">                     PACKET_OUT, &amp;acnData);</a></div>
      <div class="Code_Segment"><a name="999645">    MESSAGE_Send(node, msg, delay);</a></div>
      <div class="Code_Segment"><a name="999648">}</a></div>
      <div class="Figure">FIGURE 4-47.&nbsp;&nbsp;<a name="968392">Setting Port Numbers in API Calls</a></div>
      <div class="Heading4Numbered">4.2.7.1.1  <a name="948523">Overriding AppType as Destination Port</a></div>
      <div class="BodyAfterHead"><a name="948524">While it is recommended to use AppType as the destination port, it is possible to override this assignment and make a connection to a different port number. Though port numbers do not alter the statistics of an experiment, an application may need to use a specific port to facilitate tracing or for some special post processing scripts.</a></div>
      <div class="Body"><span class="Variable"><a name="1029364">QualNet</a></span> provides several API function to enable overriding <span style="font-family: &quot;Courier New&quot;">AppType</span> as a destination port. Some of these are listed in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1029375', '');" title="Application Layer">Table&nbsp;4-5</a></span>. These APIs accept the desired destination port number as a parameter. Note that the first two functions listed in the table are overloaded functions. These functions are implemented in app_util.cpp.</div>
      <table class="Format_A" style="text-align: left; width: 432pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-5.&nbsp;&nbsp;<a name="1029375">Examples of API Functions to Override Default Port Numbers&nbsp;</a></div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 216pt">
            <div class="CellHeading"><a name="1029379">Function </a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 216pt">
            <div class="CellHeading"><a name="1029381">Description</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029383">AppInfo *<br />APP_RegisterNewApp(</a></div>
            <div class="CellBody"><a name="1029384">   Node *node, <br />   AppType appType, <br />   void *dataPtr, <br />   short myPort)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029386">Registers the application. Additionally inserts the port number (myPort) in the PortTable. </a></div>
            <div class="CellBody"><a name="1029387">&nbsp;</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029389">void<br />APP_UdpSendNewHeaderVirtualDataWithPriority(</a></div>
            <div class="CellBody" style="margin-bottom: 0.0pt"><a name="1029390">    Node *node,<br />    NodeAddress sourceAddr,<br />    short sourcePort,<br />    NodeAddress destAddr,<br />    short destinationPort,<br />    char *header<br />    int headerSize,<br />    int payloadSize,<br />    TosType priority,<br />    clocktype delay,<br />    TraceProtocolType traceProtocol)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029392">Allocates header and virtual data with specified priority and sends to UDP. Delivers data to a particular destination port at the destination node. The destination port need not be the same as the AppType value.</a></div>
            <div class="CellBody"><a name="1029393">&nbsp;</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029395">void<br />APP_TcpOpenConnectionWithPriority(</a></div>
            <div class="CellBody" style="margin-bottom: 0.0pt"><a name="1029396">    Node *node,<br />    AppType appType,<br />    NodeAddress localAddr,<br />    short localPort,<br />    NodeAddress remoteAddr,<br />    short remotePort,<br />    int uniqueId,<br />    clocktype waitTime,<br />    TosType priority)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029398">Opens a TCP connection with a specified priority and to a specified server port, which need not be the same as the AppType value. </a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029400">void<br />APP_TcpServerListen(</a></div>
            <div class="CellBody" style="margin-bottom: 0.0pt"><a name="1029401">    Node *node,<br />    AppType appType,<br />    NodeAddress serverAddr,<br />    short serverPort)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029403">Listens on a specified server port which need not be the same as the AppType value.</a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><span class="Variable"><a name="1029405">QualNet</a></span> provides several functions to manage port number assignment. These functions are listed in <span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1029413', '');" title="Application Layer">Table&nbsp;4-6</a></span> and are implemented in app_util.cpp.</div>
      <table class="Format_A" style="text-align: left; width: 432pt" cellspacing="0" summary="">
        <caption>
          <div class="TableTitle">TABLE 4-6.&nbsp;&nbsp;<a name="1029413">Functions to Support Overriding of Default Port Numbers</a></div>
        </caption>
        <tr>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 216pt">
            <div class="CellHeading"><a name="1029417">Function </a></div>
          </td>
          <td style="background-color: #E6E6E6; border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: bottom; width: 216pt">
            <div class="CellHeading"><a name="1029419">Description</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029421">short APP_GetFreePort(Node *node)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029423">Returns a free port.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029425">BOOL APP_IsFreePort(</a></div>
            <div class="CellBody"><a name="1029426">   Node* node, <br />   unsigned short portNumber)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029428">Checks if the port number is free or in use. Also checks if there is an application running at the node that uses an AppType that has been assigned the same value as this port number. This is done since applications may use AppType as destination port.</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029430">void APP_InserInPortTable(</a></div>
            <div class="CellBody"><a name="1029431">   Node* node, <br />   AppType appType,<br />   unsigned short myPort)</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #000000; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #000000; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #000000; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 2pt; padding-left: 6pt; padding-right: 6pt; padding-top: 4pt; vertical-align: top">
            <div class="CellBody"><a name="1029433">Inserts information about the port number and the application using it in the port table. This function is called when registering an application at a new port by using APP_RegisterNewApp.</a></div>
          </td>
        </tr>
      </table>
      <div class="Heading3Numbered">4.2.7.2  <a name="1003009">Setting Address for Broadcast Messages</a></div>
      <div class="BodyAfterHead"><a name="990658">For broadcasting packets, the destination address can be set to </a><span style="font-family: &quot;Courier New&quot;">ANY_DEST</span>, or the library function NetworkIpGetInterfaceBroadcastAddress can be used to get the interface broadcast address. <span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> is a constant defined in <span class="Variable">QUALNET_HOME</span>/include/main.h and stands for any destination. Function NetworkIpGetInterfaceBroadcastAddress is defined in network_ip.h, and returns the broadcast address of the specified interface.</div>
      <div class="Body"><span class="Cross-Ref"><a href="javascript:WWHClickedPopup('Programmers_Guide', 'Chapter%204-2.html#1005437', '');" title="Application Layer" name="994216">Figure&nbsp;4-48</a></span> shows a code snippet from the Bellman-Ford function SendRouteAdvertisement (implemented in file routing_bellmanford.cpp) that sets the destination address to the interface broadcast address for the wired interface and to <span style="font-family: &quot;Courier New&quot;">ANY_DEST</span> for the wireless interface. </div>
      <div class="Code_Segment"><a name="995871">&nbsp;</a></div>
      <div class="Code_Segment"><a name="999695">static void SendRouteAdvertisement(Node *node, RouteAdvertisementType type)</a></div>
      <div class="Code_Segment"><a name="995873">{</a></div>
      <div class="Code_Segment"><a name="995875">  ...</a></div>
      <div class="Code_Segment"><a name="995876">  int i;</a></div>
      <div class="Code_Segment"><a name="995877">  for (i = 0; i &lt; node-&gt;numberInterfaces; i++)</a></div>
      <div class="Code_Segment"><a name="995878">    {</a></div>
      <div class="Code_Segment"><a name="995879">      NodeAddress destAddress;</a></div>
      <div class="Code_Segment"><a name="995880">      ...</a></div>
      <div class="Code_Segment"><a name="995881">      if (NetworkIpIsWiredNetwork (node, i))</a></div>
      <div class="Code_Segment"><a name="995882">      {</a></div>
      <div class="Code_Segment"><a name="1041212">          destAddress = NetworkIpGetInterfaceBroadcastAddress(node, i);</a></div>
      <div class="Code_Segment"><a name="1041213">			  }</a></div>
      <div class="Code_Segment"><a name="1041214">     			else</a></div>
      <div class="Code_Segment"><a name="995887">     {</a></div>
      <div class="Code_Segment"><a name="995888">         destAddress = ANY_DEST;</a></div>
      <div class="Code_Segment"><a name="995889">     }</a></div>
      <div class="Code_Segment"><a name="995890">   ...</a></div>
      <div class="Code_Segment"><a name="995891">   }</a></div>
      <div class="Code_Segment"><a name="995892">  ...</a></div>
      <div class="Code_Segment"><a name="995893">}</a></div>
      <div class="Figure">FIGURE 4-48.&nbsp;&nbsp;<a name="1005437">Setting Broadcast Address</a></div>
      <div class="Body"><a name="1040278">&nbsp;</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <hr align="left" />
    <table align="left">
      <tr>
        <td class="WebWorks_Company_Phone_Bottom">© 2008 - 2012 SCALABLE Network Technologies, Inc. All rights reserved.</td>
      </tr>
    </table>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>